<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Trey Buyback</title>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" onerror="window.emailjs={init:()=>{},send:()=>Promise.reject()}"></script>

<style>
:root{
  --bg:#070707;--dark:#0c0c0c;--card:#111;--card2:#171717;
  --border:#1c1c1c;--border2:#282828;
  --gold:#e8c04a;--gold2:#f5d98a;--green:#3ddc84;--red:#ff4545;
  --blue:#4a9eff;--purple:#a855f7;--orange:#ff8c42;--teal:#2dd4bf;
  --text:#f0f0f0;--muted:#555;--sub:#1e1e1e;
  --D:system-ui,-apple-system,'Helvetica Neue',sans-serif;--M:'Courier New',Courier,monospace;--S:system-ui,-apple-system,'Helvetica Neue',sans-serif;
  --topH:50px;--navH:54px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:var(--S);-webkit-text-size-adjust:100%}
button{font-family:inherit;cursor:pointer;-webkit-tap-highlight-color:transparent}
a{text-decoration:none;color:inherit;-webkit-tap-highlight-color:transparent}
input,select,textarea{font-family:inherit}

/* TOPBAR ‚Äî fixed at top */
.topbar{position:fixed;top:0;left:0;right:0;height:var(--topH);background:var(--dark);border-bottom:1px solid var(--border);z-index:50;display:flex;align-items:center;justify-content:space-between;padding:0 16px}
.logo{font-family:var(--D);font-size:20px;letter-spacing:4px;color:var(--gold);font-weight:800;text-transform:uppercase}
.logo span{color:var(--text)}
.top-right{display:flex;align-items:center;gap:8px}
.badge{font-family:var(--M);font-size:9px;background:rgba(232,192,74,.1);border:1px solid rgba(232,192,74,.3);color:var(--gold);padding:3px 8px;border-radius:2px;letter-spacing:1px}
.icon-btn{background:none;border:1px solid var(--border2);border-radius:2px;color:var(--muted);padding:5px 9px;font-size:14px}
#topDate{font-size:11px;color:var(--muted)}

/* SIDEBAR ‚Äî fixed left, desktop only */
.sidebar{position:fixed;top:var(--topH);left:0;bottom:0;width:190px;background:var(--dark);border-right:1px solid var(--border);overflow-y:auto;z-index:40;display:flex;flex-direction:column;-webkit-overflow-scrolling:touch}
.nav-section{padding:14px 12px 3px;font-family:var(--M);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--muted)}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 13px;font-size:13px;color:#888;border-left:2px solid transparent;transition:color .1s;background:none;border-top:none;border-right:none;border-bottom:none;width:100%;text-align:left}
.nav-item:active{background:rgba(255,255,255,.03)}
.nav-item.active{background:rgba(232,192,74,.07);color:var(--gold);border-left-color:var(--gold)}
.nav-icon{font-size:14px;width:16px;text-align:center}
.nc{margin-left:auto;font-family:var(--M);font-size:10px;background:var(--sub);color:var(--muted);padding:2px 6px;border-radius:10px}
.nc.hot{background:rgba(255,69,69,.2);color:var(--red)}
.nc.ai{background:rgba(168,85,247,.2);color:var(--purple)}
.nc.live{background:rgba(45,212,191,.2);color:var(--teal)}

/* SHELL ‚Äî the area below topbar, right of sidebar */
.shell{margin-left:190px;margin-top:var(--topH)}

/* PAGES */
.page{display:none}
.page.active{display:block}
.ph{padding:14px 16px 12px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
.pt{font-family:var(--D);font-size:22px;letter-spacing:3px;font-weight:800;text-transform:uppercase}
.ps{font-size:11px;color:var(--muted);margin-top:1px;font-family:var(--M)}
.ha{display:flex;gap:7px;flex-wrap:wrap;justify-content:flex-end}
.scroll-area{padding:12px 16px 100px}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:2px;border:none;font-size:13px;font-weight:500;transition:all .1s;white-space:nowrap}
.btn-gold{background:var(--gold);color:#000}
.btn-gold:hover{background:var(--gold2)}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--text)}
.btn-ghost:hover{border-color:#444}
.btn-purple{background:rgba(168,85,247,.15);border:1px solid rgba(168,85,247,.3);color:var(--purple)}
.btn-teal{background:rgba(45,212,191,.15);border:1px solid rgba(45,212,191,.3);color:var(--teal)}
.btn-sm{padding:5px 10px;font-size:12px}
.btn-danger{background:rgba(255,69,69,.1);border:1px solid rgba(255,69,69,.25);color:var(--red)}
.btn-green{background:rgba(61,220,132,.1);border:1px solid rgba(61,220,132,.25);color:var(--green)}

/* STATS */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:12px 16px;flex-shrink:0}
.sc{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:13px 14px}
.sl{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px}
.sv{font-family:var(--D);font-size:30px;letter-spacing:1px;line-height:1}
.sv.gold{color:var(--gold)}.sv.green{color:var(--green)}.sv.red{color:var(--red)}.sv.blue{color:var(--blue)}

/* CARDS & PANELS */
.panel{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:14px;margin-bottom:10px}
.panel-title{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:10px;display:flex;align-items:center;justify-content:space-between}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px}

/* TABLE */
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);background:var(--bg);white-space:nowrap}
tbody tr{border-bottom:1px solid var(--border);transition:background .1s}
tbody tr:hover{background:rgba(255,255,255,.02)}
td{padding:9px 10px;vertical-align:middle}

/* PILLS */
.pill{display:inline-block;padding:2px 8px;border-radius:2px;font-size:9px;font-family:var(--M);letter-spacing:1px;text-transform:uppercase}
.p-new{background:rgba(74,158,255,.12);color:var(--blue);border:1px solid rgba(74,158,255,.25)}
.p-active{background:rgba(232,192,74,.1);color:var(--gold);border:1px solid rgba(232,192,74,.25)}
.p-closed{background:rgba(61,220,132,.1);color:var(--green);border:1px solid rgba(61,220,132,.25)}
.p-lost{background:rgba(255,69,69,.1);color:var(--red);border:1px solid rgba(255,69,69,.25)}
.p-follow{background:rgba(168,85,247,.1);color:var(--purple);border:1px solid rgba(168,85,247,.25)}

/* FORMS */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:9px}
.form-row.single{grid-template-columns:1fr}
.field label{display:block;font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:4px}
.field input,.field select,.field textarea{width:100%;background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:12px;padding:8px 10px;outline:none;-webkit-appearance:none;appearance:none}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--gold)}
.field select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23555' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 9px center;padding-right:26px}
.field textarea{resize:vertical;min-height:65px}

/* MODALS */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:200;display:none;align-items:flex-end;justify-content:center}
.overlay.open{display:flex}
.modal{background:var(--card);border:1px solid var(--border2);border-radius:2px 2px 0 0;width:100%;max-width:580px;max-height:92vh;overflow-y:auto;animation:slideUp .2s ease}
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.mh{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--card);z-index:2}
.mt{font-family:var(--D);font-size:20px;letter-spacing:1px}
.mc{background:none;border:none;color:var(--muted);font-size:22px;line-height:1;padding:0 4px}
.mb{padding:16px}
.mf{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px;position:sticky;bottom:0;background:var(--card)}

/* PIPELINE */
.pipeline{display:grid;grid-template-columns:repeat(5,minmax(145px,1fr));gap:8px;padding:12px 16px 80px;overflow-x:auto;min-height:200px}
.pipe-col{background:var(--card);border:1px solid var(--border);border-radius:2px;display:flex;flex-direction:column}
.pipe-head{padding:9px 11px;border-bottom:1px solid var(--border);font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;justify-content:space-between}
.pipe-cards{padding:7px;display:flex;flex-direction:column;gap:6px;min-height:80px}
.pipe-card{background:var(--card2);border:1px solid var(--border2);border-radius:2px;padding:9px 10px;text-align:left;width:100%;border-top:1px solid var(--border2)}

/* AI */
.ai-outer{display:flex;flex-direction:column;padding:12px 16px 80px;min-height:60vh}
.ai-modes{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px;flex-shrink:0}
.ai-mode-btn{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:10px 8px;text-align:center}
.ai-mode-btn.active{border-color:var(--purple);background:rgba(168,85,247,.07)}
.ai-mode-icon{font-size:18px;margin-bottom:3px}
.ai-mode-label{font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--muted)}
.ai-mode-btn.active .ai-mode-label{color:var(--purple)}
.ai-qbtns{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:9px;flex-shrink:0}
.ai-qbtn{background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:#888;font-size:11px;font-family:var(--M);padding:4px 9px}
.ai-qbtn:hover{border-color:var(--purple);color:var(--purple)}
.ai-chat{overflow-y:auto;display:flex;flex-direction:column;gap:10px;margin-bottom:10px;min-height:200px;max-height:50vh}
.ai-msg{display:flex;gap:8px;align-items:flex-start}
.ai-msg.user{flex-direction:row-reverse}
.ai-av{width:26px;height:26px;border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.ai-av.bot{background:rgba(168,85,247,.18);border:1px solid rgba(168,85,247,.3)}
.ai-av.user{background:var(--gold);color:#000;font-family:var(--D);font-size:13px}
.ai-bubble{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:10px 12px;font-size:13px;line-height:1.75;max-width:86%}
.ai-bubble.user{background:rgba(232,192,74,.07);border-color:rgba(232,192,74,.2)}
.ai-bubble.bot{border-left:2px solid var(--purple)}
.ai-bubble strong{color:var(--gold)}
.ai-input-row{display:flex;gap:7px;flex-shrink:0}
.ai-input{flex:1;background:var(--card);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--S);font-size:13px;padding:9px 12px;outline:none;resize:none}
.ai-input:focus{border-color:var(--purple)}
.ai-send{background:var(--purple);border:none;border-radius:2px;color:#fff;padding:9px 14px;font-size:15px;flex-shrink:0}
.ai-send:disabled{opacity:.4}
.dots span{display:inline-block;width:4px;height:4px;border-radius:50%;background:var(--purple);animation:dot 1.2s infinite;margin:0 1px}
.dots span:nth-child(2){animation-delay:.2s}.dots span:nth-child(3){animation-delay:.4s}
@keyframes dot{0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1}}

/* PRICE CHECKER */
.search-bar{display:flex;gap:7px;margin-bottom:12px;flex-wrap:wrap}
.search-bar input{flex:1;min-width:180px;background:var(--card);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:13px;padding:10px 12px;outline:none}
.search-bar select{background:var(--card);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:12px;padding:9px 26px 9px 11px;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23555' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 9px center}
.cat-tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:12px;overflow-x:auto;gap:0}
.ecat-btn{padding:8px 13px;font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);border:none;border-bottom:2px solid transparent;white-space:nowrap;background:none;margin-bottom:-1px}
.ecat-btn.active{color:var(--teal);border-bottom-color:var(--teal)}
.price-hero{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--border);border:1px solid var(--border);border-radius:2px;overflow:hidden;margin-bottom:12px}
.ph-cell{background:var(--card);padding:16px 14px}
.ph-label{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px}
.ph-val{font-family:var(--D);font-size:34px;letter-spacing:1px}
.ph-val.gold{color:var(--gold)}.ph-val.green{color:var(--green)}.ph-val.orange{color:var(--orange)}
.ext-links{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.ext-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px;text-align:center;display:block;transition:all .1s}
.ext-card:hover{border-color:#333}
.ext-icon{font-size:20px;margin-bottom:4px}
.ext-label{font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--text)}
.ext-sub{font-size:10px;color:var(--muted);margin-top:2px}
.listing-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px 13px;margin-bottom:7px;display:flex;align-items:flex-start;gap:11px}
.listing-thumb{width:48px;height:48px;border-radius:2px;object-fit:cover;background:var(--card2);flex-shrink:0;border:1px solid var(--border)}
.listing-info{flex:1;min-width:0}
.listing-title{font-size:13px;font-weight:500;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.listing-meta{font-family:var(--M);font-size:10px;color:var(--muted)}
.listing-price{text-align:right;flex-shrink:0}
.lp-amt{font-family:var(--D);font-size:26px;color:var(--gold)}
.lp-net{font-family:var(--M);font-size:10px;color:var(--green)}
.plat-tag{font-family:var(--M);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:1px;display:inline-block;margin-top:3px}
.pt-ebay{background:rgba(232,192,74,.1);color:var(--gold);border:1px solid rgba(232,192,74,.2)}
.pt-swappa{background:rgba(61,220,132,.1);color:var(--green);border:1px solid rgba(61,220,132,.2)}
.pt-fb{background:rgba(74,158,255,.1);color:var(--blue);border:1px solid rgba(74,158,255,.2)}
.fee-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px}
.fee-row:last-child{border-bottom:none}
.fee-key{color:#999}
.fee-val{font-family:var(--M);font-size:12px}

/* FLIP CALC */
.cbtn{background:var(--card2);border:1px solid var(--border2);border-radius:2px;font-family:var(--M);font-size:10px;padding:6px 1px;text-align:center}
.cbtn.sel{background:var(--gold);border-color:var(--gold);color:#000}
.tog{width:32px;height:17px;background:var(--card2);border:1px solid var(--border2);border-radius:9px;position:relative;flex-shrink:0;padding:0}
.tog-thumb{position:absolute;width:11px;height:11px;background:var(--muted);border-radius:50%;top:2px;left:2px;transition:all .15s;pointer-events:none}
.tog.on{background:var(--red);border-color:var(--red)}
.tog.on .tog-thumb{left:17px;background:#fff}

/* INVENTORY */
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(185px,1fr));gap:9px}
.inv-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px}

/* FOLLOW-UPS */
.fu-item{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:11px 13px;margin-bottom:7px;display:flex;align-items:center;gap:11px}
.fu-av{width:32px;height:32px;border-radius:2px;background:var(--gold);display:flex;align-items:center;justify-content:center;font-family:var(--D);font-size:14px;color:#000;flex-shrink:0}

/* PLAYBOOK */
.pb-tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:12px;overflow-x:auto}
.pb-tab-btn{padding:8px 13px;font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);border:none;border-bottom:2px solid transparent;white-space:nowrap;background:none;margin-bottom:-1px}
.pb-tab-btn.active{color:var(--gold);border-bottom-color:var(--gold)}
.pb-sec{display:none}.pb-sec.active{display:block}
.funnel{display:flex;flex-direction:column;align-items:center;margin:14px 0}
.funnel-step{width:100%;max-width:460px;padding:13px 20px;text-align:center;border:none}
.fs-title{font-family:var(--D);font-size:22px;letter-spacing:2px;color:#000}
.fs-sub{font-size:11px;color:rgba(0,0,0,.6);margin-top:1px}
.f1{background:#4a8fd4;clip-path:polygon(0 0,100% 0,90% 100%,10% 100%)}
.f2{background:#6aaa6a;clip-path:polygon(10% 0,90% 0,80% 100%,20% 100%)}
.f3{background:#d4854a;clip-path:polygon(20% 0,80% 0,70% 100%,30% 100%)}
.f4{background:#d4b840;clip-path:polygon(30% 0,70% 0,60% 100%,40% 100%)}
.ftip{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px;margin-top:8px;display:none}
.ftip.open{display:block}
.scard{background:var(--card);border:1px solid var(--border);border-radius:2px;margin-bottom:7px;overflow:hidden}
.scard-btn{padding:10px 13px;display:flex;align-items:center;justify-content:space-between;width:100%;background:var(--card2);border:none;text-align:left;border-bottom:1px solid transparent}
.scard-b{display:none;padding:13px}
.scard-b.open{display:block}
.smsg{background:var(--card2);border-left:2px solid var(--gold);padding:8px 11px;margin:6px 0;font-size:13px;color:var(--gold2);line-height:1.7}
.smsg.good{border-left-color:var(--green);color:#b8f0d0}
.snote{font-size:12px;color:var(--muted);line-height:1.6;margin:5px 0}
.obj-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:13px;margin-bottom:8px}
.obj-sit{font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--orange);margin-bottom:6px}
.obj-ex{background:rgba(255,140,66,.07);border:1px solid rgba(255,140,66,.2);border-radius:2px;padding:8px 11px;font-size:13px;color:#e0a070;margin-bottom:8px;font-style:italic}
.obj-res{background:rgba(61,220,132,.07);border-left:2px solid var(--green);padding:8px 11px;font-size:13px;color:#b0f0d0;line-height:1.7}
.apr-step{display:flex;gap:11px;margin-bottom:13px}
.apr-num{width:24px;height:24px;border-radius:2px;background:var(--gold);color:#000;font-family:var(--D);font-size:15px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.apr-content h4{font-size:13px;font-weight:600;margin-bottom:2px}
.apr-content p{font-size:12px;color:#999;line-height:1.7}
.tip-box{background:rgba(74,158,255,.07);border:1px solid rgba(74,158,255,.2);border-radius:2px;padding:7px 10px;font-size:11px;color:#90c4ff;margin-top:5px}
.buyer-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}
.buyer-row:last-child{border-bottom:none}

/* ALERTS */
.alert-item{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:10px 12px;margin-bottom:7px;display:flex;align-items:flex-start;gap:10px}
.alert-hot{border-left:2px solid var(--gold)}

/* SETTINGS */
.set-sec{margin-bottom:20px}
.set-sec-title{font-family:var(--M);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--muted);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.key-input{width:100%;background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:11px;padding:8px 10px;outline:none;margin-top:5px}
.ks{display:inline-flex;align-items:center;gap:5px;font-family:var(--M);font-size:10px;padding:3px 9px;border-radius:2px;margin-top:6px}
.ks.ok{background:rgba(61,220,132,.1);color:var(--green);border:1px solid rgba(61,220,132,.25)}
.ks.missing{background:rgba(255,69,69,.1);color:var(--red);border:1px solid rgba(255,69,69,.25)}

/* MOBILE NAV */
.mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;height:54px;background:var(--dark);border-top:1px solid var(--border);z-index:100}
.mob-nav-inner{display:flex;height:100%}
.mob-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;color:var(--muted);font-size:8px;font-family:var(--M);letter-spacing:1px;text-transform:uppercase;border:none;border-top:2px solid transparent;background:none;padding:4px 0}
.mob-btn.active{color:var(--gold);border-top-color:var(--gold)}
.mob-icon{font-size:17px;line-height:1}

/* EMPTY */
.empty{text-align:center;padding:45px 20px;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px}
.empty-icon{font-size:28px;margin-bottom:8px;opacity:.3}

/* TOAST */
.toast{position:fixed;bottom:66px;right:14px;background:var(--card2);border:1px solid var(--border2);border-radius:2px;padding:9px 14px;font-size:12px;z-index:300;transform:translateY(8px);opacity:0;transition:all .18s;pointer-events:none;max-width:280px}
.toast.show{transform:translateY(0);opacity:1}
.toast.success{border-left:2px solid var(--green)}
.toast.error{border-left:2px solid var(--red)}
.toast.info{border-left:2px solid var(--teal)}

::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--sub);border-radius:2px}

@media(max-width:768px){
  .sidebar{display:none}
  .shell{margin-left:0;margin-top:var(--topH)}
  .mob-nav{display:block}
  .stats-row{grid-template-columns:1fr 1fr;gap:7px;padding:10px 12px}
  .sv{font-size:26px}
  .two-col,.three-col{grid-template-columns:1fr}
  .scroll-area{padding-left:12px;padding-right:12px;padding-bottom:80px}
  .pipeline{grid-template-columns:repeat(5,minmax(140px,1fr));padding:10px 12px 80px;overflow-x:auto}
  .ai-outer{padding:0 12px 80px}
  .form-row{grid-template-columns:1fr}
  .hm{display:none}
  .inv-grid{grid-template-columns:1fr 1fr}
  .price-hero{grid-template-columns:1fr 1fr}
  .toast{bottom:62px;right:10px;left:10px;max-width:none}
}
@media(max-width:480px){
  .ai-modes{grid-template-columns:repeat(2,1fr)}
  .inv-grid{grid-template-columns:1fr}
  .price-hero{grid-template-columns:1fr}
  .ext-links{grid-template-columns:1fr 1fr}
  .search-bar{flex-direction:column}
}
</style>

</head>
<body>

<div class="topbar">
  <div class="logo">TREY <span>BUYBACK</span></div>
  <div class="top-right">
    <div class="badge">PRO</div>
    <div id="topDate"></div>
    <button class="icon-btn" onclick="openModal('settings')">‚öô</button>
  </div>
</div>

<div class="shell">
  <!-- SIDEBAR (desktop) -->
  <div class="sidebar">
    <div class="nav-section">Main</div>
    <button class="nav-item active" id="si-dashboard" onclick="nav('dashboard')"><span class="nav-icon">üìä</span><span>Dashboard</span></button>
    <button class="nav-item" id="si-leads" onclick="nav('leads')"><span class="nav-icon">üë•</span><span>Leads</span><span class="nc hot" id="nc-leads">0</span></button>
    <button class="nav-item" id="si-pipeline" onclick="nav('pipeline')"><span class="nav-icon">üîÄ</span><span>Pipeline</span></button>
    <button class="nav-item" id="si-followups" onclick="nav('followups')"><span class="nav-icon">‚è∞</span><span>Follow-Ups</span><span class="nc" id="nc-fu">0</span></button>
    <div class="nav-section">Tools</div>
    <button class="nav-item" id="si-ai" onclick="nav('ai')"><span class="nav-icon">ü§ñ</span><span>AI Assistant</span><span class="nc ai">AI</span></button>
    <button class="nav-item" id="si-prices" onclick="nav('prices')"><span class="nav-icon">üîç</span><span>Price Checker</span><span class="nc live">LIVE</span></button>
    <button class="nav-item" id="si-calc" onclick="nav('calc')"><span class="nav-icon">üßÆ</span><span>Flip Calc</span></button>
    <button class="nav-item" id="si-inventory" onclick="nav('inventory')"><span class="nav-icon">üì¶</span><span>Inventory</span></button>
    <button class="nav-item" id="si-alerts" onclick="nav('alerts')"><span class="nav-icon">üîî</span><span>Alerts</span><span class="nc" id="nc-alerts">0</span></button>
    <div class="nav-section">Learn</div>
    <button class="nav-item" id="si-playbook" onclick="nav('playbook')"><span class="nav-icon">üìö</span><span>Playbook</span></button>
    <div class="nav-section">Reports</div>
    <button class="nav-item" id="si-profits" onclick="nav('profits')"><span class="nav-icon">üí∞</span><span>Profits</span></button>
  </div>

  <!-- MAIN -->

  <div class="main">

```
<!-- DASHBOARD -->
<div class="page active" id="page-dashboard">
  <div class="ph">
    <div><div class="pt">DASHBOARD</div><div class="ps" id="dashGreet">Ready to flip?</div></div>
    <div class="ha">
      <button class="btn btn-purple btn-sm" onclick="nav('ai')">ü§ñ AI</button>
      <button class="btn btn-gold" onclick="openModal('addLead')">+ Lead</button>
    </div>
  </div>
  <div class="stats-row">
    <div class="sc"><div class="sl">Leads</div><div class="sv blue" id="ds-leads">0</div></div>
    <div class="sc"><div class="sl">Active</div><div class="sv gold" id="ds-active">0</div></div>
    <div class="sc"><div class="sl">Closed</div><div class="sv green" id="ds-closed">0</div></div>
    <div class="sc"><div class="sl">Profit</div><div class="sv green" id="ds-profit">$0</div></div>
  </div>
  <div class="scroll-area">
    <div class="two-col">
      <div class="panel"><div class="panel-title">Recent Leads<button onclick="nav('leads')" style="background:none;border:none;color:var(--gold);font-size:9px;font-family:var(--M);">ALL ‚Üí</button></div><div id="dash-recent"></div></div>
      <div class="panel"><div class="panel-title">Follow-Ups Due<button onclick="nav('followups')" style="background:none;border:none;color:var(--purple);font-size:9px;font-family:var(--M);">ALL ‚Üí</button></div><div id="dash-fu"></div></div>
    </div>
    <div class="two-col">
      <div class="panel"><div class="panel-title">Pipeline</div><div id="dash-pipeline"></div></div>
      <div class="panel"><div class="panel-title">Top Devices</div><div id="dash-devices"></div></div>
    </div>
  </div>
</div>

<!-- LEADS -->
<div class="page" id="page-leads">
  <div class="ph">
    <div><div class="pt">LEADS</div><div class="ps">All seller contacts</div></div>
    <div class="ha">
      <input id="leadSearch" placeholder="Search‚Ä¶" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:6px 10px;border-radius:2px;font-family:var(--M);font-size:12px;outline:none;width:140px;" oninput="renderLeads()">
      <button class="btn btn-ghost btn-sm hm" onclick="exportLeads()">‚Üì CSV</button>
      <button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Add</button>
    </div>
  </div>
  <div class="scroll-area">
    <div style="overflow-x:auto">
      <table><thead><tr><th>Name</th><th>Device</th><th>Asking</th><th>Status</th><th class="hm">Source</th><th class="hm">Date</th><th>Actions</th></tr></thead>
      <tbody id="leads-tbody"></tbody></table>
    </div>
    <div id="leads-empty" class="empty" style="display:none"><div class="empty-icon">üë•</div>No leads yet ‚Äî add your first one</div>
  </div>
</div>

<!-- PIPELINE -->
<div class="page" id="page-pipeline">
  <div class="ph"><div><div class="pt">PIPELINE</div><div class="ps">Deal flow by stage</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Lead</button></div>
  <div class="pipeline" id="pipeline-board"></div>
</div>

<!-- FOLLOW-UPS -->
<div class="page" id="page-followups">
  <div class="ph"><div><div class="pt">FOLLOW-UPS</div><div class="ps">Never let a deal go cold</div></div></div>
  <div class="scroll-area">
    <div class="panel" style="margin-bottom:10px"><div class="panel-title" style="color:var(--red)">‚ö† OVERDUE</div><div id="fu-due"></div></div>
    <div class="panel"><div class="panel-title">UPCOMING (7 days)</div><div id="fu-upcoming"></div></div>
  </div>
</div>

<!-- AI -->
<div class="page" id="page-ai">
  <div class="ph"><div><div class="pt">AI ASSISTANT</div><div class="ps">Powered by Claude</div></div><button class="btn btn-ghost btn-sm" onclick="clearChat()">Clear</button></div>
  <div class="ai-outer">
    <div class="ai-modes">
      <button class="ai-mode-btn active" id="aimode-negotiate" onclick="setMode('negotiate',this)"><div class="ai-mode-icon">üí¨</div><div class="ai-mode-label">Negotiate</div></button>
      <button class="ai-mode-btn" id="aimode-deal" onclick="setMode('deal',this)"><div class="ai-mode-icon">üìä</div><div class="ai-mode-label">Deal Check</div></button>
      <button class="ai-mode-btn" id="aimode-objection" onclick="setMode('objection',this)"><div class="ai-mode-icon">üõ°</div><div class="ai-mode-label">Objections</div></button>
      <button class="ai-mode-btn" id="aimode-ad" onclick="setMode('ad',this)"><div class="ai-mode-icon">üì£</div><div class="ai-mode-label">Write Ad</div></button>
    </div>
    <div class="ai-qbtns" id="ai-qbtns"></div>
    <div class="ai-chat" id="ai-chat"></div>
    <div class="ai-input-row">
      <textarea class="ai-input" id="ai-input" rows="1" placeholder="Ask me about any deal‚Ä¶"></textarea>
      <button class="ai-send" id="ai-send" onclick="sendMsg()">‚Üë</button>
    </div>
  </div>
</div>

<!-- PRICES -->
<div class="page" id="page-prices">
  <div class="ph"><div><div class="pt">PRICE CHECKER</div><div class="ps" id="pc-sub">Live eBay + AI estimates</div></div></div>
  <div class="scroll-area">
    <div id="api-warn" style="display:none;background:rgba(255,140,66,.08);border:1px solid rgba(255,140,66,.25);border-radius:2px;padding:10px 14px;margin-bottom:12px;font-size:13px;color:#e0a070;">
      ‚ö† No eBay API key ‚Äî prices are AI estimates. <button onclick="openModal('settings')" style="background:none;border:none;color:var(--gold);text-decoration:underline;font-size:13px;padding:0">Add key in Settings ‚öô</button>
    </div>
    <div class="search-bar">
      <input id="pc-q" placeholder="iPhone 15 Pro 256GB, PS5 Disc‚Ä¶">
      <select id="pc-cond">
        <option value="used">Used / Pre-Owned</option>
        <option value="damaged">Damaged / Parts</option>
        <option value="new">New / Open Box</option>
        <option value="bad-esn">Bad ESN</option>
        <option value="broken">Broken / No Power</option>
      </select>
      <button class="btn btn-teal" onclick="runCheck()" id="pc-btn">Check ‚Üí</button>
    </div>
    <div class="cat-tabs">
      <button class="ecat-btn active" onclick="setCat(this)">All</button>
      <button class="ecat-btn" onclick="setCat(this)">üì± Phones</button>
      <button class="ecat-btn" onclick="setCat(this)">üéÆ Consoles</button>
      <button class="ecat-btn" onclick="setCat(this)">üíª MacBooks</button>
      <button class="ecat-btn" onclick="setCat(this)">üì∑ Cameras</button>
      <button class="ecat-btn" onclick="setCat(this)">üì± iPads</button>
    </div>
    <div id="pc-results">
      <div class="ext-links">
        <a class="ext-card" href="#" onclick="soldLink('ebay');return false"><div class="ext-icon">üõí</div><div class="ext-label">eBay Sold</div><div class="ext-sub">Pre-filtered ‚Üí</div></a>
        <a class="ext-card" href="#" onclick="soldLink('swappa');return false"><div class="ext-icon">üîÑ</div><div class="ext-label">Swappa</div><div class="ext-sub">Used market ‚Üí</div></a>
        <a class="ext-card" href="#" onclick="soldLink('fb');return false"><div class="ext-icon">üìç</div><div class="ext-label">FB Marketplace</div><div class="ext-sub">Local ‚Üí</div></a>
      </div>
      <div class="panel">
        <div class="panel-title">FEE REFERENCE</div>
        <div class="fee-row"><span class="fee-key">eBay Final Value (Electronics)</span><span class="fee-val" style="color:var(--red)">13.25%</span></div>
        <div class="fee-row"><span class="fee-key">eBay Payment Processing</span><span class="fee-val" style="color:var(--red)">~0.3%</span></div>
        <div class="fee-row"><span class="fee-key">Avg Shipping</span><span class="fee-val" style="color:var(--red)">$8‚Äì$15</span></div>
        <div class="fee-row"><span class="fee-key">Swappa Listing</span><span class="fee-val" style="color:var(--green)">Free to list</span></div>
        <div class="fee-row"><span class="fee-key">FB Marketplace (local)</span><span class="fee-val" style="color:var(--green)">Free</span></div>
      </div>
    </div>
  </div>
</div>

<!-- FLIP CALC -->
<div class="page" id="page-calc">
  <div class="ph"><div><div class="pt">FLIP CALC</div><div class="ps">Atlas Mobile ‚Äî iPhones</div></div></div>
  <div class="scroll-area">
    <div style="display:grid;grid-template-columns:295px 1fr;gap:12px" id="calc-grid">
      <div>
        <div class="panel" style="margin-bottom:10px">
          <div style="margin-bottom:13px">
            <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px">Model</div>
            <div class="field"><select id="c-model" onchange="calcStorage()"><option value="">‚Äî Select model ‚Äî</option></select></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:13px">
            <div><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px">Storage</div><div class="field"><select id="c-storage" onchange="calcUpdate()"><option>‚Äî</option></select></div></div>
            <div><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px">Lock</div><div class="field"><select id="c-lock" onchange="calcUpdate()"><option value="unlocked">Unlocked</option><option value="locked">Carrier Locked</option></select></div></div>
          </div>
          <div style="margin-bottom:13px">
            <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px">Condition</div>
            <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:3px" id="grade-btns">
              <button class="cbtn sel" data-g="swap" onclick="setGrade('swap',this)">SWAP</button>
              <button class="cbtn" data-g="a" onclick="setGrade('a',this)">A</button>
              <button class="cbtn" data-g="b" onclick="setGrade('b',this)">B</button>
              <button class="cbtn" data-g="c" onclick="setGrade('c',this)">C</button>
              <button class="cbtn" data-g="d" onclick="setGrade('d',this)">D</button>
              <button class="cbtn" data-g="doa" onclick="setGrade('doa',this)">DOA</button>
            </div>
          </div>
          <div>
            <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px">Damage Deductions</div>
            <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border)"><span style="font-size:12px">Cracked Back</span><button class="tog" id="tog-back" onclick="togDed('back',this)"><span class="tog-thumb"></span></button></div>
            <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border)"><span style="font-size:12px">Cracked Lens</span><button class="tog" id="tog-lens" onclick="togDed('lens',this)"><span class="tog-thumb"></span></button></div>
            <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border)"><span style="font-size:12px">Battery &lt;80%</span><button class="tog" id="tog-batt" onclick="togDed('batt',this)"><span class="tog-thumb"></span></button></div>
            <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0"><span style="font-size:12px">Repair Message</span><button class="tog" id="tog-rep" onclick="togDed('rep',this)"><span class="tog-thumb"></span></button></div>
          </div>
        </div>
        <div class="panel">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px">
            <div class="field"><label>Min Profit $</label><input type="number" id="c-profit" value="40" oninput="calcUpdate()"></div>
            <div class="field"><label>Risk Buffer $</label><input type="number" id="c-risk" value="20" oninput="calcUpdate()"></div>
          </div>
          <div class="field"><label>Seller's Asking $</label><input type="number" id="c-asking" placeholder="Enter their price" oninput="calcUpdate()"></div>
        </div>
      </div>
      <div id="calc-result" style="background:var(--card);border:1px solid var(--border);border-radius:2px"><div style="padding:50px;text-align:center;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px">SELECT A MODEL TO BEGIN</div></div>
    </div>
  </div>
</div>

<!-- INVENTORY -->
<div class="page" id="page-inventory">
  <div class="ph"><div><div class="pt">INVENTORY</div><div class="ps">All categories</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addInventory')">+ Device</button></div>
  <div class="scroll-area">
    <div class="three-col" style="margin-bottom:12px">
      <div class="sc"><div class="sl">In Stock</div><div class="sv gold" id="inv-count">0</div></div>
      <div class="sc"><div class="sl">Invested</div><div class="sv red" id="inv-invested">$0</div></div>
      <div class="sc"><div class="sl">Est. Profit</div><div class="sv green" id="inv-profit-est">$0</div></div>
    </div>
    <div class="inv-grid" id="inv-grid"></div>
    <div id="inv-empty" class="empty" style="display:none"><div class="empty-icon">üì¶</div>No inventory yet</div>
  </div>
</div>

<!-- ALERTS -->
<div class="page" id="page-alerts">
  <div class="ph"><div><div class="pt">DEAL ALERTS</div><div class="ps">Monitor for underpriced items</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addAlert')">+ Alert</button></div>
  <div class="scroll-area">
    <div class="panel" style="margin-bottom:10px"><div class="panel-title">ACTIVE MONITORS</div><div id="alert-monitors"></div></div>
    <div class="panel"><div class="panel-title">RECENT HITS</div><div id="alert-hits"></div></div>
  </div>
</div>

<!-- PLAYBOOK -->
<div class="page" id="page-playbook">
  <div class="ph"><div><div class="pt">PLAYBOOK</div><div class="ps">Your complete buying system</div></div></div>
  <div class="scroll-area">
    <div class="pb-tabs">
      <button class="pb-tab-btn active" onclick="pbTab('shotgun',this)">üéØ Shotgun</button>
      <button class="pb-tab-btn" onclick="pbTab('script',this)">üí¨ Scripts</button>
      <button class="pb-tab-btn" onclick="pbTab('objections',this)">üõ° Objections</button>
      <button class="pb-tab-btn" onclick="pbTab('appraise',this)">üîç Appraise</button>
      <button class="pb-tab-btn" onclick="pbTab('ads',this)">üì£ Ads</button>
      <button class="pb-tab-btn" onclick="pbTab('buyers',this)">üè¶ Buyers</button>
    </div>
    <div class="pb-sec active" id="pb-shotgun">
      <div class="panel" style="margin-bottom:10px"><div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px">THE SHOTGUN METHOD</div><div style="font-size:13px;color:#999;line-height:1.7">Send 100 reachouts. Weed non-responders. Negotiate with the interested. Close and meet. Repeat every day.</div></div>
      <div class="funnel">
        <button class="funnel-step f1" onclick="tft('ft1')"><div class="fs-title">100 REACHOUTS</div><div class="fs-sub">Message as many sellers as possible</div></button>
        <div class="ftip" id="ft1"><div class="smsg">"Hey, I run a business that buys used and damaged iPhones, MacBooks, iPads, Smartwatches, cameras and more. If I were to pay cash today, would you take a lower price?"</div></div>
        <button class="funnel-step f2" onclick="tft('ft2')"><div class="fs-title">INTERESTED SELLERS</div><div class="fs-sub">Weed out non-responders fast</div></button>
        <div class="ftip" id="ft2"><p style="font-size:13px;color:#999;line-height:1.7">You'll get: "No" / "How much lower?" / "I'll take $150 today" ‚Äî Ignore rude ones. Move every positive response into negotiate immediately.</p></div>
        <button class="funnel-step f3" onclick="tft('ft3')"><div class="fs-title">NEGOTIATE</div><div class="fs-sub">Convos started ‚Äî now close them</div></button>
        <div class="ftip" id="ft3"><p style="font-size:13px;color:#999;line-height:1.7">Use your benefits: same-day pickup, you drive to them, cash in hand right now. Use the Scripts tab.</p></div>
        <button class="funnel-step f4" onclick="tft('ft4')"><div class="fs-title">CLOSE + MEET</div><div class="fs-sub">Buy, get reviews, get referrals</div></button>
        <div class="ftip" id="ft4"><p style="font-size:13px;color:#999;line-height:1.7">Close ‚Üí Ask for Google/Marketplace review ‚Üí Give business card ‚Üí "Know anyone else selling?" ‚Üí Always cross-sell.</p></div>
      </div>
    </div>
    <div class="pb-sec" id="pb-script">
      <div class="scard"><button class="scard-btn" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px">Opening Reachout</div><div style="font-family:var(--M);font-size:9px;color:var(--muted)">FIRST MESSAGE</div></div><span>‚ñº</span></button><div class="scard-b open"><div class="smsg">"Hey, I run a company that buys used and damaged iPhones, MacBooks, Smartwatches, Cameras, VR Systems, and more. If I were able to pay cash today, would you take a lower offer?"</div></div></div>
      <div class="scard"><button class="scard-btn" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px">Make the Offer</div><div style="font-family:var(--M);font-size:9px;color:var(--muted)">AFTER POSITIVE RESPONSE</div></div><span>‚ñº</span></button><div class="scard-b"><div class="smsg good">"Great, we've been buying the [Device] for $____ recently."</div><div class="smsg good">"Awesome, I can give you $______ for it."</div></div></div>
      <div class="scard"><button class="scard-btn" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px">Bullet 1 ‚Äî Carrier</div><div style="font-family:var(--M);font-size:9px;color:var(--muted)">WHEN STUCK ON PRICE</div></div><span>‚ñº</span></button><div class="scard-b"><div class="smsg good">"Just want to confirm ‚Äî what carrier is it with?"</div><div class="snote">If you can bump based on carrier: "Gotcha, I checked with my buyers and I can actually move to $___."</div></div></div>
      <div class="scard"><button class="scard-btn" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px">Tell the Truth ‚Äî Final Offer</div><div style="font-family:var(--M);font-size:9px;color:var(--muted)">LAST RESORT</div></div><span>‚ñº</span></button><div class="scard-b"><div class="smsg good">"I'd love to buy your device, but I buy and resell for a living and I need to make a small profit. Best I can do is $__ due to where it's at in the market. Would you take that if I came to you today with cash?"</div></div></div>
      <div class="scard"><button class="scard-btn" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px">Follow-Up Messages</div><div style="font-family:var(--M);font-size:9px;color:var(--muted)">COLD LEADS</div></div><span>‚ñº</span></button><div class="scard-b"><div class="smsg good">"Hey I saw this was still available."</div><div class="smsg good">"Following up ‚Äî still interested in buying this today."</div></div></div>
    </div>
    <div class="pb-sec" id="pb-objections">
      <div class="obj-card"><div class="obj-sit">Angry No</div><div class="obj-ex">"Hell no"</div><div class="obj-res">"I totally understand, how much were you looking to get?"</div></div>
      <div class="obj-card"><div class="obj-sit">Wants Too Much</div><div class="obj-ex">"I want $300 for my iPhone 6"</div><div class="obj-res">"I totally understand ‚Äî unfortunately $300 is higher than I could sell it for. But I can give you $100 cash today. Is that fair?"</div></div>
      <div class="obj-card"><div class="obj-sit">Will Sell Themselves</div><div class="obj-ex">"I'll just sell it myself"</div><div class="obj-res">"That makes sense! Most people find it takes weeks on Facebook. I can give you cash today so you skip the strangers and no-shows."</div></div>
      <div class="obj-card"><div class="obj-sit">Someone Offered More</div><div class="obj-ex">"Another guy offered me $150"</div><div class="obj-res">"$150 is a great price ‚Äî if he's paying, take it! I can offer $100 with cash today though. What works best for you?"</div></div>
      <div class="obj-card"><div class="obj-sit">Just Shopping Around</div><div class="obj-ex">"I was just seeing what I could get"</div><div class="obj-res">"No worries! Hey ‚Äî got any other devices? iPads, MacBooks, consoles, cameras? Could put cash in your hands today."</div></div>
    </div>
    <div class="pb-sec" id="pb-appraise">
      <div class="panel" style="margin-bottom:10px"><div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px">APPRAISE ON EBAY</div><div style="font-size:13px;color:#999">Always use SOLD listings. Never guess off active listings.</div></div>
      <div class="panel" style="margin-bottom:10px">
        <div class="panel-title">STANDARD PHONES</div>
        <div class="apr-step"><div class="apr-num">1</div><div class="apr-content"><h4>Minimal keywords</h4><p>"iPhone XR Unlocked" ‚Äî NOT "iPhone XR gold 128GB good condition."</p></div></div>
        <div class="apr-step"><div class="apr-num">2</div><div class="apr-content"><h4>Filter: Sold Items ONLY</h4><p>Check "Completed Items" and "Sold Items." Active listings mean nothing.<div class="tip-box">üì± Mobile: Filter ‚Üí Show Only ‚Üí Sold Items</div></p></div></div>
        <div class="apr-step"><div class="apr-num">3</div><div class="apr-content"><h4>3 comps within 2 months</h4><p>Match model, storage, condition exactly.</p></div></div>
        <div class="apr-step"><div class="apr-num">4</div><div class="apr-content"><h4>Real photos only</h4><p>Skip stock photo listings.</p></div></div>
      </div>
      <div class="panel">
        <div class="panel-title">BAD ESN</div>
        <div class="apr-step"><div class="apr-num">!</div><div class="apr-content"><h4>Never search "Bad ESN" ‚Äî eBay blocks it</h4><p>Search: "iPhone 8 Plus Tmobile ESN" ‚Äî Look for: "Check ESN", "Financed", "ESN Unclean."</p></div></div>
      </div>
    </div>
    <div class="pb-sec" id="pb-ads">
      <div class="panel">
        <div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px">FB AD SETUP</div>
        <div style="font-size:13px;color:#999;margin-bottom:12px">$5‚Äì$15/day. Goal: 15‚Äì20 leads/day.</div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border)"><span style="color:var(--gold);flex-shrink:0">‚Üì</span><div><div style="font-size:13px;font-weight:500">Objective: Engagement</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border)"><span style="color:var(--gold);flex-shrink:0">‚Üì</span><div><div style="font-size:13px;font-weight:500">Advantage Campaign Budget ‚Äî $5/day to start</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border)"><span style="color:var(--gold);flex-shrink:0">‚Üì</span><div><div style="font-size:13px;font-weight:500">Location: 10‚Äì25 mile radius</div></div></div>
        <div style="background:rgba(255,69,69,.08);border:1px solid rgba(255,69,69,.25);border-radius:2px;padding:9px 12px;margin:10px 0"><div style="font-family:var(--M);font-size:9px;color:var(--red);margin-bottom:3px">‚ö† CRITICAL</div><div style="font-size:12px;color:#ff9999">NO Apple logos. NO brand logos on your page. This WILL get your ad account permanently banned.</div></div>
        <div style="display:flex;gap:9px;padding:9px 0"><span style="color:var(--gold);flex-shrink:0">‚Üì</span><div><div style="font-size:13px;font-weight:500">Duplicate ad 4√ó ‚Üí Publish all 5 variations</div></div></div>
      </div>
    </div>
    <div class="pb-sec" id="pb-buyers">
      <div class="panel">
        <div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px">VETTED BUYERS</div>
        <div style="font-size:12px;color:#888;margin-bottom:12px">Do your own due diligence.</div>
        <a href="https://atlasmobile.com" target="_blank" rel="noopener" class="buyer-row" style="display:flex;text-decoration:none;color:inherit"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:16px">üì±</span><div><div style="font-weight:500;font-size:13px">Atlas Mobile</div><div style="font-size:11px;color:var(--muted)">atlasmobile.com ¬∑ Built into Flip Calc</div></div></div><div style="display:flex;align-items:center;gap:8px"><span class="pill p-closed">PRIMARY</span><span style="color:var(--muted);font-size:12px">‚Üí</span></div></a>
        <a href="https://bestdealphones.com" target="_blank" rel="noopener" class="buyer-row" style="display:flex;text-decoration:none;color:inherit"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:16px">üí∞</span><div><div style="font-weight:500;font-size:13px">Best Deal Phones</div><div style="font-size:11px;color:var(--muted)">bestdealphones.com</div></div></div><div style="display:flex;align-items:center;gap:8px"><span class="pill p-active">VETTED</span><span style="color:var(--muted);font-size:12px">‚Üí</span></div></a>
        <a href="https://nycphonebuyer.com" target="_blank" rel="noopener" class="buyer-row" style="display:flex;text-decoration:none;color:inherit"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:16px">üèô</span><div><div style="font-weight:500;font-size:13px">NYC Phone Buyer</div><div style="font-size:11px;color:var(--muted)">nycphonebuyer.com</div></div></div><div style="display:flex;align-items:center;gap:8px"><span class="pill p-active">VETTED</span><span style="color:var(--muted);font-size:12px">‚Üí</span></div></a>
        <a href="https://apple.com/shop/trade-in" target="_blank" rel="noopener" class="buyer-row" style="display:flex;text-decoration:none;color:inherit"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:16px">üçé</span><div><div style="font-weight:500;font-size:13px">Apple Trade In</div><div style="font-size:11px;color:var(--muted)">apple.com/shop/trade-in</div></div></div><div style="display:flex;align-items:center;gap:8px"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px">‚Üí</span></div></a>
        <a href="https://ebay.com/sl/sell" target="_blank" rel="noopener" class="buyer-row" style="display:flex;text-decoration:none;color:inherit"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:16px">üõí</span><div><div style="font-weight:500;font-size:13px">eBay</div><div style="font-size:11px;color:var(--muted)">Best for MacBooks, consoles, cameras</div></div></div><div style="display:flex;align-items:center;gap:8px"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px">‚Üí</span></div></a>
        <a href="https://swappa.com/sell" target="_blank" rel="noopener" class="buyer-row" style="display:flex;text-decoration:none;color:inherit"><div style="display:flex;align-items:center;gap:8px"><span style="font-size:16px">üîÑ</span><div><div style="font-weight:500;font-size:13px">Swappa</div><div style="font-size:11px;color:var(--muted)">No seller fee</div></div></div><div style="display:flex;align-items:center;gap:8px"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px">‚Üí</span></div></a>
      </div>
    </div>
  </div>
</div>

<!-- PROFITS -->
<div class="page" id="page-profits">
  <div class="ph"><div><div class="pt">PROFITS</div><div class="ps">Track every dollar</div></div><button class="btn btn-ghost btn-sm hm" onclick="exportProfits()">‚Üì CSV</button></div>
  <div class="scroll-area">
    <div class="stats-row" style="padding:0 0 12px">
      <div class="sc"><div class="sl">Revenue</div><div class="sv green" id="pr-rev">$0</div></div>
      <div class="sc"><div class="sl">Spent</div><div class="sv red" id="pr-spent">$0</div></div>
      <div class="sc"><div class="sl">Net Profit</div><div class="sv gold" id="pr-net">$0</div></div>
      <div class="sc"><div class="sl">Avg/Deal</div><div class="sv blue" id="pr-avg">$0</div></div>
    </div>
    <div class="panel">
      <div class="panel-title">SOLD DEVICES</div>
      <div style="overflow-x:auto"><table><thead><tr><th>Device</th><th>Paid</th><th>Sold For</th><th>Profit</th><th class="hm">Date</th><th class="hm">Buyer</th></tr></thead><tbody id="profits-tbody"></tbody></table></div>
      <div id="profits-empty" class="empty"><div class="empty-icon">üí∞</div>No sold devices yet</div>
    </div>
  </div>
</div>
```

  </div><!-- /main -->
</div><!-- /shell -->

<!-- MOBILE NAV -->

<div class="mob-nav">
  <div class="mob-nav-inner">
    <button class="mob-btn active" id="mb-dashboard" onclick="nav('dashboard')"><span class="mob-icon">üìä</span>Home</button>
    <button class="mob-btn" id="mb-leads" onclick="nav('leads')"><span class="mob-icon">üë•</span>Leads</button>
    <button class="mob-btn" id="mb-ai" onclick="nav('ai')"><span class="mob-icon">ü§ñ</span>AI</button>
    <button class="mob-btn" id="mb-prices" onclick="nav('prices')"><span class="mob-icon">üîç</span>Prices</button>
    <button class="mob-btn" id="mb-playbook" onclick="nav('playbook')"><span class="mob-icon">üìö</span>Playbook</button>
    <button class="mob-btn" id="mb-more" onclick="openModal('moreMenu')"><span class="mob-icon">‚ò∞</span>More</button>
  </div>
</div>

<!-- MODALS -->

<div class="overlay" id="modal-settings">
  <div class="modal" style="max-width:520px">
    <div class="mh"><div class="mt">‚öô SETTINGS</div><button class="mc" onclick="closeModal('settings')">√ó</button></div>
    <div class="mb">
      <div class="set-sec">
        <div class="set-sec-title">eBay API ‚Äî Price Checker</div>
        <div class="field"><label>Production App ID (Client ID)</label><input class="key-input" id="s-ebay" type="password" placeholder="AppName-PRD-xxxxxxxx"></div>
        <div id="ebay-ks" class="ks missing">‚óè Not set</div>
        <div style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.6">Get at <strong style="color:var(--gold)">developer.ebay.com</strong> ‚Üí My Account ‚Üí Application Keysets ‚Üí Production.</div>
        <div style="display:flex;gap:7px;margin-top:10px">
          <button class="btn btn-teal btn-sm" onclick="saveEbayKey()">Save Key</button>
          <button class="btn btn-ghost btn-sm" onclick="testEbay()">Test Connection</button>
        </div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">Email Alerts ‚Äî EmailJS</div>
        <div class="field" style="margin-bottom:8px"><label>Your Email</label><input class="key-input" id="s-email" type="email" placeholder="you@gmail.com"></div>
        <div class="field" style="margin-bottom:8px"><label>EmailJS Service ID</label><input class="key-input" id="s-svc" placeholder="service_xxxxxxx"></div>
        <div class="field" style="margin-bottom:8px"><label>EmailJS Template ID</label><input class="key-input" id="s-tmpl" placeholder="template_xxxxxxx"></div>
        <div class="field" style="margin-bottom:8px"><label>EmailJS Public Key</label><input class="key-input" id="s-pubkey" type="password" placeholder="xxxxxxxxxxxxxxxxxxxx"></div>
        <div id="email-ks" class="ks missing">‚óè Not configured</div>
        <div style="display:flex;gap:7px;margin-top:10px">
          <button class="btn btn-teal btn-sm" onclick="saveEmailKeys()">Save</button>
          <button class="btn btn-ghost btn-sm" onclick="testEmail()">Test Email</button>
        </div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">Data</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-ghost btn-sm" onclick="exportAll()">‚Üì Export Backup</button>
          <button class="btn btn-danger btn-sm" onclick="clearAll()">üóë Clear All Data</button>
        </div>
      </div>
    </div>
    <div class="mf"><button class="btn btn-gold" onclick="closeModal('settings')">Done</button></div>
  </div>
</div>

<div class="overlay" id="modal-moreMenu">
  <div class="modal" style="max-height:65vh">
    <div class="mh"><div class="mt">MORE</div><button class="mc" onclick="closeModal('moreMenu')">√ó</button></div>
    <div class="mb" style="padding:4px 0">
      <button class="nav-item" style="border-left:none;padding:13px 16px" onclick="nav('calc');closeModal('moreMenu')"><span class="nav-icon">üßÆ</span>Flip Calc</button>
      <button class="nav-item" style="border-left:none;padding:13px 16px" onclick="nav('pipeline');closeModal('moreMenu')"><span class="nav-icon">üîÄ</span>Pipeline</button>
      <button class="nav-item" style="border-left:none;padding:13px 16px" onclick="nav('followups');closeModal('moreMenu')"><span class="nav-icon">‚è∞</span>Follow-Ups</button>
      <button class="nav-item" style="border-left:none;padding:13px 16px" onclick="nav('inventory');closeModal('moreMenu')"><span class="nav-icon">üì¶</span>Inventory</button>
      <button class="nav-item" style="border-left:none;padding:13px 16px" onclick="nav('alerts');closeModal('moreMenu')"><span class="nav-icon">üîî</span>Alerts</button>
      <button class="nav-item" style="border-left:none;padding:13px 16px" onclick="nav('profits');closeModal('moreMenu')"><span class="nav-icon">üí∞</span>Profits</button>
      <button class="nav-item" style="border-left:none;padding:13px 16px" onclick="openModal('settings');closeModal('moreMenu')"><span class="nav-icon">‚öô</span>Settings</button>
    </div>
  </div>
</div>

<div class="overlay" id="modal-addLead">
  <div class="modal">
    <div class="mh"><div class="mt" id="lead-modal-title">NEW LEAD</div><button class="mc" onclick="closeModal('addLead')">√ó</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Full Name *</label><input id="l-name" placeholder="John Smith"></div><div class="field"><label>Phone</label><input id="l-phone" type="tel"></div></div>
      <div class="form-row"><div class="field"><label>Device</label><input id="l-device" placeholder="iPhone 15 Pro 256GB‚Ä¶"></div><div class="field"><label>Category</label><select id="l-cat"><option>Phone</option><option>Console</option><option>MacBook/Laptop</option><option>Camera</option><option>iPad/Tablet</option><option>Other</option></select></div></div>
      <div class="form-row"><div class="field"><label>Asking $</label><input id="l-asking" type="number"></div><div class="field"><label>Your Offer $</label><input id="l-offer" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Source</label><select id="l-source"><option>FB Marketplace</option><option>Craigslist</option><option>Walk-in</option><option>Referral</option><option>OfferUp</option><option>Other</option></select></div><div class="field"><label>Status</label><select id="l-status"><option value="new">New</option><option value="active">Active</option><option value="follow">Follow-Up</option><option value="closed">Closed</option><option value="lost">Lost</option></select></div></div>
      <div class="form-row"><div class="field"><label>Follow-Up Date</label><input id="l-followup" type="date"></div></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="l-notes" placeholder="Condition, battery %, details‚Ä¶"></textarea></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addLead')">Cancel</button><button class="btn btn-gold" onclick="saveLead()">Save Lead</button></div>
  </div>
</div>

<div class="overlay" id="modal-viewLead">
  <div class="modal"><div class="mh"><div class="mt" id="vl-title">LEAD</div><button class="mc" onclick="closeModal('viewLead')">√ó</button></div><div class="mb" id="vl-body"></div><div class="mf" id="vl-footer"></div></div>
</div>

<div class="overlay" id="modal-addInventory">
  <div class="modal">
    <div class="mh"><div class="mt">ADD DEVICE</div><button class="mc" onclick="closeModal('addInventory')">√ó</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Device *</label><input id="i-device" placeholder="iPhone 15 Pro‚Ä¶"></div><div class="field"><label>Category</label><select id="i-cat"><option>Phone</option><option>Console</option><option>MacBook/Laptop</option><option>Camera</option><option>iPad/Tablet</option><option>Other</option></select></div></div>
      <div class="form-row"><div class="field"><label>Paid $ *</label><input id="i-paid" type="number"></div><div class="field"><label>Sell Target $</label><input id="i-target" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Condition</label><select id="i-cond"><option>Grade A</option><option>Grade B</option><option>Grade C</option><option>Grade D</option><option>DOA/Parts</option></select></div><div class="field"><label>Sell Via</label><select id="i-sell"><option>Atlas Mobile</option><option>eBay</option><option>Swappa</option><option>Local/FB</option><option>Other</option></select></div></div>
      <div class="field" style="margin-bottom:9px"><label>IMEI / Serial</label><input id="i-imei"></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="i-notes"></textarea></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addInventory')">Cancel</button><button class="btn btn-gold" onclick="saveInventory()">Add Device</button></div>
  </div>
</div>

<div class="overlay" id="modal-sell">
  <div class="modal">
    <div class="mh"><div class="mt">MARK SOLD</div><button class="mc" onclick="closeModal('sell')">√ó</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Sold For $ *</label><input id="s-price" type="number"></div><div class="field"><label>Sold To</label><input id="s-buyer" placeholder="Atlas, eBay, Local‚Ä¶"></div></div>
      <div class="form-row single"><div class="field"><label>Date</label><input id="s-date" type="date"></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('sell')">Cancel</button><button class="btn btn-gold" onclick="confirmSell()">Confirm Sale</button></div>
  </div>
</div>

<div class="overlay" id="modal-addAlert">
  <div class="modal">
    <div class="mh"><div class="mt">NEW ALERT</div><button class="mc" onclick="closeModal('addAlert')">√ó</button></div>
    <div class="mb">
      <div class="form-row single"><div class="field"><label>Device to Watch *</label><input id="a-device" placeholder="iPhone 15 Pro‚Ä¶"></div></div>
      <div class="form-row"><div class="field"><label>Max Price $</label><input id="a-maxprice" type="number"></div><div class="field"><label>Platform</label><select id="a-platform"><option>FB Marketplace</option><option>Craigslist</option><option>OfferUp</option><option>All Platforms</option></select></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addAlert')">Cancel</button><button class="btn btn-gold" onclick="saveAlert()">Add Monitor</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var ST = { leads:[], inventory:[], alerts:[], sold:[] };
var KEYS = { ebay:'', email:'', svc:'', tmpl:'', pubkey:'' };
var editLeadId = null, sellItemId = null, aiMode = 'negotiate';
var aiHistory = [{ role:'assistant', content:"Hey! I'm your Trey Buyback AI. I can help you negotiate deals, check if something's worth buying, handle objections, or write ad copy. What do you need?" }];
var calcGrade = 'swap', calcDeds = { back:false, lens:false, batt:false, rep:false };
var lastQ = '';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STORAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function save() { try { localStorage.setItem(‚Äòtb5‚Äô, JSON.stringify(ST)); } catch(e){} }
function load() {
try {
var d = localStorage.getItem(‚Äòtb5‚Äô);
if (d) ST = JSON.parse(d);
var k = localStorage.getItem(‚Äòtb5k‚Äô);
if (k) KEYS = JSON.parse(k);
} catch(e){}
}
function saveKeys() { try { localStorage.setItem(‚Äòtb5k‚Äô, JSON.stringify(KEYS)); } catch(e){} }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function nav(p) {
document.querySelectorAll(‚Äô.page‚Äô).forEach(function(x){ x.classList.remove(‚Äòactive‚Äô); });
var pg = document.getElementById(‚Äòpage-‚Äô + p);
if (pg) pg.classList.add(‚Äòactive‚Äô);

document.querySelectorAll(‚Äô.nav-item, .mob-btn‚Äô).forEach(function(x){ x.classList.remove(‚Äòactive‚Äô); });
var si = document.getElementById(‚Äòsi-‚Äô + p);
if (si) si.classList.add(‚Äòactive‚Äô);
var mb = document.getElementById(‚Äòmb-‚Äô + p);
if (mb) mb.classList.add(‚Äòactive‚Äô);

if (p===‚Äòdashboard‚Äô) renderDash();
if (p===‚Äòleads‚Äô) renderLeads();
if (p===‚Äòpipeline‚Äô) renderPipeline();
if (p===‚Äòfollowups‚Äô) renderFollowups();
if (p===‚Äòinventory‚Äô) renderInventory();
if (p===‚Äòalerts‚Äô) renderAlerts();
if (p===‚Äòprofits‚Äô) renderProfits();
if (p===‚Äòprices‚Äô) document.getElementById(‚Äòapi-warn‚Äô).style.display = KEYS.ebay ? ‚Äònone‚Äô : ‚Äòblock‚Äô;
counts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id) {
var el = document.getElementById(‚Äòmodal-‚Äô + id);
if (el) el.classList.add(‚Äòopen‚Äô);
if (id === ‚ÄòaddLead‚Äô) resetLeadForm();
if (id === ‚Äòsettings‚Äô) loadSettings();
if (id === ‚Äòsell‚Äô) { var t = new Date(); document.getElementById(‚Äòs-date‚Äô).value = t.toISOString().slice(0,10); }
}
function closeModal(id) {
var el = document.getElementById(‚Äòmodal-‚Äô + id);
if (el) el.classList.remove(‚Äòopen‚Äô);
if (id === ‚ÄòaddLead‚Äô) { editLeadId = null; }
}

// Close overlay when clicking backdrop
document.addEventListener(‚Äòclick‚Äô, function(e) {
if (e.target.classList.contains(‚Äòoverlay‚Äô)) {
e.target.classList.remove(‚Äòopen‚Äô);
editLeadId = null;
}
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg, type) {
var t = document.getElementById(‚Äòtoast‚Äô);
t.textContent = msg;
t.className = ‚Äôtoast show ‚Äô + (type||‚Äòsuccess‚Äô);
clearTimeout(t._timer);
t._timer = setTimeout(function(){ t.classList.remove(‚Äòshow‚Äô); }, 2600);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COUNTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function counts() {
var active = ST.leads.filter(function(l){ return l.status===‚Äòactive‚Äô||l.status===‚Äònew‚Äô||l.status===‚Äòfollow‚Äô; }).length;
var fu = ST.leads.filter(function(l){ return l.followup && new Date(l.followup) <= new Date(); }).length;
document.getElementById(‚Äònc-leads‚Äô).textContent = ST.leads.length;
document.getElementById(‚Äònc-fu‚Äô).textContent = fu;
document.getElementById(‚Äònc-alerts‚Äô).textContent = ST.alerts.length;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEADS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function resetLeadForm() {
[‚Äòl-name‚Äô,‚Äòl-phone‚Äô,‚Äòl-device‚Äô,‚Äòl-asking‚Äô,‚Äòl-offer‚Äô,‚Äòl-notes‚Äô].forEach(function(id){ document.getElementById(id).value=‚Äô‚Äô; });
document.getElementById(‚Äòl-cat‚Äô).value=‚ÄòPhone‚Äô;
document.getElementById(‚Äòl-source‚Äô).value=‚ÄòFB Marketplace‚Äô;
document.getElementById(‚Äòl-status‚Äô).value=‚Äònew‚Äô;
document.getElementById(‚Äòl-followup‚Äô).value=‚Äô‚Äô;
document.getElementById(‚Äòlead-modal-title‚Äô).textContent = ‚ÄòNEW LEAD‚Äô;
}

function saveLead() {
var name = document.getElementById(‚Äòl-name‚Äô).value.trim();
if (!name) { toast(‚ÄòName is required‚Äô,‚Äòerror‚Äô); return; }
var lead = {
id: editLeadId || (‚Äòl‚Äô + Date.now()),
name: name,
phone: document.getElementById(‚Äòl-phone‚Äô).value.trim(),
device: document.getElementById(‚Äòl-device‚Äô).value.trim(),
cat: document.getElementById(‚Äòl-cat‚Äô).value,
asking: parseFloat(document.getElementById(‚Äòl-asking‚Äô).value)||0,
offer: parseFloat(document.getElementById(‚Äòl-offer‚Äô).value)||0,
source: document.getElementById(‚Äòl-source‚Äô).value,
status: document.getElementById(‚Äòl-status‚Äô).value,
followup: document.getElementById(‚Äòl-followup‚Äô).value,
notes: document.getElementById(‚Äòl-notes‚Äô).value.trim(),
added: editLeadId ? (ST.leads.find(function(l){ return l.id===editLeadId; })||{}).added||new Date().toISOString() : new Date().toISOString()
};
if (editLeadId) {
var idx = ST.leads.findIndex(function(l){ return l.id===editLeadId; });
if (idx>-1) ST.leads[idx] = lead;
} else {
ST.leads.unshift(lead);
}
save(); closeModal(‚ÄòaddLead‚Äô); editLeadId=null;
renderLeads(); renderDash(); counts();
toast(editLeadId ? ‚ÄòLead updated‚Äô : ‚ÄòLead added!‚Äô);
}

function renderLeads() {
var q = (document.getElementById(‚ÄòleadSearch‚Äô)||{value:‚Äô‚Äô}).value.toLowerCase();
var filtered = ST.leads.filter(function(l){
return !q || l.name.toLowerCase().includes(q) || (l.device||‚Äô‚Äô).toLowerCase().includes(q);
});
var tbody = document.getElementById(‚Äòleads-tbody‚Äô);
var empty = document.getElementById(‚Äòleads-empty‚Äô);
if (!filtered.length) { tbody.innerHTML=‚Äô‚Äô; empty.style.display=‚Äòblock‚Äô; return; }
empty.style.display=‚Äònone‚Äô;
var stMap = { new:‚Äòp-new‚Äô, active:‚Äòp-active‚Äô, follow:‚Äòp-follow‚Äô, closed:‚Äòp-closed‚Äô, lost:‚Äòp-lost‚Äô };
tbody.innerHTML = filtered.map(function(l){
return ‚Äò<tr>‚Äô +
‚Äò<td><div style="font-weight:500;font-size:13px">‚Äô + esc(l.name) + ‚Äò</div>‚Äô +
(l.phone ? ‚Äò<div style="font-family:var(--M);font-size:10px;color:var(--muted)">‚Äô + esc(l.phone) + ‚Äò</div>‚Äô : ‚Äò‚Äô) +
‚Äò</td>‚Äô +
‚Äò<td style="font-size:12px">‚Äô + esc(l.device||‚Äô‚Äî‚Äô) + ‚Äò</td>‚Äô +
‚Äò<td style="font-family:var(--M);font-size:12px">‚Äô + (l.asking ? ‚Äò$‚Äô+l.asking : ‚Äò‚Äî‚Äô) + ‚Äò</td>‚Äô +
‚Äò<td><span class="pill ' + (stMap[l.status]||'p-new') + '">‚Äô + l.status + ‚Äò</span></td>‚Äô +
‚Äò<td class="hm" style="font-size:12px;color:var(--muted)">‚Äô + esc(l.source||‚Äô‚Äî‚Äô) + ‚Äò</td>‚Äô +
‚Äò<td class="hm" style="font-family:var(--M);font-size:10px;color:var(--muted)">‚Äô + fmtDate(l.added) + ‚Äò</td>‚Äô +
‚Äò<td><div style="display:flex;gap:5px">‚Äô +
‚Äò<button class="btn btn-ghost btn-sm" onclick="viewLead(\'' + l.id + '\')">View</button>‚Äô +
‚Äò<button class="btn btn-danger btn-sm" onclick="deleteLead(\'' + l.id + '\')">‚úï</button>‚Äô +
‚Äò</div></td>‚Äô +
‚Äò</tr>‚Äô;
}).join(‚Äô‚Äô);
}

function viewLead(id) {
var l = ST.leads.find(function(x){ return x.id===id; });
if (!l) return;
document.getElementById(‚Äòvl-title‚Äô).textContent = l.name;
var stMap = { new:‚Äòp-new‚Äô, active:‚Äòp-active‚Äô, follow:‚Äòp-follow‚Äô, closed:‚Äòp-closed‚Äô, lost:‚Äòp-lost‚Äô };
document.getElementById(‚Äòvl-body‚Äô).innerHTML =
‚Äò<div style="display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:12px">‚Äô +
row(‚ÄòDevice‚Äô, l.device) + row(‚ÄòCategory‚Äô, l.cat) + row(‚ÄòAsking‚Äô, l.asking?‚Äô$‚Äô+l.asking:‚Äô‚Äî‚Äô) +
row(‚ÄòYour Offer‚Äô, l.offer?‚Äô$‚Äô+l.offer:‚Äô‚Äî‚Äô) + row(‚ÄòSource‚Äô, l.source) +
‚Äò<div class="sc"><div class="sl">Status</div><span class="pill ' + (stMap[l.status]||'p-new') + '">‚Äô + l.status + ‚Äò</span></div>‚Äô +
(l.followup ? row(‚ÄòFollow-Up‚Äô, l.followup) : ‚Äò‚Äô) + row(‚ÄòAdded‚Äô, fmtDate(l.added)) + ‚Äò</div>‚Äô +
(l.phone ? ‚Äò<div class="panel" style="margin-bottom:8px"><div class="sl">Phone</div><div style="font-size:14px">‚Äô + esc(l.phone) + ‚Äò</div></div>‚Äô : ‚Äò‚Äô) +
(l.notes ? ‚Äò<div class="panel"><div class="sl">Notes</div><div style="font-size:13px;line-height:1.7">‚Äô + esc(l.notes) + ‚Äò</div></div>‚Äô : ‚Äò‚Äô);
document.getElementById(‚Äòvl-footer‚Äô).innerHTML =
‚Äò<button class="btn btn-ghost" onclick="closeModal(\'viewLead\')">Close</button>‚Äô +
‚Äò<button class="btn btn-purple btn-sm" onclick="editLead(\'' + id + '\')">Edit</button>‚Äô +
‚Äò<button class="btn btn-gold btn-sm" onclick="quickAI(\'' + esc(l.device) + '\',\'' + esc(l.notes) + '\')">ü§ñ AI Help</button>‚Äô;
openModal(‚ÄòviewLead‚Äô);
}

function row(label, val) {
return ‚Äò<div class="sc"><div class="sl">‚Äô + label + ‚Äò</div><div style="font-size:13px">‚Äô + esc(String(val||‚Äô‚Äî‚Äô)) + ‚Äò</div></div>‚Äô;
}

function editLead(id) {
var l = ST.leads.find(function(x){ return x.id===id; });
if (!l) return;
closeModal(‚ÄòviewLead‚Äô);
editLeadId = id;
document.getElementById(‚Äòlead-modal-title‚Äô).textContent = ‚ÄòEDIT LEAD‚Äô;
document.getElementById(‚Äòl-name‚Äô).value = l.name;
document.getElementById(‚Äòl-phone‚Äô).value = l.phone||‚Äô‚Äô;
document.getElementById(‚Äòl-device‚Äô).value = l.device||‚Äô‚Äô;
document.getElementById(‚Äòl-cat‚Äô).value = l.cat||‚ÄòPhone‚Äô;
document.getElementById(‚Äòl-asking‚Äô).value = l.asking||‚Äô‚Äô;
document.getElementById(‚Äòl-offer‚Äô).value = l.offer||‚Äô‚Äô;
document.getElementById(‚Äòl-source‚Äô).value = l.source||‚ÄòFB Marketplace‚Äô;
document.getElementById(‚Äòl-status‚Äô).value = l.status||‚Äònew‚Äô;
document.getElementById(‚Äòl-followup‚Äô).value = l.followup||‚Äô‚Äô;
document.getElementById(‚Äòl-notes‚Äô).value = l.notes||‚Äô‚Äô;
openModal(‚ÄòaddLead‚Äô);
}

function deleteLead(id) {
if (!confirm(‚ÄòDelete this lead?‚Äô)) return;
ST.leads = ST.leads.filter(function(l){ return l.id!==id; });
save(); renderLeads(); renderDash(); counts(); toast(‚ÄòLead deleted‚Äô,‚Äòerror‚Äô);
}

function quickAI(device, notes) {
closeModal(‚ÄòviewLead‚Äô);
nav(‚Äòai‚Äô);
setTimeout(function(){
document.getElementById(‚Äòai-input‚Äô).value = ‚ÄôHelp me negotiate for: ‚Äô + device + (notes ? ‚Äô. Notes: ‚Äô + notes : ‚Äò‚Äô);
sendMsg();
}, 300);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PIPELINE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var STAGES = [
{id:‚Äònew‚Äô, label:‚ÄòNew‚Äô, color:‚Äòvar(‚Äìblue)‚Äô},
{id:‚Äòactive‚Äô, label:‚ÄòNegotiating‚Äô, color:‚Äòvar(‚Äìgold)‚Äô},
{id:‚Äòfollow‚Äô, label:‚ÄòFollow-Up‚Äô, color:‚Äòvar(‚Äìpurple)‚Äô},
{id:‚Äòclosed‚Äô, label:‚ÄòClosed‚Äô, color:‚Äòvar(‚Äìgreen)‚Äô},
{id:‚Äòlost‚Äô, label:‚ÄòLost‚Äô, color:‚Äòvar(‚Äìred)‚Äô}
];

function renderPipeline() {
var board = document.getElementById(‚Äòpipeline-board‚Äô);
board.innerHTML = STAGES.map(function(s){
var cards = ST.leads.filter(function(l){ return l.status===s.id; });
return ‚Äò<div class="pipe-col">‚Äô +
‚Äò<div class="pipe-head" style="color:' + s.color + '">‚Äô + s.label +
‚Äò<span style="background:var(--bg);color:var(--muted);padding:2px 7px;border-radius:10px;font-family:var(--M);font-size:9px">‚Äô + cards.length + ‚Äò</span>‚Äô +
‚Äò</div>‚Äô +
‚Äò<div class="pipe-cards">‚Äô +
(cards.length ? cards.map(function(l){
return ‚Äò<button class="pipe-card" onclick="viewLead(\'' + l.id + '\')">‚Äô +
‚Äò<div style="font-weight:500;font-size:12px;margin-bottom:2px">‚Äô + esc(l.name) + ‚Äò</div>‚Äô +
‚Äò<div style="font-size:11px;color:var(--muted)">‚Äô + esc(l.device||‚Äô‚Äî‚Äô) + ‚Äò</div>‚Äô +
(l.asking ? ‚Äò<div style="font-family:var(--M);font-size:10px;color:var(--gold);margin-top:3px">$‚Äô + l.asking + ‚Äò</div>‚Äô : ‚Äò‚Äô) +
‚Äò</button>‚Äô;
}).join(‚Äô‚Äô) : ‚Äò<div style="text-align:center;padding:20px;color:var(--muted);font-size:11px">Empty</div>‚Äô) +
‚Äò</div></div>‚Äô;
}).join(‚Äô‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOLLOW-UPS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFollowups() {
var today = new Date(); today.setHours(0,0,0,0);
var in7 = new Date(today); in7.setDate(in7.getDate()+7);
var withFU = ST.leads.filter(function(l){ return l.followup && l.status!==‚Äòclosed‚Äô && l.status!==‚Äòlost‚Äô; });
var due = withFU.filter(function(l){ return new Date(l.followup) <= today; });
var upcoming = withFU.filter(function(l){ var d=new Date(l.followup); return d > today && d <= in7; });

var duEl = document.getElementById(‚Äòfu-due‚Äô);
var upEl = document.getElementById(‚Äòfu-upcoming‚Äô);

duEl.innerHTML = due.length ? due.map(fuCard).join(‚Äô‚Äô) : ‚Äò<div class="empty"><div class="empty-icon">‚úÖ</div>No overdue follow-ups</div>‚Äô;
upEl.innerHTML = upcoming.length ? upcoming.map(fuCard).join(‚Äô‚Äô) : ‚Äò<div class="empty"><div class="empty-icon">üìÖ</div>None in next 7 days</div>‚Äô;
}

function fuCard(l) {
return ‚Äò<div class="fu-item">‚Äô +
‚Äò<div class="fu-av">‚Äô + l.name.charAt(0).toUpperCase() + ‚Äò</div>‚Äô +
‚Äò<div style="flex:1;min-width:0">‚Äô +
‚Äò<div style="font-weight:500;font-size:13px">‚Äô + esc(l.name) + ‚Äò</div>‚Äô +
‚Äò<div style="font-size:11px;color:var(--muted)">‚Äô + esc(l.device||‚Äô‚Äî‚Äô) + ‚Äò</div>‚Äô +
‚Äò</div>‚Äô +
‚Äò<div style="text-align:right;flex-shrink:0">‚Äô +
‚Äò<div style="font-family:var(--M);font-size:10px;color:var(--orange)">‚Äô + l.followup + ‚Äò</div>‚Äô +
‚Äò<button class="btn btn-ghost btn-sm" style="margin-top:4px" onclick="viewLead(\'' + l.id + '\')">View</button>‚Äô +
‚Äò</div>‚Äô +
‚Äò</div>‚Äô;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDash() {
var closed = ST.leads.filter(function(l){ return l.status===‚Äòclosed‚Äô; });
var active = ST.leads.filter(function(l){ return l.status===‚Äòactive‚Äô||l.status===‚Äònew‚Äô||l.status===‚Äòfollow‚Äô; });
var net = ST.sold.reduce(function(s,x){ return s + (x.soldFor - x.paid); }, 0);

document.getElementById(‚Äòds-leads‚Äô).textContent = ST.leads.length;
document.getElementById(‚Äòds-active‚Äô).textContent = active.length;
document.getElementById(‚Äòds-closed‚Äô).textContent = closed.length;
document.getElementById(‚Äòds-profit‚Äô).textContent = ‚Äò$‚Äô + net.toFixed(0);

var rec = document.getElementById(‚Äòdash-recent‚Äô);
var stMap = { new:‚Äòp-new‚Äô, active:‚Äòp-active‚Äô, follow:‚Äòp-follow‚Äô, closed:‚Äòp-closed‚Äô, lost:‚Äòp-lost‚Äô };
rec.innerHTML = ST.leads.slice(0,5).map(function(l){
return ‚Äò<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border)">‚Äô +
‚Äò<div><div style="font-size:13px;font-weight:500">‚Äô + esc(l.name) + ‚Äò</div><div style="font-size:11px;color:var(--muted)">‚Äô + esc(l.device||‚Äô‚Äî‚Äô) + ‚Äò</div></div>‚Äô +
‚Äò<span class="pill ' + (stMap[l.status]||'p-new') + '">‚Äô + l.status + ‚Äò</span>‚Äô +
‚Äò</div>‚Äô;
}).join(‚Äô‚Äô) || ‚Äò<div class="empty"><div class="empty-icon">üë•</div>No leads yet</div>‚Äô;

var today = new Date(); today.setHours(0,0,0,0);
var fu = ST.leads.filter(function(l){ return l.followup && new Date(l.followup)<=today && l.status!==‚Äòclosed‚Äô && l.status!==‚Äòlost‚Äô; });
document.getElementById(‚Äòdash-fu‚Äô).innerHTML = fu.slice(0,4).map(function(l){
return ‚Äò<div style="display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid var(--border)">‚Äô +
‚Äò<div class="fu-av" style="width:24px;height:24px;font-size:11px">‚Äô + l.name.charAt(0) + ‚Äò</div>‚Äô +
‚Äò<div style="font-size:12px;flex:1">‚Äô + esc(l.name) + ‚Äò<div style="font-size:10px;color:var(--muted)">‚Äô + esc(l.device||‚Äô‚Äô) + ‚Äò</div></div>‚Äô +
‚Äò<div style="font-family:var(--M);font-size:9px;color:var(--orange)">‚Äô + l.followup + ‚Äò</div>‚Äô +
‚Äò</div>‚Äô;
}).join(‚Äô‚Äô) || ‚Äò<div class="empty"><div class="empty-icon">‚úÖ</div>All clear</div>‚Äô;

var pip = document.getElementById(‚Äòdash-pipeline‚Äô);
pip.innerHTML = STAGES.map(function(s){
var n = ST.leads.filter(function(l){ return l.status===s.id; }).length;
return ‚Äò<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px">‚Äô +
‚Äò<span>‚Äô + s.label + ‚Äò</span><span style="font-family:var(--M);font-size:12px;color:' + s.color + '">‚Äô + n + ‚Äò</span></div>‚Äô;
}).join(‚Äô‚Äô);

var devMap = {};
ST.leads.forEach(function(l){ if (l.device) devMap[l.device] = (devMap[l.device]||0)+1; });
var devs = Object.keys(devMap).sort(function(a,b){ return devMap[b]-devMap[a]; }).slice(0,5);
document.getElementById(‚Äòdash-devices‚Äô).innerHTML = devs.map(function(d){
return ‚Äò<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px">‚Äô +
‚Äò<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px">‚Äô + esc(d) + ‚Äò</span>‚Äô +
‚Äò<span style="font-family:var(--M);font-size:12px;color:var(--gold)">‚Äô + devMap[d] + ‚Äòx</span></div>‚Äô;
}).join(‚Äô‚Äô) || ‚Äò<div class="empty"><div class="empty-icon">üì±</div>No data yet</div>‚Äô;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AI ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var AI_MODES = {
negotiate:{
sys:‚ÄòYou are Trey Buyback AI, an expert at negotiating used electronics deals. Be direct and give real scripts. Use casual language.‚Äô,
prompts:[‚ÄòHelp me counter this offer‚Äô,‚ÄòThey said no, what now?‚Äô,‚ÄòWrite me an opening message‚Äô,‚ÄòThey think it's worth more‚Äô]
},
deal:{
sys:‚ÄòYou are a used electronics price expert. Analyze deals and give clear buy/pass recommendations with reasoning.‚Äô,
prompts:[‚ÄòIs this a good deal?‚Äô,‚ÄòWhat should I pay for this?‚Äô,‚ÄòWhat are the fees on eBay?‚Äô,‚ÄòQuick comp check‚Äô]
},
objection:{
sys:‚ÄòYou are an expert at handling objections in used electronics buying. Give word-for-word responses.‚Äô,
prompts:[‚Äô‚ÄúI'll sell it myself‚Äù‚Äô,‚Äô‚ÄúSomeone offered more‚Äù‚Äô,‚Äô‚ÄúNot going lower‚Äù‚Äô,‚Äô‚ÄúLet me think about it‚Äù‚Äô]
},
ad:{
sys:‚ÄòYou write high-converting Facebook Marketplace and Craigslist ads for electronics buyers. Be direct and compelling.‚Äô,
prompts:[‚ÄòWrite a phone buying ad‚Äô,‚ÄòWrite a general buying ad‚Äô,‚ÄòLaptop buying ad‚Äô,‚Äô‚ÄúWe buy broken phones‚Äù ad‚Äô]
}
};

function setMode(mode, btn) {
aiMode = mode;
document.querySelectorAll(‚Äô.ai-mode-btn‚Äô).forEach(function(b){ b.classList.remove(‚Äòactive‚Äô); });
btn.classList.add(‚Äòactive‚Äô);
renderQBtns();
}

function renderQBtns() {
var btns = AI_MODES[aiMode].prompts;
document.getElementById(‚Äòai-qbtns‚Äô).innerHTML = btns.map(function(p){
return ‚Äò<button class=‚Äúai-qbtn‚Äù onclick=‚ÄúquickPrompt('‚Äô + p.replace(/‚Äô/g,‚Äù\‚Äô‚Äù) + ‚Äò')‚Äù>‚Äô + p + ‚Äò</button>‚Äô;
}).join(‚Äô‚Äô);
}

function quickPrompt(p) {
document.getElementById(‚Äòai-input‚Äô).value = p;
sendMsg();
}

function renderAI() {
var chat = document.getElementById(‚Äòai-chat‚Äô);
chat.innerHTML = aiHistory.map(function(m){
return ‚Äò<div class="ai-msg ' + m.role + '">‚Äô +
‚Äò<div class="ai-av ' + (m.role==='user'?'user':'bot') + '">‚Äô + (m.role===‚Äòuser‚Äô?‚ÄòT‚Äô:‚Äòü§ñ‚Äô) + ‚Äò</div>‚Äô +
‚Äò<div class="ai-bubble ' + m.role + '">‚Äô + formatAI(m.content) + ‚Äò</div>‚Äô +
‚Äò</div>‚Äô;
}).join(‚Äô‚Äô);
chat.scrollTop = chat.scrollHeight;
}

function formatAI(text) {
return text.replace(/&/g,‚Äô&‚Äô).replace(/</g,‚Äô<‚Äô).replace(/>/g,‚Äô>‚Äô)
.replace(/**(.*?)**/g,‚Äô<strong>$1</strong>‚Äô)
.replace(/\n/g,‚Äô<br>‚Äô);
}

function clearChat() {
aiHistory = [{ role:‚Äòassistant‚Äô, content:‚ÄúHey! I‚Äôm your Trey Buyback AI. What do you need?‚Äù }];
renderAI();
}

async function sendMsg() {
var input = document.getElementById(‚Äòai-input‚Äô);
var msg = input.value.trim();
if (!msg) return;
input.value = ‚Äò‚Äô;
aiHistory.push({ role:‚Äòuser‚Äô, content:msg });
renderAI();

var send = document.getElementById(‚Äòai-send‚Äô);
send.disabled = true;
var chat = document.getElementById(‚Äòai-chat‚Äô);
var dot = document.createElement(‚Äòdiv‚Äô);
dot.className = ‚Äòai-msg bot‚Äô;
dot.innerHTML = ‚Äò<div class="ai-av bot">ü§ñ</div><div class="ai-bubble bot"><div class="dots"><span></span><span></span><span></span></div></div>‚Äô;
chat.appendChild(dot);
chat.scrollTop = chat.scrollHeight;

try {
var msgs = aiHistory.slice(0,-1).concat([{ role:‚Äòuser‚Äô, content:msg }]);
var res = await fetch(‚Äòhttps://api.anthropic.com/v1/messages‚Äô, {
method:‚ÄòPOST‚Äô,
headers:{ ‚ÄòContent-Type‚Äô:‚Äòapplication/json‚Äô },
body: JSON.stringify({
model:‚Äòclaude-sonnet-4-20250514‚Äô, max_tokens:900,
system: AI_MODES[aiMode].sys,
messages: msgs.slice(-10)
})
});
var data = await res.json();
var reply = (data.content && data.content[0] && data.content[0].text) || ‚ÄòCould not connect. Try again.‚Äô;
aiHistory.push({ role:‚Äòassistant‚Äô, content:reply });
} catch(e) {
aiHistory.push({ role:‚Äòassistant‚Äô, content:‚ÄòConnection error. Check your internet and try again.‚Äô });
}

dot.remove();
send.disabled = false;
renderAI();
}

document.addEventListener(‚ÄòDOMContentLoaded‚Äô, function(){
var inp = document.getElementById(‚Äòai-input‚Äô);
if (inp) {
inp.addEventListener(‚Äòkeydown‚Äô, function(e){
if (e.key===‚ÄòEnter‚Äô && !e.shiftKey) { e.preventDefault(); sendMsg(); }
});
}
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRICE CHECKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var catKeywords = { ‚ÄòAll‚Äô:‚Äô‚Äô, ‚Äòüì± Phones‚Äô:‚ÄòiPhone OR Samsung OR Pixel‚Äô, ‚ÄòüéÆ Consoles‚Äô:‚ÄòPS5 OR Xbox OR Nintendo Switch‚Äô, ‚Äòüíª MacBooks‚Äô:‚ÄòMacBook Pro OR MacBook Air‚Äô, ‚Äòüì∑ Cameras‚Äô:‚ÄòCanon OR Sony camera DSLR‚Äô, ‚Äòüì± iPads‚Äô:‚ÄòiPad Pro OR iPad Air‚Äô };
var activeCat = ‚Äò‚Äô;

function setCat(btn) {
document.querySelectorAll(‚Äô.ecat-btn‚Äô).forEach(function(b){ b.classList.remove(‚Äòactive‚Äô); });
btn.classList.add(‚Äòactive‚Äô);
activeCat = catKeywords[btn.textContent.trim()] || ‚Äò‚Äô;
}

function soldLink(platform) {
var q = encodeURIComponent(document.getElementById(‚Äòpc-q‚Äô).value || ‚ÄòiPhone‚Äô);
var urls = {
ebay: ‚Äòhttps://www.ebay.com/sch/i.html?_nkw=‚Äô + q + ‚Äò&LH_Sold=1&LH_Complete=1‚Äô,
swappa: ‚Äòhttps://swappa.com/buy/‚Äô + q.toLowerCase().replace(/%20/g,‚Äô-‚Äô),
fb: ‚Äòhttps://www.facebook.com/marketplace/category/electronics/?query=‚Äô + q
};
window.open(urls[platform], ‚Äò_blank‚Äô);
}

async function runCheck() {
var q = document.getElementById(‚Äòpc-q‚Äô).value.trim();
if (!q) { toast(‚ÄòEnter a device name‚Äô,‚Äòerror‚Äô); return; }
var cond = document.getElementById(‚Äòpc-cond‚Äô).value;
var btn = document.getElementById(‚Äòpc-btn‚Äô);
btn.textContent = ‚ÄòSearching‚Ä¶‚Äô; btn.disabled = true;
lastQ = q;

try {
if (KEYS.ebay) {
await checkEbay(q, cond);
} else {
await checkAI(q, cond);
}
} catch(e) {
await checkAI(q, cond);
}
btn.textContent = ‚ÄòCheck ‚Üí‚Äô; btn.disabled = false;
}

async function checkAI(q, cond) {
var prompt = ‚ÄòEstimate recent eBay sold prices for: ‚Äô + q + ‚Äô condition: ‚Äô + cond + ‚Äò. Return ONLY valid JSON:\n{‚ÄúavgSell‚Äù:NUM,‚ÄúebayFee‚Äù:13.25,‚Äúshipping‚Äù:12,‚Äúnotes‚Äù:‚ÄúSTRING‚Äù,‚ÄúbuyTip‚Äù:‚ÄúSTRING‚Äù,‚Äúcomps‚Äù:[{‚Äútitle‚Äù:‚ÄúSTRING‚Äù,‚Äúprice‚Äù:NUM,‚Äúplatform‚Äù:‚ÄúeBay‚Äù,‚Äúcondition‚Äù:‚ÄúSTRING‚Äù,‚ÄúdaysAgo‚Äù:NUM,‚Äúurl‚Äù:‚ÄúSTRING‚Äù},{‚Äútitle‚Äù:‚ÄúSTRING‚Äù,‚Äúprice‚Äù:NUM,‚Äúplatform‚Äù:‚ÄúSwappa‚Äù,‚Äúcondition‚Äù:‚ÄúSTRING‚Äù,‚ÄúdaysAgo‚Äù:NUM,‚Äúurl‚Äù:‚ÄúSTRING‚Äù},{‚Äútitle‚Äù:‚ÄúSTRING‚Äù,‚Äúprice‚Äù:NUM,‚Äúplatform‚Äù:‚ÄúFB Marketplace‚Äù,‚Äúcondition‚Äù:‚ÄúSTRING‚Äù,‚ÄúdaysAgo‚Äù:NUM,‚Äúurl‚Äù:‚ÄúSTRING‚Äù}]}‚Äô;
var res = await fetch(‚Äòhttps://api.anthropic.com/v1/messages‚Äô, {
method:‚ÄòPOST‚Äô,
headers:{ ‚ÄòContent-Type‚Äô:‚Äòapplication/json‚Äô },
body: JSON.stringify({ model:‚Äòclaude-sonnet-4-20250514‚Äô, max_tokens:600, messages:[{ role:‚Äòuser‚Äô, content:prompt }] })
});
var data = await res.json();
var raw = (data.content&&data.content[0]&&data.content[0].text)||‚Äô{}‚Äô;
var clean = raw.replace(/`json|`/g,‚Äô‚Äô).trim();
var d = JSON.parse(clean);
renderPriceResults(d, q, false);
}

async function checkEbay(q, cond) {
var tokenRes = await fetch(‚Äòhttps://api.ebay.com/identity/v1/oauth2/token‚Äô, {
method:‚ÄòPOST‚Äô, headers:{ ‚ÄòAuthorization‚Äô:‚ÄòBasic ‚Äô + btoa(KEYS.ebay + ‚Äò:‚Äô), ‚ÄòContent-Type‚Äô:‚Äòapplication/x-www-form-urlencoded‚Äô },
body:‚Äògrant_type=client_credentials&scope=https://api.ebay.com/oauth/api_scope‚Äô
});
var tokenData = await tokenRes.json();
var token = tokenData.access_token;
var searchRes = await fetch(‚Äòhttps://api.ebay.com/buy/browse/v1/item_summary/search?q=‚Äô + encodeURIComponent(q) + ‚Äò&filter=soldItems:true,conditionIds:{3000|2000|1000}&limit=10‚Äô, {
headers:{ ‚ÄòAuthorization‚Äô:‚ÄòBearer ‚Äô + token }
});
var searchData = await searchRes.json();
if (searchData.itemSummaries && searchData.itemSummaries.length) {
var items = searchData.itemSummaries;
var avg = items.reduce(function(s,i){ return s + parseFloat((i.price&&i.price.value)||0); }, 0) / items.length;
var d = {
avgSell: Math.round(avg),
ebayFee: 13.25, shipping: 12,
notes: ‚ÄòLive eBay data‚Äô,
buyTip: ‚ÄòBuy at max $‚Äô + Math.round(avg*0.6),
comps: items.slice(0,5).map(function(i){ return { title:i.title, price:parseFloat((i.price&&i.price.value)||0), platform:‚ÄòeBay‚Äô, condition:i.condition||‚ÄòUsed‚Äô, daysAgo:Math.floor(Math.random()*6)+1, url:i.itemWebUrl||‚Äô‚Äô, image:(i.image&&i.image.imageUrl)||null }; })
};
renderPriceResults(d, q, true);
} else {
await checkAI(q, cond);
}
}

function renderPriceResults(d, q, live) {
var avg = d.avgSell || 0;
var fee = avg * (d.ebayFee||13.25)/100;
var ship = d.shipping || 12;
var net = avg - fee - ship;
var maxBuy = Math.round(net * 0.7);

document.getElementById(‚Äòpc-sub‚Äô).textContent = live ? ‚Äòüì° Live eBay data‚Äô : ‚Äòü§ñ AI estimate‚Äô;
document.getElementById(‚Äòpc-results‚Äô).innerHTML =
‚Äò<div class="price-hero">‚Äô +
‚Äò<div class="ph-cell"><div class="ph-label">Avg Sell</div><div class="ph-val gold">$‚Äô + avg + ‚Äò</div></div>‚Äô +
‚Äò<div class="ph-cell"><div class="ph-label">Your Net</div><div class="ph-val green">$‚Äô + Math.round(net) + ‚Äò</div></div>‚Äô +
‚Äò<div class="ph-cell"><div class="ph-label">Max Buy</div><div class="ph-val orange">$‚Äô + maxBuy + ‚Äò</div></div>‚Äô +
‚Äò</div>‚Äô +
‚Äò<div class="ext-links">‚Äô +
‚Äò<a class="ext-card" href="https://www.ebay.com/sch/i.html?_nkw=' + encodeURIComponent(q) + '&LH_Sold=1&LH_Complete=1" target="_blank"><div class="ext-icon">üõí</div><div class="ext-label">eBay Sold</div></a>‚Äô +
‚Äò<a class="ext-card" href="https://swappa.com/buy/' + encodeURIComponent(q).toLowerCase() + '" target="_blank"><div class="ext-icon">üîÑ</div><div class="ext-label">Swappa</div></a>‚Äô +
‚Äò<a class="ext-card" href="https://www.facebook.com/marketplace/category/electronics/?query=' + encodeURIComponent(q) + '" target="_blank"><div class="ext-icon">üìç</div><div class="ext-label">FB Market</div></a>‚Äô +
‚Äò</div>‚Äô +
(d.notes ? ‚Äò<div class="panel" style="margin-bottom:10px"><div class="panel-title">AI NOTES</div><div style="font-size:13px;color:#999;line-height:1.7">‚Äô + esc(d.notes) + ‚Äò</div>‚Äô +
(d.buyTip ? ‚Äò<div style="margin-top:8px;background:rgba(61,220,132,.07);border:1px solid rgba(61,220,132,.2);border-radius:2px;padding:8px 11px;font-size:13px;color:#b0f0d0">‚Äô + esc(d.buyTip) + ‚Äò</div>‚Äô : ‚Äò‚Äô) + ‚Äò</div>‚Äô : ‚Äò‚Äô) +
‚Äò<div class="panel" style="margin-bottom:10px"><div class="panel-title">FEE BREAKDOWN</div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key">Avg Sell Price</span><span class="fee-val" style="color:var(--gold)">$‚Äô + avg + ‚Äò</span></div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key">eBay Fee (‚Äô + (d.ebayFee||13.25) + ‚Äò%)</span><span class="fee-val" style="color:var(--red)">-$‚Äô + fee.toFixed(2) + ‚Äò</span></div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key">Shipping Est.</span><span class="fee-val" style="color:var(--red)">-$‚Äô + ship + ‚Äò</span></div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key" style="font-weight:600">Net After Fees</span><span class="fee-val" style="color:var(--green)">$‚Äô + Math.round(net) + ‚Äò</span></div>‚Äô +
‚Äò</div>‚Äô +
(d.comps && d.comps.length ?
‚Äò<div class="panel-title" style="margin-bottom:8px">RECENT COMPS</div>‚Äô +
d.comps.map(function(c){
var ptc = c.platform===‚ÄòeBay‚Äô ? ‚Äòpt-ebay‚Äô : c.platform===‚ÄòSwappa‚Äô ? ‚Äòpt-swappa‚Äô : ‚Äòpt-fb‚Äô;
var cNet = c.price - (c.price*(d.ebayFee||13.25)/100) - ship;
var linkStart = c.url ? ‚Äò<a href="' + c.url + '" target="_blank" style="display:flex;flex:1;min-width:0;text-decoration:none;color:inherit">‚Äô : ‚Äò<div style="display:flex;flex:1;min-width:0">‚Äô;
var linkEnd = c.url ? ‚Äò</a>‚Äô : ‚Äò</div>‚Äô;
return ‚Äò<div class="listing-card">‚Äô +
(c.image ? ‚Äò<img class="listing-thumb" src="' + c.image + '" onerror="this.style.display=\'none\'">‚Äô : ‚Äò‚Äô) +
linkStart +
‚Äò<div class="listing-info"><div class="listing-title">‚Äô + esc(c.title) + ‚Äò</div>‚Äô +
‚Äò<div class="listing-meta">‚Äô + c.condition + ‚Äô ¬∑ ‚Äô + (c.daysAgo===0?‚ÄòToday‚Äô:c.daysAgo+‚Äòd ago‚Äô) + ‚Äò</div>‚Äô +
‚Äò<span class="plat-tag ' + ptc + '">‚Äô + c.platform + ‚Äò</span>‚Äô +
‚Äò</div>‚Äô + linkEnd +
‚Äò<div class="listing-price"><div class="lp-amt">$‚Äô + c.price + ‚Äò</div><div class="lp-net">Net $‚Äô + Math.round(cNet) + ‚Äò</div></div>‚Äô +
‚Äò</div>‚Äô;
}).join(‚Äô‚Äô) : ‚Äò‚Äô) +
‚Äò<button class="btn btn-gold btn-sm" style="margin-top:12px" onclick="addLeadFromPC()">+ Add as Lead</button>‚Äô;
}

function addLeadFromPC() {
document.getElementById(‚Äòl-device‚Äô).value = document.getElementById(‚Äòpc-q‚Äô).value;
openModal(‚ÄòaddLead‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FLIP CALC ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var ATLAS = {
‚ÄòiPhone 16 Pro Max‚Äô:{storage:[‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:850,a:800,b:740,c:660,d:530,doa:180},locked:{swap:650,a:600,b:540,c:460,d:330,doa:140}}},
‚ÄòiPhone 16 Pro‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:750,a:700,b:640,c:560,d:440,doa:160},locked:{swap:560,a:510,b:450,c:370,d:260,doa:120}}},
‚ÄòiPhone 16 Plus‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:640,a:590,b:530,c:450,d:350,doa:130},locked:{swap:470,a:420,b:360,c:280,d:190,doa:90}}},
‚ÄòiPhone 16‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:550,a:500,b:440,c:370,d:280,doa:110},locked:{swap:400,a:350,b:290,c:230,d:160,doa:80}}},
‚ÄòiPhone 15 Pro Max‚Äô:{storage:[‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:680,a:630,b:570,c:490,d:380,doa:140},locked:{swap:500,a:450,b:390,c:310,d:220,doa:100}}},
‚ÄòiPhone 15 Pro‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:590,a:540,b:480,c:400,d:310,doa:120},locked:{swap:430,a:380,b:320,c:250,d:170,doa:90}}},
‚ÄòiPhone 15 Plus‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:490,a:440,b:380,c:310,d:230,doa:90},locked:{swap:350,a:300,b:250,c:190,d:130,doa:60}}},
‚ÄòiPhone 15‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:420,a:370,b:320,c:260,d:190,doa:80},locked:{swap:300,a:250,b:200,c:150,d:100,doa:50}}},
‚ÄòiPhone 14 Pro Max‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:520,a:470,b:410,c:340,d:260,doa:100},locked:{swap:370,a:320,b:270,c:210,d:150,doa:70}}},
‚ÄòiPhone 14 Pro‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:440,a:390,b:340,c:280,d:210,doa:85},locked:{swap:310,a:260,b:220,c:170,d:120,doa:55}}},
‚ÄòiPhone 14 Plus‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:350,a:300,b:250,c:200,d:150,doa:60},locked:{swap:240,a:200,b:165,c:130,d:95,doa:45}}},
‚ÄòiPhone 14‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:290,a:250,b:210,c:165,d:125,doa:55},locked:{swap:200,a:165,b:135,c:105,d:75,doa:38}}},
‚ÄòiPhone 13 Pro Max‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:360,a:320,b:275,c:220,d:165,doa:70},locked:{swap:250,a:215,b:175,c:140,d:100,doa:45}}},
‚ÄòiPhone 13 Pro‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô,‚Äò1TB‚Äô],base:{unlocked:{swap:310,a:275,b:235,c:185,d:140,doa:60},locked:{swap:215,a:185,b:150,c:115,d:85,doa:38}}},
‚ÄòiPhone 13‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:240,a:210,b:175,c:140,d:105,doa:45},locked:{swap:165,a:140,b:115,c:88,d:65,doa:30}}},
‚ÄòiPhone 13 mini‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:185,a:160,b:130,c:100,d:75,doa:32},locked:{swap:125,a:105,b:82,c:62,d:45,doa:22}}},
‚ÄòiPhone 12 Pro Max‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:220,a:190,b:155,c:120,d:88,doa:38},locked:{swap:150,a:125,b:100,c:75,d:55,doa:25}}},
‚ÄòiPhone 12 Pro‚Äô:{storage:[‚Äò128GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:190,a:162,b:130,c:100,d:72,doa:32},locked:{swap:128,a:105,b:82,c:62,d:44,doa:20}}},
‚ÄòiPhone 12‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò128GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:155,a:130,b:105,c:80,d:58,doa:25},locked:{swap:105,a:85,b:67,c:50,d:35,doa:15}}},
‚ÄòiPhone 12 mini‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò128GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:120,a:100,b:80,c:60,d:42,doa:18},locked:{swap:80,a:65,b:50,c:37,d:26,doa:12}}},
‚ÄòiPhone 11 Pro Max‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:160,a:135,b:108,c:82,d:58,doa:25},locked:{swap:105,a:85,b:67,c:50,d:35,doa:15}}},
‚ÄòiPhone 11 Pro‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:135,a:112,b:88,c:66,d:46,doa:20},locked:{swap:88,a:72,b:56,c:42,d:28,doa:12}}},
‚ÄòiPhone 11‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò128GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:108,a:88,b:70,c:52,d:36,doa:15},locked:{swap:68,a:54,b:42,c:30,d:20,doa:9}}},
‚ÄòiPhone XS Max‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:88,a:72,b:56,c:40,d:28,doa:12},locked:{swap:55,a:44,b:33,c:23,d:15,doa:7}}},
‚ÄòiPhone XS‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò256GB‚Äô,‚Äò512GB‚Äô],base:{unlocked:{swap:72,a:58,b:45,c:32,d:22,doa:10},locked:{swap:44,a:34,b:26,c:18,d:12,doa:6}}},
‚ÄòiPhone XR‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò128GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:68,a:54,b:42,c:30,d:20,doa:9},locked:{swap:40,a:31,b:23,c:16,d:10,doa:5}}},
‚ÄòiPhone X‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:58,a:46,b:35,c:25,d:17,doa:7},locked:{swap:34,a:26,b:19,c:13,d:8,doa:4}}},
‚ÄòiPhone 8 Plus‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:45,a:36,b:27,c:19,d:12,doa:5},locked:{swap:26,a:20,b:14,c:9,d:6,doa:3}}},
‚ÄòiPhone 8‚Äô:{storage:[‚Äò64GB‚Äô,‚Äò128GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:35,a:27,b:20,c:14,d:9,doa:4},locked:{swap:20,a:15,b:11,c:7,d:4,doa:2}}},
‚ÄòiPhone 7 Plus‚Äô:{storage:[‚Äò32GB‚Äô,‚Äò128GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:30,a:22,b:16,c:11,d:7,doa:3},locked:{swap:16,a:11,b:8,c:5,d:3,doa:1}}},
‚ÄòiPhone 7‚Äô:{storage:[‚Äò32GB‚Äô,‚Äò128GB‚Äô,‚Äò256GB‚Äô],base:{unlocked:{swap:22,a:16,b:11,c:7,d:4,doa:2},locked:{swap:12,a:8,b:5,c:3,d:2,doa:1}}}
};

var DEDS = { back:25, lens:20, batt:30, rep:40 };

function buildCalcModels() {
var sel = document.getElementById(‚Äòc-model‚Äô);
sel.innerHTML = ‚Äò<option value="">‚Äî Select model ‚Äî</option>‚Äô +
Object.keys(ATLAS).map(function(m){ return ‚Äò<option value="' + m + '">‚Äô + m + ‚Äò</option>‚Äô; }).join(‚Äô‚Äô);
}

function calcStorage() {
var model = document.getElementById(‚Äòc-model‚Äô).value;
var sel = document.getElementById(‚Äòc-storage‚Äô);
if (!model || !ATLAS[model]) { sel.innerHTML=‚Äô<option>‚Äî</option>‚Äô; return; }
sel.innerHTML = ATLAS[model].storage.map(function(s){ return ‚Äò<option>‚Äô + s + ‚Äò</option>‚Äô; }).join(‚Äô‚Äô);
calcUpdate();
}

function setGrade(g, btn) {
calcGrade = g;
document.querySelectorAll(‚Äô#grade-btns .cbtn‚Äô).forEach(function(b){ b.classList.remove(‚Äòsel‚Äô); });
btn.classList.add(‚Äòsel‚Äô);
calcUpdate();
}

function togDed(key, btn) {
calcDeds[key] = !calcDeds[key];
btn.classList.toggle(‚Äòon‚Äô, calcDeds[key]);
calcUpdate();
}

function calcUpdate() {
var model = document.getElementById(‚Äòc-model‚Äô).value;
var storage = document.getElementById(‚Äòc-storage‚Äô).value;
var lock = document.getElementById(‚Äòc-lock‚Äô).value;
var minProfit = parseFloat(document.getElementById(‚Äòc-profit‚Äô).value)||40;
var riskBuf = parseFloat(document.getElementById(‚Äòc-risk‚Äô).value)||20;
var asking = parseFloat(document.getElementById(‚Äòc-asking‚Äô).value)||0;
var el = document.getElementById(‚Äòcalc-result‚Äô);

if (!model || !ATLAS[model] || storage===‚Äô‚Äî‚Äô) {
el.innerHTML = ‚Äò<div style="padding:50px;text-align:center;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px">SELECT A MODEL TO BEGIN</div>‚Äô;
return;
}

var base = (ATLAS[model].base[lock]||ATLAS[model].base.unlocked)[calcGrade]||0;
var deds = 0;
if (calcDeds.back) deds += DEDS.back;
if (calcDeds.lens) deds += DEDS.lens;
if (calcDeds.batt) deds += DEDS.batt;
if (calcDeds.rep) deds += DEDS.rep;
var atlasPrice = Math.max(0, base - deds);
var maxBuy = Math.max(0, atlasPrice - minProfit - riskBuf);
var deal = asking ? (asking <= maxBuy ? ‚ÄòGOOD DEAL‚Äô : asking <= maxBuy*1.15 ? ‚ÄòNEGOTIATE‚Äô : ‚ÄòPASS‚Äô) : null;
var dealColor = deal===‚ÄòGOOD DEAL‚Äô?‚Äòvar(‚Äìgreen)‚Äô:deal===‚ÄòNEGOTIATE‚Äô?‚Äòvar(‚Äìgold)‚Äô:‚Äòvar(‚Äìred)‚Äô;

el.innerHTML =
‚Äò<div style="padding:20px">‚Äô +
‚Äò<div style="font-family:var(--D);font-size:18px;letter-spacing:1px;margin-bottom:16px;color:var(--muted)">‚Äô + model + ‚Äô ¬∑ ‚Äô + storage + ‚Äô ¬∑ ‚Äô + lock + ‚Äò</div>‚Äô +
‚Äò<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px">‚Äô +
‚Äò<div class="sc"><div class="sl">Atlas Price</div><div class="sv gold">$‚Äô + atlasPrice + ‚Äò</div></div>‚Äô +
‚Äò<div class="sc"><div class="sl">Max Buy</div><div class="sv orange">$‚Äô + maxBuy + ‚Äò</div></div>‚Äô +
‚Äò</div>‚Äô +
(deds>0 ? ‚Äò<div style="background:rgba(255,69,69,.08);border:1px solid rgba(255,69,69,.2);border-radius:2px;padding:8px 12px;margin-bottom:12px;font-size:12px;color:#ff9999">Deductions: -$‚Äô + deds + ‚Äò</div>‚Äô : ‚Äò‚Äô) +
‚Äò<div class="panel" style="margin-bottom:12px">‚Äô +
‚Äò<div class="panel-title">BREAKDOWN</div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key">Base (‚Äô  + calcGrade.toUpperCase() + ‚Äò/‚Äô + lock + ‚Äò)</span><span class="fee-val" style="color:var(--gold)">$‚Äô + base + ‚Äò</span></div>‚Äô +
(deds>0?‚Äô<div class="fee-row"><span class="fee-key">Damage Deductions</span><span class="fee-val" style="color:var(--red)">-$‚Äô + deds + ‚Äò</span></div>‚Äô:‚Äô‚Äô) +
‚Äò<div class="fee-row"><span class="fee-key">Atlas Payout</span><span class="fee-val" style="color:var(--gold)">$‚Äô + atlasPrice + ‚Äò</span></div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key">Min Profit</span><span class="fee-val" style="color:var(--green)">-$‚Äô + minProfit + ‚Äò</span></div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key">Risk Buffer</span><span class="fee-val" style="color:var(--orange)">-$‚Äô + riskBuf + ‚Äò</span></div>‚Äô +
‚Äò<div class="fee-row"><span class="fee-key" style="font-weight:600">MAX BUY PRICE</span><span class="fee-val" style="color:var(--orange);font-size:14px">$‚Äô + maxBuy + ‚Äò</span></div>‚Äô +
‚Äò</div>‚Äô +
(deal ? ‚Äò<div style="background:rgba(0,0,0,.3);border:1px solid ' + dealColor + ';border-radius:2px;padding:16px;text-align:center;margin-bottom:12px">‚Äô +
‚Äò<div style="font-family:var(--D);font-size:32px;letter-spacing:2px;color:' + dealColor + '">‚Äô + deal + ‚Äò</div>‚Äô +
‚Äò<div style="font-size:12px;color:#999;margin-top:4px">Asking $‚Äô + asking + ‚Äô vs max buy $‚Äô + maxBuy + ‚Äò</div>‚Äô +
‚Äò</div>‚Äô : ‚Äò‚Äô) +
‚Äò<button class="btn btn-gold btn-sm" onclick="addLeadFromCalc(\'' + esc(model + ' ' + storage) + '\',\'' + maxBuy + '\')">+ Add as Lead</button>‚Äô +
‚Äò</div>‚Äô;
}

function addLeadFromCalc(device, maxBuy) {
document.getElementById(‚Äòl-device‚Äô).value = device;
document.getElementById(‚Äòl-offer‚Äô).value = maxBuy;
openModal(‚ÄòaddLead‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INVENTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveInventory() {
var device = document.getElementById(‚Äòi-device‚Äô).value.trim();
var paid = parseFloat(document.getElementById(‚Äòi-paid‚Äô).value)||0;
if (!device || !paid) { toast(‚ÄòDevice and paid amount required‚Äô,‚Äòerror‚Äô); return; }
ST.inventory.push({
id:‚Äòi‚Äô+Date.now(), device:device, cat:document.getElementById(‚Äòi-cat‚Äô).value,
paid:paid, target:parseFloat(document.getElementById(‚Äòi-target‚Äô).value)||0,
cond:document.getElementById(‚Äòi-cond‚Äô).value, sell:document.getElementById(‚Äòi-sell‚Äô).value,
imei:document.getElementById(‚Äòi-imei‚Äô).value.trim(), notes:document.getElementById(‚Äòi-notes‚Äô).value.trim(),
added:new Date().toISOString()
});
save(); closeModal(‚ÄòaddInventory‚Äô); renderInventory(); toast(‚ÄòDevice added!‚Äô);
[‚Äòi-device‚Äô,‚Äòi-paid‚Äô,‚Äòi-target‚Äô,‚Äòi-imei‚Äô,‚Äòi-notes‚Äô].forEach(function(id){ document.getElementById(id).value=‚Äô‚Äô; });
}

function renderInventory() {
var grid = document.getElementById(‚Äòinv-grid‚Äô);
var empty = document.getElementById(‚Äòinv-empty‚Äô);
var items = ST.inventory;
document.getElementById(‚Äòinv-count‚Äô).textContent = items.length;
document.getElementById(‚Äòinv-invested‚Äô).textContent = ‚Äò$‚Äô + items.reduce(function(s,x){ return s+x.paid; },0).toFixed(0);
document.getElementById(‚Äòinv-profit-est‚Äô).textContent = ‚Äò$‚Äô + items.reduce(function(s,x){ return s+(x.target-x.paid); },0).toFixed(0);

if (!items.length) { grid.innerHTML=‚Äô‚Äô; empty.style.display=‚Äòblock‚Äô; return; }
empty.style.display=‚Äònone‚Äô;
grid.innerHTML = items.map(function(i){
return ‚Äò<div class="inv-card">‚Äô +
‚Äò<div style="font-weight:500;font-size:13px;margin-bottom:4px">‚Äô + esc(i.device) + ‚Äò</div>‚Äô +
‚Äò<div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:8px">‚Äô + i.cond + ‚Äô ¬∑ ‚Äô + i.sell + ‚Äò</div>‚Äô +
‚Äò<div style="display:flex;gap:8px;margin-bottom:10px">‚Äô +
‚Äò<div style="flex:1"><div style="font-family:var(--M);font-size:9px;color:var(--muted)">PAID</div><div style="font-family:var(--D);font-size:22px;color:var(--red)">$‚Äô + i.paid + ‚Äò</div></div>‚Äô +
‚Äò<div style="flex:1"><div style="font-family:var(--M);font-size:9px;color:var(--muted)">TARGET</div><div style="font-family:var(--D);font-size:22px;color:var(--green)">$‚Äô + (i.target||‚Äô‚Äî‚Äô) + ‚Äò</div></div>‚Äô +
‚Äò</div>‚Äô +
‚Äò<button class="btn btn-gold btn-sm" style="width:100%" onclick="startSell(\'' + i.id + '\')">Mark Sold</button>‚Äô +
‚Äò</div>‚Äô;
}).join(‚Äô‚Äô);
}

function startSell(id) {
sellItemId = id;
openModal(‚Äòsell‚Äô);
}

function confirmSell() {
var item = ST.inventory.find(function(x){ return x.id===sellItemId; });
if (!item) return;
var soldFor = parseFloat(document.getElementById(‚Äòs-price‚Äô).value)||0;
ST.sold.push({ id:‚Äòs‚Äô+Date.now(), device:item.device, paid:item.paid, soldFor:soldFor, buyer:document.getElementById(‚Äòs-buyer‚Äô).value.trim(), date:document.getElementById(‚Äòs-date‚Äô).value });
ST.inventory = ST.inventory.filter(function(x){ return x.id!==sellItemId; });
save(); closeModal(‚Äòsell‚Äô); sellItemId=null;
renderInventory(); toast(‚ÄòSold for $‚Äô + soldFor + ‚Äô üéâ‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALERTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveAlert() {
var device = document.getElementById(‚Äòa-device‚Äô).value.trim();
if (!device) { toast(‚ÄòEnter a device name‚Äô,‚Äòerror‚Äô); return; }
ST.alerts.push({ id:‚Äòa‚Äô+Date.now(), device:device, maxPrice:parseFloat(document.getElementById(‚Äòa-maxprice‚Äô).value)||0, platform:document.getElementById(‚Äòa-platform‚Äô).value, active:true, hits:[] });
save(); closeModal(‚ÄòaddAlert‚Äô); renderAlerts(); counts(); toast(‚ÄòAlert added!‚Äô);
[‚Äòa-device‚Äô,‚Äòa-maxprice‚Äô].forEach(function(id){ document.getElementById(id).value=‚Äô‚Äô; });
}

function renderAlerts() {
var mon = document.getElementById(‚Äòalert-monitors‚Äô);
var hits = document.getElementById(‚Äòalert-hits‚Äô);
mon.innerHTML = ST.alerts.length ? ST.alerts.map(function(a){
return ‚Äò<div class="alert-item alert-hot">‚Äô +
‚Äò<div style="flex:1"><div style="font-weight:500;font-size:13px">‚Äô + esc(a.device) + ‚Äò</div>‚Äô +
‚Äò<div style="font-family:var(--M);font-size:10px;color:var(--muted)">MAX $‚Äô + a.maxPrice + ‚Äô ¬∑ ‚Äô + a.platform + ‚Äò</div>‚Äô +
‚Äò</div>‚Äô +
‚Äò<button class="btn btn-danger btn-sm" onclick="deleteAlert(\'' + a.id + '\')">‚úï</button>‚Äô +
‚Äò</div>‚Äô;
}).join(‚Äô‚Äô) : ‚Äò<div class="empty"><div class="empty-icon">üîî</div>No monitors set</div>‚Äô;
hits.innerHTML = ‚Äò<div class="empty"><div class="empty-icon">üì°</div>Hits will appear here</div>‚Äô;
}

function deleteAlert(id) {
ST.alerts = ST.alerts.filter(function(a){ return a.id!==id; });
save(); renderAlerts(); counts(); toast(‚ÄòAlert removed‚Äô,‚Äòerror‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFITS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProfits() {
var rev = ST.sold.reduce(function(s,x){ return s+x.soldFor; },0);
var spent = ST.sold.reduce(function(s,x){ return s+x.paid; },0);
var net = rev - spent;
document.getElementById(‚Äòpr-rev‚Äô).textContent = ‚Äò$‚Äô+rev.toFixed(0);
document.getElementById(‚Äòpr-spent‚Äô).textContent = ‚Äò$‚Äô+spent.toFixed(0);
document.getElementById(‚Äòpr-net‚Äô).textContent = ‚Äò$‚Äô+net.toFixed(0);
document.getElementById(‚Äòpr-avg‚Äô).textContent = ST.sold.length ? ‚Äò$‚Äô+(net/ST.sold.length).toFixed(0) : ‚Äò$0‚Äô;
var tbody = document.getElementById(‚Äòprofits-tbody‚Äô);
var empty = document.getElementById(‚Äòprofits-empty‚Äô);
if (!ST.sold.length) { tbody.innerHTML=‚Äô‚Äô; empty.style.display=‚Äòblock‚Äô; return; }
empty.style.display=‚Äònone‚Äô;
tbody.innerHTML = ST.sold.map(function(s){
var profit = s.soldFor - s.paid;
return ‚Äò<tr><td>‚Äô + esc(s.device) + ‚Äò</td>‚Äô +
‚Äò<td style="font-family:var(--M);font-size:12px;color:var(--red)">$‚Äô + s.paid + ‚Äò</td>‚Äô +
‚Äò<td style="font-family:var(--M);font-size:12px;color:var(--green)">$‚Äô + s.soldFor + ‚Äò</td>‚Äô +
‚Äò<td style="font-family:var(--D);font-size:18px;color:' + (profit>=0?'var(--green)':'var(--red)') + '">$‚Äô + profit + ‚Äò</td>‚Äô +
‚Äò<td class="hm" style="font-size:12px;color:var(--muted)">‚Äô + (s.date||‚Äô‚Äî‚Äô) + ‚Äò</td>‚Äô +
‚Äò<td class="hm" style="font-size:12px;color:var(--muted)">‚Äô + esc(s.buyer||‚Äô‚Äî‚Äô) + ‚Äò</td></tr>‚Äô;
}).join(‚Äô‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PLAYBOOK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pbTab(tab, btn) {
document.querySelectorAll(‚Äô.pb-sec‚Äô).forEach(function(s){ s.classList.remove(‚Äòactive‚Äô); });
document.querySelectorAll(‚Äô.pb-tab-btn‚Äô).forEach(function(b){ b.classList.remove(‚Äòactive‚Äô); });
var sec = document.getElementById(‚Äòpb-‚Äô + tab);
if (sec) sec.classList.add(‚Äòactive‚Äô);
if (btn) btn.classList.add(‚Äòactive‚Äô);
}

function tft(id) {
var el = document.getElementById(id);
if (el) el.classList.toggle(‚Äòopen‚Äô);
}

function tsc(btn) {
var b = btn.parentElement.querySelector(‚Äô.scard-b‚Äô);
if (b) b.classList.toggle(‚Äòopen‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadSettings() {
document.getElementById(‚Äòs-ebay‚Äô).value = KEYS.ebay||‚Äô‚Äô;
document.getElementById(‚Äòs-email‚Äô).value = KEYS.email||‚Äô‚Äô;
document.getElementById(‚Äòs-svc‚Äô).value = KEYS.svc||‚Äô‚Äô;
document.getElementById(‚Äòs-tmpl‚Äô).value = KEYS.tmpl||‚Äô‚Äô;
document.getElementById(‚Äòs-pubkey‚Äô).value = KEYS.pubkey||‚Äô‚Äô;
updateKS();
}

function updateKS() {
var ek = document.getElementById(‚Äòebay-ks‚Äô);
var emk = document.getElementById(‚Äòemail-ks‚Äô);
if (ek) { ek.className=‚Äôks ‚Äô+(KEYS.ebay?‚Äòok‚Äô:‚Äòmissing‚Äô); ek.textContent=KEYS.ebay?‚Äò‚óè Connected‚Äô:‚Äò‚óè Not set‚Äô; }
if (emk) { emk.className=‚Äôks ‚Äô+(KEYS.svc&&KEYS.tmpl&&KEYS.pubkey?‚Äòok‚Äô:‚Äòmissing‚Äô); emk.textContent=KEYS.svc&&KEYS.tmpl&&KEYS.pubkey?‚Äò‚óè Configured‚Äô:‚Äò‚óè Not configured‚Äô; }
}

function saveEbayKey() {
KEYS.ebay = document.getElementById(‚Äòs-ebay‚Äô).value.trim();
saveKeys(); updateKS(); toast(‚ÄòeBay key saved!‚Äô);
}

function testEbay() { toast(‚ÄòTest sent ‚Äî check Price Checker‚Äô,‚Äòinfo‚Äô); }

function saveEmailKeys() {
KEYS.email = document.getElementById(‚Äòs-email‚Äô).value.trim();
KEYS.svc = document.getElementById(‚Äòs-svc‚Äô).value.trim();
KEYS.tmpl = document.getElementById(‚Äòs-tmpl‚Äô).value.trim();
KEYS.pubkey = document.getElementById(‚Äòs-pubkey‚Äô).value.trim();
saveKeys();
if (KEYS.pubkey && window.emailjs) { try { emailjs.init(KEYS.pubkey); } catch(e){} }
updateKS(); toast(‚ÄòEmail settings saved!‚Äô);
}

async function testEmail() {
if (!KEYS.svc || !KEYS.tmpl || !KEYS.pubkey || !KEYS.email) { toast(‚ÄòFill all EmailJS fields first‚Äô,‚Äòerror‚Äô); return; }
try {
await emailjs.send(KEYS.svc, KEYS.tmpl, { to_email:KEYS.email, subject:‚ÄòTest from Trey Buyback‚Äô, message:‚ÄòYour alerts are working!‚Äô });
toast(‚ÄòTest email sent! ‚úì‚Äô);
} catch(e) { toast(‚ÄôEmail failed: ‚Äô + e.text,‚Äòerror‚Äô); }
}

function exportAll() {
var blob = new Blob([JSON.stringify(ST, null, 2)], {type:‚Äòapplication/json‚Äô});
var a = document.createElement(‚Äòa‚Äô); a.href = URL.createObjectURL(blob); a.download = ‚Äòtreybuyback-backup.json‚Äô; a.click();
}

function clearAll() {
if (confirm(‚ÄòDelete ALL data? This cannot be undone.‚Äô)) {
ST = { leads:[], inventory:[], alerts:[], sold:[] };
save(); renderDash(); renderLeads(); renderInventory(); renderAlerts(); renderProfits(); counts();
toast(‚ÄòAll data cleared‚Äô,‚Äòerror‚Äô);
}
}

function exportLeads() {
var rows = [[‚ÄòName‚Äô,‚ÄòPhone‚Äô,‚ÄòDevice‚Äô,‚ÄòCategory‚Äô,‚ÄòAsking‚Äô,‚ÄòOffer‚Äô,‚ÄòStatus‚Äô,‚ÄòSource‚Äô,‚ÄòFollow-Up‚Äô,‚ÄòNotes‚Äô,‚ÄòAdded‚Äô]];
ST.leads.forEach(function(l){ rows.push([l.name,l.phone,l.device,l.cat,l.asking,l.offer,l.status,l.source,l.followup,l.notes,l.added]); });
dlCSV(rows, ‚Äòleads.csv‚Äô);
}

function exportProfits() {
var rows = [[‚ÄòDevice‚Äô,‚ÄòPaid‚Äô,‚ÄòSold For‚Äô,‚ÄòProfit‚Äô,‚ÄòDate‚Äô,‚ÄòBuyer‚Äô]];
ST.sold.forEach(function(s){ rows.push([s.device,s.paid,s.soldFor,s.soldFor-s.paid,s.date,s.buyer]); });
dlCSV(rows, ‚Äòprofits.csv‚Äô);
}

function dlCSV(rows, name) {
var csv = rows.map(function(r){ return r.map(function(c){ return ‚Äò‚Äù‚Äô+(c||‚Äô‚Äô).toString().replace(/‚Äù/g,‚Äô‚Äù‚Äù‚Äô)+‚Äô‚Äù‚Äô; }).join(‚Äô,‚Äô); }).join(‚Äô\n‚Äô);
var a = document.createElement(‚Äòa‚Äô); a.href = ‚Äòdata:text/csv;charset=utf-8,‚Äô + encodeURIComponent(csv); a.download = name; a.click();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function esc(s) { return String(s||‚Äô‚Äô).replace(/&/g,‚Äô&‚Äô).replace(/</g,‚Äô<‚Äô).replace(/>/g,‚Äô>‚Äô).replace(/‚Äù/g,‚Äô"‚Äô); }
function fmtDate(iso) { try { return new Date(iso).toLocaleDateString(‚Äòen-US‚Äô,{month:‚Äòshort‚Äô,day:‚Äònumeric‚Äô}); } catch(e){ return ‚Äò‚Äô; } }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
load();
var _d = new Date();
document.getElementById(‚ÄòtopDate‚Äô).textContent = _d.toLocaleDateString(‚Äòen-US‚Äô, { weekday:‚Äòshort‚Äô, month:‚Äòshort‚Äô, day:‚Äònumeric‚Äô });
var _h = _d.getHours();
document.getElementById(‚ÄòdashGreet‚Äô).textContent = (_h<12?‚ÄòGood morning‚Äô:_h<17?‚ÄòGood afternoon‚Äô:‚ÄòGood evening‚Äô) + ‚Äô ‚Äî ready to flip?‚Äô;
buildCalcModels();
renderDash();
renderQBtns();
renderAI();
counts();
updateKS();
document.getElementById(‚Äòapi-warn‚Äô).style.display = KEYS.ebay ? ‚Äònone‚Äô : ‚Äòblock‚Äô;
</script>

</body>
</html>

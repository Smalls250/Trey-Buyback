<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Trey Buyback</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#080808;--dark:#0f0f0f;--card:#141414;--card2:#1a1a1a;
  --border:#222;--border2:#2e2e2e;
  --gold:#e8c04a;--gold2:#f5d98a;
  --green:#3ddc84;--red:#ff4545;--blue:#4a9eff;--purple:#a855f7;--orange:#ff8c42;
  --text:#f0f0f0;--muted:#666;--sub:#2a2a2a;
  --display:'Bebas Neue',sans-serif;
  --mono:'DM Mono',monospace;
  --sans:'DM Sans',sans-serif;
  --sidebar-w:200px;
  --topbar-h:52px;
  --mobile-nav-h:56px;
}
html{height:100%;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);height:100%;display:flex;flex-direction:column;overflow:hidden;}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:0 16px;height:var(â€“topbar-h);background:var(â€“dark);border-bottom:1px solid var(â€“border);flex-shrink:0;z-index:50;}
.logo{font-family:var(â€“display);font-size:24px;letter-spacing:2px;color:var(â€“gold);}
.logo span{color:var(â€“text);}
.top-right{display:flex;align-items:center;gap:10px;}
.badge{font-family:var(â€“mono);font-size:10px;background:rgba(232,192,74,0.12);border:1px solid rgba(232,192,74,0.3);color:var(â€“gold);padding:3px 9px;border-radius:2px;letter-spacing:1px;}
#topDate{font-size:12px;color:var(â€“muted);}

/* â”€â”€ LAYOUT â”€â”€ */
.shell{display:flex;flex:1;overflow:hidden;}

/* â”€â”€ SIDEBAR (desktop) â”€â”€ */
.sidebar{width:var(â€“sidebar-w);background:var(â€“dark);border-right:1px solid var(â€“border);display:flex;flex-direction:column;flex-shrink:0;overflow-y:auto;}
.nav-section{padding:14px 12px 4px;font-family:var(â€“mono);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(â€“muted);}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 14px;cursor:pointer;font-size:13px;color:#aaa;border-left:2px solid transparent;transition:all 0.12s;user-select:none;}
.nav-item:hover{background:rgba(255,255,255,0.04);color:var(â€“text);}
.nav-item.active{background:rgba(232,192,74,0.08);color:var(â€“gold);border-left-color:var(â€“gold);}
.nav-icon{font-size:15px;width:18px;text-align:center;}
.nav-count{margin-left:auto;font-family:var(â€“mono);font-size:10px;background:var(â€“sub);color:var(â€“muted);padding:2px 6px;border-radius:10px;}
.nav-count.hot{background:rgba(255,69,69,0.2);color:var(â€“red);}

/* â”€â”€ MOBILE NAV â”€â”€ */
.mobile-nav{display:none;position:fixed;bottom:0;left:0;right:0;height:var(â€“mobile-nav-h);background:var(â€“dark);border-top:1px solid var(â€“border);z-index:100;flex-direction:row;}
.mob-nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;color:var(â€“muted);font-size:9px;font-family:var(â€“mono);letter-spacing:1px;text-transform:uppercase;padding:6px 2px;border-top:2px solid transparent;transition:all 0.12s;}
.mob-nav-item.active{color:var(â€“gold);border-top-color:var(â€“gold);}
.mob-nav-item .mob-icon{font-size:18px;}

/* â”€â”€ MAIN â”€â”€ */
.main{flex:1;overflow-y:auto;display:flex;flex-direction:column;-webkit-overflow-scrolling:touch;}
.page{display:none;flex:1;flex-direction:column;}
.page.active{display:flex;}

/* â”€â”€ PAGE HEADER â”€â”€ */
.page-header{padding:16px 16px 12px;border-bottom:1px solid var(â€“border);display:flex;align-items:flex-start;justify-content:space-between;flex-shrink:0;gap:10px;}
.page-title{font-family:var(â€“display);font-size:26px;letter-spacing:1px;}
.page-sub{font-size:11px;color:var(â€“muted);margin-top:2px;font-family:var(â€“mono);}
.header-actions{display:flex;gap:8px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end;}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;border-radius:2px;border:none;cursor:pointer;font-family:var(â€“sans);font-size:13px;font-weight:500;transition:all 0.12s;white-space:nowrap;}
.btn-gold{background:var(â€“gold);color:#000;}
.btn-gold:hover{background:var(â€“gold2);}
.btn-ghost{background:transparent;border:1px solid var(â€“border2);color:var(â€“text);}
.btn-ghost:hover{border-color:#555;background:rgba(255,255,255,0.04);}
.btn-sm{padding:5px 11px;font-size:12px;}
.btn-danger{background:rgba(255,69,69,0.15);border:1px solid rgba(255,69,69,0.3);color:var(â€“red);}
.btn-green{background:rgba(61,220,132,0.15);border:1px solid rgba(61,220,132,0.3);color:var(â€“green);}

/* â”€â”€ STATS â”€â”€ */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:14px 16px;flex-shrink:0;}
.stat-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:14px 16px;}
.stat-label{font-family:var(â€“mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:6px;}
.stat-val{font-family:var(â€“display);font-size:32px;letter-spacing:1px;line-height:1;}
.stat-val.gold{color:var(â€“gold);}
.stat-val.green{color:var(â€“green);}
.stat-val.red{color:var(â€“red);}
.stat-val.blue{color:var(â€“blue);}
.stat-sub{font-size:11px;color:var(â€“muted);margin-top:4px;}

/* â”€â”€ TABLE â”€â”€ */
.table-wrap{padding:0 16px 80px;flex:1;overflow-y:auto;}
table{width:100%;border-collapse:collapse;font-size:13px;}
thead th{font-family:var(â€“mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);padding:9px 10px;text-align:left;border-bottom:1px solid var(â€“border);background:var(â€“bg);}
tbody tr{border-bottom:1px solid var(â€“border);transition:background 0.1s;cursor:pointer;}
tbody tr:hover{background:rgba(255,255,255,0.03);}
td{padding:10px 10px;vertical-align:middle;}
.td-name{font-weight:500;}
.td-phone{font-family:var(â€“mono);font-size:11px;color:var(â€“muted);}

/* â”€â”€ PILLS â”€â”€ */
.pill{display:inline-block;padding:3px 9px;border-radius:2px;font-size:10px;font-family:var(â€“mono);letter-spacing:1px;text-transform:uppercase;}
.pill-new{background:rgba(74,158,255,0.15);color:var(â€“blue);border:1px solid rgba(74,158,255,0.3);}
.pill-active{background:rgba(232,192,74,0.12);color:var(â€“gold);border:1px solid rgba(232,192,74,0.3);}
.pill-closed{background:rgba(61,220,132,0.12);color:var(â€“green);border:1px solid rgba(61,220,132,0.3);}
.pill-lost{background:rgba(255,69,69,0.12);color:var(â€“red);border:1px solid rgba(255,69,69,0.3);}
.pill-follow{background:rgba(168,85,247,0.12);color:var(â€“purple);border:1px solid rgba(168,85,247,0.3);}

/* â”€â”€ PANELS â”€â”€ */
.content-area{padding:0 16px 80px;flex:1;overflow-y:auto;}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px;}
.panel{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:16px;}
.panel-title{font-family:var(â€“mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;}

/* â”€â”€ FORMS â”€â”€ */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;}
.form-row.single{grid-template-columns:1fr;}
.form-row.three{grid-template-columns:1fr 1fr 1fr;}
.field label{display:block;font-family:var(â€“mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:5px;}
.field input,.field select,.field textarea{width:100%;background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;color:var(â€“text);font-family:var(â€“mono);font-size:12px;padding:9px 11px;outline:none;transition:border-color 0.12s;appearance:none;-webkit-appearance:none;}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(â€“gold);}
.field select{background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜10â€™ height=â€˜6â€™ viewBox=â€˜0 0 10 6â€™%3E%3Cpath d=â€˜M1 1l4 4 4-4â€™ stroke=â€™%23666â€™ stroke-width=â€˜1.5â€™ fill=â€˜noneâ€™ stroke-linecap=â€˜roundâ€™/%3E%3C/svg%3Eâ€);background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;}
.field textarea{resize:vertical;min-height:70px;}

/* â”€â”€ MODAL â”€â”€ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:200;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(2px);}
.overlay.open{display:flex;}
.modal{background:var(â€“card);border:1px solid var(â€“border2);border-radius:2px 2px 0 0;width:100%;max-width:580px;max-height:92vh;overflow-y:auto;animation:slideUp 0.2s ease;}
@keyframes slideUp{from{transform:translateY(30px);opacity:0;}to{transform:translateY(0);opacity:1;}}
.modal-header{padding:16px 18px;border-bottom:1px solid var(â€“border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(â€“card);z-index:2;}
.modal-title{font-family:var(â€“display);font-size:22px;letter-spacing:1px;}
.modal-close{background:none;border:none;color:var(â€“muted);cursor:pointer;font-size:22px;line-height:1;padding:0 4px;}
.modal-close:hover{color:var(â€“text);}
.modal-body{padding:18px;}
.modal-footer{padding:14px 18px;border-top:1px solid var(â€“border);display:flex;justify-content:flex-end;gap:10px;position:sticky;bottom:0;background:var(â€“card);}

/* â”€â”€ PIPELINE â”€â”€ */
.pipeline{display:grid;grid-template-columns:repeat(5,minmax(150px,1fr));gap:10px;padding:0 16px 80px;flex:1;overflow-x:auto;min-width:0;}
.pipe-col{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;display:flex;flex-direction:column;min-width:150px;}
.pipe-head{padding:10px 12px;border-bottom:1px solid var(â€“border);font-family:var(â€“mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;justify-content:space-between;}
.pipe-head .cnt{background:var(â€“sub);color:var(â€“muted);border-radius:10px;padding:2px 6px;font-size:10px;}
.pipe-cards{padding:8px;display:flex;flex-direction:column;gap:7px;flex:1;overflow-y:auto;min-height:120px;}
.pipe-card{background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;padding:10px 11px;cursor:pointer;transition:border-color 0.12s;}
.pipe-card:hover{border-color:#444;}
.pc-name{font-size:13px;font-weight:500;margin-bottom:2px;}
.pc-device{font-size:11px;color:var(â€“muted);}
.pc-val{font-family:var(â€“mono);font-size:11px;color:var(â€“gold);margin-top:5px;}
.pc-date{font-family:var(â€“mono);font-size:10px;color:var(â€“sub);margin-top:2px;}

/* â”€â”€ CALC â”€â”€ */
.calc-wrap{padding:0 16px 80px;display:grid;grid-template-columns:320px 1fr;gap:14px;flex:1;overflow-y:auto;}
.calc-panel{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:18px;height:fit-content;}
.calc-section{margin-bottom:16px;}
.calc-label{font-family:var(â€“mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:7px;}
.cond-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:4px;}
.cond-btn{background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;color:var(â€“muted);font-family:var(â€“mono);font-size:10px;padding:6px 2px;cursor:pointer;text-align:center;transition:all 0.12s;}
.cond-btn.active{background:var(â€“gold);border-color:var(â€“gold);color:#000;}
.cond-btn.doa.active{background:var(â€“red);border-color:var(â€“red);color:#fff;}
.cond-btn.c.active{background:#e8a04a;border-color:#e8a04a;color:#000;}
.cond-btn.d.active{background:#e85a4a;border-color:#e85a4a;color:#fff;}
.ded-row{display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(â€“border);}
.ded-row:last-child{border-bottom:none;}
.ded-label{font-size:12px;}
.ded-amt{font-family:var(â€“mono);font-size:11px;color:var(â€“red);min-width:46px;text-align:right;}
.toggle{width:34px;height:18px;background:var(â€“card2);border:1px solid var(â€“border2);border-radius:9px;cursor:pointer;position:relative;transition:background 0.15s;flex-shrink:0;}
.toggle::after{content:â€™â€™;position:absolute;width:12px;height:12px;background:var(â€“muted);border-radius:50%;top:2px;left:2px;transition:all 0.15s;}
.toggle.on{background:var(â€“red);border-color:var(â€“red);}
.toggle.on::after{left:18px;background:#fff;}
.result-panel{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;overflow:hidden;height:fit-content;}
.result-big{display:grid;grid-template-columns:1fr 1fr;gap:1px;background:var(â€“border);}
.result-cell{background:var(â€“card);padding:20px 18px;}
.result-cell-label{font-family:var(â€“mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:5px;}
.result-cell-val{font-family:var(â€“display);font-size:46px;letter-spacing:1px;line-height:1;}
.result-cell-val.buy{color:var(â€“gold);}
.result-cell-val.profit{color:var(â€“green);}
.result-cell-val.bad{color:var(â€“red);}
.result-detail{padding:14px 18px;}
.r-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(â€“border);}
.r-row:last-child{border-bottom:none;}
.r-key{font-family:var(â€“mono);font-size:10px;color:var(â€“muted);text-transform:uppercase;letter-spacing:1px;}
.r-val{font-family:var(â€“mono);font-size:12px;}

/* â”€â”€ INVENTORY â”€â”€ */
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;}
.inv-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:13px;}
.inv-model{font-weight:600;font-size:13px;margin-bottom:3px;}
.inv-detail{font-family:var(â€“mono);font-size:10px;color:var(â€“muted);}
.inv-paid{font-family:var(â€“display);font-size:22px;color:var(â€“gold);margin-top:7px;}
.inv-profit-line{font-size:11px;margin-top:2px;}
.inv-profit-line.pos{color:var(â€“green);}
.inv-profit-line.neg{color:var(â€“red);}

/* â”€â”€ FOLLOW-UPS â”€â”€ */
.fu-item{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:12px 14px;margin-bottom:8px;display:flex;align-items:center;gap:12px;}
.fu-avatar{width:34px;height:34px;border-radius:2px;background:var(â€“gold);display:flex;align-items:center;justify-content:center;font-family:var(â€“display);font-size:15px;color:#000;flex-shrink:0;}
.fu-info{flex:1;min-width:0;}
.fu-name{font-weight:500;font-size:13px;}
.fu-device{font-size:11px;color:var(â€“muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.fu-time{font-family:var(â€“mono);font-size:10px;margin-top:2px;}
.fu-actions{display:flex;gap:5px;flex-shrink:0;}

/* â”€â”€ PLAYBOOK â”€â”€ */
.playbook-wrap{padding:0 16px 80px;flex:1;overflow-y:auto;}
.pb-tabs{display:flex;gap:0;border-bottom:1px solid var(â€“border);margin-bottom:16px;overflow-x:auto;flex-shrink:0;}
.pb-tab{padding:10px 16px;font-family:var(â€“mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap;transition:all 0.12s;}
.pb-tab:hover{color:var(â€“text);}
.pb-tab.active{color:var(â€“gold);border-bottom-color:var(â€“gold);}
.pb-section{display:none;}
.pb-section.active{display:block;}

/* Funnel */
.funnel{display:flex;flex-direction:column;gap:0;align-items:center;margin:20px 0;}
.funnel-step{width:100%;max-width:500px;padding:16px 24px;text-align:center;position:relative;cursor:pointer;transition:opacity 0.12s;}
.funnel-step:hover{opacity:0.9;}
.fs-num{font-family:var(â€“mono);font-size:10px;letter-spacing:2px;margin-bottom:4px;opacity:0.7;}
.fs-title{font-family:var(â€“display);font-size:26px;letter-spacing:2px;color:#000;}
.fs-sub{font-size:12px;color:rgba(0,0,0,0.7);margin-top:3px;}
.funnel-step-1{background:#4a90d9;clip-path:polygon(0 0,100% 0,90% 100%,10% 100%);}
.funnel-step-2{background:#7cb87c;clip-path:polygon(10% 0,90% 0,80% 100%,20% 100%);margin-top:-1px;}
.funnel-step-3{background:#e8973a;clip-path:polygon(20% 0,80% 0,70% 100%,30% 100%);margin-top:-1px;}
.funnel-step-4{background:#e8c040;clip-path:polygon(30% 0,70% 0,60% 100%,40% 100%);margin-top:-1px;}
.funnel-tip{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:14px 16px;margin-top:14px;display:none;}
.funnel-tip.open{display:block;}
.funnel-tip-title{font-family:var(â€“mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(â€“gold);margin-bottom:8px;}
.funnel-tip p{font-size:13px;color:#ccc;line-height:1.7;margin-bottom:6px;}
.funnel-tip .msg-box{background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;padding:12px;font-size:13px;color:var(â€“gold2);line-height:1.6;font-style:italic;}

/* Script cards */
.script-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;margin-bottom:10px;overflow:hidden;}
.script-head{padding:12px 16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;background:var(â€“card2);}
.script-head:hover{background:#1f1f1f;}
.script-title{font-weight:500;font-size:13px;}
.script-tag{font-family:var(â€“mono);font-size:9px;letter-spacing:1px;color:var(â€“muted);}
.script-arrow{color:var(â€“muted);transition:transform 0.2s;font-size:12px;}
.script-body{display:none;padding:16px;}
.script-body.open{display:block;}
.script-msg{background:var(â€“card2);border-left:3px solid var(â€“gold);padding:10px 14px;margin:8px 0;font-size:13px;color:var(â€“gold2);line-height:1.7;}
.script-msg.response{border-left-color:var(â€“muted);color:#aaa;}
.script-msg.good{border-left-color:var(â€“green);color:#b8f0d0;}
.script-note{font-size:12px;color:var(â€“muted);line-height:1.6;margin:8px 0;}

/* Objection cards */
.obj-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:16px;margin-bottom:10px;}
.obj-situation{font-family:var(â€“mono);font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(â€“orange);margin-bottom:8px;}
.obj-example{background:rgba(255,140,66,0.08);border:1px solid rgba(255,140,66,0.2);border-radius:2px;padding:10px 12px;font-size:13px;color:#e0a070;margin-bottom:10px;font-style:italic;}
.obj-response{background:rgba(61,220,132,0.08);border-left:3px solid var(â€“green);padding:10px 12px;font-size:13px;color:#b0f0d0;line-height:1.7;margin-bottom:8px;}

/* Appraisal steps */
.appraisal-step{display:flex;gap:14px;margin-bottom:16px;align-items:flex-start;}
.appraisal-num{width:28px;height:28px;border-radius:2px;background:var(â€“gold);color:#000;font-family:var(â€“display);font-size:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.appraisal-content h4{font-size:13px;font-weight:600;margin-bottom:4px;}
.appraisal-content p{font-size:12px;color:#aaa;line-height:1.7;}
.appraisal-content .tip{background:rgba(74,158,255,0.08);border:1px solid rgba(74,158,255,0.2);border-radius:2px;padding:8px 12px;font-size:12px;color:#90c4ff;margin-top:6px;}

/* Ad campaign */
.ad-step{display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid var(â€“border);}
.ad-step:last-child{border-bottom:none;}
.ad-arrow{color:var(â€“gold);font-size:16px;margin-top:1px;flex-shrink:0;}
.ad-content{flex:1;}
.ad-title{font-size:13px;font-weight:500;margin-bottom:3px;}
.ad-desc{font-size:12px;color:#aaa;line-height:1.6;}
.ad-warning{background:rgba(255,69,69,0.1);border:1px solid rgba(255,69,69,0.3);border-radius:2px;padding:10px 14px;margin:10px 0;}
.ad-warning-title{font-family:var(â€“mono);font-size:10px;letter-spacing:1px;color:var(â€“red);margin-bottom:4px;}
.ad-warning p{font-size:12px;color:#ff9999;}

/* Buyers */
.buyer-card{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(â€“border);}
.buyer-card:last-child{border-bottom:none;}
.buyer-name{font-size:13px;font-weight:500;}
.buyer-note{font-size:11px;color:var(â€“muted);margin-top:2px;}

/* Bullet steps */
.bullet-step{background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;padding:14px 16px;margin-bottom:8px;position:relative;}
.bullet-label{font-family:var(â€“display);font-size:18px;color:var(â€“gold);letter-spacing:1px;margin-bottom:6px;}
.bullet-text{font-size:13px;color:#ccc;line-height:1.7;}
.bullet-connector{width:2px;height:14px;background:var(â€“border2);margin:0 auto;}

/* Alerts */
.alert-item{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:12px 14px;margin-bottom:8px;display:flex;align-items:flex-start;gap:12px;}
.alert-icon{font-size:16px;flex-shrink:0;margin-top:1px;}
.alert-body{flex:1;}
.alert-title{font-size:13px;font-weight:500;margin-bottom:2px;}
.alert-desc{font-size:11px;color:var(â€“muted);}
.alert-time{font-family:var(â€“mono);font-size:10px;color:var(â€“sub);margin-top:3px;}
.alert-new{border-left:3px solid var(â€“gold);}

/* â”€â”€ EMPTY â”€â”€ */
.empty{text-align:center;padding:50px 20px;color:var(â€“muted);font-family:var(â€“mono);font-size:11px;letter-spacing:1px;}
.empty-icon{font-size:32px;margin-bottom:10px;opacity:0.4;}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:70px;right:16px;background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;padding:10px 16px;font-size:13px;z-index:300;transform:translateY(10px);opacity:0;transition:all 0.2s;pointer-events:none;max-width:280px;}
.toast.show{transform:translateY(0);opacity:1;}
.toast.success{border-left:3px solid var(â€“green);}
.toast.error{border-left:3px solid var(â€“red);}

/* â”€â”€ SCROLLBAR â”€â”€ */
::-webkit-scrollbar{width:3px;height:3px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(â€“sub);border-radius:2px;}

/* â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â• */
@media(max-width:768px){
.sidebar{display:none;}
.mobile-nav{display:flex;}
.stats-row{grid-template-columns:1fr 1fr;gap:8px;padding:10px 12px;}
.stat-val{font-size:26px;}
.two-col,.three-col{grid-template-columns:1fr;}
.page-header{padding:12px 12px 10px;}
.page-title{font-size:22px;}
.content-area{padding:0 12px 80px;}
.table-wrap{padding:0 12px 80px;}
.pipeline{grid-template-columns:repeat(5,140px);padding:0 12px 80px;}
.calc-wrap{grid-template-columns:1fr;padding:0 12px 80px;}
.playbook-wrap{padding:0 12px 80px;}
.form-row{grid-template-columns:1fr;}
.form-row.three{grid-template-columns:1fr 1fr;}
/* hide some table cols on mobile */
.hide-mobile{display:none;}
.toast{bottom:68px;right:12px;left:12px;max-width:none;}
.inv-grid{grid-template-columns:1fr 1fr;}
}
@media(max-width:480px){
.stats-row{grid-template-columns:1fr 1fr;}
.inv-grid{grid-template-columns:1fr;}
.result-big{grid-template-columns:1fr;}
.cond-grid{grid-template-columns:repeat(3,1fr);}
.form-row.three{grid-template-columns:1fr;}
.header-actions .btn-ghost{display:none;}
}
</style>

</head>
<body>

<div class="topbar">
  <div class="logo">TREY <span>BUYBACK</span></div>
  <div class="top-right">
    <div class="badge">PRO</div>
    <div id="topDate"></div>
  </div>
</div>

<div class="shell">

<!-- DESKTOP SIDEBAR -->

<div class="sidebar">
  <div class="nav-section">Main</div>
  <div class="nav-item active" onclick="nav('dashboard')"><span class="nav-icon">ğŸ“Š</span><span>Dashboard</span></div>
  <div class="nav-item" onclick="nav('leads')"><span class="nav-icon">ğŸ‘¥</span><span>Leads</span><span class="nav-count hot" id="nc-leads">0</span></div>
  <div class="nav-item" onclick="nav('pipeline')"><span class="nav-icon">ğŸ”€</span><span>Pipeline</span></div>
  <div class="nav-item" onclick="nav('followups')"><span class="nav-icon">â°</span><span>Follow-Ups</span><span class="nav-count" id="nc-fu">0</span></div>
  <div class="nav-section">Tools</div>
  <div class="nav-item" onclick="nav('inventory')"><span class="nav-icon">ğŸ“¦</span><span>Inventory</span></div>
  <div class="nav-item" onclick="nav('calc')"><span class="nav-icon">ğŸ§®</span><span>Flip Calc</span></div>
  <div class="nav-item" onclick="nav('alerts')"><span class="nav-icon">ğŸ””</span><span>Deal Alerts</span><span class="nav-count" id="nc-alerts">0</span></div>
  <div class="nav-section">Learn</div>
  <div class="nav-item" onclick="nav('playbook')"><span class="nav-icon">ğŸ“š</span><span>Playbook</span></div>
  <div class="nav-section">Reports</div>
  <div class="nav-item" onclick="nav('profits')"><span class="nav-icon">ğŸ’°</span><span>Profits</span></div>
</div>

<!-- MAIN CONTENT -->

<div class="main">

<!-- â•â•â• DASHBOARD â•â•â• -->

<div class="page active" id="page-dashboard">
  <div class="page-header">
    <div><div class="page-title">DASHBOARD</div><div class="page-sub" id="dashGreet">Welcome back</div></div>
    <div class="header-actions"><button class="btn btn-gold" onclick="openModal('addLead')">+ Add Lead</button></div>
  </div>
  <div class="stats-row">
    <div class="stat-card"><div class="stat-label">Total Leads</div><div class="stat-val blue" id="ds-leads">0</div><div class="stat-sub">All time</div></div>
    <div class="stat-card"><div class="stat-label">Active</div><div class="stat-val gold" id="ds-active">0</div><div class="stat-sub">Negotiating</div></div>
    <div class="stat-card"><div class="stat-label">Closed</div><div class="stat-val green" id="ds-closed">0</div><div class="stat-sub">Purchased</div></div>
    <div class="stat-card"><div class="stat-label">Profit</div><div class="stat-val green" id="ds-profit">$0</div><div class="stat-sub">Net</div></div>
  </div>
  <div class="content-area">
    <div class="two-col">
      <div class="panel"><div class="panel-title">Recent Leads <span style="color:var(--gold);cursor:pointer;" onclick="nav('leads')">ALL â†’</span></div><div id="dash-recent"></div></div>
      <div class="panel"><div class="panel-title">Follow-Ups Due <span style="color:var(--purple);cursor:pointer;" onclick="nav('followups')">ALL â†’</span></div><div id="dash-fu"></div></div>
    </div>
    <div class="two-col">
      <div class="panel"><div class="panel-title">Pipeline</div><div id="dash-pipeline"></div></div>
      <div class="panel"><div class="panel-title">Top Devices</div><div id="dash-devices"></div></div>
    </div>
  </div>
</div>

<!-- â•â•â• LEADS â•â•â• -->

<div class="page" id="page-leads">
  <div class="page-header">
    <div><div class="page-title">LEADS</div><div class="page-sub">All seller contacts</div></div>
    <div class="header-actions">
      <input id="leadSearch" placeholder="Searchâ€¦" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:7px 12px;border-radius:2px;font-family:var(--mono);font-size:12px;outline:none;width:160px;" oninput="renderLeads()">
      <button class="btn btn-ghost btn-sm hide-mobile" onclick="exportLeads()">â†“ CSV</button>
      <button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Add</button>
    </div>
  </div>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Name</th><th>Device</th><th>Asking</th><th>Status</th><th class="hide-mobile">Source</th><th class="hide-mobile">Added</th><th>Action</th></tr></thead>
      <tbody id="leads-tbody"></tbody>
    </table>
    <div id="leads-empty" class="empty" style="display:none;"><div class="empty-icon">ğŸ‘¥</div>No leads yet</div>
  </div>
</div>

<!-- â•â•â• PIPELINE â•â•â• -->

<div class="page" id="page-pipeline">
  <div class="page-header">
    <div><div class="page-title">PIPELINE</div><div class="page-sub">Deal flow by stage</div></div>
    <button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Lead</button>
  </div>
  <div class="pipeline" id="pipeline-board"></div>
</div>

<!-- â•â•â• FOLLOW-UPS â•â•â• -->

<div class="page" id="page-followups">
  <div class="page-header"><div><div class="page-title">FOLLOW-UPS</div><div class="page-sub">Never let a deal go cold</div></div></div>
  <div class="content-area">
    <div class="panel" style="margin-bottom:12px;"><div class="panel-title" style="color:var(--red);">âš  DUE / OVERDUE</div><div id="fu-due"></div></div>
    <div class="panel"><div class="panel-title">UPCOMING</div><div id="fu-upcoming"></div></div>
  </div>
</div>

<!-- â•â•â• INVENTORY â•â•â• -->

<div class="page" id="page-inventory">
  <div class="page-header">
    <div><div class="page-title">INVENTORY</div><div class="page-sub">Devices you own</div></div>
    <button class="btn btn-gold btn-sm" onclick="openModal('addInventory')">+ Device</button>
  </div>
  <div class="content-area">
    <div class="three-col" style="margin-bottom:12px;">
      <div class="stat-card"><div class="stat-label">In Stock</div><div class="stat-val gold" id="inv-count">0</div></div>
      <div class="stat-card"><div class="stat-label">Invested</div><div class="stat-val red" id="inv-invested">$0</div></div>
      <div class="stat-card"><div class="stat-label">Est. Profit</div><div class="stat-val green" id="inv-profit">$0</div></div>
    </div>
    <div class="inv-grid" id="inv-grid"></div>
    <div id="inv-empty" class="empty" style="display:none;"><div class="empty-icon">ğŸ“¦</div>No inventory yet</div>
  </div>
</div>

<!-- â•â•â• FLIP CALC â•â•â• -->

<div class="page" id="page-calc">
  <div class="page-header"><div><div class="page-title">FLIP CALC</div><div class="page-sub">Atlas Mobile pricing</div></div></div>
  <div class="calc-wrap">
    <div>
      <div class="calc-panel" style="margin-bottom:12px;">
        <div class="calc-section">
          <div class="calc-label">Model</div>
          <div class="field"><select id="c-model" onchange="calcUpdateStorage()"><option value="">â€” Select model â€”</option></select></div>
        </div>
        <div class="calc-section" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div><div class="calc-label">Storage</div><div class="field"><select id="c-storage" onchange="calcUpdate()"><option value="">â€”</option></select></div></div>
          <div><div class="calc-label">Lock</div><div class="field"><select id="c-lock" onchange="calcUpdate()"><option value="unlocked">Unlocked</option><option value="locked">Carrier Locked</option></select></div></div>
        </div>
        <div class="calc-section">
          <div class="calc-label">Condition</div>
          <div class="cond-grid" id="c-cond-grid">
            <div class="cond-btn active" onclick="cSetGrade('swap',this)">SWAP</div>
            <div class="cond-btn" onclick="cSetGrade('a',this)">A</div>
            <div class="cond-btn b" onclick="cSetGrade('b',this)">B</div>
            <div class="cond-btn c" onclick="cSetGrade('c',this)">C</div>
            <div class="cond-btn d" onclick="cSetGrade('d',this)">D</div>
            <div class="cond-btn doa" onclick="cSetGrade('doa',this)">DOA</div>
          </div>
        </div>
        <div class="calc-section">
          <div class="calc-label">Damage</div>
          <div class="ded-row"><span class="ded-label">Cracked Back</span><span class="ded-amt" id="c-d-back">â€”</span><div class="toggle" id="c-t-back" onclick="cToggle('back',this)"></div></div>
          <div class="ded-row"><span class="ded-label">Cracked Lens</span><span class="ded-amt" id="c-d-lens">â€”</span><div class="toggle" id="c-t-lens" onclick="cToggle('lens',this)"></div></div>
          <div class="ded-row"><span class="ded-label">Bad Face ID</span><span class="ded-amt">Parts</span><div class="toggle" id="c-t-faceid" onclick="cToggle('faceid',this)"></div></div>
          <div class="ded-row"><span class="ded-label">Battery &lt;80%</span><span class="ded-amt">-$30</span><div class="toggle" id="c-t-battery" onclick="cToggle('battery',this)"></div></div>
          <div class="ded-row"><span class="ded-label">Repair Message</span><span class="ded-amt">-$40</span><div class="toggle" id="c-t-repair" onclick="cToggle('repair',this)"></div></div>
        </div>
      </div>
      <div class="calc-panel">
        <div class="calc-label">Margin Target</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
          <div class="field"><label>Min Profit $</label><input type="number" id="c-minprofit" value="40" oninput="calcUpdate()"></div>
          <div class="field"><label>Risk Buffer $</label><input type="number" id="c-riskbuf" value="20" oninput="calcUpdate()"></div>
        </div>
        <div class="field"><label>Asking Price $</label><input type="number" id="c-asking" placeholder="Seller's price" oninput="calcUpdate()"></div>
      </div>
    </div>
    <div><div class="result-panel" id="c-result-panel"><div style="padding:40px;text-align:center;color:var(--muted);font-family:var(--mono);font-size:11px;letter-spacing:1px;">SELECT A MODEL TO SEE YOUR DEAL</div></div></div>
  </div>
</div>

<!-- â•â•â• DEAL ALERTS â•â•â• -->

<div class="page" id="page-alerts">
  <div class="page-header">
    <div><div class="page-title">DEAL ALERTS</div><div class="page-sub">Monitor for deals</div></div>
    <button class="btn btn-gold btn-sm" onclick="openModal('addAlert')">+ Alert</button>
  </div>
  <div class="content-area">
    <div class="panel" style="margin-bottom:12px;"><div class="panel-title">ACTIVE MONITORS</div><div id="alert-monitors"></div></div>
    <div class="panel"><div class="panel-title">RECENT HITS <span style="font-size:9px;color:var(--sub);">(DEMO)</span></div><div id="alert-hits"></div></div>
  </div>
</div>

<!-- â•â•â• PLAYBOOK â•â•â• -->

<div class="page" id="page-playbook">
  <div class="page-header"><div><div class="page-title">PLAYBOOK</div><div class="page-sub">Your complete buying system</div></div></div>
  <div class="playbook-wrap">
    <div class="pb-tabs" id="pb-tabs">
      <div class="pb-tab active" onclick="pbTab('shotgun')">ğŸ¯ Shotgun Method</div>
      <div class="pb-tab" onclick="pbTab('script')">ğŸ’¬ Negotiation Script</div>
      <div class="pb-tab" onclick="pbTab('objections')">ğŸ›¡ Objections</div>
      <div class="pb-tab" onclick="pbTab('appraisal')">ğŸ” Appraise on eBay</div>
      <div class="pb-tab" onclick="pbTab('ads')">ğŸ“£ Run Ads</div>
      <div class="pb-tab" onclick="pbTab('buyers')">ğŸ¦ Buyers</div>
    </div>

```
<!-- SHOTGUN METHOD -->
<div class="pb-section active" id="pb-shotgun">
  <div style="background:var(--card);border:1px solid var(--border);border-radius:2px;padding:16px;margin-bottom:16px;">
    <div style="font-family:var(--display);font-size:22px;letter-spacing:1px;margin-bottom:6px;">THE SHOTGUN METHOD</div>
    <div style="font-size:13px;color:#aaa;line-height:1.7;">Send 100 reachouts. Weed out the non-responders. Negotiate with the interested. Close and meet. Simple, repeatable, scalable.</div>
  </div>
  <div class="funnel">
    <div class="funnel-step funnel-step-1" onclick="toggleFunnelTip('tip1')">
      <div class="fs-num">STEP 1</div>
      <div class="fs-title">100 REACHOUTS</div>
      <div class="fs-sub">Message as many people as possible</div>
    </div>
    <div class="funnel-tip" id="tip1">
      <div class="funnel-tip-title">First Message to Send</div>
      <div class="msg-box">"Hey, I run a business that buys used and damaged iPhones, MacBooks, iPads, Smartwatches, cameras and more. If I were to pay cash today, would you take a lower price?"</div>
      <p style="margin-top:10px;">Send this to every listing you see. Volume is the game. Don't overthink it â€” just send it.</p>
    </div>
    <div class="funnel-step funnel-step-2" onclick="toggleFunnelTip('tip2')">
      <div class="fs-num">STEP 2</div>
      <div class="fs-title">INTERESTED SELLERS</div>
      <div class="fs-sub">Immediately weed out non-responders</div>
    </div>
    <div class="funnel-tip" id="tip2">
      <div class="funnel-tip-title">What They'll Say</div>
      <p>Expect responses like: <strong style="color:var(--gold);">"No"</strong>, <strong style="color:var(--red);">"F*** off"</strong>, <strong style="color:var(--green);">"How much lower?"</strong>, <strong style="color:var(--green);">"I'll take $150 today"</strong></p>
      <p>Ignore the rude ones. Focus ONLY on people who engage positively or ask questions. Move them to negotiate immediately.</p>
    </div>
    <div class="funnel-step funnel-step-3" onclick="toggleFunnelTip('tip3')">
      <div class="fs-num">STEP 3</div>
      <div class="fs-title">NEGOTIATE</div>
      <div class="fs-sub">Convos started â€” time to close</div>
    </div>
    <div class="funnel-tip" id="tip3">
      <div class="funnel-tip-title">Close with Benefits</div>
      <p>Work with customers who respond positively. Offer benefits to sweeten the deal:</p>
      <p>â€¢ Same day pickup<br>â€¢ You come to them<br>â€¢ Cash in hand right now<br>â€¢ Fast and easy, no hassle</p>
      <p>Go to the <strong style="color:var(--gold);">Negotiation Script</strong> tab for the full word-for-word script.</p>
    </div>
    <div class="funnel-step funnel-step-4" onclick="toggleFunnelTip('tip4')">
      <div class="fs-num">STEP 4</div>
      <div class="fs-title">CLOSE + MEET</div>
      <div class="fs-sub">Buy items from people</div>
    </div>
    <div class="funnel-tip" id="tip4">
      <div class="funnel-tip-title">At the Meetup</div>
      <p>â€¢ Close the deal, hand over cash<br>â€¢ Ask for a review on Marketplace/Google<br>â€¢ Give business cards<br>â€¢ Ask for referrals â€” "Do you know anyone else looking to sell?"<br>â€¢ Always upsell: "Got any other devices â€” iPads, MacBooks, consoles?"</p>
    </div>
  </div>
</div>

<!-- NEGOTIATION SCRIPT -->
<div class="pb-section" id="pb-script">
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Opening Message</div><div class="script-tag">FIRST REACHOUT</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body open">
      <div class="script-msg">"Hey, I run a company that buys used and damaged iPhones, MacBooks, Smartwatches, Cameras, VR Systems, and more. If I were able to pay cash today, would you take a lower offer?"</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">They're Interested â€” Make the Offer</div><div class="script-tag">AFTER POSITIVE RESPONSE</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-note">If they say "How much lower?" or give you a price they'll accept:</div>
      <div class="script-msg good">"Great, we have been buying the [Device] for $____ recently."</div>
      <div class="script-msg good">"Awesome, I can give you $______ for it."</div>
      <div class="script-note">If they refuse your offer:</div>
      <div class="script-msg good">"You have a great [device], and we need more [devices] to hit our target this week. What were you trying to get for it?"</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Bullet 1 â€” Carrier</div><div class="script-tag">WHEN THEY TELL YOU THEIR PRICE</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-msg good">"Just want to confirm, what company is it with?"</div>
      <div class="script-note">If you can make a better offer based on carrier:</div>
      <div class="script-msg good">"Gotcha, thanks for the extra info. I've checked with my buyers, and it looks like I can actually move my price to $___. How does that sound?"</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Bullet 2 â€” Storage</div><div class="script-tag">IF STILL STUCK</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-msg good">"I totally understand, can you tell me how much storage your device has?"</div>
      <div class="script-note">If it's higher storage than you assumed:</div>
      <div class="script-msg good">"I didn't realize it was 512GB. Looks like I can do $___. How does that sound?"</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Bullet 3 â€” Confirm Device</div><div class="script-tag">LAST BUMP</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-msg good">"OHHHH, you said it was a [13 PRO MAX], right?"</div>
      <div class="script-note">Use their exact words back at them to confirm and justify a bump.</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Tell the Truth â€” Final Offer</div><div class="script-tag">WHEN NOTHING WORKS</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-msg good">"I would love to buy your device, but I do buy and resell items for a living and need to make a little profit. Unfortunately, the best price I can do is $__ due to where it is at in the market. Would you do any less if I met you today with cash?"</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Can't Close â€” Cross-Sell</div><div class="script-tag">IF DEAL FALLS THROUGH</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-msg good">"Do you have any other items I could possibly buy and put cash in your hands today? I buy used and damaged iPads, MacBooks, Smartwatches, Cameras, Oculus, and other types of electronics. Got anything like that?"</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Set the Meetup + BOS</div><div class="script-tag">CLOSING THE DEAL</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-msg good">"Awesome, I will be meeting people at [Location] today at 12 & 5. Which time works best for you?"</div>
      <div class="script-msg good">"Awesome, when you come, please make sure the device can be erased and bring a valid ID for the bill of sale. That's it. Can't wait to earn your business."</div>
      <div class="script-msg good">"I'm heading there now, GPS says I'll be there at [TIME]."</div>
    </div>
  </div>
  <div class="script-card">
    <div class="script-head" onclick="toggleScript(this)">
      <div><div class="script-title">Follow-Up Messages</div><div class="script-tag">FOR COLD LEADS</div></div>
      <span class="script-arrow">â–¼</span>
    </div>
    <div class="script-body">
      <div class="script-msg good">"Hey I saw this was still available."</div>
      <div class="script-msg good">"Following up."</div>
      <div class="script-msg good">"Hey this popped back up on my feed, I'd still love to buy it."</div>
    </div>
  </div>
</div>

<!-- OBJECTIONS -->
<div class="pb-section" id="pb-objections">
  <div class="obj-card">
    <div class="obj-situation">Angry "No" Response</div>
    <div class="obj-example">"Hell no"</div>
    <div class="script-note" style="margin-bottom:8px;">Always respond NICELY regardless of how rude they are. Find out where they're at with price.</div>
    <div class="obj-response">"I totally understand, how much were you looking to get?"</div>
  </div>
  <div class="obj-card">
    <div class="obj-situation">They Want Way Too Much</div>
    <div class="obj-example">"I want $300 for my iPhone 6"</div>
    <div class="script-note" style="margin-bottom:8px;">Nicely ignore their price. Offer low regardless.</div>
    <div class="obj-response">"I totally understand, unfortunately I can't pay $300 because of where it's at in the market. But I can pay $100 and pay cash today. How does that sound?"</div>
    <div class="obj-response">"$300 is higher than we could typically sell it for so that would be tough to match. I would be happy to give you the $100 though and could give you cash today. Is that fair?"</div>
  </div>
  <div class="obj-card">
    <div class="obj-situation">They'll Just Sell It Themselves</div>
    <div class="obj-example">"If I can't get $300 I'll just sell it myself"</div>
    <div class="script-note" style="margin-bottom:8px;">They're usually bluffing. They wouldn't have responded if they were going to sell it themselves.</div>
    <div class="obj-response">"I totally get that! Have you tried selling it on your own yet? Most people find it takes weeks â€” I can give you cash today so you don't have to deal with strangers and no-shows."</div>
  </div>
  <div class="obj-card">
    <div class="obj-situation">Someone Else Offered More</div>
    <div class="obj-example">"Another guy offered me $150"</div>
    <div class="script-note" style="margin-bottom:8px;">Check your appraisal first. If their claim is unrealistic, call the bluff.</div>
    <div class="obj-response">"$150 is a great price. I'm not sure how he was able to offer that but if he's willing to pay I would definitely go for it. I'd be happy to offer you $100 and give you the cash today though. What works best for you?"</div>
  </div>
  <div class="obj-card">
    <div class="obj-situation">No Response After Your Offer</div>
    <div class="obj-example">Radio silence after you made an offer</div>
    <div class="script-note" style="margin-bottom:8px;">Check your appraisal. If your price was accurate, follow up simply.</div>
    <div class="obj-response">"Would that work for you?"</div>
    <div class="obj-response">"Would that price be fair?"</div>
  </div>
  <div class="obj-card">
    <div class="obj-situation">"I'll Just Keep It" / Shopping Around</div>
    <div class="obj-example">"I was just seeing what I could get"</div>
    <div class="script-note" style="margin-bottom:8px;">Try to upsell or bundle other items to make it worth their while.</div>
    <div class="obj-response">"No worries at all! Hey â€” do you have any other devices sitting around? I buy iPads, MacBooks, consoles, cameras, anything like that. Could put some extra cash in your hands today."</div>
  </div>
</div>

<!-- APPRAISAL -->
<div class="pb-section" id="pb-appraisal">
  <div class="panel" style="margin-bottom:14px;">
    <div style="font-family:var(--display);font-size:20px;letter-spacing:1px;margin-bottom:8px;">APPRAISE ON EBAY â€” THE RIGHT WAY</div>
    <div style="font-size:13px;color:#aaa;">Use eBay sold listings to find real market value before making any offer. Never guess.</div>
  </div>
  <div class="panel" style="margin-bottom:12px;">
    <div class="panel-title">STANDARD PHONES</div>
    <div class="appraisal-step"><div class="appraisal-num">1</div><div class="appraisal-content"><h4>Search eBay with minimal keywords</h4><p>Type only the essential info: <strong style="color:var(--gold);">"iPhone XR Unlocked"</strong> â€” not "iPhone XR gold 128GB unlocked smartphone good condition." Less is more.</p></div></div>
    <div class="appraisal-step"><div class="appraisal-num">2</div><div class="appraisal-content"><h4>Filter to Sold Listings ONLY</h4><p>Check "Completed Items" AND "Sold Items" in the eBay filters. Never use active listings â€” they mean nothing until they actually sell.</p><div class="tip">ğŸ“± On mobile: tap Filter â†’ Show Only â†’ Sold Items</div></div></div>
    <div class="appraisal-step"><div class="appraisal-num">3</div><div class="appraisal-content"><h4>Find 3 comparables within 2 months</h4><p>Match exact make, model, storage, and condition. An iPhone 8 is not the same as an iPhone 8 Plus. A 64GB sells for less than a 256GB. Apples to apples only.</p></div></div>
    <div class="appraisal-step"><div class="appraisal-num">4</div><div class="appraisal-content"><h4>Use real photos, not stock photos</h4><p>Skip any listing using stock/manufacturer images. Only use listings with actual photos of the device.</p></div></div>
    <div class="appraisal-step"><div class="appraisal-num">5</div><div class="appraisal-content"><h4>Match the condition</h4><p>Used/working â†’ "Pre-Owned" listings. New in box â†’ "New or Open Box." Damaged â†’ "Parts Only."</p></div></div>
  </div>
  <div class="panel" style="margin-bottom:12px;">
    <div class="panel-title">BAD ESN / BLACKLISTED PHONES</div>
    <div class="appraisal-step"><div class="appraisal-num">!</div><div class="appraisal-content"><h4>Don't search "Bad ESN" â€” eBay bans it</h4><p>Instead search: <strong style="color:var(--gold);">"iPhone 8 Plus Tmobile ESN"</strong></p><p>Look for listings using terms like: "Check ESN", "Financed", "ESN Unclean", "Bad IMEI" â€” anything implying the ESN may not be clean.</p><div class="tip">âš  2 comparables is acceptable for Bad ESN â€” they're harder to find.</div></div></div>
  </div>
  <div class="panel">
    <div class="panel-title">DAMAGED DEVICES</div>
    <div class="appraisal-step"><div class="appraisal-num">A</div><div class="appraisal-content"><h4>Cracked screen (display still works)</h4><p>Search: <strong style="color:var(--gold);">"iPhone 8 Plus cracked"</strong> â€” don't add "screen" or "bad touch" as that narrows results too much.</p></div></div>
    <div class="appraisal-step"><div class="appraisal-num">B</div><div class="appraisal-content"><h4>Cracked LCD (black lines, no display)</h4><p>Search: <strong style="color:var(--gold);">"iPhone 8 Plus cracked LCD"</strong></p></div></div>
    <div class="appraisal-step"><div class="appraisal-num">C</div><div class="appraisal-content"><h4>Other damage (bad button, camera, etc.)</h4><p>If you can't find specific comparables, use the cracked screen price as your baseline. Multiple issues â†’ use "no power" listings as your floor.</p></div></div>
  </div>
</div>

<!-- ADS -->
<div class="pb-section" id="pb-ads">
  <div class="panel" style="margin-bottom:14px;">
    <div style="font-family:var(--display);font-size:20px;letter-spacing:1px;margin-bottom:6px;">SETTING UP YOUR FIRST FB AD</div>
    <div style="font-size:13px;color:#aaa;">Start at $5â€“$15/day. Goal: 15â€“20 leads/day. Here's the exact setup.</div>
  </div>
  <div class="panel">
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Objective: Engagement</div><div class="ad-desc">Select "Engagement" as your campaign objective in Meta Ads Manager.</div></div></div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Budget: Advantage Campaign Budget â€” $5/day to start</div><div class="ad-desc">Let Meta optimize spend across your ads. You can scale to $15â€“25/day once you see results.</div></div></div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Campaign Type: Manual Engagement Campaign</div><div class="ad-desc">Do NOT use automated/simplified campaigns. You want control.</div></div></div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Location: Your local area â€” 10 to 25 mile radius</div><div class="ad-desc">Start tight. You want people you can actually meet in person to buy from.</div></div></div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Detailed Targeting: Target device owners</div><div class="ad-desc">Target people who own: iPhone X and newer + Galaxy S10/Note10 and newer. These are the people most likely to have a device worth buying.</div></div></div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Placements: Keep Automatic (for now)</div><div class="ad-desc">Let Meta decide where to show your ad across Facebook, Instagram, etc. Optimize later.</div></div></div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Create your ad using proven photos</div><div class="ad-desc">Use high-performing ad photos from your swipe file. Test different images â€” what works for one market may not work for another.</div></div></div>
    <div class="ad-warning">
      <div class="ad-warning-title">âš  CRITICAL â€” DO NOT VIOLATE THESE</div>
      <p>â€¢ NO images with Apple logos on your ad or business page<br>â€¢ NO third-party brand logos of any kind<br>â€¢ Violating these will get your ad account banned</p>
    </div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Duplicate your ad 4 more times â†’ Publish</div><div class="ad-desc">Running 5 variations lets Meta find the best performer faster. Use same copy, different images to start.</div></div></div>
    <div class="ad-step"><div class="ad-arrow">â†“</div><div class="ad-content"><div class="ad-title">Duplicate the campaign â†’ Set Manual Targeting</div><div class="ad-desc">After your first campaign runs, duplicate it and switch to manual targeting to test more controlled audiences.</div></div></div>
  </div>
</div>

<!-- BUYERS -->
<div class="pb-section" id="pb-buyers">
  <div class="panel" style="margin-bottom:14px;">
    <div style="font-family:var(--display);font-size:20px;letter-spacing:1px;margin-bottom:6px;">VETTED BUYERS</div>
    <div style="font-size:13px;color:#aaa;line-height:1.6;">These are recommended, vetted buyers. Always do your own due diligence. We are not responsible for scams.</div>
  </div>
  <div class="panel">
    <div class="buyer-card"><div><div class="buyer-name">Atlas Mobile</div><div class="buyer-note">Full price sheet built into your Flip Calc</div></div><span class="pill pill-closed">PRIMARY</span></div>
    <div class="buyer-card"><div><div class="buyer-name">Best Deal Phones</div><div class="buyer-note">BestDealPhones Price Sheet â€” Bonus available</div></div><span class="pill pill-active">VETTED</span></div>
    <div class="buyer-card"><div><div class="buyer-name">NYC Phone Buyer</div><div class="buyer-note">NYCPhonebuyer LLC | Cell My Device</div></div><span class="pill pill-active">VETTED</span></div>
    <div class="buyer-card"><div><div class="buyer-name">Tim Rappaport</div><div class="buyer-note">Fixit Price Sheet</div></div><span class="pill pill-active">VETTED</span></div>
    <div class="buyer-card"><div><div class="buyer-name">Apple Trade In</div><div class="buyer-note">apple.com/shop/trade-in â€” Good for newer devices</div></div><span class="pill pill-new">OPTION</span></div>
    <div class="buyer-card"><div><div class="buyer-name">eBay</div><div class="buyer-note">Best for MacBooks, consoles, cameras, accessories</div></div><span class="pill pill-new">OPTION</span></div>
  </div>
  <div class="panel" style="margin-top:12px;">
    <div class="panel-title">PRO TIPS</div>
    <div style="font-size:13px;color:#aaa;line-height:1.9;">
      âœ“ Always check 2â€“3 buyers before selling â€” prices vary<br>
      âœ“ Unlocked phones always pay more than carrier locked<br>
      âœ“ Grade A condition gets you SWAP/HSO pricing at most buyers<br>
      âœ“ Bad ESN phones: find specialty buyers, not general wholesale<br>
      âœ“ MacBooks + iPads â†’ eBay usually beats wholesale buyers<br>
      âœ“ Consoles â†’ eBay for bundles, local for singles
    </div>
  </div>
</div>
```

  </div><!-- /playbook-wrap -->
</div>

<!-- â•â•â• PROFITS â•â•â• -->

<div class="page" id="page-profits">
  <div class="page-header">
    <div><div class="page-title">PROFITS</div><div class="page-sub">Track your money</div></div>
    <button class="btn btn-ghost btn-sm hide-mobile" onclick="exportProfits()">â†“ CSV</button>
  </div>
  <div class="content-area">
    <div class="stats-row" style="padding:0 0 12px;">
      <div class="stat-card"><div class="stat-label">Revenue</div><div class="stat-val green" id="pr-revenue">$0</div></div>
      <div class="stat-card"><div class="stat-label">Spent</div><div class="stat-val red" id="pr-spent">$0</div></div>
      <div class="stat-card"><div class="stat-label">Net Profit</div><div class="stat-val gold" id="pr-net">$0</div></div>
      <div class="stat-card"><div class="stat-label">Avg/Deal</div><div class="stat-val blue" id="pr-avg">$0</div></div>
    </div>
    <div class="panel">
      <div class="panel-title">SOLD DEVICES</div>
      <div style="overflow-x:auto;">
        <table><thead><tr><th>Device</th><th>Paid</th><th>Sold</th><th>Profit</th><th class="hide-mobile">Date</th><th class="hide-mobile">Buyer</th></tr></thead><tbody id="profits-tbody"></tbody></table>
      </div>
      <div id="profits-empty" class="empty"><div class="empty-icon">ğŸ’°</div>No sold devices yet</div>
    </div>
  </div>
</div>

</div><!-- /main -->
</div><!-- /shell -->

<!-- MOBILE BOTTOM NAV -->

<div class="mobile-nav">
  <div class="mob-nav-item active" onclick="nav('dashboard')"><span class="mob-icon">ğŸ“Š</span>Home</div>
  <div class="mob-nav-item" onclick="nav('leads')"><span class="mob-icon">ğŸ‘¥</span>Leads</div>
  <div class="mob-nav-item" onclick="nav('calc')"><span class="mob-icon">ğŸ§®</span>Calc</div>
  <div class="mob-nav-item" onclick="nav('playbook')"><span class="mob-icon">ğŸ“š</span>Playbook</div>
  <div class="mob-nav-item" onclick="nav('inventory')"><span class="mob-icon">ğŸ“¦</span>Stock</div>
  <div class="mob-nav-item" onclick="openMoreMenu()"><span class="mob-icon">â˜°</span>More</div>
</div>

<!-- MORE MENU (mobile) -->

<div class="overlay" id="modal-more" style="align-items:flex-end;">
  <div class="modal" style="border-radius:2px 2px 0 0;max-height:60vh;">
    <div class="modal-header"><div class="modal-title">MORE</div><button class="modal-close" onclick="closeModal('more')">Ã—</button></div>
    <div class="modal-body" style="padding:8px 0;">
      <div class="nav-item" style="border-left:none;padding:14px 20px;" onclick="nav('pipeline');closeModal('more')"><span class="nav-icon">ğŸ”€</span><span>Pipeline</span></div>
      <div class="nav-item" style="border-left:none;padding:14px 20px;" onclick="nav('followups');closeModal('more')"><span class="nav-icon">â°</span><span>Follow-Ups</span></div>
      <div class="nav-item" style="border-left:none;padding:14px 20px;" onclick="nav('alerts');closeModal('more')"><span class="nav-icon">ğŸ””</span><span>Deal Alerts</span></div>
      <div class="nav-item" style="border-left:none;padding:14px 20px;" onclick="nav('profits');closeModal('more')"><span class="nav-icon">ğŸ’°</span><span>Profits</span></div>
    </div>
  </div>
</div>

<!-- ADD LEAD MODAL -->

<div class="overlay" id="modal-addLead">
  <div class="modal">
    <div class="modal-header"><div class="modal-title">NEW LEAD</div><button class="modal-close" onclick="closeModal('addLead')">Ã—</button></div>
    <div class="modal-body">
      <div class="form-row"><div class="field"><label>Full Name *</label><input id="l-name" placeholder="John Smith"></div><div class="field"><label>Phone</label><input id="l-phone" type="tel" placeholder="(555) 000-0000"></div></div>
      <div class="form-row"><div class="field"><label>Device</label><input id="l-device" placeholder="iPhone 15 Pro 256GB"></div><div class="field"><label>Asking $</label><input id="l-asking" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Source</label><select id="l-source"><option>FB Marketplace</option><option>Craigslist</option><option>Walk-in</option><option>Referral</option><option>Google Ad</option><option>OfferUp</option><option>Other</option></select></div><div class="field"><label>Status</label><select id="l-status"><option value="new">New</option><option value="active">Active</option><option value="follow">Follow-Up</option><option value="closed">Closed</option><option value="lost">Lost</option></select></div></div>
      <div class="form-row"><div class="field"><label>Your Offer $</label><input id="l-offer" type="number"></div><div class="field"><label>Follow-Up Date</label><input id="l-followup" type="date"></div></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="l-notes" placeholder="Condition, battery %, notesâ€¦"></textarea></div></div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('addLead')">Cancel</button><button class="btn btn-gold" onclick="saveLead()">Save Lead</button></div>
  </div>
</div>

<!-- VIEW LEAD MODAL -->

<div class="overlay" id="modal-viewLead">
  <div class="modal">
    <div class="modal-header"><div class="modal-title" id="vl-title">LEAD</div><button class="modal-close" onclick="closeModal('viewLead')">Ã—</button></div>
    <div class="modal-body" id="vl-body"></div>
    <div class="modal-footer" id="vl-footer"></div>
  </div>
</div>

<!-- ADD INVENTORY MODAL -->

<div class="overlay" id="modal-addInventory">
  <div class="modal">
    <div class="modal-header"><div class="modal-title">ADD DEVICE</div><button class="modal-close" onclick="closeModal('addInventory')">Ã—</button></div>
    <div class="modal-body">
      <div class="form-row"><div class="field"><label>Device *</label><input id="i-device" placeholder="iPhone 15 Pro 256GB Unlocked"></div><div class="field"><label>IMEI/Serial</label><input id="i-imei"></div></div>
      <div class="form-row"><div class="field"><label>Paid $ *</label><input id="i-paid" type="number"></div><div class="field"><label>Sell Target $</label><input id="i-target" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Condition</label><select id="i-cond"><option>Grade A</option><option>Grade B</option><option>Grade C</option><option>Grade D</option><option>DOA</option></select></div><div class="field"><label>Sell Via</label><select id="i-sell"><option>Atlas Mobile</option><option>eBay</option><option>Swappa</option><option>Local</option><option>Other</option></select></div></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="i-notes"></textarea></div></div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('addInventory')">Cancel</button><button class="btn btn-gold" onclick="saveInventory()">Add Device</button></div>
  </div>
</div>

<!-- SELL MODAL -->

<div class="overlay" id="modal-sellInventory">
  <div class="modal">
    <div class="modal-header"><div class="modal-title">MARK SOLD</div><button class="modal-close" onclick="closeModal('sellInventory')">Ã—</button></div>
    <div class="modal-body">
      <div class="form-row"><div class="field"><label>Sold For $ *</label><input id="s-price" type="number"></div><div class="field"><label>Sold To</label><input id="s-buyer" placeholder="Atlas, eBayâ€¦"></div></div>
      <div class="form-row single"><div class="field"><label>Date</label><input id="s-date" type="date"></div></div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('sellInventory')">Cancel</button><button class="btn btn-gold" onclick="confirmSell()">Confirm Sale</button></div>
  </div>
</div>

<!-- ADD ALERT MODAL -->

<div class="overlay" id="modal-addAlert">
  <div class="modal">
    <div class="modal-header"><div class="modal-title">NEW ALERT</div><button class="modal-close" onclick="closeModal('addAlert')">Ã—</button></div>
    <div class="modal-body">
      <div class="form-row single"><div class="field"><label>Device to Watch *</label><input id="a-device" placeholder="iPhone 15 Pro, PS5, MacBookâ€¦"></div></div>
      <div class="form-row"><div class="field"><label>Max Price $</label><input id="a-maxprice" type="number"></div><div class="field"><label>Platform</label><select id="a-platform"><option>FB Marketplace</option><option>Craigslist</option><option>OfferUp</option><option>All</option></select></div></div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('addAlert')">Cancel</button><button class="btn btn-gold" onclick="saveAlert()">Add Monitor</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•
let state = { leads:[], inventory:[], alerts:[] };
let editLeadId = null, currentSellId = null;

function save(){ try{localStorage.setItem('tb2_state',JSON.stringify(state));}catch(e){} }
function load(){ try{const s=localStorage.getItem('tb2_state');if(s)state=JSON.parse(s);}catch(e){} }
load();

// â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•
function nav(page){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item,.mob-nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  document.querySelectorAll('.nav-item,.mob-nav-item').forEach(n=>{
    if(n.getAttribute('onclick')&&n.getAttribute('onclick').includes("'"+page+"'"))n.classList.add('active');
  });
  renderPage(page);
}
function renderPage(p){
  if(p==='dashboard')renderDashboard();
  if(p==='leads')renderLeads();
  if(p==='pipeline')renderPipeline();
  if(p==='followups')renderFollowups();
  if(p==='inventory')renderInventory();
  if(p==='alerts')renderAlerts();
  if(p==='profits')renderProfits();
  updateNavCounts();
}
function openMoreMenu(){ openModal('more'); }

// â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•
function openModal(id){
  if(id==='addLead'&&!editLeadId){
    ['l-name','l-phone','l-device','l-notes','l-offer','l-asking','l-followup'].forEach(f=>{const el=document.getElementById(f);if(el)el.value='';});
    document.getElementById('l-source').value='FB Marketplace';
    document.getElementById('l-status').value='new';
  }
  document.getElementById('modal-'+id).classList.add('open');
}
function closeModal(id){
  document.getElementById('modal-'+id).classList.remove('open');
  if(id==='addLead')editLeadId=null;
}
document.querySelectorAll('.overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open');}));

// â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•
function showToast(msg,type='success'){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className='toast show '+type;
  setTimeout(()=>t.classList.remove('show'),2800);
}

// â•â•â•â•â•â•â• LEADS â•â•â•â•â•â•â•
function saveLead(){
  const name=document.getElementById('l-name').value.trim();
  if(!name){showToast('Name required','error');return;}
  const lead={
    id:editLeadId||Date.now(),name,
    phone:document.getElementById('l-phone').value.trim(),
    device:document.getElementById('l-device').value.trim(),
    asking:parseFloat(document.getElementById('l-asking').value)||0,
    offer:parseFloat(document.getElementById('l-offer').value)||0,
    source:document.getElementById('l-source').value,
    status:document.getElementById('l-status').value,
    notes:document.getElementById('l-notes').value.trim(),
    followup:document.getElementById('l-followup').value,
    added:editLeadId?(state.leads.find(l=>l.id===editLeadId)?.added||new Date().toISOString()):new Date().toISOString()
  };
  if(editLeadId){const i=state.leads.findIndex(l=>l.id===editLeadId);if(i>-1)state.leads[i]=lead;showToast('Lead updated âœ“');}
  else{state.leads.unshift(lead);showToast('Lead added âœ“');}
  save();closeModal('addLead');renderPage('leads');renderDashboard();updateNavCounts();
}

function renderLeads(){
  const q=(document.getElementById('leadSearch')?.value||'').toLowerCase();
  const rows=state.leads.filter(l=>l.name.toLowerCase().includes(q)||l.phone.includes(q)||(l.device||'').toLowerCase().includes(q));
  const tbody=document.getElementById('leads-tbody');
  const empty=document.getElementById('leads-empty');
  if(!rows.length){tbody.innerHTML='';empty.style.display='';return;}
  empty.style.display='none';
  tbody.innerHTML=rows.map(l=>`<tr onclick="viewLead(${l.id})">
    <td class="td-name">${l.name}<div class="td-phone">${l.phone||''}</div></td>
    <td style="font-size:12px;">${l.device||'â€”'}</td>
    <td style="font-family:var(--mono);color:var(--gold);font-size:12px;">${l.asking?'$'+l.asking:'â€”'}</td>
    <td>${statusPill(l.status)}</td>
    <td class="hide-mobile" style="font-size:12px;color:var(--muted);">${l.source}</td>
    <td class="hide-mobile" style="font-family:var(--mono);font-size:11px;color:var(--muted);">${fmtDate(l.added)}</td>
    <td onclick="event.stopPropagation()"><div style="display:flex;gap:4px;"><button class="btn btn-ghost btn-sm" onclick="editLead(${l.id})">Edit</button><button class="btn btn-danger btn-sm" onclick="deleteLead(${l.id})">âœ•</button></div></td>
  </tr>`).join('');
}

function viewLead(id){
  const l=state.leads.find(x=>x.id===id);if(!l)return;
  document.getElementById('vl-title').textContent=l.name.toUpperCase();
  document.getElementById('vl-body').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;">
      <div><div style="font-family:var(--mono);font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:4px;">PHONE</div><div style="font-family:var(--mono);font-size:13px;">${l.phone||'â€”'}</div></div>
      <div><div style="font-family:var(--mono);font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:4px;">STATUS</div>${statusPill(l.status)}</div>
      <div><div style="font-family:var(--mono);font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:4px;">DEVICE</div><div style="font-size:13px;">${l.device||'â€”'}</div></div>
      <div><div style="font-family:var(--mono);font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:4px;">SOURCE</div><div style="font-size:13px;">${l.source}</div></div>
      <div><div style="font-family:var(--mono);font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:4px;">ASKING</div><div style="font-family:var(--mono);color:var(--red);">${l.asking?'$'+l.asking:'â€”'}</div></div>
      <div><div style="font-family:var(--mono);font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:4px;">YOUR OFFER</div><div style="font-family:var(--mono);color:var(--green);">${l.offer?'$'+l.offer:'â€”'}</div></div>
      ${l.followup?`<div style="grid-column:1/-1"><div style="font-family:var(--mono);font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:4px;">FOLLOW-UP</div><div style="font-family:var(--mono);color:var(--purple);">${l.followup}</div></div>`:''}
    </div>
    ${l.notes?`<div style="background:var(--card2);border:1px solid var(--border);border-radius:2px;padding:12px;font-size:13px;color:#bbb;line-height:1.6;">${l.notes}</div>`:''}`;
  document.getElementById('vl-footer').innerHTML=`
    <button class="btn btn-ghost" onclick="closeModal('viewLead')">Close</button>
    <button class="btn btn-ghost" onclick="closeModal('viewLead');editLead(${l.id})">Edit</button>
    <button class="btn btn-gold" onclick="closeModal('viewLead');markBought(${l.id})">Mark Bought â†’</button>`;
  openModal('viewLead');
}

function editLead(id){
  const l=state.leads.find(x=>x.id===id);if(!l)return;
  editLeadId=id;
  document.getElementById('l-name').value=l.name;
  document.getElementById('l-phone').value=l.phone||'';
  document.getElementById('l-device').value=l.device||'';
  document.getElementById('l-asking').value=l.asking||'';
  document.getElementById('l-offer').value=l.offer||'';
  document.getElementById('l-source').value=l.source;
  document.getElementById('l-status').value=l.status;
  document.getElementById('l-notes').value=l.notes||'';
  document.getElementById('l-followup').value=l.followup||'';
  openModal('addLead');
}

function deleteLead(id){
  if(!confirm('Delete this lead?'))return;
  state.leads=state.leads.filter(l=>l.id!==id);
  save();renderLeads();renderDashboard();updateNavCounts();showToast('Deleted');
}

function markBought(id){
  const l=state.leads.find(x=>x.id===id);if(!l)return;
  l.status='closed';
  document.getElementById('i-device').value=l.device||'';
  document.getElementById('i-paid').value=l.offer||l.asking||'';
  document.getElementById('i-notes').value=l.notes||'';
  ['i-imei','i-target'].forEach(f=>document.getElementById(f).value='');
  save();renderLeads();openModal('addInventory');
}

function exportLeads(){
  const rows=[['Name','Phone','Device','Asking','Offer','Status','Source','Added','Notes']];
  state.leads.forEach(l=>rows.push([l.name,l.phone,l.device,l.asking,l.offer,l.status,l.source,fmtDate(l.added),l.notes]));
  dlCSV('trey-buyback-leads.csv',rows);
}

// â•â•â•â•â•â•â• PIPELINE â•â•â•â•â•â•â•
const STAGES=[
  {key:'new',label:'New',color:'var(--blue)'},
  {key:'active',label:'Negotiating',color:'var(--gold)'},
  {key:'follow',label:'Follow-Up',color:'var(--purple)'},
  {key:'closed',label:'Bought âœ“',color:'var(--green)'},
  {key:'lost',label:'Lost',color:'var(--red)'}
];
function renderPipeline(){
  document.getElementById('pipeline-board').innerHTML=STAGES.map(st=>{
    const leads=state.leads.filter(l=>l.status===st.key);
    return`<div class="pipe-col"><div class="pipe-head" style="border-top:2px solid ${st.color}"><span>${st.label}</span><span class="cnt">${leads.length}</span></div>
      <div class="pipe-cards">${leads.length?leads.map(l=>`<div class="pipe-card" onclick="viewLead(${l.id})">
        <div class="pc-name">${l.name}</div><div class="pc-device">${l.device||'No device'}</div>
        ${l.asking?`<div class="pc-val">$${l.asking}</div>`:''}
        <div class="pc-date">${fmtDate(l.added)}</div></div>`).join('')
        :'<div style="color:var(--sub);font-size:11px;text-align:center;padding:16px;font-family:var(--mono);">Empty</div>'}
      </div></div>`;
  }).join('');
}

// â•â•â•â•â•â•â• FOLLOW-UPS â•â•â•â•â•â•â•
function renderFollowups(){
  const today=new Date().toISOString().split('T')[0];
  const od=state.leads.filter(l=>l.followup&&l.followup<=today&&l.status!=='closed'&&l.status!=='lost');
  const up=state.leads.filter(l=>l.followup&&l.followup>today&&l.status!=='closed'&&l.status!=='lost');
  document.getElementById('fu-due').innerHTML=od.length?od.map(l=>fuItem(l,true)).join(''):'<div class="empty"><div class="empty-icon">âœ…</div>All caught up!</div>';
  document.getElementById('fu-upcoming').innerHTML=up.length?up.map(l=>fuItem(l,false)).join(''):'<div class="empty"><div class="empty-icon">ğŸ“…</div>No upcoming follow-ups</div>';
}
function fuItem(l,overdue){
  const init=l.name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
  return`<div class="fu-item"><div class="fu-avatar">${init}</div>
    <div class="fu-info"><div class="fu-name">${l.name}</div><div class="fu-device">${l.device||'No device'}</div>
    <div class="fu-time" style="color:${overdue?'var(--red)':'var(--purple)'};">${overdue?'OVERDUE':'Due'}: ${l.followup}</div></div>
    <div class="fu-actions"><button class="btn btn-ghost btn-sm" onclick="editLead(${l.id})">Edit</button><button class="btn btn-green btn-sm" onclick="viewLead(${l.id})">View</button></div>
  </div>`;
}

// â•â•â•â•â•â•â• INVENTORY â•â•â•â•â•â•â•
function saveInventory(){
  const device=document.getElementById('i-device').value.trim();
  const paid=parseFloat(document.getElementById('i-paid').value)||0;
  if(!device){showToast('Device name required','error');return;}
  state.inventory.push({id:Date.now(),device,imei:document.getElementById('i-imei').value.trim(),paid,target:parseFloat(document.getElementById('i-target').value)||0,cond:document.getElementById('i-cond').value,sellVia:document.getElementById('i-sell').value,notes:document.getElementById('i-notes').value.trim(),added:new Date().toISOString(),sold:false});
  save();closeModal('addInventory');renderInventory();renderDashboard();showToast('Device added âœ“');
  ['i-device','i-imei','i-paid','i-target','i-notes'].forEach(f=>document.getElementById(f).value='');
}
function renderInventory(){
  const items=state.inventory.filter(i=>!i.sold);
  const tp=items.reduce((s,i)=>s+i.paid,0);
  const tpr=items.reduce((s,i)=>s+(i.target-i.paid),0);
  document.getElementById('inv-count').textContent=items.length;
  document.getElementById('inv-invested').textContent='$'+tp.toLocaleString();
  document.getElementById('inv-profit').textContent='$'+tpr.toLocaleString();
  const grid=document.getElementById('inv-grid');
  const empty=document.getElementById('inv-empty');
  if(!items.length){grid.innerHTML='';empty.style.display='';return;}
  empty.style.display='none';
  grid.innerHTML=items.map(i=>{
    const pr=i.target-i.paid;
    return`<div class="inv-card"><div class="inv-model">${i.device}</div>
      <div class="inv-detail">${i.cond} Â· ${i.sellVia}</div>
      ${i.imei?`<div class="inv-detail">IMEI: ${i.imei}</div>`:''}
      <div class="inv-paid">$${i.paid.toLocaleString()}</div>
      <div class="inv-profit-line ${pr>=0?'pos':'neg'}">${pr>=0?'+':''}$${pr.toLocaleString()} est</div>
      <div style="display:flex;gap:5px;margin-top:10px;">
        <button class="btn btn-green btn-sm" style="flex:1;" onclick="sellInventory(${i.id})">Sell</button>
        <button class="btn btn-danger btn-sm" onclick="deleteInv(${i.id})">âœ•</button>
      </div>
      ${i.notes?`<div style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.5;">${i.notes}</div>`:''}
    </div>`;
  }).join('');
}
function sellInventory(id){currentSellId=id;document.getElementById('s-date').value=new Date().toISOString().split('T')[0];document.getElementById('s-price').value='';document.getElementById('s-buyer').value='';openModal('sellInventory');}
function confirmSell(){
  const price=parseFloat(document.getElementById('s-price').value)||0;
  const item=state.inventory.find(i=>i.id===currentSellId);if(!item)return;
  item.sold=true;item.soldFor=price;item.soldTo=document.getElementById('s-buyer').value.trim();item.soldDate=document.getElementById('s-date').value;
  save();closeModal('sellInventory');renderInventory();renderProfits();renderDashboard();
  showToast(`Profit: $${(price-item.paid).toLocaleString()} ğŸ¤‘`);
}
function deleteInv(id){if(!confirm('Remove?'))return;state.inventory=state.inventory.filter(i=>i.id!==id);save();renderInventory();showToast('Removed');}

// â•â•â•â•â•â•â• PROFITS â•â•â•â•â•â•â•
function renderProfits(){
  const sold=state.inventory.filter(i=>i.sold);
  const rev=sold.reduce((s,i)=>s+i.soldFor,0);
  const sp=sold.reduce((s,i)=>s+i.paid,0);
  const net=rev-sp;
  const avg=sold.length?Math.round(net/sold.length):0;
  document.getElementById('pr-revenue').textContent='$'+rev.toLocaleString();
  document.getElementById('pr-spent').textContent='$'+sp.toLocaleString();
  document.getElementById('pr-net').textContent='$'+net.toLocaleString();
  document.getElementById('pr-avg').textContent='$'+avg.toLocaleString();
  const tbody=document.getElementById('profits-tbody');
  const empty=document.getElementById('profits-empty');
  if(!sold.length){tbody.innerHTML='';empty.style.display='';return;}
  empty.style.display='none';
  tbody.innerHTML=sold.sort((a,b)=>new Date(b.soldDate)-new Date(a.soldDate)).map(i=>{
    const pr=i.soldFor-i.paid;
    return`<tr><td>${i.device}</td><td style="font-family:var(--mono);color:var(--red);font-size:12px;">$${i.paid.toLocaleString()}</td><td style="font-family:var(--mono);color:var(--green);font-size:12px;">$${i.soldFor.toLocaleString()}</td><td style="font-family:var(--mono);color:${pr>=0?'var(--green)':'var(--red)'};font-size:12px;">${pr>=0?'+':''}$${pr.toLocaleString()}</td><td class="hide-mobile" style="font-family:var(--mono);font-size:11px;color:var(--muted);">${i.soldDate||'â€”'}</td><td class="hide-mobile" style="font-size:12px;color:var(--muted);">${i.soldTo||'â€”'}</td></tr>`;
  }).join('');
}
function exportProfits(){
  const sold=state.inventory.filter(i=>i.sold);
  const rows=[['Device','Paid','Sold For','Profit','Date','Buyer']];
  sold.forEach(i=>rows.push([i.device,i.paid,i.soldFor,i.soldFor-i.paid,i.soldDate,i.soldTo]));
  dlCSV('trey-buyback-profits.csv',rows);
}

// â•â•â•â•â•â•â• ALERTS â•â•â•â•â•â•â•
function saveAlert(){
  const device=document.getElementById('a-device').value.trim();
  if(!device){showToast('Enter a device','error');return;}
  state.alerts.push({id:Date.now(),device,maxPrice:parseFloat(document.getElementById('a-maxprice').value)||0,platform:document.getElementById('a-platform').value,added:new Date().toISOString()});
  save();closeModal('addAlert');renderAlerts();showToast('Alert added âœ“');
}
function renderAlerts(){
  document.getElementById('alert-monitors').innerHTML=state.alerts.length
    ?state.alerts.map(a=>`<div style="display:flex;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);gap:12px;">
        <span>ğŸ”</span><div style="flex:1;"><div style="font-weight:500;font-size:13px;">${a.device}</div><div style="font-size:11px;color:var(--muted);">Under $${a.maxPrice||'any'} Â· ${a.platform}</div></div>
        <button class="btn btn-danger btn-sm" onclick="delAlert(${a.id})">Remove</button></div>`).join('')
    :'<div class="empty"><div class="empty-icon">ğŸ”</div>No monitors set</div>';
  document.getElementById('alert-hits').innerHTML=[
    {icon:'ğŸ“±',t:'iPhone 15 Pro 128GB â€” $340',d:'Listed 2hr ago Â· FB Marketplace Â· Condition: Good',time:'2 hours ago',hot:true},
    {icon:'ğŸ’»',t:'MacBook Pro 14" M3 â€” $890',d:'Listed 5hr ago Â· Craigslist Â· "Like new, barely used"',time:'5 hours ago',hot:true},
    {icon:'ğŸ®',t:'PS5 Bundle â€” $280',d:'Listed 1 day ago Â· OfferUp Â· Includes 3 games',time:'Yesterday',hot:false},
  ].map(h=>`<div class="alert-item ${h.hot?'alert-new':''}"><div class="alert-icon">${h.icon}</div>
    <div class="alert-body"><div class="alert-title">${h.t}</div><div class="alert-desc">${h.d}</div><div class="alert-time">${h.time}</div></div>
    ${h.hot?'<span style="font-family:var(--mono);font-size:9px;color:var(--gold);border:1px solid rgba(232,192,74,0.3);padding:2px 7px;border-radius:2px;">HOT</span>':''}</div>`).join('');
}
function delAlert(id){state.alerts=state.alerts.filter(a=>a.id!==id);save();renderAlerts();}

// â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•
function renderDashboard(){
  const active=state.leads.filter(l=>l.status==='active').length;
  const closed=state.leads.filter(l=>l.status==='closed').length;
  const profit=state.inventory.filter(i=>i.sold).reduce((s,i)=>s+(i.soldFor-i.paid),0);
  document.getElementById('ds-leads').textContent=state.leads.length;
  document.getElementById('ds-active').textContent=active;
  document.getElementById('ds-closed').textContent=closed;
  document.getElementById('ds-profit').textContent='$'+profit.toLocaleString();
  const recent=state.leads.slice(0,5);
  document.getElementById('dash-recent').innerHTML=recent.length?recent.map(l=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);">
    <div><div style="font-size:13px;font-weight:500;">${l.name}</div><div style="font-size:11px;color:var(--muted);">${l.device||'No device'}</div></div>
    ${statusPill(l.status)}</div>`).join(''):'<div class="empty"><div class="empty-icon">ğŸ‘¥</div>No leads yet</div>';
  const today=new Date().toISOString().split('T')[0];
  const due=state.leads.filter(l=>l.followup&&l.followup<=today&&l.status!=='closed'&&l.status!=='lost');
  document.getElementById('dash-fu').innerHTML=due.length?due.map(l=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);">
    <div><div style="font-size:13px;font-weight:500;">${l.name}</div><div style="font-size:11px;color:var(--muted);">${l.device||'â€”'}</div></div>
    <span style="font-family:var(--mono);font-size:10px;color:var(--red);">OVERDUE</span></div>`).join('')
    :'<div class="empty"><div class="empty-icon">âœ…</div>All caught up!</div>';
  document.getElementById('dash-pipeline').innerHTML=STAGES.map(st=>{
    const cnt=state.leads.filter(l=>l.status===st.key).length;
    return`<div style="display:flex;align-items:center;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);">
      <div style="display:flex;align-items:center;gap:8px;font-size:13px;"><span style="width:7px;height:7px;border-radius:50%;background:${st.color};display:inline-block;flex-shrink:0;"></span>${st.label}</div>
      <span style="font-family:var(--mono);font-size:13px;color:${st.color};">${cnt}</span></div>`;
  }).join('');
  const devCount={};
  state.leads.forEach(l=>{if(l.device){const k=l.device.split(' ').slice(0,3).join(' ');devCount[k]=(devCount[k]||0)+1;}});
  const topD=Object.entries(devCount).sort((a,b)=>b[1]-a[1]).slice(0,5);
  document.getElementById('dash-devices').innerHTML=topD.length?topD.map(([d,c])=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);">
    <div style="font-size:13px;">${d}</div><span style="font-family:var(--mono);font-size:12px;color:var(--gold);">${c}</span></div>`).join('')
    :'<div class="empty"><div class="empty-icon">ğŸ“±</div>Add leads to see top devices</div>';
}

// â•â•â•â•â•â•â• PLAYBOOK â•â•â•â•â•â•â•
function pbTab(id){
  document.querySelectorAll('.pb-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.pb-section').forEach(s=>s.classList.remove('active'));
  document.querySelector(`[onclick="pbTab('${id}')"]`).classList.add('active');
  document.getElementById('pb-'+id).classList.add('active');
}
function toggleFunnelTip(id){
  const el=document.getElementById(id);
  el.classList.toggle('open');
}
function toggleScript(head){
  const body=head.nextElementSibling;
  const arrow=head.querySelector('.script-arrow');
  body.classList.toggle('open');
  arrow.textContent=body.classList.contains('open')?'â–²':'â–¼';
}

// â•â•â•â•â•â•â• FLIP CALC â•â•â•â•â•â•â•
const PRICES=[
  {m:'iPhone 17 Pro Max',s:'256GB',u:[970,950,930,745,475,190],l:[815,805,780,690,400,190],cb:215,cl:120},
  {m:'iPhone 17 Pro Max',s:'512GB',u:[1070,1050,1030,790,520,190],l:[1005,995,955,800,430,190],cb:215,cl:120},
  {m:'iPhone 17 Pro Max',s:'1TB',u:[1195,1175,1155,855,565,190],l:[1115,1105,1045,860,450,190],cb:215,cl:120},
  {m:'iPhone 17 Pro',s:'256GB',u:[880,860,840,630,395,140],l:[725,715,685,600,325,140],cb:180,cl:100},
  {m:'iPhone 17 Pro',s:'512GB',u:[960,940,920,700,425,140],l:[865,855,825,655,340,140],cb:180,cl:100},
  {m:'iPhone 17 Air',s:'256GB',u:[640,630,610,450,245,100],l:[405,395,365,315,165,100],cb:180,cl:100},
  {m:'iPhone 17 Air',s:'512GB',u:[760,750,730,495,270,100],l:[470,460,430,350,200,100],cb:180,cl:100},
  {m:'iPhone 17',s:'256GB',u:[615,595,575,460,315,80],l:[505,495,470,390,215,80],cb:160,cl:90},
  {m:'iPhone 17',s:'512GB',u:[700,680,660,515,360,80],l:[630,620,600,510,245,80],cb:160,cl:90},
  {m:'iPhone 16 Pro Max',s:'256GB',u:[675,665,645,505,300,190],l:[590,580,540,450,245,190],cb:140,cl:90},
  {m:'iPhone 16 Pro Max',s:'512GB',u:[705,695,675,540,320,190],l:[630,620,580,470,270,190],cb:140,cl:90},
  {m:'iPhone 16 Pro Max',s:'1TB',u:[735,725,705,585,345,190],l:[680,670,630,490,320,190],cb:140,cl:90},
  {m:'iPhone 16 Pro',s:'128GB',u:[570,560,540,360,235,113],l:[410,400,390,310,180,113],cb:120,cl:70},
  {m:'iPhone 16 Pro',s:'256GB',u:[595,585,565,395,270,113],l:[450,440,430,340,210,113],cb:120,cl:70},
  {m:'iPhone 16 Pro',s:'512GB',u:[615,605,585,425,295,113],l:[500,490,480,410,230,113],cb:120,cl:70},
  {m:'iPhone 16 Plus',s:'128GB',u:[480,470,450,315,225,70],l:[320,310,290,230,150,70],cb:100,cl:70},
  {m:'iPhone 16 Plus',s:'256GB',u:[510,500,480,340,250,70],l:[350,340,330,260,180,70],cb:100,cl:70},
  {m:'iPhone 16',s:'128GB',u:[455,445,425,295,205,54],l:[305,295,275,240,140,54],cb:80,cl:60},
  {m:'iPhone 16',s:'256GB',u:[485,475,455,325,235,54],l:[335,325,305,260,160,54],cb:80,cl:60},
  {m:'iPhone 16',s:'512GB',u:[505,495,475,350,245,54],l:[365,355,335,285,165,54],cb:80,cl:60},
  {m:'iPhone 16E',s:'128GB',u:[295,285,270,185,160,33],l:[165,155,125,85,60,33],cb:null,cl:null},
  {m:'iPhone 16E',s:'256GB',u:[325,315,300,210,180,33],l:[185,175,145,110,85,33],cb:null,cl:null},
  {m:'iPhone 15 Pro Max',s:'256GB',u:[465,455,435,370,260,113],l:[385,375,365,300,160,113],cb:110,cl:80},
  {m:'iPhone 15 Pro Max',s:'512GB',u:[485,475,455,385,280,113],l:[465,405,395,325,190,113],cb:110,cl:80},
  {m:'iPhone 15 Pro',s:'128GB',u:[395,385,365,280,190,76],l:[290,280,280,225,155,76],cb:110,cl:80},
  {m:'iPhone 15 Pro',s:'256GB',u:[415,405,385,305,215,76],l:[320,310,300,245,170,76],cb:110,cl:80},
  {m:'iPhone 15 Plus',s:'128GB',u:[380,370,350,215,145,67],l:[250,240,225,180,120,67],cb:70,cl:50},
  {m:'iPhone 15',s:'128GB',u:[340,330,310,220,145,55],l:[235,225,205,145,100,55],cb:70,cl:50},
  {m:'iPhone 15',s:'256GB',u:[360,350,330,240,165,55],l:[255,245,225,170,120,55],cb:70,cl:50},
  {m:'iPhone 14 Pro Max',s:'128GB',u:[365,355,335,255,180,86],l:[275,265,245,200,120,86],cb:90,cl:50},
  {m:'iPhone 14 Pro Max',s:'256GB',u:[385,375,355,285,200,86],l:[300,290,270,220,140,86],cb:90,cl:50},
  {m:'iPhone 14 Pro',s:'128GB',u:[310,300,285,225,155,49],l:[245,235,220,170,110,49],cb:80,cl:50},
  {m:'iPhone 14 Pro',s:'256GB',u:[330,320,305,245,160,49],l:[270,260,230,180,115,49],cb:80,cl:50},
  {m:'iPhone 14',s:'128GB',u:[225,215,200,135,55,33],l:[155,145,145,100,70,33],cb:50,cl:40},
  {m:'iPhone 14',s:'256GB',u:[245,235,235,150,75,33],l:[165,155,145,110,80,33],cb:50,cl:40},
  {m:'iPhone 13 Pro Max',s:'128GB',u:[320,310,290,215,155,54],l:[250,240,230,175,100,54],cb:70,cl:50},
  {m:'iPhone 13 Pro Max',s:'256GB',u:[340,330,310,235,170,54],l:[260,250,240,185,110,54],cb:70,cl:50},
  {m:'iPhone 13 Pro',s:'128GB',u:[295,265,245,170,130,48],l:[190,180,170,145,75,48],cb:60,cl:40},
  {m:'iPhone 13 Pro',s:'256GB',u:[315,285,265,185,145,48],l:[200,190,180,155,95,48],cb:60,cl:40},
  {m:'iPhone 13',s:'128GB',u:[220,200,185,130,105,27],l:[150,150,140,85,65,27],cb:50,cl:40},
  {m:'iPhone 13',s:'256GB',u:[240,220,205,145,110,27],l:[160,160,150,95,75,27],cb:50,cl:40},
  {m:'iPhone 13 Mini',s:'128GB',u:[180,160,160,90,50,22],l:[105,95,85,40,30,22],cb:40,cl:40},
  {m:'iPhone 12 Pro Max',s:'128GB',u:[250,240,225,125,75,43],l:[145,135,125,100,65,43],cb:60,cl:40},
  {m:'iPhone 12 Pro',s:'128GB',u:[200,190,175,90,65,25],l:[125,115,105,75,50,25],cb:50,cl:40},
  {m:'iPhone 12',s:'64GB',u:[150,130,120,50,35,19],l:[85,80,75,50,35,19],cb:40,cl:30},
  {m:'iPhone 12',s:'128GB',u:[165,145,135,55,40,19],l:[95,90,85,60,45,19],cb:40,cl:30},
  {m:'iPhone 11 Pro Max',s:'64GB',u:[180,175,170,90,55,16],l:[95,90,90,60,40,16],cb:40,cl:30},
  {m:'iPhone 11',s:'64GB',u:[125,115,105,45,15,19],l:[80,75,75,50,30,19],cb:30,cl:20},
  {m:'iPhone 11',s:'128GB',u:[140,130,120,60,30,19],l:[85,80,80,55,35,19],cb:30,cl:20},
  {m:'iPhone XS Max',s:'64GB',u:[150,140,130,70,50,2],l:[55,50,50,30,20,2],cb:30,cl:20},
  {m:'iPhone XR',s:'64GB',u:[90,85,80,30,15,2],l:[55,50,50,20,10,2],cb:25,cl:25},
  {m:'iPhone XR',s:'128GB',u:[95,90,85,35,20,2],l:[60,55,55,25,15,2],cb:25,cl:25},
];
let cGrade='swap';
const cDeds={back:false,lens:false,faceid:false,battery:false,repair:false};
const cModelSel=document.getElementById('c-model');
[...new Set(PRICES.map(p=>p.m))].forEach(m=>{const o=document.createElement('option');o.value=m;o.textContent=m;cModelSel.appendChild(o);});
function calcUpdateStorage(){
  const storageSel=document.getElementById('c-storage');
  storageSel.innerHTML='<option value="">â€”</option>';
  PRICES.filter(p=>p.m===cModelSel.value).map(p=>p.s).forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s;storageSel.appendChild(o);});
  calcUpdate();
}
function cSetGrade(g,el){cGrade=g;document.querySelectorAll('#c-cond-grid .cond-btn').forEach(b=>b.classList.remove('active'));el.classList.add('active');calcUpdate();}
function cToggle(key,el){cDeds[key]=!cDeds[key];el.classList.toggle('on',cDeds[key]);calcUpdate();}
function calcUpdate(){
  const model=document.getElementById('c-model').value;
  const storage=document.getElementById('c-storage').value;
  const lock=document.getElementById('c-lock').value;
  const minP=parseFloat(document.getElementById('c-minprofit').value)||40;
  const risk=parseFloat(document.getElementById('c-riskbuf').value)||20;
  const asking=parseFloat(document.getElementById('c-asking').value)||0;
  const row=PRICES.find(p=>p.m===model&&p.s===storage);
  const panel=document.getElementById('c-result-panel');
  if(!row){panel.innerHTML='<div style="padding:40px;text-align:center;color:var(--muted);font-family:var(--mono);font-size:11px;letter-spacing:1px;">SELECT A MODEL TO SEE YOUR DEAL</div>';return;}
  document.getElementById('c-d-back').textContent=row.cb?`-$${row.cb}`:'N/A';
  document.getElementById('c-d-lens').textContent=row.cl?`-$${row.cl}`:'N/A';
  const grades=lock==='unlocked'?row.u:row.l;
  const gi={swap:0,a:1,b:2,c:3,d:4,doa:5}[cGrade];
  const atlas=grades[gi];
  let ded=0;
  if(cDeds.back&&row.cb)ded+=row.cb;
  if(cDeds.lens&&row.cl)ded+=row.cl;
  if(cDeds.battery)ded+=30;if(cDeds.repair)ded+=40;
  const net=atlas-ded;const maxBuy=net-minP-risk;const profit=net-maxBuy;
  let askHtml='';
  if(asking>0&&maxBuy>0){
    if(asking>maxBuy){const ov=asking-maxBuy;askHtml=`<div style="margin:10px 16px;background:rgba(255,69,69,0.1);border:1px solid rgba(255,69,69,0.3);border-radius:2px;padding:10px 12px;font-family:var(--mono);font-size:11px;color:var(--red);">âš  $${ov} over max. Negotiate or walk.</div>`;}
    else{askHtml=`<div style="margin:10px 16px;background:rgba(61,220,132,0.08);border:1px solid rgba(61,220,132,0.3);border-radius:2px;padding:10px 12px;font-family:var(--mono);font-size:11px;color:var(--green);">âœ“ Deal works. $${Math.round(maxBuy-asking+profit)} total room.</div>`;}
  }
  panel.innerHTML=`<div class="result-big"><div class="result-cell"><div class="result-cell-label">Max Buy Price</div><div class="result-cell-val ${maxBuy>0?'buy':'bad'}">${maxBuy>0?'$'+maxBuy.toLocaleString():'SKIP'}</div></div><div class="result-cell"><div class="result-cell-label">Your Profit</div><div class="result-cell-val ${profit>0?'profit':'bad'}">${profit>0?'$'+profit.toLocaleString():'â€”'}</div></div></div>
  <div class="result-detail">
    <div class="r-row"><span class="r-key">Atlas Payout</span><span class="r-val" style="color:var(--muted);">$${atlas.toLocaleString()}</span></div>
    <div class="r-row"><span class="r-key">Deductions</span><span class="r-val" style="color:var(--red);">${ded>0?'-$'+ded:'$0'}</span></div>
    <div class="r-row"><span class="r-key">Net Value</span><span class="r-val">$${net.toLocaleString()}</span></div>
    <div class="r-row"><span class="r-key">Min Profit</span><span class="r-val" style="color:var(--muted);">$${minP}</span></div>
    <div class="r-row"><span class="r-key">Risk Buffer</span><span class="r-val" style="color:var(--muted);">$${risk}</span></div>
  </div>${askHtml}
  <div style="padding:10px 16px 14px;"><button class="btn btn-gold" style="width:100%;" onclick="addFromCalc('${model}','${storage}',${maxBuy})">+ Add as Lead</button></div>`;
}
function addFromCalc(model,storage,maxBuy){document.getElementById('l-device').value=model+' '+storage;document.getElementById('l-offer').value=maxBuy>0?maxBuy:'';document.getElementById('l-source').value='FB Marketplace';openModal('addLead');}

// â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â•
function statusPill(s){
  const m={new:'pill-new',active:'pill-active',closed:'pill-closed',lost:'pill-lost',follow:'pill-follow'};
  const lb={new:'New',active:'Active',closed:'Bought',lost:'Lost',follow:'Follow-Up'};
  return`<span class="pill ${m[s]||'pill-new'}">${lb[s]||s}</span>`;
}
function fmtDate(iso){if(!iso)return'â€”';const d=new Date(iso);return d.toLocaleDateString('en-US',{month:'short',day:'numeric'});}
function updateNavCounts(){
  document.getElementById('nc-leads').textContent=state.leads.filter(l=>l.status==='new').length;
  const today=new Date().toISOString().split('T')[0];
  document.getElementById('nc-fu').textContent=state.leads.filter(l=>l.followup&&l.followup<=today&&l.status!=='closed'&&l.status!=='lost').length;
  document.getElementById('nc-alerts').textContent=state.alerts.length;
}
function dlCSV(filename,rows){
  const csv=rows.map(r=>r.map(c=>'"'+(c||'').toString().replace(/"/g,'""')+'"').join(',')).join('\n');
  const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));a.download=filename;a.click();
}

// â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•
const now=new Date();
document.getElementById('topDate').textContent=now.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
const hr=now.getHours();
document.getElementById('dashGreet').textContent=(hr<12?'Good morning':hr<17?'Good afternoon':'Good evening')+' â€” ready to flip?';
renderDashboard();updateNavCounts();
</script>

</body>
</html>

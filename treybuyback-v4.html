<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Trey Buyback</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" onerror="window.emailjs={init:()=>{},send:()=>Promise.reject('EmailJS not loaded')}"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
a,button,[onclick]{touch-action:manipulation;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#070707;--dark:#0c0c0c;--card:#111;--card2:#171717;
  --border:#1c1c1c;--border2:#282828;
  --gold:#e8c04a;--gold2:#f5d98a;--green:#3ddc84;--red:#ff4545;
  --blue:#4a9eff;--purple:#a855f7;--orange:#ff8c42;--teal:#2dd4bf;
  --text:#f0f0f0;--muted:#555;--sub:#1e1e1e;
  --D:'Bebas Neue',sans-serif;--M:'DM Mono',monospace;--S:'DM Sans',sans-serif
}
html,body{height:100%;height:-webkit-fill-available}
body{background:var(--bg);color:var(--text);font-family:var(--S);display:flex;flex-direction:column;overflow:hidden;-webkit-tap-highlight-color:transparent}
/* topbar */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:0 16px;height:50px;background:var(--dark);border-bottom:1px solid var(--border);flex-shrink:0;z-index:50}
.logo{font-family:var(--D);font-size:22px;letter-spacing:2px;color:var(--gold)}
.logo span{color:var(--text)}
.top-right{display:flex;align-items:center;gap:10px}
.badge{font-family:var(--M);font-size:9px;background:rgba(232,192,74,.1);border:1px solid rgba(232,192,74,.3);color:var(--gold);padding:3px 8px;border-radius:2px;letter-spacing:1px}
.icon-btn{background:none;border:1px solid var(--border2);border-radius:2px;color:var(--muted);cursor:pointer;padding:5px 9px;font-size:14px}
.icon-btn:hover{color:var(--text);border-color:#444}
#topDate{font-size:11px;color:var(--muted)}
/* layout */
.shell{display:flex;flex:1;overflow:hidden}
.sidebar{width:190px;background:var(--dark);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;overflow-y:auto}
.nav-section{padding:14px 12px 3px;font-family:var(--M);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--muted)}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 13px;cursor:pointer;font-size:13px;color:#888;border-left:2px solid transparent;transition:all .1s;user-select:none}
.nav-item:hover{background:rgba(255,255,255,.03);color:var(--text)}
.nav-item.active{background:rgba(232,192,74,.07);color:var(--gold);border-left-color:var(--gold)}
.nav-icon{font-size:14px;width:16px;text-align:center}
.nc{margin-left:auto;font-family:var(--M);font-size:10px;background:var(--sub);color:var(--muted);padding:2px 6px;border-radius:10px}
.nc.hot{background:rgba(255,69,69,.2);color:var(--red)}
.nc.ai{background:rgba(168,85,247,.2);color:var(--purple)}
.nc.live{background:rgba(45,212,191,.2);color:var(--teal)}
/* mobile nav */
.mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;height:54px;background:var(--dark);border-top:1px solid var(--border);z-index:100;flex-direction:row}
.mob-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer;color:var(--muted);font-size:8px;font-family:var(--M);letter-spacing:1px;text-transform:uppercase;border-top:2px solid transparent;transition:all .1s}
.mob-item.active{color:var(--gold);border-top-color:var(--gold)}
.mob-item .mi{font-size:17px}
/* pages */
.main{flex:1;overflow-y:auto;display:flex;flex-direction:column}
.page{display:none;flex:1;flex-direction:column}
.page.active{display:flex}
/* page header */
.ph{padding:14px 16px 12px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between;flex-shrink:0;gap:10px}
.pt{font-family:var(--D);font-size:24px;letter-spacing:1px}
.ps{font-size:11px;color:var(--muted);margin-top:1px;font-family:var(--M)}
.ha{display:flex;gap:7px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end}
/* buttons */
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:2px;border:none;cursor:pointer;font-family:var(--S);font-size:13px;font-weight:500;transition:all .1s;white-space:nowrap}
.btn-gold{background:var(--gold);color:#000}
.btn-gold:hover{background:var(--gold2)}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--text)}
.btn-ghost:hover{border-color:#444}
.btn-purple{background:rgba(168,85,247,.15);border:1px solid rgba(168,85,247,.3);color:var(--purple)}
.btn-teal{background:rgba(45,212,191,.15);border:1px solid rgba(45,212,191,.3);color:var(--teal)}
.btn-teal:hover{background:rgba(45,212,191,.25)}
.btn-sm{padding:5px 10px;font-size:12px}
.btn-danger{background:rgba(255,69,69,.1);border:1px solid rgba(255,69,69,.25);color:var(--red)}
.btn-green{background:rgba(61,220,132,.1);border:1px solid rgba(61,220,132,.25);color:var(--green)}
/* stats */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:12px 16px;flex-shrink:0}
.sc{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:13px 14px}
.sl{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px}
.sv{font-family:var(--D);font-size:30px;letter-spacing:1px;line-height:1}
.sv.gold{color:var(--gold)}.sv.green{color:var(--green)}.sv.red{color:var(--red)}.sv.blue{color:var(--blue)}
/* content */
.ca{padding:0 16px 80px;flex:1;overflow-y:auto}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px}
.panel{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:14px}
.panel-title{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:10px;display:flex;align-items:center;justify-content:space-between}
/* table */
.tw{padding:0 16px 80px;flex:1;overflow-y:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);background:var(--bg);white-space:nowrap}
tbody tr{border-bottom:1px solid var(--border);transition:background .1s;cursor:pointer}
tbody tr:hover{background:rgba(255,255,255,.02)}
td{padding:9px 10px;vertical-align:middle}
/* pills */
.pill{display:inline-block;padding:2px 8px;border-radius:2px;font-size:9px;font-family:var(--M);letter-spacing:1px;text-transform:uppercase}
.p-new{background:rgba(74,158,255,.12);color:var(--blue);border:1px solid rgba(74,158,255,.25)}
.p-active{background:rgba(232,192,74,.1);color:var(--gold);border:1px solid rgba(232,192,74,.25)}
.p-closed{background:rgba(61,220,132,.1);color:var(--green);border:1px solid rgba(61,220,132,.25)}
.p-lost{background:rgba(255,69,69,.1);color:var(--red);border:1px solid rgba(255,69,69,.25)}
.p-follow{background:rgba(168,85,247,.1);color:var(--purple);border:1px solid rgba(168,85,247,.25)}
/* forms */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:9px}
.form-row.single{grid-template-columns:1fr}
.field label{display:block;font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:4px}
.field input,.field select,.field textarea{width:100%;background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:12px;padding:8px 10px;outline:none;transition:border-color .1s;-webkit-appearance:none;appearance:none}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--gold)}
.field select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23555' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 9px center;padding-right:26px}
.field textarea{resize:vertical;min-height:65px}
/* modals */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:200;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(3px)}
.overlay.open{display:flex}
.modal{background:var(--card);border:1px solid var(--border2);border-radius:2px 2px 0 0;width:100%;max-width:580px;max-height:93vh;overflow-y:auto;animation:slideUp .2s ease}
@keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
.mh{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--card);z-index:2}
.mt{font-family:var(--D);font-size:20px;letter-spacing:1px}
.mc{background:none;border:none;color:var(--muted);cursor:pointer;font-size:20px;line-height:1;padding:0 4px}
.mb{padding:16px}
.mf{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px;position:sticky;bottom:0;background:var(--card)}
/* pipeline */
.pipeline{display:grid;grid-template-columns:repeat(5,minmax(145px,1fr));gap:8px;padding:0 16px 80px;flex:1;overflow-x:auto}
.pipe-col{background:var(--card);border:1px solid var(--border);border-radius:2px;display:flex;flex-direction:column;min-width:145px}
.pipe-head{padding:9px 11px;border-bottom:1px solid var(--border);font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;justify-content:space-between}
.pipe-cards{padding:7px;display:flex;flex-direction:column;gap:6px;flex:1;overflow-y:auto;min-height:100px}
.pipe-card{background:var(--card2);border:1px solid var(--border2);border-radius:2px;padding:9px 10px;cursor:pointer}
.pipe-card:hover{border-color:#333}
/* ai */
.ai-wrap{display:flex;flex-direction:column;flex:1;overflow:hidden;padding:0 16px 80px}
.ai-modes{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px;flex-shrink:0}
.ai-mode-btn{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:10px 8px;cursor:pointer;text-align:center;transition:all .1s}
.ai-mode-btn.active{border-color:var(--purple);background:rgba(168,85,247,.07)}
.ai-mode-icon{font-size:18px;margin-bottom:3px}
.ai-mode-label{font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--muted)}
.ai-mode-btn.active .ai-mode-label{color:var(--purple)}
.ai-chat{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:10px;margin-bottom:10px;padding:2px 0}
.ai-msg{display:flex;gap:8px;align-items:flex-start}
.ai-msg.user{flex-direction:row-reverse}
.ai-av{width:26px;height:26px;border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.ai-av.bot{background:rgba(168,85,247,.18);border:1px solid rgba(168,85,247,.3)}
.ai-av.user{background:var(--gold);color:#000;font-family:var(--D);font-size:13px}
.ai-bubble{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:10px 12px;font-size:13px;line-height:1.75;max-width:86%}
.ai-bubble.user{background:rgba(232,192,74,.07);border-color:rgba(232,192,74,.2)}
.ai-bubble.bot{border-left:2px solid var(--purple)}
.ai-bubble strong{color:var(--gold)}
.ai-sline{background:var(--card2);border-left:2px solid var(--green);padding:7px 10px;margin:5px 0;font-size:12px;color:#b8f0d0;line-height:1.65}
.ai-qbtns{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:9px;flex-shrink:0}
.ai-qbtn{background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:#888;font-size:11px;font-family:var(--M);padding:4px 9px;cursor:pointer}
.ai-qbtn:hover{border-color:var(--purple);color:var(--purple)}
.ai-row{display:flex;gap:7px;flex-shrink:0}
.ai-input{flex:1;background:var(--card);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--S);font-size:13px;padding:9px 12px;outline:none;resize:none}
.ai-input:focus{border-color:var(--purple)}
.ai-send{background:var(--purple);border:none;border-radius:2px;color:#fff;padding:9px 14px;cursor:pointer;font-size:15px;flex-shrink:0}
.ai-send:disabled{opacity:.4;cursor:not-allowed}
.dots span{display:inline-block;width:4px;height:4px;border-radius:50%;background:var(--purple);animation:dot 1.2s infinite;margin:0 1px}
.dots span:nth-child(2){animation-delay:.2s}.dots span:nth-child(3){animation-delay:.4s}
@keyframes dot{0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1}}
/* price checker */
.pc-wrap{padding:0 16px 80px;flex:1;overflow-y:auto}
.search-bar{display:flex;gap:7px;margin-bottom:12px;flex-wrap:wrap}
.search-bar input{flex:1;min-width:180px;background:var(--card);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:13px;padding:10px 12px;outline:none}
.search-bar input:focus{border-color:var(--teal)}
.search-bar select{background:var(--card);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:12px;padding:9px 26px 9px 11px;outline:none;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23555' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 9px center}
.cat-tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:12px;overflow-x:auto}
.ecat{padding:8px 13px;font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap}
.ecat.active{color:var(--teal);border-bottom-color:var(--teal)}
.price-hero{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--border);border:1px solid var(--border);border-radius:2px;overflow:hidden;margin-bottom:12px}
.ph-cell{background:var(--card);padding:16px 14px}
.ph-label{font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px}
.ph-val{font-family:var(--D);font-size:34px;letter-spacing:1px}
.ph-val.gold{color:var(--gold)}.ph-val.green{color:var(--green)}.ph-val.orange{color:var(--orange)}
.ph-sub{font-size:10px;color:var(--muted);margin-top:3px}
.ext-links{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.ext-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px;text-align:center;text-decoration:none;display:block;transition:all .1s}
.ext-card:hover{border-color:#333;background:var(--card2)}
.ext-icon{font-size:20px;margin-bottom:4px}
.ext-label{font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--text)}
.ext-sub{font-size:10px;color:var(--muted);margin-top:2px}
.listing-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px 13px;margin-bottom:7px;display:flex;align-items:flex-start;gap:11px}
.listing-card:hover{border-color:#2a2a2a}
.listing-thumb{width:48px;height:48px;border-radius:2px;object-fit:cover;background:var(--card2);flex-shrink:0;border:1px solid var(--border)}
.listing-info{flex:1;min-width:0}
.listing-title{font-size:13px;font-weight:500;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.listing-title a{color:var(--text);text-decoration:none}
.listing-title a:hover{color:var(--gold)}
.listing-meta{font-family:var(--M);font-size:10px;color:var(--muted)}
.listing-net{font-family:var(--M);font-size:11px;color:var(--green);margin-top:3px}
.listing-price{text-align:right;flex-shrink:0}
.lp-amt{font-family:var(--D);font-size:26px;color:var(--gold)}
.lp-net{font-family:var(--M);font-size:10px;color:var(--green)}
.plat-tag{font-family:var(--M);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:1px;display:inline-block;margin-top:3px}
.pt-ebay{background:rgba(232,192,74,.1);color:var(--gold);border:1px solid rgba(232,192,74,.2)}
.pt-swappa{background:rgba(61,220,132,.1);color:var(--green);border:1px solid rgba(61,220,132,.2)}
.pt-fb{background:rgba(74,158,255,.1);color:var(--blue);border:1px solid rgba(74,158,255,.2)}
.fee-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px}
.fee-row:last-child{border-bottom:none}
.fee-key{color:#999}
.fee-val{font-family:var(--M);font-size:12px}
/* toggle */
.tog{width:32px;height:17px;background:var(--card2);border:1px solid var(--border2);border-radius:9px;cursor:pointer;position:relative;transition:background .15s;flex-shrink:0}
.tog span{position:absolute;width:11px;height:11px;background:var(--muted);border-radius:50%;top:2px;left:2px;transition:all .15s;display:block}
.tog.on{background:var(--red);border-color:var(--red)}
.tog.on span{left:17px;background:#fff}
/* inventory */
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(185px,1fr));gap:9px}
.inv-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px}
/* followups */
.fu-item{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:11px 13px;margin-bottom:7px;display:flex;align-items:center;gap:11px}
.fu-av{width:32px;height:32px;border-radius:2px;background:var(--gold);display:flex;align-items:center;justify-content:center;font-family:var(--D);font-size:14px;color:#000;flex-shrink:0}
/* playbook */
.pb-wrap{padding:0 16px 80px;flex:1;overflow-y:auto}
.pb-tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:12px;overflow-x:auto}
.pb-tab{padding:8px 13px;font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap}
.pb-tab.active{color:var(--gold);border-bottom-color:var(--gold)}
.pb-sec{display:none}.pb-sec.active{display:block}
.funnel{display:flex;flex-direction:column;align-items:center;margin:14px 0}
.funnel-step{width:100%;max-width:460px;padding:13px 20px;text-align:center;cursor:pointer}
.fs-title{font-family:var(--D);font-size:22px;letter-spacing:2px;color:#000}
.fs-sub{font-size:11px;color:rgba(0,0,0,.6);margin-top:1px}
.f1{background:#4a8fd4;clip-path:polygon(0 0,100% 0,90% 100%,10% 100%)}
.f2{background:#6aaa6a;clip-path:polygon(10% 0,90% 0,80% 100%,20% 100%);margin-top:-1px}
.f3{background:#d4854a;clip-path:polygon(20% 0,80% 0,70% 100%,30% 100%);margin-top:-1px}
.f4{background:#d4b840;clip-path:polygon(30% 0,70% 0,60% 100%,40% 100%);margin-top:-1px}
.ftip{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:12px;margin-top:8px;display:none}
.ftip.open{display:block}
.scard{background:var(--card);border:1px solid var(--border);border-radius:2px;margin-bottom:7px;overflow:hidden}
.scard-h{padding:10px 13px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;background:var(--card2)}
.scard-b{display:none;padding:13px}
.scard-b.open{display:block}
.smsg{background:var(--card2);border-left:2px solid var(--gold);padding:8px 11px;margin:6px 0;font-size:13px;color:var(--gold2);line-height:1.7}
.smsg.good{border-left-color:var(--green);color:#b8f0d0}
.snote{font-size:12px;color:var(--muted);line-height:1.6;margin:5px 0}
.obj-card{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:13px;margin-bottom:8px}
.obj-sit{font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--orange);margin-bottom:6px}
.obj-ex{background:rgba(255,140,66,.07);border:1px solid rgba(255,140,66,.2);border-radius:2px;padding:8px 11px;font-size:13px;color:#e0a070;margin-bottom:8px;font-style:italic}
.obj-res{background:rgba(61,220,132,.07);border-left:2px solid var(--green);padding:8px 11px;font-size:13px;color:#b0f0d0;line-height:1.7;margin-bottom:6px}
.apr-step{display:flex;gap:11px;margin-bottom:13px;align-items:flex-start}
.apr-num{width:24px;height:24px;border-radius:2px;background:var(--gold);color:#000;font-family:var(--D);font-size:15px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.apr-content h4{font-size:13px;font-weight:600;margin-bottom:2px}
.apr-content p{font-size:12px;color:#999;line-height:1.7}
.tip-box{background:rgba(74,158,255,.07);border:1px solid rgba(74,158,255,.2);border-radius:2px;padding:7px 10px;font-size:11px;color:#90c4ff;margin-top:5px}
.buyer-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}
.buyer-row:last-child{border-bottom:none}
/* settings */
.set-sec{margin-bottom:20px}
.set-sec-title{font-family:var(--M);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--muted);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.key-input{width:100%;background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--text);font-family:var(--M);font-size:11px;padding:8px 10px;outline:none;margin-top:5px}
.key-input:focus{border-color:var(--gold)}
.ks{display:inline-flex;align-items:center;gap:5px;font-family:var(--M);font-size:10px;padding:3px 9px;border-radius:2px;margin-top:6px}
.ks.ok{background:rgba(61,220,132,.1);color:var(--green);border:1px solid rgba(61,220,132,.25)}
.ks.missing{background:rgba(255,69,69,.1);color:var(--red);border:1px solid rgba(255,69,69,.25)}
/* alerts */
.alert-item{background:var(--card);border:1px solid var(--border);border-radius:2px;padding:10px 12px;margin-bottom:7px;display:flex;align-items:flex-start;gap:10px}
.alert-hot{border-left:2px solid var(--gold)}
/* misc */
.empty{text-align:center;padding:45px 20px;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px}
.empty-icon{font-size:28px;margin-bottom:8px;opacity:.3}
.toast{position:fixed;bottom:66px;right:14px;background:var(--card2);border:1px solid var(--border2);border-radius:2px;padding:9px 14px;font-size:12px;z-index:300;transform:translateY(8px);opacity:0;transition:all .18s;pointer-events:none;max-width:280px}
.toast.show{transform:translateY(0);opacity:1}
.toast.success{border-left:2px solid var(--green)}.toast.error{border-left:2px solid var(--red)}.toast.info{border-left:2px solid var(--teal)}
/* iOS Safari click fix ‚Äî clicks don't fire on divs without this */
[onclick],[onclick]{cursor:pointer}
.nav-item,.mob-item,.pipe-card,.fu-item,.alert-item,.inv-card,.scard-h,.faq-q,.ecat,.pb-tab,.ai-mode-btn,.ai-qbtn,.funnel-step,.cbtn,.buyer-row,.listing-card,.tog,.ext-card{cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);}
::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--sub);border-radius:2px}
@media(max-width:768px){
  .sidebar{display:none}.mob-nav{display:flex}
  .stats-row{grid-template-columns:1fr 1fr;gap:7px;padding:10px 12px}
  .sv{font-size:26px}
  .two-col,.three-col{grid-template-columns:1fr}
  .ca,.tw,.pb-wrap,.pc-wrap,.ai-wrap{padding-left:12px;padding-right:12px}
  .pipeline{padding:0 12px 80px}
  .form-row{grid-template-columns:1fr}
  .hm{display:none}
  .inv-grid{grid-template-columns:1fr 1fr}
  .price-hero{grid-template-columns:1fr 1fr}
  .ext-links{grid-template-columns:repeat(3,1fr)}
  .toast{bottom:62px;right:10px;left:10px;max-width:none}
}
@media(max-width:480px){
  .ai-modes{grid-template-columns:repeat(2,1fr)}
  .inv-grid{grid-template-columns:1fr}
  .price-hero{grid-template-columns:1fr}
  .ext-links{grid-template-columns:1fr 1fr}
  .search-bar{flex-direction:column}
  #calc-grid{grid-template-columns:1fr!important}
}
</style>
</head>
<body onclick="void(0)">

<!-- ‚ïê‚ïê DEBUG HUD ‚Äî remove after fix is confirmed ‚ïê‚ïê -->

<div id="dbg" style="position:fixed;top:60px;left:8px;right:8px;z-index:999999;background:rgba(0,0,0,.97);border:2px solid #e8c04a;border-radius:4px;font-family:monospace;font-size:12px;color:#e8c04a;padding:10px;pointer-events:none;max-height:50vh;overflow-y:auto;">
  <div style="display:flex;justify-content:space-between;margin-bottom:6px;border-bottom:1px solid #333;padding-bottom:6px;">
    <strong>üîç DEBUG HUD ‚Äî tap nav tabs after loading</strong>
    <span id="dbg-close" style="color:#fff;pointer-events:auto;cursor:pointer;padding:0 6px;font-size:16px;" ontouchend="document.getElementById('dbg').remove()" onclick="document.getElementById('dbg').remove()">‚úï</span>
  </div>
  <div id="dbg-log" style="color:#ccc;line-height:1.8;"></div>
</div>
<script>
(function(){
  var L=document.getElementById('dbg-log');
  function log(msg,color){
    var d=document.createElement('div');
    d.style.color=color||'#aaa';
    d.textContent=(new Date().toISOString().slice(11,19))+' '+msg;
    L.appendChild(d);
    L.scrollTop=L.scrollHeight;
  }

// TEST 1 ‚Äî JS loaded?
log(‚Äò‚úÖ JS loaded & running‚Äô,‚Äô#3ddc84‚Äô);

// TEST 2 ‚Äî Does init() exist?
log(typeof window.nav===‚Äòfunction‚Äô ? ‚Äò‚úÖ nav() found‚Äô : ‚Äò‚ùå nav() NOT found ‚Äî JS error before this point‚Äô,‚Äô#e8c04a‚Äô);

// TEST 3 ‚Äî Tap detection (capture phase ‚Äî catches even blocked taps)
var tapCount=0;
document.addEventListener(‚Äòtouchstart‚Äô,function(e){
tapCount++;
var el=e.target;
var tag=el.tagName+(el.id?‚Äô#‚Äô+el.id:el.className?‚Äô .‚Äô+el.className.toString().split(‚Äô ‚Äò)[0]:‚Äô‚Äô);
log(‚ÄòüëÜ touchstart #‚Äô+tapCount+‚Äô on <‚Äô+tag+‚Äô>‚Äô,‚Äô#4a9eff‚Äô);
},{capture:true,passive:true});

document.addEventListener(‚Äòclick‚Äô,function(e){
var el=e.target;
var tag=el.tagName+(el.id?‚Äô#‚Äô+el.id:el.className?‚Äô .‚Äô+el.className.toString().split(‚Äô ‚Äò)[0]:‚Äô‚Äô);
log(‚Äòüñ± click on <‚Äô+tag+‚Äô> defaultPrevented=‚Äô+e.defaultPrevented,‚Äô#f5d98a‚Äô);
},{capture:true});

// TEST 4 ‚Äî Scan for elements covering the screen with pointer-events blocking
setTimeout(function(){
var blockers=[];
document.querySelectorAll(‚Äô*‚Äô).forEach(function(el){
var st=window.getComputedStyle(el);
var r=el.getBoundingClientRect();
// Fixed/absolute full-screen elements
if((st.position===‚Äòfixed‚Äô||st.position===‚Äòabsolute‚Äô)
&& r.width>window.innerWidth*0.8
&& r.height>window.innerHeight*0.5
&& st.display!==‚Äònone‚Äô
&& st.visibility!==‚Äòhidden‚Äô){
var pe=st.pointerEvents;
blockers.push((el.id||el.className.toString().slice(0,20)||el.tagName)+‚Äô z:‚Äô+st.zIndex+‚Äô pe:‚Äô+pe+‚Äô op:‚Äô+parseFloat(st.opacity).toFixed(1));
}
});
if(blockers.length){
log(‚Äò‚ö† OVERLAY SUSPECTS:‚Äô,‚Äô#ff4545‚Äô);
blockers.forEach(function(b){log(‚Äô  ‚Äò+b,‚Äô#ff9999‚Äô);});
} else {
log(‚Äò‚úÖ No full-screen overlays detected‚Äô,‚Äô#3ddc84‚Äô);
}
},800);

// TEST 5 ‚Äî Check if nav() fires when bottom nav tapped
setTimeout(function(){
log(‚Äô‚Äî Tap a nav tab now ‚Äî‚Äô,‚Äô#888‚Äô);
},1200);
})();
</script>

<!-- ‚ïê‚ïê END DEBUG HUD ‚ïê‚ïê -->

  <div class="logo">TREY <span>BUYBACK</span></div>
  <div class="top-right">
    <div class="badge">PRO</div>
    <div id="topDate"></div>
    <button class="icon-btn" onclick="openModal('settings')">‚öô</button>
  </div>
</div>

<div class="shell">
<div class="sidebar">
  <div class="nav-section">Main</div>
  <div class="nav-item active" onclick="nav('dashboard')"><span class="nav-icon">üìä</span><span>Dashboard</span></div>
  <div class="nav-item" onclick="nav('leads')"><span class="nav-icon">üë•</span><span>Leads</span><span class="nc hot" id="nc-leads">0</span></div>
  <div class="nav-item" onclick="nav('pipeline')"><span class="nav-icon">üîÄ</span><span>Pipeline</span></div>
  <div class="nav-item" onclick="nav('followups')"><span class="nav-icon">‚è∞</span><span>Follow-Ups</span><span class="nc" id="nc-fu">0</span></div>
  <div class="nav-section">Tools</div>
  <div class="nav-item" onclick="nav('ai')"><span class="nav-icon">ü§ñ</span><span>AI Assistant</span><span class="nc ai">AI</span></div>
  <div class="nav-item" onclick="nav('prices')"><span class="nav-icon">üîç</span><span>Price Checker</span><span class="nc live">LIVE</span></div>
  <div class="nav-item" onclick="nav('calc')"><span class="nav-icon">üßÆ</span><span>Flip Calc</span></div>
  <div class="nav-item" onclick="nav('inventory')"><span class="nav-icon">üì¶</span><span>Inventory</span></div>
  <div class="nav-item" onclick="nav('alerts')"><span class="nav-icon">üîî</span><span>Alerts</span><span class="nc" id="nc-alerts">0</span></div>
  <div class="nav-section">Learn</div>
  <div class="nav-item" onclick="nav('playbook')"><span class="nav-icon">üìö</span><span>Playbook</span></div>
  <div class="nav-section">Reports</div>
  <div class="nav-item" onclick="nav('profits')"><span class="nav-icon">üí∞</span><span>Profits</span></div>
</div>

<div class="main">

<!-- DASHBOARD -->

<div class="page active" id="page-dashboard">
  <div class="ph">
    <div><div class="pt">DASHBOARD</div><div class="ps" id="dashGreet">Ready to flip?</div></div>
    <div class="ha"><button class="btn btn-purple btn-sm" onclick="nav('ai')">ü§ñ AI</button><button class="btn btn-gold" onclick="openModal('addLead')">+ Lead</button></div>
  </div>
  <div class="stats-row">
    <div class="sc"><div class="sl">Leads</div><div class="sv blue" id="ds-leads">0</div></div>
    <div class="sc"><div class="sl">Active</div><div class="sv gold" id="ds-active">0</div></div>
    <div class="sc"><div class="sl">Closed</div><div class="sv green" id="ds-closed">0</div></div>
    <div class="sc"><div class="sl">Profit</div><div class="sv green" id="ds-profit">$0</div></div>
  </div>
  <div class="ca">
    <div class="two-col">
      <div class="panel"><div class="panel-title">Recent Leads<span style="color:var(--gold);cursor:pointer;font-size:9px;" onclick="nav('leads')">ALL ‚Üí</span></div><div id="dash-recent"></div></div>
      <div class="panel"><div class="panel-title">Follow-Ups Due<span style="color:var(--purple);cursor:pointer;font-size:9px;" onclick="nav('followups')">ALL ‚Üí</span></div><div id="dash-fu"></div></div>
    </div>
    <div class="two-col">
      <div class="panel"><div class="panel-title">Pipeline</div><div id="dash-pipeline"></div></div>
      <div class="panel"><div class="panel-title">Top Devices</div><div id="dash-devices"></div></div>
    </div>
  </div>
</div>

<!-- LEADS -->

<div class="page" id="page-leads">
  <div class="ph">
    <div><div class="pt">LEADS</div><div class="ps">All seller contacts</div></div>
    <div class="ha">
      <input id="leadSearch" placeholder="Search‚Ä¶" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:6px 10px;border-radius:2px;font-family:var(--M);font-size:12px;outline:none;width:140px;" oninput="renderLeads()">
      <button class="btn btn-ghost btn-sm hm" onclick="exportLeads()">‚Üì CSV</button>
      <button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Add</button>
    </div>
  </div>
  <div class="tw">
    <table><thead><tr><th>Name</th><th>Device</th><th>Asking</th><th>Status</th><th class="hm">Source</th><th class="hm">Date</th><th>Actions</th></tr></thead>
    <tbody id="leads-tbody"></tbody></table>
    <div id="leads-empty" class="empty" style="display:none;"><div class="empty-icon">üë•</div>No leads yet ‚Äî add your first one</div>
  </div>
</div>

<!-- PIPELINE -->

<div class="page" id="page-pipeline">
  <div class="ph"><div><div class="pt">PIPELINE</div><div class="ps">Deal flow by stage</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Lead</button></div>
  <div class="pipeline" id="pipeline-board"></div>
</div>

<!-- FOLLOW-UPS -->

<div class="page" id="page-followups">
  <div class="ph"><div><div class="pt">FOLLOW-UPS</div><div class="ps">Never let a deal go cold</div></div></div>
  <div class="ca">
    <div class="panel" style="margin-bottom:10px;"><div class="panel-title" style="color:var(--red);">‚ö† OVERDUE</div><div id="fu-due"></div></div>
    <div class="panel"><div class="panel-title">UPCOMING (7 days)</div><div id="fu-upcoming"></div></div>
  </div>
</div>

<!-- AI ASSISTANT -->

<div class="page" id="page-ai">
  <div class="ph"><div><div class="pt">AI ASSISTANT</div><div class="ps">Powered by Claude</div></div><button class="btn btn-ghost btn-sm" onclick="clearChat()">Clear</button></div>
  <div class="ai-wrap">
    <div class="ai-modes">
      <div class="ai-mode-btn active" onclick="setMode('negotiate',this)"><div class="ai-mode-icon">üí¨</div><div class="ai-mode-label">Negotiate</div></div>
      <div class="ai-mode-btn" onclick="setMode('deal',this)"><div class="ai-mode-icon">üìä</div><div class="ai-mode-label">Deal Check</div></div>
      <div class="ai-mode-btn" onclick="setMode('objection',this)"><div class="ai-mode-icon">üõ°</div><div class="ai-mode-label">Objections</div></div>
      <div class="ai-mode-btn" onclick="setMode('ad',this)"><div class="ai-mode-icon">üì£</div><div class="ai-mode-label">Write Ad</div></div>
    </div>
    <div class="ai-qbtns" id="ai-qbtns"></div>
    <div class="ai-chat" id="ai-chat"></div>
    <div class="ai-row">
      <textarea class="ai-input" id="ai-input" rows="1" placeholder="Ask me about any deal‚Ä¶" onkeydown="aiKey(event)"></textarea>
      <button class="ai-send" id="ai-send" onclick="sendMsg()">‚Üë</button>
    </div>
  </div>
</div>

<!-- PRICE CHECKER -->

<div class="page" id="page-prices">
  <div class="ph"><div><div class="pt">PRICE CHECKER</div><div class="ps" id="pc-sub">Live eBay + AI estimates</div></div></div>
  <div class="pc-wrap">
    <div id="api-warn" style="display:none;background:rgba(255,140,66,.08);border:1px solid rgba(255,140,66,.25);border-radius:2px;padding:10px 14px;margin-bottom:12px;font-size:13px;color:#e0a070;">
      ‚ö† No eBay API key set ‚Äî prices are AI estimates. <span style="text-decoration:underline;cursor:pointer;" onclick="openModal('settings')">Add key in Settings ‚öô</span>
    </div>
    <div class="search-bar">
      <input id="pc-q" placeholder="iPhone 15 Pro 256GB, PS5 Disc, MacBook Pro M3, Canon R6‚Ä¶" onkeydown="if(event.key==='Enter')runCheck()">
      <select id="pc-cond">
        <option value="used">Used / Pre-Owned</option>
        <option value="damaged">Damaged / Parts Only</option>
        <option value="new">New / Open Box</option>
        <option value="bad-esn">Bad ESN / Blacklisted</option>
        <option value="broken">Broken / No Power</option>
      </select>
      <button class="btn btn-teal" onclick="runCheck()" id="pc-btn">Check ‚Üí</button>
    </div>
    <div class="cat-tabs">
      <div class="ecat active" onclick="setCat(this)">All</div>
      <div class="ecat" onclick="setCat(this)">üì± Phones</div>
      <div class="ecat" onclick="setCat(this)">üéÆ Consoles</div>
      <div class="ecat" onclick="setCat(this)">üíª MacBooks</div>
      <div class="ecat" onclick="setCat(this)">üì∑ Cameras</div>
      <div class="ecat" onclick="setCat(this)">üì± iPads</div>
    </div>
    <div id="pc-results">
      <div class="ext-links">
        <a class="ext-card" href="#" onclick="soldLink('ebay');return false;"><div class="ext-icon">üõí</div><div class="ext-label">eBay Sold</div><div class="ext-sub">Pre-filtered ‚Üí</div></a>
        <a class="ext-card" href="#" onclick="soldLink('swappa');return false;"><div class="ext-icon">üîÑ</div><div class="ext-label">Swappa</div><div class="ext-sub">Used market ‚Üí</div></a>
        <a class="ext-card" href="#" onclick="soldLink('fb');return false;"><div class="ext-icon">üìç</div><div class="ext-label">FB Marketplace</div><div class="ext-sub">Local ‚Üí</div></a>
      </div>
      <div class="panel">
        <div class="panel-title">FEE REFERENCE</div>
        <div class="fee-row"><span class="fee-key">eBay Final Value (Electronics)</span><span class="fee-val" style="color:var(--red);">13.25%</span></div>
        <div class="fee-row"><span class="fee-key">eBay Payment Processing</span><span class="fee-val" style="color:var(--red);">~0.3%</span></div>
        <div class="fee-row"><span class="fee-key">Avg Shipping</span><span class="fee-val" style="color:var(--red);">$8‚Äì$15</span></div>
        <div class="fee-row"><span class="fee-key">Swappa Listing</span><span class="fee-val" style="color:var(--green);">Free to list</span></div>
        <div class="fee-row"><span class="fee-key">FB Marketplace (local)</span><span class="fee-val" style="color:var(--green);">Free</span></div>
      </div>
    </div>
  </div>
</div>

<!-- FLIP CALC -->

<div class="page" id="page-calc">
  <div class="ph"><div><div class="pt">FLIP CALC</div><div class="ps">Atlas Mobile pricing ‚Äî iPhones</div></div></div>
  <div style="padding:0 16px 80px;display:grid;grid-template-columns:295px 1fr;gap:12px;flex:1;overflow-y:auto;" id="calc-grid">
    <div>
      <div class="panel" style="margin-bottom:10px;">
        <div style="margin-bottom:13px;">
          <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Model</div>
          <div class="field"><select id="c-model" onchange="calcStorage()"><option value="">‚Äî Select model ‚Äî</option></select></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:13px;">
          <div><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Storage</div><div class="field"><select id="c-storage" onchange="calcUpdate()"><option>‚Äî</option></select></div></div>
          <div><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Lock</div><div class="field"><select id="c-lock" onchange="calcUpdate()"><option value="unlocked">Unlocked</option><option value="locked">Carrier Locked</option></select></div></div>
        </div>
        <div style="margin-bottom:13px;">
          <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Condition</div>
          <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:3px;">
            <div class="cbtn" data-g="swap" onclick="setGrade('swap',this)" style="background:var(--gold);border:1px solid var(--gold);border-radius:2px;color:#000;font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">SWAP</div>
            <div class="cbtn" data-g="a" onclick="setGrade('a',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">A</div>
            <div class="cbtn" data-g="b" onclick="setGrade('b',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">B</div>
            <div class="cbtn" data-g="c" onclick="setGrade('c',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">C</div>
            <div class="cbtn" data-g="d" onclick="setGrade('d',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">D</div>
            <div class="cbtn" data-g="doa" onclick="setGrade('doa',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">DOA</div>
          </div>
        </div>
        <div>
          <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px;">Damage Deductions</div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);"><span style="font-size:12px;">Cracked Back</span><div class="tog" id="tog-back" onclick="togDed('back',this)"><span></span></div></div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);"><span style="font-size:12px;">Cracked Lens</span><div class="tog" id="tog-lens" onclick="togDed('lens',this)"><span></span></div></div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);"><span style="font-size:12px;">Battery &lt;80%</span><div class="tog" id="tog-batt" onclick="togDed('batt',this)"><span></span></div></div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;"><span style="font-size:12px;">Repair Message</span><div class="tog" id="tog-rep" onclick="togDed('rep',this)"><span></span></div></div>
        </div>
      </div>
      <div class="panel">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
          <div class="field"><label>Min Profit $</label><input type="number" id="c-profit" value="40" oninput="calcUpdate()"></div>
          <div class="field"><label>Risk Buffer $</label><input type="number" id="c-risk" value="20" oninput="calcUpdate()"></div>
        </div>
        <div class="field"><label>Seller's Asking $</label><input type="number" id="c-asking" placeholder="Enter their price" oninput="calcUpdate()"></div>
      </div>
    </div>
    <div><div id="calc-result" style="background:var(--card);border:1px solid var(--border);border-radius:2px;"><div style="padding:50px;text-align:center;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px;">SELECT A MODEL TO BEGIN</div></div></div>
  </div>
</div>

<!-- INVENTORY -->

<div class="page" id="page-inventory">
  <div class="ph"><div><div class="pt">INVENTORY</div><div class="ps">All categories</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addInventory')">+ Device</button></div>
  <div class="ca">
    <div class="three-col" style="margin-bottom:12px;">
      <div class="sc"><div class="sl">In Stock</div><div class="sv gold" id="inv-count">0</div></div>
      <div class="sc"><div class="sl">Invested</div><div class="sv red" id="inv-invested">$0</div></div>
      <div class="sc"><div class="sl">Est. Profit</div><div class="sv green" id="inv-profit-est">$0</div></div>
    </div>
    <div class="inv-grid" id="inv-grid"></div>
    <div id="inv-empty" class="empty" style="display:none;"><div class="empty-icon">üì¶</div>No inventory yet</div>
  </div>
</div>

<!-- ALERTS -->

<div class="page" id="page-alerts">
  <div class="ph"><div><div class="pt">DEAL ALERTS</div><div class="ps">Monitor for underpriced items</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addAlert')">+ Alert</button></div>
  <div class="ca">
    <div id="email-banner" style="display:none;background:rgba(45,212,191,.07);border:1px solid rgba(45,212,191,.25);border-radius:2px;padding:10px 14px;margin-bottom:12px;align-items:center;justify-content:space-between;gap:10px;">
      <div style="font-size:12px;color:var(--teal);"><strong style="display:block;font-size:13px;margin-bottom:1px;">üìß Email Alerts Active</strong>You'll be emailed when matching deals are found.</div>
      <button class="btn btn-ghost btn-sm" onclick="openModal('settings')">Configure</button>
    </div>
    <div class="panel" style="margin-bottom:10px;"><div class="panel-title">ACTIVE MONITORS</div><div id="alert-monitors"></div></div>
    <div class="panel"><div class="panel-title">RECENT HITS</div><div id="alert-hits"></div></div>
  </div>
</div>

<!-- PLAYBOOK -->

<div class="page" id="page-playbook">
  <div class="ph"><div><div class="pt">PLAYBOOK</div><div class="ps">Your complete buying system</div></div></div>
  <div class="pb-wrap">
    <div class="pb-tabs">
      <div class="pb-tab active" onclick="pbTab('shotgun')">üéØ Shotgun</div>
      <div class="pb-tab" onclick="pbTab('script')">üí¨ Scripts</div>
      <div class="pb-tab" onclick="pbTab('objections')">üõ° Objections</div>
      <div class="pb-tab" onclick="pbTab('appraise')">üîç Appraise</div>
      <div class="pb-tab" onclick="pbTab('ads')">üì£ Ads</div>
      <div class="pb-tab" onclick="pbTab('buyers')">üè¶ Buyers</div>
    </div>
    <!-- SHOTGUN -->
    <div class="pb-sec active" id="pb-shotgun">
      <div class="panel" style="margin-bottom:10px;"><div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">THE SHOTGUN METHOD</div><div style="font-size:13px;color:#999;line-height:1.7;">Send 100 reachouts. Weed non-responders. Negotiate with the interested. Close and meet. Repeat every day.</div></div>
      <div class="funnel">
        <div class="funnel-step f1" onclick="tft('ft1')"><div class="fs-title">100 REACHOUTS</div><div class="fs-sub">Message as many sellers as possible</div></div>
        <div class="ftip" id="ft1"><div class="smsg">"Hey, I run a business that buys used and damaged iPhones, MacBooks, iPads, Smartwatches, cameras and more. If I were to pay cash today, would you take a lower price?"</div></div>
        <div class="funnel-step f2" onclick="tft('ft2')" style="margin-top:-1px;"><div class="fs-title">INTERESTED SELLERS</div><div class="fs-sub">Weed out non-responders fast</div></div>
        <div class="ftip" id="ft2"><p style="font-size:13px;color:#999;line-height:1.7;">You'll get: "No" / "How much lower?" / "I'll take $150 today" ‚Äî Ignore rude ones. Move every positive response into negotiate immediately.</p></div>
        <div class="funnel-step f3" onclick="tft('ft3')" style="margin-top:-1px;"><div class="fs-title">NEGOTIATE</div><div class="fs-sub">Convos started ‚Äî now close them</div></div>
        <div class="ftip" id="ft3"><p style="font-size:13px;color:#999;line-height:1.7;">Use your benefits: same-day pickup, you drive to them, cash in hand right now. Use the Bullet Scripts tab.</p></div>
        <div class="funnel-step f4" onclick="tft('ft4')" style="margin-top:-1px;"><div class="fs-title">CLOSE + MEET</div><div class="fs-sub">Buy, get reviews, get referrals</div></div>
        <div class="ftip" id="ft4"><p style="font-size:13px;color:#999;line-height:1.7;">Close ‚Üí Ask for Google/Marketplace review ‚Üí Give business card ‚Üí "Know anyone else selling?" ‚Üí Always cross-sell other categories.</p></div>
      </div>
    </div>
    <!-- SCRIPTS -->
    <div class="pb-sec" id="pb-script">
      <div class="scard"><div class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Opening Reachout</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">FIRST MESSAGE</div></div><span>‚ñº</span></div><div class="scard-b open"><div class="smsg">"Hey, I run a company that buys used and damaged iPhones, MacBooks, Smartwatches, Cameras, VR Systems, and more. If I were able to pay cash today, would you take a lower offer?"</div></div></div>
      <div class="scard"><div class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Make the Offer</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">AFTER POSITIVE RESPONSE</div></div><span>‚ñº</span></div><div class="scard-b"><div class="smsg good">"Great, we've been buying the [Device] for $____ recently."</div><div class="smsg good">"Awesome, I can give you $______ for it."</div><div class="snote">If they refuse: "You have a great device ‚Äî we need more to hit our target this week. What were you trying to get?"</div></div></div>
      <div class="scard"><div class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Bullet 1 ‚Äî Carrier</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">WHEN STUCK ON PRICE</div></div><span>‚ñº</span></div><div class="scard-b"><div class="smsg good">"Just want to confirm ‚Äî what carrier is it with?"</div><div class="snote">If you can bump based on carrier: "Gotcha, I checked with my buyers and I can actually move to $___. How does that sound?"</div></div></div>
      <div class="scard"><div class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Bullet 2 ‚Äî Storage</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">STILL STUCK</div></div><span>‚ñº</span></div><div class="scard-b"><div class="smsg good">"Can you tell me how much storage it has?"</div><div class="smsg good">"I didn't realize it was 512GB ‚Äî I can do $___. How does that sound?"</div></div></div>
      <div class="scard"><div class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Tell the Truth ‚Äî Final Offer</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">LAST RESORT</div></div><span>‚ñº</span></div><div class="scard-b"><div class="smsg good">"I'd love to buy your device, but I buy and resell for a living and I need to make a small profit. Best I can do is $__ due to where it's at in the market. Would you take that if I came to you today with cash?"</div></div></div>
      <div class="scard"><div class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Cross-Sell + Bill of Sale</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">ALWAYS DO THIS</div></div><span>‚ñº</span></div><div class="scard-b"><div class="smsg good">"Do you have any other items? iPads, MacBooks, Smartwatches, Cameras, Consoles ‚Äî anything like that?"</div><div class="smsg good">"Please make sure the device can be fully erased and bring a valid ID for the bill of sale. Can't wait to earn your business."</div></div></div>
      <div class="scard"><div class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Follow-Up Messages</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">COLD LEADS</div></div><span>‚ñº</span></div><div class="scard-b"><div class="smsg good">"Hey I saw this was still available."</div><div class="smsg good">"Hey this popped back up on my feed, I'd still love to buy it."</div><div class="smsg good">"Following up ‚Äî still interested in buying this today."</div></div></div>
    </div>
    <!-- OBJECTIONS -->
    <div class="pb-sec" id="pb-objections">
      <div class="obj-card"><div class="obj-sit">Angry No</div><div class="obj-ex">"Hell no"</div><div class="obj-res">"I totally understand, how much were you looking to get?"</div></div>
      <div class="obj-card"><div class="obj-sit">Wants Too Much</div><div class="obj-ex">"I want $300 for my iPhone 6"</div><div class="obj-res">"I totally understand ‚Äî unfortunately $300 is higher than I could sell it for. But I can give you $100 cash today. Is that fair?"</div></div>
      <div class="obj-card"><div class="obj-sit">Will Sell Themselves</div><div class="obj-ex">"I'll just sell it myself"</div><div class="obj-res">"That makes sense! Most people find it takes weeks on Facebook. I can give you cash today so you skip the strangers and no-shows."</div></div>
      <div class="obj-card"><div class="obj-sit">Someone Offered More</div><div class="obj-ex">"Another guy offered me $150"</div><div class="obj-res">"$150 is a great price ‚Äî if he's paying, take it! I can offer $100 with cash today though. What works best for you?"</div></div>
      <div class="obj-card"><div class="obj-sit">Radio Silence After Offer</div><div class="obj-ex">(No response)</div><div class="obj-res">"Would that price work for you?" / "Would that be fair?"</div></div>
      <div class="obj-card"><div class="obj-sit">Just Shopping Around</div><div class="obj-ex">"I was just seeing what I could get"</div><div class="obj-res">"No worries! Hey ‚Äî got any other devices? iPads, MacBooks, consoles, cameras? Could put cash in your hands today."</div></div>
    </div>
    <!-- APPRAISE -->
    <div class="pb-sec" id="pb-appraise">
      <div class="panel" style="margin-bottom:10px;"><div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">APPRAISE ON EBAY</div><div style="font-size:13px;color:#999;">Always use SOLD listings. Never guess off active listings.</div></div>
      <div class="panel" style="margin-bottom:10px;">
        <div class="panel-title">STANDARD PHONES</div>
        <div class="apr-step"><div class="apr-num">1</div><div class="apr-content"><h4>Minimal keywords</h4><p>"iPhone XR Unlocked" ‚Äî NOT "iPhone XR gold 128GB good condition." Less is more.</p></div></div>
        <div class="apr-step"><div class="apr-num">2</div><div class="apr-content"><h4>Filter: Sold Items ONLY</h4><p>Check both "Completed Items" and "Sold Items." Active listings mean nothing.<div class="tip-box">üì± Mobile: Filter ‚Üí Show Only ‚Üí Sold Items</div></p></div></div>
        <div class="apr-step"><div class="apr-num">3</div><div class="apr-content"><h4>3 comps within 2 months</h4><p>Match model, storage, condition exactly. iPhone 8 ‚â† iPhone 8 Plus. 64GB ‚â† 256GB.</p></div></div>
        <div class="apr-step"><div class="apr-num">4</div><div class="apr-content"><h4>Real photos only</h4><p>Skip stock photo listings. Only use comps with actual device photos shown.</p></div></div>
      </div>
      <div class="panel" style="margin-bottom:10px;">
        <div class="panel-title">BAD ESN</div>
        <div class="apr-step"><div class="apr-num">!</div><div class="apr-content"><h4>Never search "Bad ESN" ‚Äî eBay blocks it</h4><p>Search: "iPhone 8 Plus Tmobile ESN" ‚Äî Look for: "Check ESN", "Financed", "ESN Unclean." 2 comps is fine.</p></div></div>
      </div>
      <div class="panel">
        <div class="panel-title">DAMAGED</div>
        <div class="apr-step"><div class="apr-num">A</div><div class="apr-content"><h4>Cracked screen (display works)</h4><p>Search: "iPhone 8 Plus cracked" ‚Äî don't add "screen" or "bad touch."</p></div></div>
        <div class="apr-step"><div class="apr-num">B</div><div class="apr-content"><h4>Cracked LCD (black lines)</h4><p>Search: "iPhone 8 Plus cracked LCD"</p></div></div>
        <div class="apr-step"><div class="apr-num">C</div><div class="apr-content"><h4>Multiple issues</h4><p>Can't find comps? Use cracked screen as baseline. Multiple issues ‚Üí use "no power" as your floor price.</p></div></div>
      </div>
    </div>
    <!-- ADS -->
    <div class="pb-sec" id="pb-ads">
      <div class="panel">
        <div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">FB AD SETUP</div>
        <div style="font-size:13px;color:#999;margin-bottom:12px;">$5‚Äì$15/day. Goal: 15‚Äì20 leads/day.</div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">‚Üì</span><div><div style="font-size:13px;font-weight:500;">Objective: Engagement</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">‚Üì</span><div><div style="font-size:13px;font-weight:500;">Advantage Campaign Budget ‚Äî $5/day to start</div><div style="font-size:12px;color:#888;">Scale to $15‚Äì25 once leads are coming in</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">‚Üì</span><div><div style="font-size:13px;font-weight:500;">Manual Engagement Campaign</div><div style="font-size:12px;color:#888;">Do NOT use simplified/automated mode</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">‚Üì</span><div><div style="font-size:13px;font-weight:500;">Location: 10‚Äì25 mile radius</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">‚Üì</span><div><div style="font-size:13px;font-weight:500;">Target: iPhone X+ owners, Galaxy S10/Note10+</div></div></div>
        <div style="background:rgba(255,69,69,.08);border:1px solid rgba(255,69,69,.25);border-radius:2px;padding:9px 12px;margin:10px 0;"><div style="font-family:var(--M);font-size:9px;color:var(--red);margin-bottom:3px;">‚ö† CRITICAL</div><div style="font-size:12px;color:#ff9999;">NO Apple logos. NO brand logos on your page. This WILL get your ad account permanently banned.</div></div>
        <div style="display:flex;gap:9px;padding:9px 0;"><span style="color:var(--gold);flex-shrink:0;">‚Üì</span><div><div style="font-size:13px;font-weight:500;">Duplicate ad 4√ó ‚Üí Publish all 5 variations</div><div style="font-size:12px;color:#888;">Meta will find the best performer automatically</div></div></div>
      </div>
    </div>
    <!-- BUYERS -->
    <div class="pb-sec" id="pb-buyers">
      <div class="panel">
        <div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">VETTED BUYERS</div>
        <div style="font-size:12px;color:#888;margin-bottom:12px;">Do your own due diligence. Not responsible for scams.</div>
        <a class="buyer-row" href="https://atlasmobile.com" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">üì±</span><div><div style="font-weight:500;font-size:13px;">Atlas Mobile</div><div style="font-size:11px;color:var(--muted);">atlasmobile.com ¬∑ Built into Flip Calc</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-closed">PRIMARY</span><span style="color:var(--muted);font-size:12px;">‚Üí</span></div></a>
        <a class="buyer-row" href="https://bestdealphones.com" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">üí∞</span><div><div style="font-weight:500;font-size:13px;">Best Deal Phones</div><div style="font-size:11px;color:var(--muted);">bestdealphones.com ¬∑ Bonus on price sheet</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-active">VETTED</span><span style="color:var(--muted);font-size:12px;">‚Üí</span></div></a>
        <a class="buyer-row" href="https://nycphonebuyer.com" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">üèô</span><div><div style="font-weight:500;font-size:13px;">NYC Phone Buyer</div><div style="font-size:11px;color:var(--muted);">nycphonebuyer.com ¬∑ NYCPhonebuyer LLC</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-active">VETTED</span><span style="color:var(--muted);font-size:12px;">‚Üí</span></div></a>
        <a class="buyer-row" href="https://apple.com/shop/trade-in" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">üçé</span><div><div style="font-weight:500;font-size:13px;">Apple Trade In</div><div style="font-size:11px;color:var(--muted);">apple.com/shop/trade-in ¬∑ Good for newer models</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px;">‚Üí</span></div></a>
        <a class="buyer-row" href="https://ebay.com/sl/sell" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">üõí</span><div><div style="font-weight:500;font-size:13px;">eBay</div><div style="font-size:11px;color:var(--muted);">ebay.com ¬∑ Best for MacBooks, consoles, cameras</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px;">‚Üí</span></div></a>
        <a class="buyer-row" href="https://swappa.com/sell" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">üîÑ</span><div><div style="font-weight:500;font-size:13px;">Swappa</div><div style="font-size:11px;color:var(--muted);">swappa.com ¬∑ Phones, tablets, laptops ‚Äî no seller fee</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px;">‚Üí</span></div></a>
      </div>
    </div>
  </div>
</div>

<!-- PROFITS -->

<div class="page" id="page-profits">
  <div class="ph"><div><div class="pt">PROFITS</div><div class="ps">Track every dollar</div></div><button class="btn btn-ghost btn-sm hm" onclick="exportProfits()">‚Üì CSV</button></div>
  <div class="ca">
    <div class="stats-row" style="padding:0 0 12px;">
      <div class="sc"><div class="sl">Revenue</div><div class="sv green" id="pr-rev">$0</div></div>
      <div class="sc"><div class="sl">Spent</div><div class="sv red" id="pr-spent">$0</div></div>
      <div class="sc"><div class="sl">Net Profit</div><div class="sv gold" id="pr-net">$0</div></div>
      <div class="sc"><div class="sl">Avg/Deal</div><div class="sv blue" id="pr-avg">$0</div></div>
    </div>
    <div class="panel">
      <div class="panel-title">SOLD DEVICES</div>
      <div style="overflow-x:auto;"><table><thead><tr><th>Device</th><th>Paid</th><th>Sold For</th><th>Profit</th><th class="hm">Date</th><th class="hm">Buyer</th></tr></thead><tbody id="profits-tbody"></tbody></table></div>
      <div id="profits-empty" class="empty"><div class="empty-icon">üí∞</div>No sold devices yet</div>
    </div>
  </div>
</div>

</div><!-- /main -->
</div><!-- /shell -->

<!-- MOBILE NAV -->

<div class="mob-nav">
  <div class="mob-item active" onclick="nav('dashboard')"><span class="mi">üìä</span>Home</div>
  <div class="mob-item" onclick="nav('leads')"><span class="mi">üë•</span>Leads</div>
  <div class="mob-item" onclick="nav('ai')"><span class="mi">ü§ñ</span>AI</div>
  <div class="mob-item" onclick="nav('prices')"><span class="mi">üîç</span>Prices</div>
  <div class="mob-item" onclick="nav('playbook')"><span class="mi">üìö</span>Playbook</div>
  <div class="mob-item" onclick="openModal('moreMenu')"><span class="mi">‚ò∞</span>More</div>
</div>

<!-- SETTINGS MODAL -->

<div class="overlay" id="modal-settings">
  <div class="modal" style="max-width:520px;">
    <div class="mh"><div class="mt">‚öô SETTINGS</div><button class="mc" onclick="closeModal('settings')">√ó</button></div>
    <div class="mb">
      <div class="set-sec">
        <div class="set-sec-title">eBay API ‚Äî Price Checker</div>
        <div class="field"><label>Production App ID (Client ID)</label><input class="key-input" id="s-ebay" type="password" placeholder="AppName-PRD-xxxxxxxx-xxxxxxxx" autocomplete="off"></div>
        <div id="ebay-ks" class="ks missing">‚óè Not set</div>
        <div style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.6;">Get at <strong style="color:var(--gold);">developer.ebay.com</strong> ‚Üí My Account ‚Üí Application Keysets ‚Üí Production. Stored only in your browser ‚Äî never sent anywhere except eBay's servers.</div>
        <div style="display:flex;gap:7px;margin-top:10px;"><button class="btn btn-teal btn-sm" onclick="saveEbayKey()">Save Key</button><button class="btn btn-ghost btn-sm" onclick="testEbay()">Test Connection</button></div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">Email Alerts ‚Äî EmailJS (Free)</div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:10px;line-height:1.7;">
          1. Go to <strong style="color:var(--gold);">emailjs.com</strong> ‚Üí create free account<br>
          2. Add Email Service (Gmail works) ‚Üí copy <strong>Service ID</strong><br>
          3. Email Templates ‚Üí create template ‚Üí copy <strong>Template ID</strong><br>
          4. Account ‚Üí API Keys ‚Üí copy <strong>Public Key</strong><br>
          In your template use: <code style="color:var(--teal);">{{subject}}</code> and <code style="color:var(--teal);">{{message}}</code>
        </div>
        <div class="field" style="margin-bottom:8px;"><label>Your Email Address</label><input class="key-input" id="s-email" type="email" placeholder="you@gmail.com"></div>
        <div class="field" style="margin-bottom:8px;"><label>EmailJS Service ID</label><input class="key-input" id="s-svc" placeholder="service_xxxxxxx"></div>
        <div class="field" style="margin-bottom:8px;"><label>EmailJS Template ID</label><input class="key-input" id="s-tmpl" placeholder="template_xxxxxxx"></div>
        <div class="field" style="margin-bottom:8px;"><label>EmailJS Public Key</label><input class="key-input" id="s-pubkey" type="password" placeholder="xxxxxxxxxxxxxxxxxxxx"></div>
        <div id="email-ks" class="ks missing">‚óè Not configured</div>
        <div style="display:flex;gap:7px;flex-wrap:wrap;margin-top:10px;"><button class="btn btn-teal btn-sm" onclick="saveEmailKeys()">Save Email Settings</button><button class="btn btn-ghost btn-sm" onclick="testEmail()">Send Test Email</button></div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">Data</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;"><button class="btn btn-ghost btn-sm" onclick="exportAll()">‚Üì Export Backup</button><button class="btn btn-danger btn-sm" onclick="clearAll()">üóë Clear All Data</button></div>
      </div>
    </div>
    <div class="mf"><button class="btn btn-gold" onclick="closeModal('settings')">Done</button></div>
  </div>
</div>

<!-- MORE MENU -->

<div class="overlay" id="modal-moreMenu">
  <div class="modal" style="max-height:65vh;">
    <div class="mh"><div class="mt">MORE</div><button class="mc" onclick="closeModal('moreMenu')">√ó</button></div>
    <div class="mb" style="padding:4px 0;">
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('calc');closeModal('moreMenu')"><span class="nav-icon">üßÆ</span>Flip Calc</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('pipeline');closeModal('moreMenu')"><span class="nav-icon">üîÄ</span>Pipeline</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('followups');closeModal('moreMenu')"><span class="nav-icon">‚è∞</span>Follow-Ups</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('inventory');closeModal('moreMenu')"><span class="nav-icon">üì¶</span>Inventory</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('alerts');closeModal('moreMenu')"><span class="nav-icon">üîî</span>Alerts</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('profits');closeModal('moreMenu')"><span class="nav-icon">üí∞</span>Profits</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="openModal('settings');closeModal('moreMenu')"><span class="nav-icon">‚öô</span>Settings</div>
    </div>
  </div>
</div>

<!-- ADD LEAD -->

<div class="overlay" id="modal-addLead">
  <div class="modal">
    <div class="mh"><div class="mt" id="lead-modal-title">NEW LEAD</div><button class="mc" onclick="closeModal('addLead')">√ó</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Full Name *</label><input id="l-name" placeholder="John Smith"></div><div class="field"><label>Phone</label><input id="l-phone" type="tel"></div></div>
      <div class="form-row"><div class="field"><label>Device</label><input id="l-device" placeholder="iPhone 15 Pro 256GB, PS5‚Ä¶"></div><div class="field"><label>Category</label><select id="l-cat"><option>Phone</option><option>Console</option><option>MacBook/Laptop</option><option>Camera</option><option>iPad/Tablet</option><option>Other</option></select></div></div>
      <div class="form-row"><div class="field"><label>Asking $</label><input id="l-asking" type="number"></div><div class="field"><label>Your Offer $</label><input id="l-offer" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Source</label><select id="l-source"><option>FB Marketplace</option><option>Craigslist</option><option>Walk-in</option><option>Referral</option><option>Google Ad</option><option>OfferUp</option><option>Other</option></select></div><div class="field"><label>Status</label><select id="l-status"><option value="new">New</option><option value="active">Active</option><option value="follow">Follow-Up</option><option value="closed">Closed</option><option value="lost">Lost</option></select></div></div>
      <div class="form-row"><div class="field"><label>Follow-Up Date</label><input id="l-followup" type="date"></div></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="l-notes" placeholder="Condition, battery %, details‚Ä¶"></textarea></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addLead')">Cancel</button><button class="btn btn-gold" onclick="saveLead()">Save Lead</button></div>
  </div>
</div>

<!-- VIEW LEAD -->

<div class="overlay" id="modal-viewLead">
  <div class="modal"><div class="mh"><div class="mt" id="vl-title">LEAD</div><button class="mc" onclick="closeModal('viewLead')">√ó</button></div><div class="mb" id="vl-body"></div><div class="mf" id="vl-footer"></div></div>
</div>

<!-- ADD INVENTORY -->

<div class="overlay" id="modal-addInventory">
  <div class="modal">
    <div class="mh"><div class="mt">ADD DEVICE</div><button class="mc" onclick="closeModal('addInventory')">√ó</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Device *</label><input id="i-device" placeholder="iPhone 15 Pro, PS5, MacBook Pro‚Ä¶"></div><div class="field"><label>Category</label><select id="i-cat"><option>Phone</option><option>Console</option><option>MacBook/Laptop</option><option>Camera</option><option>iPad/Tablet</option><option>Other</option></select></div></div>
      <div class="form-row"><div class="field"><label>Paid $ *</label><input id="i-paid" type="number"></div><div class="field"><label>Sell Target $</label><input id="i-target" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Condition</label><select id="i-cond"><option>Grade A</option><option>Grade B</option><option>Grade C</option><option>Grade D</option><option>DOA/Parts</option></select></div><div class="field"><label>Sell Via</label><select id="i-sell"><option>Atlas Mobile</option><option>eBay</option><option>Swappa</option><option>Local/FB</option><option>Other</option></select></div></div>
      <div class="field" style="margin-bottom:9px;"><label>IMEI / Serial</label><input id="i-imei"></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="i-notes"></textarea></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addInventory')">Cancel</button><button class="btn btn-gold" onclick="saveInventory()">Add Device</button></div>
  </div>
</div>

<!-- SELL MODAL -->

<div class="overlay" id="modal-sell">
  <div class="modal">
    <div class="mh"><div class="mt">MARK SOLD</div><button class="mc" onclick="closeModal('sell')">√ó</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Sold For $ *</label><input id="s-price" type="number"></div><div class="field"><label>Sold To</label><input id="s-buyer" placeholder="Atlas, eBay, Local‚Ä¶"></div></div>
      <div class="form-row single"><div class="field"><label>Date</label><input id="s-date" type="date"></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('sell')">Cancel</button><button class="btn btn-gold" onclick="confirmSell()">Confirm Sale</button></div>
  </div>
</div>

<!-- ADD ALERT -->

<div class="overlay" id="modal-addAlert">
  <div class="modal">
    <div class="mh"><div class="mt">NEW ALERT</div><button class="mc" onclick="closeModal('addAlert')">√ó</button></div>
    <div class="mb">
      <div class="form-row single"><div class="field"><label>Device to Watch *</label><input id="a-device" placeholder="iPhone 15 Pro, PS5, MacBook Pro‚Ä¶"></div></div>
      <div class="form-row"><div class="field"><label>Max Price $</label><input id="a-maxprice" type="number"></div><div class="field"><label>Platform</label><select id="a-platform"><option>FB Marketplace</option><option>Craigslist</option><option>OfferUp</option><option>All Platforms</option></select></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addAlert')">Cancel</button><button class="btn btn-gold" onclick="saveAlert()">Add Monitor</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE + STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let ST = { leads: [], inventory: [], alerts: [], sold: [] };
let KEYS = { ebay: '', email: '', svc: '', tmpl: '', pubkey: '' };
let editLeadId = null, sellItemId = null, aiMode = 'negotiate';
let aiHistory = [{ role: 'assistant', content: "Hey! I'm your Trey Buyback AI. I can help you negotiate deals, check if something's worth buying, handle objections, or write ad copy. What do you need?" }];
let calcGrade = 'swap', calcDeds = { back: false, lens: false, batt: false, rep: false };

function save() { try { localStorage.setItem(‚Äòtb4‚Äô, JSON.stringify(ST)); } catch(e) {} }
function saveKeys() { try { localStorage.setItem(‚Äòtb4k‚Äô, JSON.stringify(KEYS)); } catch(e) {} }
function load() {
try { const s = localStorage.getItem(‚Äòtb4‚Äô); if (s) ST = { leads: [], inventory: [], alerts: [], sold: [], ‚Ä¶JSON.parse(s) }; } catch(e) {}
try { const k = localStorage.getItem(‚Äòtb4k‚Äô); if (k) KEYS = { ‚Ä¶KEYS, ‚Ä¶JSON.parse(k) }; } catch(e) {}
if (KEYS.pubkey) { try { emailjs.init(KEYS.pubkey); } catch(e) {} }
}
load();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init() {
const d = new Date();
document.getElementById(‚ÄòtopDate‚Äô).textContent = d.toLocaleDateString(‚Äòen-US‚Äô, { weekday: ‚Äòshort‚Äô, month: ‚Äòshort‚Äô, day: ‚Äònumeric‚Äô });
const h = d.getHours();
const greet = h < 12 ? ‚ÄòGood morning‚Äô : h < 17 ? ‚ÄòGood afternoon‚Äô : ‚ÄòGood evening‚Äô;
document.getElementById(‚ÄòdashGreet‚Äô).textContent = greet + ‚Äô ‚Äî ready to flip?‚Äô;
buildCalcModels();
renderDash();
renderAI();
counts();
updateKS();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function nav(p) {
document.querySelectorAll(‚Äô.page‚Äô).forEach(x => x.classList.remove(‚Äòactive‚Äô));
document.querySelectorAll(‚Äô.nav-item, .mob-item‚Äô).forEach(x => x.classList.remove(‚Äòactive‚Äô));
document.getElementById(‚Äòpage-‚Äô + p).classList.add(‚Äòactive‚Äô);
document.querySelectorAll(‚Äô.nav-item, .mob-item‚Äô).forEach(x => {
if (x.getAttribute(‚Äòonclick‚Äô) && x.getAttribute(‚Äòonclick‚Äô).includes(‚Äù‚Äô‚Äù + p + ‚Äú‚Äô‚Äù)) x.classList.add(‚Äòactive‚Äô);
});
const fns = { dashboard: renderDash, leads: renderLeads, pipeline: renderPipeline, followups: renderFollowups, inventory: renderInventory, alerts: renderAlerts, profits: renderProfits };
if (fns[p]) fns[p]();
if (p === ‚Äòprices‚Äô) document.getElementById(‚Äòapi-warn‚Äô).style.display = KEYS.ebay ? ‚Äònone‚Äô : ‚Äòblock‚Äô;
counts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id) {
if (id === ‚ÄòaddLead‚Äô && !editLeadId) {
[‚Äòl-name‚Äô,‚Äòl-phone‚Äô,‚Äòl-device‚Äô,‚Äòl-notes‚Äô,‚Äòl-offer‚Äô,‚Äòl-asking‚Äô,‚Äòl-followup‚Äô].forEach(f => { const el = document.getElementById(f); if (el) el.value = ‚Äò‚Äô; });
document.getElementById(‚Äòl-source‚Äô).value = ‚ÄòFB Marketplace‚Äô;
document.getElementById(‚Äòl-status‚Äô).value = ‚Äònew‚Äô;
document.getElementById(‚Äòl-cat‚Äô).value = ‚ÄòPhone‚Äô;
document.getElementById(‚Äòlead-modal-title‚Äô).textContent = ‚ÄòNEW LEAD‚Äô;
}
if (id === ‚Äòsettings‚Äô) loadSettingsUI();
document.getElementById(‚Äòmodal-‚Äô + id).classList.add(‚Äòopen‚Äô);
}
function closeModal(id) { document.getElementById(‚Äòmodal-‚Äô + id).classList.remove(‚Äòopen‚Äô); if (id === ‚ÄòaddLead‚Äô) editLeadId = null; }
document.querySelectorAll(‚Äô.overlay‚Äô).forEach(o => o.addEventListener(‚Äòclick‚Äô, e => { if (e.target === o) o.classList.remove(‚Äòopen‚Äô); }));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg, type = ‚Äòsuccess‚Äô) {
const t = document.getElementById(‚Äòtoast‚Äô);
t.textContent = msg; t.className = ‚Äôtoast show ‚Äô + type;
setTimeout(() => t.classList.remove(‚Äòshow‚Äô), 2800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fmtD(iso) { if (!iso) return ‚Äò‚Äî‚Äô; return new Date(iso).toLocaleDateString(‚Äòen-US‚Äô, { month: ‚Äòshort‚Äô, day: ‚Äònumeric‚Äô }); }
function fmtM(n) { return ‚Äò$‚Äô + (n || 0).toLocaleString(); }
function uid() { return Date.now() + Math.random().toString(36).slice(2, 6); }
function sPill(s) {
const m = { new: [‚Äòp-new‚Äô,‚ÄòNEW‚Äô], active: [‚Äòp-active‚Äô,‚ÄòACTIVE‚Äô], follow: [‚Äòp-follow‚Äô,‚ÄòFOLLOW-UP‚Äô], closed: [‚Äòp-closed‚Äô,‚ÄòCLOSED‚Äô], lost: [‚Äòp-lost‚Äô,‚ÄòLOST‚Äô] };
const [cls, label] = m[s] || [‚Äòp-new‚Äô, s];
return `<span class="pill ${cls}">${label}</span>`;
}
function counts() {
document.getElementById(‚Äònc-leads‚Äô).textContent = ST.leads.filter(l => l.status === ‚Äònew‚Äô).length;
document.getElementById(‚Äònc-fu‚Äô).textContent = ST.leads.filter(l => l.followup && new Date(l.followup) <= new Date()).length;
document.getElementById(‚Äònc-alerts‚Äô).textContent = ST.alerts.length;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDash() {
const profit = ST.sold.reduce((s, x) => s + ((x.soldFor || 0) - (x.paid || 0)), 0);
document.getElementById(‚Äòds-leads‚Äô).textContent = ST.leads.length;
document.getElementById(‚Äòds-active‚Äô).textContent = ST.leads.filter(l => l.status === ‚Äòactive‚Äô).length;
document.getElementById(‚Äòds-closed‚Äô).textContent = ST.leads.filter(l => l.status === ‚Äòclosed‚Äô).length;
document.getElementById(‚Äòds-profit‚Äô).textContent = fmtM(profit);

// Recent leads
const recent = ST.leads.slice(0, 5);
document.getElementById(‚Äòdash-recent‚Äô).innerHTML = recent.length ? recent.map(l =>
`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);" onclick="viewLead('${l.id}');event.stopPropagation()"> <div><div style="font-size:13px;font-weight:500;">${l.name}</div><div style="font-size:11px;color:var(--muted);">${l.device || '‚Äî'}</div></div> ${sPill(l.status)} </div>`).join(‚Äô‚Äô) : ‚Äò<div style="color:var(--muted);font-size:12px;padding:10px 0;">No leads yet</div>‚Äô;

// Follow-ups due
const due = ST.leads.filter(l => l.followup && new Date(l.followup) <= new Date()).slice(0, 4);
document.getElementById(‚Äòdash-fu‚Äô).innerHTML = due.length ? due.map(l =>
`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);"> <div><div style="font-size:13px;font-weight:500;">${l.name}</div><div style="font-family:var(--M);font-size:10px;color:var(--red);">${l.followup}</div></div> <button class="btn btn-ghost btn-sm" onclick="viewLead('${l.id}')">View</button> </div>`).join(‚Äô‚Äô) : ‚Äò<div style="color:var(--muted);font-size:12px;padding:10px 0;">No follow-ups due</div>‚Äô;

// Pipeline summary
const stages = [[‚Äònew‚Äô,‚ÄòNew‚Äô],[‚Äòactive‚Äô,‚ÄòNegotiating‚Äô],[‚Äòfollow‚Äô,‚ÄòFollow-Up‚Äô],[‚Äòclosed‚Äô,‚ÄòClosed‚Äô],[‚Äòlost‚Äô,‚ÄòLost‚Äô]];
document.getElementById(‚Äòdash-pipeline‚Äô).innerHTML = stages.map(([k, label]) => {
const cnt = ST.leads.filter(l => l.status === k).length;
return `<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px;"><span>${label}</span><span style="font-family:var(--M);font-size:12px;">${cnt}</span></div>`;
}).join(‚Äô‚Äô);

// Top devices
const freq = {};
ST.leads.forEach(l => { if (l.device) { const k = l.device.split(‚Äô ‚Äò).slice(0,3).join(‚Äô ‚Äò); freq[k] = (freq[k] || 0) + 1; } });
const top = Object.entries(freq).sort((a,b) => b[1]-a[1]).slice(0, 5);
document.getElementById(‚Äòdash-devices‚Äô).innerHTML = top.length ? top.map(([d,n]) =>
`<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px;"><span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px;">${d}</span><span style="font-family:var(--M);font-size:12px;color:var(--gold);">${n}x</span></div>`
).join(‚Äô‚Äô) : ‚Äò<div style="color:var(--muted);font-size:12px;padding:10px 0;">No devices yet</div>‚Äô;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LEADS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveLead() {
const name = document.getElementById(‚Äòl-name‚Äô).value.trim();
if (!name) { toast(‚ÄòName required‚Äô, ‚Äòerror‚Äô); return; }
const lead = {
id: editLeadId || uid(), name,
phone: document.getElementById(‚Äòl-phone‚Äô).value.trim(),
device: document.getElementById(‚Äòl-device‚Äô).value.trim(),
cat: document.getElementById(‚Äòl-cat‚Äô).value,
asking: parseFloat(document.getElementById(‚Äòl-asking‚Äô).value) || 0,
offer: parseFloat(document.getElementById(‚Äòl-offer‚Äô).value) || 0,
source: document.getElementById(‚Äòl-source‚Äô).value,
status: document.getElementById(‚Äòl-status‚Äô).value,
notes: document.getElementById(‚Äòl-notes‚Äô).value.trim(),
followup: document.getElementById(‚Äòl-followup‚Äô).value,
added: editLeadId ? (ST.leads.find(l => l.id === editLeadId)?.added || new Date().toISOString()) : new Date().toISOString()
};
if (editLeadId) { const i = ST.leads.findIndex(l => l.id === editLeadId); if (i > -1) ST.leads[i] = lead; toast(‚ÄòLead updated ‚úì‚Äô); }
else { ST.leads.unshift(lead); toast(‚ÄòLead added ‚úì‚Äô); }
save(); closeModal(‚ÄòaddLead‚Äô); renderLeads(); renderDash(); counts();
}

function renderLeads() {
const q = (document.getElementById(‚ÄòleadSearch‚Äô)?.value || ‚Äò‚Äô).toLowerCase();
const rows = ST.leads.filter(l => l.name.toLowerCase().includes(q) || (l.phone || ‚Äò‚Äô).includes(q) || (l.device || ‚Äò‚Äô).toLowerCase().includes(q));
const tb = document.getElementById(‚Äòleads-tbody‚Äô);
const em = document.getElementById(‚Äòleads-empty‚Äô);
if (!rows.length) { tb.innerHTML = ‚Äò‚Äô; em.style.display = ‚Äò‚Äô; return; }
em.style.display = ‚Äònone‚Äô;
tb.innerHTML = rows.map(l => ` <tr onclick="viewLead('${l.id}')"> <td><div style="font-weight:500;">${l.name}</div><div style="font-family:var(--M);font-size:10px;color:var(--muted);">${l.phone || ''}</div></td> <td style="font-size:12px;">${l.device || '‚Äî'}<div style="font-size:10px;color:var(--muted);">${l.cat || ''}</div></td> <td style="font-family:var(--M);color:var(--gold);font-size:12px;">${l.asking ? '$' + l.asking : '‚Äî'}</td> <td>${sPill(l.status)}</td> <td class="hm" style="font-size:11px;color:var(--muted);">${l.source}</td> <td class="hm" style="font-family:var(--M);font-size:10px;color:var(--muted);">${fmtD(l.added)}</td> <td onclick="event.stopPropagation()"> <div style="display:flex;gap:4px;"> <button class="btn btn-ghost btn-sm" onclick="editLead('${l.id}')">Edit</button> <button class="btn btn-danger btn-sm" onclick="delLead('${l.id}')">‚úï</button> </div> </td> </tr>`).join(‚Äô‚Äô);
}

function viewLead(id) {
const l = ST.leads.find(x => x.id === id); if (!l) return;
document.getElementById(‚Äòvl-title‚Äô).textContent = l.name.toUpperCase();
document.getElementById(‚Äòvl-body‚Äô).innerHTML = `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;"> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">PHONE</div><div style="font-family:var(--M);font-size:12px;">${l.phone || '‚Äî'}</div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">STATUS</div>${sPill(l.status)}</div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">DEVICE</div><div style="font-size:13px;">${l.device || '‚Äî'} <span style="font-size:10px;color:var(--muted);">${l.cat || ''}</span></div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">SOURCE</div><div style="font-size:13px;">${l.source}</div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">ASKING</div><div style="font-family:var(--M);color:var(--red);">${l.asking ? '$' + l.asking : '‚Äî'}</div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">YOUR OFFER</div><div style="font-family:var(--M);color:var(--green);">${l.offer ? '$' + l.offer : '‚Äî'}</div></div> ${l.followup ?`<div style="grid-column:1/-1"><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">FOLLOW-UP</div><div style="font-family:var(--M);color:var(--purple);">${l.followup}</div></div>`: ''} </div> ${l.notes ?`<div style="background:var(--card2);border:1px solid var(--border);border-radius:2px;padding:10px;font-size:13px;color:#bbb;line-height:1.6;">${l.notes}</div>` : ''}`;
document.getElementById(‚Äòvl-footer‚Äô).innerHTML = ` <button class="btn btn-ghost" onclick="closeModal('viewLead')">Close</button> <button class="btn btn-ghost" onclick="closeModal('viewLead');editLead('${l.id}')">Edit</button> <button class="btn btn-gold" onclick="closeModal('viewLead');markBought('${l.id}')">Mark Bought ‚Üí</button>`;
openModal(‚ÄòviewLead‚Äô);
}

function editLead(id) {
const l = ST.leads.find(x => x.id === id); if (!l) return;
editLeadId = id;
document.getElementById(‚Äòlead-modal-title‚Äô).textContent = ‚ÄòEDIT LEAD‚Äô;
document.getElementById(‚Äòl-name‚Äô).value = l.name;
document.getElementById(‚Äòl-phone‚Äô).value = l.phone || ‚Äò‚Äô;
document.getElementById(‚Äòl-device‚Äô).value = l.device || ‚Äò‚Äô;
document.getElementById(‚Äòl-cat‚Äô).value = l.cat || ‚ÄòPhone‚Äô;
document.getElementById(‚Äòl-asking‚Äô).value = l.asking || ‚Äò‚Äô;
document.getElementById(‚Äòl-offer‚Äô).value = l.offer || ‚Äò‚Äô;
document.getElementById(‚Äòl-source‚Äô).value = l.source;
document.getElementById(‚Äòl-status‚Äô).value = l.status;
document.getElementById(‚Äòl-notes‚Äô).value = l.notes || ‚Äò‚Äô;
document.getElementById(‚Äòl-followup‚Äô).value = l.followup || ‚Äò‚Äô;
openModal(‚ÄòaddLead‚Äô);
}

function delLead(id) {
if (!confirm(‚ÄòDelete this lead?‚Äô)) return;
ST.leads = ST.leads.filter(l => l.id !== id);
save(); renderLeads(); renderDash(); counts(); toast(‚ÄòDeleted‚Äô);
}

function markBought(id) {
const l = ST.leads.find(x => x.id === id); if (!l) return;
l.status = ‚Äòclosed‚Äô;
document.getElementById(‚Äòi-device‚Äô).value = l.device || ‚Äò‚Äô;
document.getElementById(‚Äòi-cat‚Äô).value = l.cat || ‚ÄòPhone‚Äô;
document.getElementById(‚Äòi-paid‚Äô).value = l.offer || l.asking || ‚Äò‚Äô;
document.getElementById(‚Äòi-notes‚Äô).value = l.notes || ‚Äò‚Äô;
[‚Äòi-imei‚Äô,‚Äòi-target‚Äô].forEach(f => document.getElementById(f).value = ‚Äò‚Äô);
save(); renderLeads(); openModal(‚ÄòaddInventory‚Äô);
}

function exportLeads() {
const rows = [[‚ÄòName‚Äô,‚ÄòPhone‚Äô,‚ÄòDevice‚Äô,‚ÄòCat‚Äô,‚ÄòAsking‚Äô,‚ÄòOffer‚Äô,‚ÄòStatus‚Äô,‚ÄòSource‚Äô,‚ÄòNotes‚Äô,‚ÄòAdded‚Äô]];
ST.leads.forEach(l => rows.push([l.name, l.phone, l.device, l.cat, l.asking, l.offer, l.status, l.source, l.notes, fmtD(l.added)]));
dlCSV(‚Äòleads.csv‚Äô, rows);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PIPELINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STAGES = [
{ key:‚Äònew‚Äô, label:‚ÄòNew‚Äô, c:‚Äòvar(‚Äìblue)‚Äô },
{ key:‚Äòactive‚Äô, label:‚ÄòNegotiating‚Äô, c:‚Äòvar(‚Äìgold)‚Äô },
{ key:‚Äòfollow‚Äô, label:‚ÄòFollow-Up‚Äô, c:‚Äòvar(‚Äìpurple)‚Äô },
{ key:‚Äòclosed‚Äô, label:‚ÄòBought ‚úì‚Äô, c:‚Äòvar(‚Äìgreen)‚Äô },
{ key:‚Äòlost‚Äô, label:‚ÄòLost‚Äô, c:‚Äòvar(‚Äìred)‚Äô }
];

function renderPipeline() {
document.getElementById(‚Äòpipeline-board‚Äô).innerHTML = STAGES.map(st => {
const leads = ST.leads.filter(l => l.status === st.key);
return `<div class="pipe-col"> <div class="pipe-head" style="border-top:2px solid ${st.c}"> <span>${st.label}</span> <span style="background:var(--sub);color:var(--muted);border-radius:10px;padding:1px 6px;font-size:10px;">${leads.length}</span> </div> <div class="pipe-cards"> ${leads.length ? leads.map(l => `
<div class="pipe-card" onclick="viewLead('${l.id}')">
<div style="font-size:12px;font-weight:500;">${l.name}</div>
<div style="font-size:10px;color:var(--muted);">${l.device || ‚ÄòNo device‚Äô}</div>
${l.asking ? `<div style="font-family:var(--M);font-size:10px;color:var(--gold);margin-top:4px;">$${l.asking}</div>` : ‚Äò‚Äô}
</div>`).join('') : '<div style="color:var(--sub);font-size:10px;text-align:center;padding:12px;font-family:var(--M);">Empty</div>'} </div> </div>`;
}).join(‚Äô‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FOLLOW-UPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFollowups() {
const today = new Date(); today.setHours(23,59,59,999);
const in7 = new Date(); in7.setDate(in7.getDate() + 7);
const due = ST.leads.filter(l => l.followup && new Date(l.followup) <= new Date());
const upcoming = ST.leads.filter(l => l.followup && new Date(l.followup) > new Date() && new Date(l.followup) <= in7);
const fuItem = l => `<div class="fu-item"> <div class="fu-av">${l.name[0].toUpperCase()}</div> <div style="flex:1;min-width:0;"> <div style="font-weight:500;font-size:13px;">${l.name}</div> <div style="font-size:11px;color:var(--muted);">${l.device || '‚Äî'}</div> <div style="font-family:var(--M);font-size:10px;margin-top:2px;color:${new Date(l.followup) < new Date() ? 'var(--red)' : 'var(--purple)'};">${l.followup}</div> </div> <div style="display:flex;gap:6px;flex-shrink:0;"> ${l.phone ?`<a href="tel:${l.phone}" class="btn btn-green btn-sm">üìû</a>` : ''} <button class="btn btn-ghost btn-sm" onclick="viewLead('${l.id}')">View</button> </div> </div>`;
document.getElementById(‚Äòfu-due‚Äô).innerHTML = due.length ? due.map(fuItem).join(‚Äô‚Äô) : ‚Äò<div style="color:var(--muted);font-size:12px;padding:8px 0;">None overdue ‚úì</div>‚Äô;
document.getElementById(‚Äòfu-upcoming‚Äô).innerHTML = upcoming.length ? upcoming.map(fuItem).join(‚Äô‚Äô) : ‚Äò<div style="color:var(--muted);font-size:12px;padding:8px 0;">No upcoming follow-ups</div>‚Äô;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AI ASSISTANT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AI_MODES = {
negotiate: {
sys: `You are an expert reseller negotiation coach for Trey Buyback. The business buys used/damaged phones, MacBooks, consoles, cameras, iPads for resale. When given a seller conversation, provide word-for-word scripts the buyer should say. Format scripts in bold. Keep responses concise and tactical.`,
prompts: [‚ÄòPaste a seller convo ‚Äî I'll write your next message‚Äô, ‚ÄòSeller won't budge on price ‚Äî help me‚Äô, ‚ÄòHow do I bring up that I need to make profit?‚Äô, ‚ÄòSeller ghosted after my offer‚Äô]
},
deal: {
sys: `You are a used electronics deal analyzer for Trey Buyback. Given an item and asking price, analyze: current market value, eBay net after 13.25% fee + $12 shipping, max buy price (68% of net), estimated profit, and a clear BUY / PASS / NEGOTIATE verdict. Be direct and numbers-focused.`,
prompts: [‚ÄòiPhone 15 Pro 256GB ‚Äî seller wants $600‚Äô, ‚ÄòPS5 Disc, asking $300 ‚Äî is it worth it?‚Äô, ‚ÄòMacBook Pro M2, cracked screen, asking $400‚Äô, ‚ÄòiPhone 13 bad ESN, they want $150‚Äô]
},
objection: {
sys: `You are an objection handling expert for Trey Buyback, a used electronics buying business. Give short, word-for-word responses the buyer should say to overcome seller objections. Focus on same-day cash, convenience, and empathy. Keep scripts natural and conversational.`,
prompts: [‚Äô‚ÄúI'll just sell it myself‚Äù ‚Äî what do I say?‚Äô, ‚ÄòSeller says someone else offered more‚Äô, ‚ÄòThey're being rude and unresponsive‚Äô, ‚ÄòSeller suddenly wants more than listed price‚Äô]
},
ad: {
sys: `You are a Facebook Marketplace and Craigslist ad copywriter for Trey Buyback, a local cash electronics buyer. Write compelling "WE BUY" ad copy that gets sellers to reach out. No Apple/brand logos mentioned. Focus on: instant cash, free pickup, no hassle, all conditions accepted. Create 2-3 variations.`,
prompts: [‚ÄòWrite a general ‚Äúwe buy phones‚Äù ad‚Äô, ‚ÄòAd targeting people with cracked iPhones‚Äô, ‚ÄòWrite a Craigslist post for buying MacBooks‚Äô, ‚ÄòHoliday season ad ‚Äî people need cash‚Äô]
}
};

function setMode(mode, btn) {
aiMode = mode;
document.querySelectorAll(‚Äô.ai-mode-btn‚Äô).forEach(b => b.classList.remove(‚Äòactive‚Äô));
btn.classList.add(‚Äòactive‚Äô);
renderAIPrompts();
}

function renderAIPrompts() {
const prompts = AI_MODES[aiMode]?.prompts || [];
document.getElementById(‚Äòai-qbtns‚Äô).innerHTML = prompts.map(p =>
`<div class="ai-qbtn" onclick="usePrompt(this)">${p}</div>`).join(‚Äô‚Äô);
}

function renderAI() {
renderAIPrompts();
renderAIChat();
}

function renderAIChat() {
const chat = document.getElementById(‚Äòai-chat‚Äô);
chat.innerHTML = aiHistory.map(m => ` <div class="ai-msg ${m.role}"> <div class="ai-av ${m.role === 'assistant' ? 'bot' : 'user'}">${m.role === 'assistant' ? 'ü§ñ' : 'T'}</div> <div class="ai-bubble ${m.role === 'assistant' ? 'bot' : 'user'}">${formatAIMsg(m.content)}</div> </div>`).join(‚Äô‚Äô);
chat.scrollTop = chat.scrollHeight;
}

function formatAIMsg(text) {
return text
.replace(/**(.*?)**/g, ‚Äò<strong>$1</strong>‚Äô)
.replace(/^> (.+)$/gm, ‚Äò<div class="ai-sline">$1</div>‚Äô)
.replace(/\n\n/g, ‚Äò<br><br>‚Äô)
.replace(/\n/g, ‚Äò<br>‚Äô);
}

function usePrompt(el) { document.getElementById(‚Äòai-input‚Äô).value = el.textContent; sendMsg(); }

function aiKey(e) {
if (e.key === ‚ÄòEnter‚Äô && !e.shiftKey) { e.preventDefault(); sendMsg(); }
}

async function sendMsg() {
const input = document.getElementById(‚Äòai-input‚Äô);
const msg = input.value.trim();
if (!msg) return;
input.value = ‚Äò‚Äô;
const btn = document.getElementById(‚Äòai-send‚Äô);
btn.disabled = true;
aiHistory.push({ role: ‚Äòuser‚Äô, content: msg });
renderAIChat();

// Add typing indicator
const chat = document.getElementById(‚Äòai-chat‚Äô);
const typing = document.createElement(‚Äòdiv‚Äô);
typing.className = ‚Äòai-msg‚Äô;
typing.innerHTML = ‚Äò<div class="ai-av bot">ü§ñ</div><div class="ai-bubble bot"><div class="dots"><span></span><span></span><span></span></div></div>‚Äô;
chat.appendChild(typing);
chat.scrollTop = chat.scrollHeight;

try {
const sys = AI_MODES[aiMode]?.sys || AI_MODES.negotiate.sys;
const res = await fetch(‚Äòhttps://api.anthropic.com/v1/messages‚Äô, {
method: ‚ÄòPOST‚Äô,
headers: { ‚ÄòContent-Type‚Äô: ‚Äòapplication/json‚Äô },
body: JSON.stringify({
model: ‚Äòclaude-sonnet-4-20250514‚Äô,
max_tokens: 800,
system: sys,
messages: aiHistory.map(m => ({ role: m.role, content: m.content }))
})
});
const data = await res.json();
const reply = data.content?.[0]?.text || ‚ÄòSorry, I had trouble connecting. Try again.‚Äô;
aiHistory.push({ role: ‚Äòassistant‚Äô, content: reply });
} catch(e) {
aiHistory.push({ role: ‚Äòassistant‚Äô, content: ‚ÄòConnection error ‚Äî check your internet and try again.‚Äô });
}
chat.removeChild(typing);
btn.disabled = false;
renderAIChat();
}

function clearChat() {
aiHistory = [{ role: ‚Äòassistant‚Äô, content: ‚ÄúChat cleared. What do you need help with?‚Äù }];
renderAIChat();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PRICE CHECKER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let lastQ = ‚Äò‚Äô;

function setCat(el) {
document.querySelectorAll(‚Äô.ecat‚Äô).forEach(e => e.classList.remove(‚Äòactive‚Äô));
el.classList.add(‚Äòactive‚Äô);
}

function soldLink(platform) {
const q = document.getElementById(‚Äòpc-q‚Äô).value.trim() || lastQ;
if (!q) { toast(‚ÄòEnter an item first‚Äô, ‚Äòerror‚Äô); return; }
const enc = encodeURIComponent(q);
const urls = {
ebay: `https://www.ebay.com/sch/i.html?_nkw=${enc}&LH_Complete=1&LH_Sold=1&_sop=13`,
swappa: `https://swappa.com/buy/${q.toLowerCase().replace(/\s+/g, '-')}`,
fb: `https://www.facebook.com/marketplace/search/?query=${enc}`
};
window.open(urls[platform], ‚Äò_blank‚Äô);
}

async function getEbayToken() {
if (!KEYS.ebay) return null;
try {
const r = await fetch(‚Äòhttps://api.ebay.com/identity/v1/oauth2/token‚Äô, {
method: ‚ÄòPOST‚Äô,
headers: { ‚ÄòContent-Type‚Äô: ‚Äòapplication/x-www-form-urlencoded‚Äô, ‚ÄòAuthorization‚Äô: ‚ÄôBasic ‚Äô + btoa(KEYS.ebay + ‚Äò:‚Äô) },
body: ‚Äògrant_type=client_credentials&scope=https%3A%2F%2Fapi.ebay.com%2Foauth%2Fapi_scope‚Äô
});
const d = await r.json();
return d.access_token || null;
} catch(e) { return null; }
}

function condFilter(c) {
if (c === ‚Äònew‚Äô) return ‚Äò&filter=conditionIds:{1000|1500}‚Äô;
if (c === ‚Äòused‚Äô) return ‚Äò&filter=conditionIds:{3000|2500|2750}‚Äô;
if (c === ‚Äòdamaged‚Äô || c === ‚Äòbroken‚Äô) return ‚Äò&filter=conditionIds:{7000}‚Äô;
return ‚Äò‚Äô;
}

async function runCheck() {
const q = document.getElementById(‚Äòpc-q‚Äô).value.trim();
const cond = document.getElementById(‚Äòpc-cond‚Äô).value;
if (!q) { toast(‚ÄòEnter an item to search‚Äô, ‚Äòerror‚Äô); return; }
lastQ = q;
const btn = document.getElementById(‚Äòpc-btn‚Äô);
btn.textContent = ‚ÄòChecking‚Ä¶‚Äô; btn.disabled = true;
const res = document.getElementById(‚Äòpc-results‚Äô);
res.innerHTML = `<div style="text-align:center;padding:50px;color:var(--muted);"><div style="font-size:28px;margin-bottom:10px;">üîç</div><div style="font-family:var(--M);font-size:11px;letter-spacing:1px;">Searching for "${q}"‚Ä¶</div></div>`;

let ebayItems = [];
if (KEYS.ebay) {
try {
const token = await getEbayToken();
if (token) {
const url = `https://api.ebay.com/buy/browse/v1/item_summary/search?q=${encodeURIComponent(q)}&limit=8&sort=newlyListed${condFilter(cond)}`;
const r = await fetch(url, { headers: { ‚ÄòAuthorization‚Äô: ‚ÄôBearer ‚Äô + token, ‚ÄòX-EBAY-C-MARKETPLACE-ID‚Äô: ‚ÄòEBAY_US‚Äô } });
const d = await r.json();
if (d.itemSummaries?.length) {
ebayItems = d.itemSummaries.map(i => ({
title: i.title, price: parseFloat(i.price?.value || 0),
condition: i.condition || ‚ÄòUsed‚Äô, url: i.itemWebUrl || ‚Äòhttps://ebay.com‚Äô,
image: i.image?.imageUrl || null, platform: ‚ÄòeBay‚Äô, daysAgo: Math.floor(Math.random() * 6) + 1
}));
}
}
} catch(e) { console.log(‚ÄòeBay API error:‚Äô, e); }
}

try {
const sys = `You are a used electronics pricing expert. Return ONLY valid JSON, no markdown fences: {"avgSell":NUM,"ebayFee":13.25,"shipping":12,"notes":"STRING","buyTip":"STRING","comps":[{"title":"STRING","price":NUM,"platform":"eBay","condition":"STRING","daysAgo":NUM,"url":"STRING"},{"title":"STRING","price":NUM,"platform":"Swappa","condition":"STRING","daysAgo":NUM,"url":"STRING"},{"title":"STRING","price":NUM,"platform":"FB Marketplace","condition":"STRING","daysAgo":NUM,"url":"STRING"}]} Rules: Realistic 2025 market prices. Damaged/parts=30-50% of working. Bad ESN=40-60%. Broken=20-35%. All URLs must be real and clickable.`;
const aiR = await fetch(‚Äòhttps://api.anthropic.com/v1/messages‚Äô, {
method: ‚ÄòPOST‚Äô,
headers: { ‚ÄòContent-Type‚Äô: ‚Äòapplication/json‚Äô },
body: JSON.stringify({ model: ‚Äòclaude-sonnet-4-20250514‚Äô, max_tokens: 800, system: sys, messages: [{ role: ‚Äòuser‚Äô, content: `Device: ${q}\nCondition: ${cond}` }] })
});
const aiD = await aiR.json();
const raw = aiD.content?.[0]?.text || ‚Äò{}‚Äô;
const d = JSON.parse(raw.replace(/`json|`/g, ‚Äò‚Äô).trim());
const avg = ebayItems.length > 0 ? Math.round(ebayItems.slice(0,5).reduce((s,i) => s+i.price, 0) / Math.min(ebayItems.length,5)) : (d.avgSell || 0);
const fee = d.ebayFee || 13.25; const ship = d.shipping || 12;
const feeAmt = Math.round(avg * (fee / 100));
const net = avg - feeAmt - ship;
const maxBuy = Math.round(net * 0.68);
const profit = net - maxBuy;
const enc = encodeURIComponent(q);
const allComps = [‚Ä¶ebayItems.slice(0,4), ‚Ä¶(d.comps || [])].slice(0, 8);

```
res.innerHTML = `
  <div class="ext-links" style="margin-bottom:12px;">
    <a class="ext-card" href="https://www.ebay.com/sch/i.html?_nkw=${enc}&LH_Complete=1&LH_Sold=1&_sop=13" target="_blank" rel="noopener">
      <div class="ext-icon">üõí</div><div class="ext-label">eBay Sold</div><div class="ext-sub">Pre-filtered ‚Üí</div>
    </a>
    <a class="ext-card" href="https://swappa.com/buy/${q.toLowerCase().replace(/\s+/g,'-')}" target="_blank" rel="noopener">
      <div class="ext-icon">üîÑ</div><div class="ext-label">Swappa</div><div class="ext-sub">Used market ‚Üí</div>
    </a>
    <a class="ext-card" href="https://www.facebook.com/marketplace/search/?query=${enc}" target="_blank" rel="noopener">
      <div class="ext-icon">üìç</div><div class="ext-label">FB Marketplace</div><div class="ext-sub">Local ‚Üí</div>
    </a>
  </div>
  <div class="price-hero">
    <div class="ph-cell"><div class="ph-label">Avg Sell Price</div><div class="ph-val gold">$${avg}</div><div class="ph-sub">${ebayItems.length ? 'Live eBay data' : 'AI estimate'}</div></div>
    <div class="ph-cell"><div class="ph-label">Net After Fees</div><div class="ph-val green">$${net}</div><div class="ph-sub">${fee}% + $${ship} ship</div></div>
    <div class="ph-cell"><div class="ph-label">Max Buy Price</div><div class="ph-val orange">$${maxBuy}</div><div class="ph-sub">~$${profit} profit</div></div>
  </div>
  <div class="panel" style="margin-bottom:12px;">
    <div class="panel-title">FEE BREAKDOWN</div>
    <div class="fee-row"><span class="fee-key">Avg Sell Price</span><span class="fee-val" style="color:var(--gold);">$${avg}</span></div>
    <div class="fee-row"><span class="fee-key">eBay Fee (${fee}%)</span><span class="fee-val" style="color:var(--red);">-$${feeAmt}</span></div>
    <div class="fee-row"><span class="fee-key">Estimated Shipping</span><span class="fee-val" style="color:var(--red);">-$${ship}</span></div>
    <div class="fee-row"><span class="fee-key">Your Net</span><span class="fee-val" style="color:var(--green);">$${net}</span></div>
    <div class="fee-row"><span class="fee-key">Max Buy Price (68%)</span><span class="fee-val" style="color:var(--orange);">$${maxBuy}</span></div>
    <div class="fee-row"><span class="fee-key">Estimated Profit</span><span class="fee-val" style="color:var(--green);">$${profit}</span></div>
  </div>
  <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;">${ebayItems.length ? 'LIVE EBAY LISTINGS' : 'MARKET COMPS'} ‚Äî click to open</div>
  ${allComps.map(c => {
    const cn = Math.round(c.price * (1 - fee/100) - ship);
    const ptc = c.platform === 'eBay' ? 'pt-ebay' : c.platform === 'Swappa' ? 'pt-swappa' : 'pt-fb';
    return `<div class="listing-card">
      ${c.image ? `<img class="listing-thumb" src="${c.image}" onerror="this.style.display='none'" loading="lazy">` : ''}
      <div class="listing-info">
        <div class="listing-title"><a href="${c.url}" target="_blank" rel="noopener">${c.title}</a></div>
        <div class="listing-meta">${c.condition || 'Used'}${c.daysAgo ? ' ¬∑ ' + c.daysAgo + 'd ago' : ''}</div>
        <div class="listing-net">Net after fees: ~$${cn}</div>
        <span class="plat-tag ${ptc}">${c.platform}</span>
      </div>
      <div class="listing-price">
        <div class="lp-amt">$${c.price}</div>
        <div class="lp-net">~$${cn} net</div>
        <a href="${c.url}" target="_blank" rel="noopener" style="display:block;margin-top:5px;font-family:var(--M);font-size:10px;color:var(--teal);text-decoration:none;">View ‚Üí</a>
      </div>
    </div>`;
  }).join('')}
  ${d.buyTip ? `<div style="background:rgba(45,212,191,.07);border:1px solid rgba(45,212,191,.2);border-radius:2px;padding:11px 13px;margin-top:10px;font-size:13px;color:#80e0d8;line-height:1.7;">üí° ${d.buyTip}</div>` : ''}
  ${d.notes ? `<div style="background:var(--card);border:1px solid var(--border);border-radius:2px;padding:11px 13px;margin-top:8px;font-size:12px;color:#777;line-height:1.7;">üìä ${d.notes}</div>` : ''}
  <div style="margin-top:12px;display:flex;gap:8px;">
    <button class="btn btn-gold" style="flex:1;" onclick="addLeadFromPC('${q.replace(/'/g,"\\'")}',${maxBuy})">+ Add as Lead at $${maxBuy}</button>
    <button class="btn btn-ghost btn-sm" onclick="nav('calc')">Flip Calc</button>
  </div>`;
```

} catch(e) {
const enc = encodeURIComponent(q);
res.innerHTML = ` <div class="ext-links"> <a class="ext-card" href="https://www.ebay.com/sch/i.html?_nkw=${enc}&LH_Complete=1&LH_Sold=1" target="_blank"><div class="ext-icon">üõí</div><div class="ext-label">eBay Sold</div><div class="ext-sub">Search manually ‚Üí</div></a> <a class="ext-card" href="https://swappa.com/buy/${q.toLowerCase().replace(/\s+/g,'-')}" target="_blank"><div class="ext-icon">üîÑ</div><div class="ext-label">Swappa</div></a> <a class="ext-card" href="https://www.facebook.com/marketplace/search/?query=${enc}" target="_blank"><div class="ext-icon">üìç</div><div class="ext-label">FB Marketplace</div></a> </div> <div class="empty"><div class="empty-icon">‚ö†Ô∏è</div>Could not load pricing data ‚Äî check your connection and try again.</div>`;
}
btn.textContent = ‚ÄòCheck ‚Üí‚Äô; btn.disabled = false;
}

function addLeadFromPC(device, maxBuy) {
document.getElementById(‚Äòl-device‚Äô).value = device;
document.getElementById(‚Äòl-offer‚Äô).value = maxBuy > 0 ? maxBuy : ‚Äò‚Äô;
document.getElementById(‚Äòl-source‚Äô).value = ‚ÄòFB Marketplace‚Äô;
openModal(‚ÄòaddLead‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FLIP CALC ‚Äî ATLAS MOBILE PRICING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ATLAS = {
‚ÄúiPhone 7‚Äù:        { ‚Äú32GB‚Äù: [38,30,22,16,9,4],    ‚Äú128GB‚Äù: [45,35,26,20,12,5],    ‚Äú256GB‚Äù: [50,40,30,23,14,6] },
‚ÄúiPhone 7 Plus‚Äù:   { ‚Äú32GB‚Äù: [50,40,30,22,13,5],   ‚Äú128GB‚Äù: [58,46,35,26,16,6],    ‚Äú256GB‚Äù: [65,52,40,30,18,7] },
‚ÄúiPhone 8‚Äù:        { ‚Äú64GB‚Äù: [55,44,33,25,15,6],   ‚Äú128GB‚Äù: [62,50,38,28,17,7],    ‚Äú256GB‚Äù: [70,56,42,31,19,8] },
‚ÄúiPhone 8 Plus‚Äù:   { ‚Äú64GB‚Äù: [70,56,42,31,19,8],   ‚Äú128GB‚Äù: [78,62,47,35,21,9],    ‚Äú256GB‚Äù: [85,68,51,38,23,10] },
‚ÄúiPhone X‚Äù:        { ‚Äú64GB‚Äù: [85,68,51,38,23,9],   ‚Äú256GB‚Äù: [95,76,57,42,26,11] },
‚ÄúiPhone XR‚Äù:       { ‚Äú64GB‚Äù: [90,72,54,40,24,10],  ‚Äú128GB‚Äù: [100,80,60,44,27,11],  ‚Äú256GB‚Äù: [110,88,66,49,30,12] },
‚ÄúiPhone XS‚Äù:       { ‚Äú64GB‚Äù: [95,76,57,43,26,11],  ‚Äú256GB‚Äù: [110,88,66,49,30,12],  ‚Äú512GB‚Äù: [125,100,75,55,34,14] },
‚ÄúiPhone XS Max‚Äù:   { ‚Äú64GB‚Äù: [105,84,63,47,29,12], ‚Äú256GB‚Äù: [120,96,72,53,32,13],  ‚Äú512GB‚Äù: [135,108,81,60,37,15] },
‚ÄúiPhone 11‚Äù:       { ‚Äú64GB‚Äù: [110,88,66,49,30,12], ‚Äú128GB‚Äù: [120,96,72,53,32,13],  ‚Äú256GB‚Äù: [135,108,81,60,37,15] },
‚ÄúiPhone 11 Pro‚Äù:   { ‚Äú64GB‚Äù: [145,116,87,64,39,16],‚Äú256GB‚Äù: [160,128,96,71,43,18], ‚Äú512GB‚Äù: [180,144,108,80,49,20] },
‚ÄúiPhone 11 Pro Max‚Äù:{‚Äú64GB‚Äù:[155,124,93,69,42,17], ‚Äú256GB‚Äù: [175,140,105,78,48,19],‚Äú512GB‚Äù: [195,156,117,86,53,22] },
‚ÄúiPhone 12‚Äù:       { ‚Äú64GB‚Äù: [150,120,90,66,41,17],‚Äú128GB‚Äù: [165,132,99,73,45,18], ‚Äú256GB‚Äù: [180,144,108,80,49,20] },
‚ÄúiPhone 12 Mini‚Äù:  { ‚Äú64GB‚Äù: [130,104,78,58,35,14],‚Äú128GB‚Äù: [145,116,87,64,39,16], ‚Äú256GB‚Äù: [160,128,96,71,43,18] },
‚ÄúiPhone 12 Pro‚Äù:   { ‚Äú128GB‚Äù:[185,148,111,82,50,21],‚Äú256GB‚Äù:[200,160,120,89,54,22],‚Äú512GB‚Äù:[220,176,132,98,60,25] },
‚ÄúiPhone 12 Pro Max‚Äù:{‚Äú128GB‚Äù:[195,156,117,86,53,22],‚Äú256GB‚Äù:[215,172,129,95,58,24],‚Äú512GB‚Äù:[235,188,141,104,64,26] },
‚ÄúiPhone 13‚Äù:       { ‚Äú128GB‚Äù:[200,160,120,89,54,22],‚Äú256GB‚Äù:[220,176,132,98,60,25],‚Äú512GB‚Äù:[245,196,147,109,67,27] },
‚ÄúiPhone 13 Mini‚Äù:  { ‚Äú128GB‚Äù:[170,136,102,75,46,19],‚Äú256GB‚Äù:[190,152,114,84,52,21],‚Äú512GB‚Äù:[210,168,126,93,57,23] },
‚ÄúiPhone 13 Pro‚Äù:   { ‚Äú128GB‚Äù:[240,192,144,107,65,27],‚Äú256GB‚Äù:[260,208,156,115,71,29],‚Äú512GB‚Äù:[285,228,171,126,77,32],‚Äú1TB‚Äù:[310,248,186,138,84,35] },
‚ÄúiPhone 13 Pro Max‚Äù:{‚Äú128GB‚Äù:[255,204,153,113,69,28],‚Äú256GB‚Äù:[278,222,167,123,75,31],‚Äú512GB‚Äù:[305,244,183,135,83,34],‚Äú1TB‚Äù:[330,264,198,147,90,37] },
‚ÄúiPhone 14‚Äù:       { ‚Äú128GB‚Äù:[255,204,153,113,69,28],‚Äú256GB‚Äù:[278,222,167,123,75,31],‚Äú512GB‚Äù:[305,244,183,135,83,34] },
‚ÄúiPhone 14 Plus‚Äù:  { ‚Äú128GB‚Äù:[230,184,138,102,62,26],‚Äú256GB‚Äù:[252,202,151,112,68,28],‚Äú512GB‚Äù:[275,220,165,122,75,31] },
‚ÄúiPhone 14 Pro‚Äù:   { ‚Äú128GB‚Äù:[320,256,192,142,87,36],‚Äú256GB‚Äù:[345,276,207,153,93,38],‚Äú512GB‚Äù:[375,300,225,166,102,42],‚Äú1TB‚Äù:[405,324,243,180,110,45] },
‚ÄúiPhone 14 Pro Max‚Äù:{‚Äú128GB‚Äù:[345,276,207,153,93,38],‚Äú256GB‚Äù:[370,296,222,164,100,41],‚Äú512GB‚Äù:[400,320,240,178,109,45],‚Äú1TB‚Äù:[430,344,258,191,117,48] },
‚ÄúiPhone 15‚Äù:       { ‚Äú128GB‚Äù:[340,272,204,151,92,38],‚Äú256GB‚Äù:[365,292,219,162,99,41],‚Äú512GB‚Äù:[395,316,237,175,107,44] },
‚ÄúiPhone 15 Plus‚Äù:  { ‚Äú128GB‚Äù:[310,248,186,138,84,35],‚Äú256GB‚Äù:[335,268,201,149,91,37],‚Äú512GB‚Äù:[365,292,219,162,99,41] },
‚ÄúiPhone 15 Pro‚Äù:   { ‚Äú128GB‚Äù:[420,336,252,186,114,47],‚Äú256GB‚Äù:[450,360,270,200,122,50],‚Äú512GB‚Äù:[490,392,294,217,133,55],‚Äú1TB‚Äù:[530,424,318,235,144,59] },
‚ÄúiPhone 15 Pro Max‚Äù:{‚Äú256GB‚Äù:[480,384,288,213,130,54],‚Äú512GB‚Äù:[520,416,312,231,141,58],‚Äú1TB‚Äù:[565,452,339,251,153,63] },
‚ÄúiPhone 16‚Äù:       { ‚Äú128GB‚Äù:[430,344,258,191,117,48],‚Äú256GB‚Äù:[460,368,276,204,125,51],‚Äú512GB‚Äù:[500,400,300,222,136,56] },
‚ÄúiPhone 16 Plus‚Äù:  { ‚Äú128GB‚Äù:[395,316,237,175,107,44],‚Äú256GB‚Äù:[425,340,255,189,115,47],‚Äú512GB‚Äù:[465,372,279,206,126,52] },
‚ÄúiPhone 16 Pro‚Äù:   { ‚Äú128GB‚Äù:[520,416,312,231,141,58],‚Äú256GB‚Äù:[555,444,333,246,151,62],‚Äú512GB‚Äù:[600,480,360,266,163,67],‚Äú1TB‚Äù:[645,516,387,286,175,72] },
‚ÄúiPhone 16 Pro Max‚Äù:{‚Äú256GB‚Äù:[590,472,354,262,160,66],‚Äú512GB‚Äù:[635,508,381,282,172,71],‚Äú1TB‚Äù:[680,544,408,302,185,76] }
};
const GRADE_LABELS = [‚ÄòSWAP‚Äô,‚ÄòA‚Äô,‚ÄòB‚Äô,‚ÄòC‚Äô,‚ÄòD‚Äô,‚ÄòDOA‚Äô];
const GRADE_KEYS = [‚Äòswap‚Äô,‚Äòa‚Äô,‚Äòb‚Äô,‚Äòc‚Äô,‚Äòd‚Äô,‚Äòdoa‚Äô];

function buildCalcModels() {
const sel = document.getElementById(‚Äòc-model‚Äô);
Object.keys(ATLAS).forEach(m => { const o = document.createElement(‚Äòoption‚Äô); o.value = m; o.textContent = m; sel.appendChild(o); });
}

function calcStorage() {
const model = document.getElementById(‚Äòc-model‚Äô).value;
const sel = document.getElementById(‚Äòc-storage‚Äô);
sel.innerHTML = ‚Äò<option value="">‚Äî Select ‚Äî</option>‚Äô;
if (!model || !ATLAS[model]) { calcUpdate(); return; }
Object.keys(ATLAS[model]).forEach(s => { const o = document.createElement(‚Äòoption‚Äô); o.value = s; o.textContent = s; sel.appendChild(o); });
calcUpdate();
}

function setGrade(g, el) {
calcGrade = g;
document.querySelectorAll(‚Äô.cbtn‚Äô).forEach(b => {
b.style.background = ‚Äòvar(‚Äìcard2)‚Äô; b.style.borderColor = ‚Äòvar(‚Äìborder2)‚Äô; b.style.color = ‚Äòvar(‚Äìmuted)‚Äô;
});
el.style.background = ‚Äòvar(‚Äìgold)‚Äô; el.style.borderColor = ‚Äòvar(‚Äìgold)‚Äô; el.style.color = ‚Äò#000‚Äô;
calcUpdate();
}

function togDed(key, el) {
calcDeds[key] = !calcDeds[key];
el.classList.toggle(‚Äòon‚Äô, calcDeds[key]);
calcUpdate();
}

function calcUpdate() {
const model = document.getElementById(‚Äòc-model‚Äô).value;
const storage = document.getElementById(‚Äòc-storage‚Äô).value;
const lock = document.getElementById(‚Äòc-lock‚Äô).value;
const minProfit = parseFloat(document.getElementById(‚Äòc-profit‚Äô).value) || 40;
const riskBuf = parseFloat(document.getElementById(‚Äòc-risk‚Äô).value) || 20;
const asking = parseFloat(document.getElementById(‚Äòc-asking‚Äô).value) || 0;
const res = document.getElementById(‚Äòcalc-result‚Äô);

if (!model || !storage || !ATLAS[model] || !ATLAS[model][storage]) {
res.innerHTML = ‚Äò<div style="padding:50px;text-align:center;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px;">SELECT MODEL + STORAGE</div>‚Äô;
return;
}

const gi = GRADE_KEYS.indexOf(calcGrade);
let atlasVal = ATLAS[model][storage][gi] || 0;
if (lock === ‚Äòlocked‚Äô) atlasVal = Math.round(atlasVal * 0.88);
let deds = 0;
if (calcDeds.back) deds += Math.round(atlasVal * 0.06);
if (calcDeds.lens) deds += Math.round(atlasVal * 0.05);
if (calcDeds.batt) deds += Math.round(atlasVal * 0.08);
if (calcDeds.rep) deds += Math.round(atlasVal * 0.10);
const netAtlas = atlasVal - deds;
const maxBuy = Math.max(0, netAtlas - minProfit - riskBuf);
const estProfit = netAtlas - maxBuy;

let verdict = ‚Äò‚Äô, verdictColor = ‚Äòvar(‚Äìmuted)‚Äô;
if (asking > 0) {
if (asking <= maxBuy * 0.85) { verdict = ‚Äòüî• STEAL ‚Äî BUY NOW‚Äô; verdictColor = ‚Äòvar(‚Äìgreen)‚Äô; }
else if (asking <= maxBuy) { verdict = ‚Äò‚úì GOOD DEAL ‚Äî BUY‚Äô; verdictColor = ‚Äòvar(‚Äìgreen)‚Äô; }
else if (asking <= maxBuy * 1.15) { verdict = ‚Äò‚ö° NEGOTIATE DOWN‚Äô; verdictColor = ‚Äòvar(‚Äìgold)‚Äô; }
else { verdict = ‚Äò‚úï PASS ‚Äî TOO HIGH‚Äô; verdictColor = ‚Äòvar(‚Äìred)‚Äô; }
}

const allGrades = GRADE_KEYS.map((g, i) => {
let v = ATLAS[model][storage][i] || 0;
if (lock === ‚Äòlocked‚Äô) v = Math.round(v * 0.88);
return { g: GRADE_LABELS[i], v };
});

res.innerHTML = `<div style="background:var(--card2);border-bottom:1px solid var(--border);padding:16px 18px;display:flex;align-items:center;justify-content:space-between;"> <div><div style="font-family:var(--D);font-size:22px;letter-spacing:1px;">${model}</div> <div style="font-family:var(--M);font-size:10px;color:var(--muted);">${storage} ¬∑ ${lock === 'locked' ? 'Carrier Locked' : 'Unlocked'} ¬∑ Grade ${GRADE_LABELS[gi]}</div></div> ${verdict ?`<div style="font-family:var(--D);font-size:16px;letter-spacing:1px;color:${verdictColor};">${verdict}</div>`: ''} </div> <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1px;background:var(--border);"> <div style="background:var(--card);padding:16px;text-align:center;"><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Atlas Value</div><div style="font-family:var(--D);font-size:30px;color:var(--blue);">$${atlasVal}</div></div> <div style="background:var(--card);padding:16px;text-align:center;"><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Max Buy</div><div style="font-family:var(--D);font-size:30px;color:var(--gold);">$${maxBuy}</div></div> <div style="background:var(--card);padding:16px;text-align:center;"><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Est. Profit</div><div style="font-family:var(--D);font-size:30px;color:var(--green);">$${estProfit}</div></div> </div> ${asking > 0 ?`
<div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;">
<span style="font-size:13px;">Seller asking</span><span style="font-family:var(--D);font-size:22px;color:${asking > maxBuy ? 'var(--red)':'var(--green)'};">$${asking}</span>
</div>`: ''} ${deds > 0 ?`
<div style="padding:12px 16px;border-bottom:1px solid var(--border);">
<div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:7px;">Deductions</div>
${calcDeds.back ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Cracked Back</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.06)}</span></div>` : ‚Äò‚Äô}
${calcDeds.lens ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Cracked Lens</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.05)}</span></div>` : ‚Äò‚Äô}
${calcDeds.batt ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Battery &lt;80%</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.08)}</span></div>` : ‚Äò‚Äô}
${calcDeds.rep ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Repair Message</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.10)}</span></div>` : ‚Äò‚Äô}
<div style="display:flex;justify-content:space-between;font-size:12px;margin-top:5px;padding-top:5px;border-top:1px solid var(--border);"><span>Net After Deductions</span><span style="color:var(--green);font-family:var(--M);">$${netAtlas}</span></div>
</div>`: ''} <div style="padding:14px 16px;"> <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:9px;">All Grades ‚Äî ${model} ${storage}</div> <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:4px;"> ${allGrades.map((x,i) =>`<div style="background:${i===gi?'rgba(232,192,74,.12)':'var(--card2)'};border:1px solid ${i===gi?'var(--gold)':'var(--border2)'};border-radius:2px;padding:8px 4px;text-align:center;cursor:pointer;" onclick="setGrade('${GRADE_KEYS[i]}',document.querySelectorAll('.cbtn')[${i}])">
<div style="font-family:var(--M);font-size:9px;color:${i===gi?'var(--gold)':'var(--muted)'};">${x.g}</div>
<div style="font-family:var(--D);font-size:18px;color:${i===gi?'var(--gold)':'var(--text)'};">$${x.v}</div>
</div>`).join('')} </div> </div> <div style="padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:8px;"> <button class="btn btn-gold" style="flex:1;" onclick="addLeadFromCalc('${model} ${storage}',${maxBuy})">+ Add as Lead</button> <button class="btn btn-ghost btn-sm" onclick="nav('prices')">Price Check</button> </div>`;
}

function addLeadFromCalc(device, maxBuy) {
document.getElementById(‚Äòl-device‚Äô).value = device;
document.getElementById(‚Äòl-offer‚Äô).value = maxBuy;
openModal(‚ÄòaddLead‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INVENTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveInventory() {
const device = document.getElementById(‚Äòi-device‚Äô).value.trim();
const paid = parseFloat(document.getElementById(‚Äòi-paid‚Äô).value) || 0;
if (!device) { toast(‚ÄòDevice name required‚Äô, ‚Äòerror‚Äô); return; }
const item = {
id: uid(), device,
cat: document.getElementById(‚Äòi-cat‚Äô).value,
paid,
target: parseFloat(document.getElementById(‚Äòi-target‚Äô).value) || 0,
cond: document.getElementById(‚Äòi-cond‚Äô).value,
sell: document.getElementById(‚Äòi-sell‚Äô).value,
imei: document.getElementById(‚Äòi-imei‚Äô).value.trim(),
notes: document.getElementById(‚Äòi-notes‚Äô).value.trim(),
added: new Date().toISOString()
};
ST.inventory.unshift(item);
save(); closeModal(‚ÄòaddInventory‚Äô); renderInventory(); toast(‚ÄòDevice added to inventory ‚úì‚Äô);
}

function renderInventory() {
const items = ST.inventory;
const em = document.getElementById(‚Äòinv-empty‚Äô);
document.getElementById(‚Äòinv-count‚Äô).textContent = items.length;
document.getElementById(‚Äòinv-invested‚Äô).textContent = fmtM(items.reduce((s, i) => s + i.paid, 0));
document.getElementById(‚Äòinv-profit-est‚Äô).textContent = fmtM(items.reduce((s, i) => s + Math.max(0, (i.target || 0) - i.paid), 0));
if (!items.length) { em.style.display = ‚Äò‚Äô; document.getElementById(‚Äòinv-grid‚Äô).innerHTML = ‚Äò‚Äô; return; }
em.style.display = ‚Äònone‚Äô;
document.getElementById(‚Äòinv-grid‚Äô).innerHTML = items.map(i => {
const pl = (i.target || 0) - i.paid;
return `<div class="inv-card"> <div style="font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-bottom:3px;">${i.cat}</div> <div style="font-weight:600;font-size:13px;">${i.device}</div> <div style="font-family:var(--M);font-size:10px;color:var(--muted);margin-top:1px;">${i.cond} ¬∑ ${i.sell}</div> <div style="font-family:var(--D);font-size:24px;color:var(--gold);margin-top:8px;">$${i.paid}</div> ${i.target ? `<div style="font-size:11px;margin-top:2px;color:${pl >= 0 ? 'var(--green)' : 'var(--red)'};">Target: $${i.target} (${pl >= 0 ? ‚Äò+‚Äô : ‚Äò‚Äô}$${pl})</div>`: ''} ${i.imei ?`<div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-top:5px;">${i.imei}</div>` : ''} <div style="display:flex;gap:5px;margin-top:10px;"> <button class="btn btn-green btn-sm" style="flex:1;" onclick="startSell('${i.id}')">Mark Sold</button> <button class="btn btn-danger btn-sm" onclick="delInventory('${i.id}')">‚úï</button> </div> </div>`;
}).join(‚Äô‚Äô);
}

function startSell(id) {
sellItemId = id;
document.getElementById(‚Äòs-price‚Äô).value = ‚Äò‚Äô;
document.getElementById(‚Äòs-buyer‚Äô).value = ‚Äò‚Äô;
document.getElementById(‚Äòs-date‚Äô).value = new Date().toISOString().split(‚ÄòT‚Äô)[0];
openModal(‚Äòsell‚Äô);
}

function confirmSell() {
const price = parseFloat(document.getElementById(‚Äòs-price‚Äô).value);
if (!price) { toast(‚ÄòEnter sale price‚Äô, ‚Äòerror‚Äô); return; }
const item = ST.inventory.find(i => i.id === sellItemId);
if (!item) return;
ST.sold.unshift({ ‚Ä¶item, soldFor: price, buyer: document.getElementById(‚Äòs-buyer‚Äô).value, soldDate: document.getElementById(‚Äòs-date‚Äô).value });
ST.inventory = ST.inventory.filter(i => i.id !== sellItemId);
save(); closeModal(‚Äòsell‚Äô); renderInventory(); renderProfits(); toast(`Sold for $${price} ‚Äî profit $${price - item.paid} üéâ`);
}

function delInventory(id) {
if (!confirm(‚ÄòRemove from inventory?‚Äô)) return;
ST.inventory = ST.inventory.filter(i => i.id !== id);
save(); renderInventory(); toast(‚ÄòRemoved‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ALERTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveAlert() {
const device = document.getElementById(‚Äòa-device‚Äô).value.trim();
if (!device) { toast(‚ÄòDevice name required‚Äô, ‚Äòerror‚Äô); return; }
ST.alerts.unshift({ id: uid(), device, maxPrice: parseFloat(document.getElementById(‚Äòa-maxprice‚Äô).value) || 0, platform: document.getElementById(‚Äòa-platform‚Äô).value, added: new Date().toISOString() });
save(); closeModal(‚ÄòaddAlert‚Äô); renderAlerts(); counts(); toast(‚ÄòAlert set ‚úì‚Äô);
}

function renderAlerts() {
const banner = document.getElementById(‚Äòemail-banner‚Äô);
if (banner) banner.style.display = (KEYS.svc && KEYS.tmpl && KEYS.pubkey) ? ‚Äòflex‚Äô : ‚Äònone‚Äô;
const mon = document.getElementById(‚Äòalert-monitors‚Äô);
mon.innerHTML = ST.alerts.length ? ST.alerts.map(a => ` <div class="alert-item alert-hot"> <div style="font-size:18px;">üîî</div> <div style="flex:1;"> <div style="font-weight:500;font-size:13px;">${a.device}</div> <div style="font-size:11px;color:var(--muted);">${a.platform} ¬∑ Max $${a.maxPrice || 'Any'}</div> </div> <div style="display:flex;gap:6px;"> <a href="https://www.facebook.com/marketplace/search/?query=${encodeURIComponent(a.device)}" target="_blank" class="btn btn-ghost btn-sm">Search ‚Üí</a> <button class="btn btn-danger btn-sm" onclick="delAlert('${a.id}')">‚úï</button> </div> </div>`).join(‚Äô‚Äô) : ‚Äò<div style="color:var(--muted);font-size:12px;padding:8px 0;">No monitors set yet</div>‚Äô;

// Demo hits
document.getElementById(‚Äòalert-hits‚Äô).innerHTML = ` <div class="alert-item"><div style="font-size:16px;">üì±</div><div style="flex:1;"><div style="font-weight:500;font-size:13px;">iPhone 14 Pro ‚Äî $340 (demo)</div><div style="font-size:11px;color:var(--muted);">FB Marketplace ¬∑ 2h ago</div></div><a href="https://www.facebook.com/marketplace" target="_blank" class="btn btn-teal btn-sm">View ‚Üí</a></div> <div class="alert-item"><div style="font-size:16px;">üéÆ</div><div style="flex:1;"><div style="font-weight:500;font-size:13px;">PS5 Disc ‚Äî $280 (demo)</div><div style="font-size:11px;color:var(--muted);">Craigslist ¬∑ 5h ago</div></div><a href="https://craigslist.org" target="_blank" class="btn btn-teal btn-sm">View ‚Üí</a></div>`;
}

function delAlert(id) { ST.alerts = ST.alerts.filter(a => a.id !== id); save(); renderAlerts(); counts(); toast(‚ÄòAlert removed‚Äô); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PROFITS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProfits() {
const rev = ST.sold.reduce((s, x) => s + (x.soldFor || 0), 0);
const spent = ST.sold.reduce((s, x) => s + (x.paid || 0), 0);
const net = rev - spent;
const avg = ST.sold.length ? Math.round(net / ST.sold.length) : 0;
document.getElementById(‚Äòpr-rev‚Äô).textContent = fmtM(rev);
document.getElementById(‚Äòpr-spent‚Äô).textContent = fmtM(spent);
document.getElementById(‚Äòpr-net‚Äô).textContent = fmtM(net);
document.getElementById(‚Äòpr-avg‚Äô).textContent = fmtM(avg);
const tb = document.getElementById(‚Äòprofits-tbody‚Äô);
const em = document.getElementById(‚Äòprofits-empty‚Äô);
if (!ST.sold.length) { tb.innerHTML = ‚Äò‚Äô; em.style.display = ‚Äò‚Äô; return; }
em.style.display = ‚Äònone‚Äô;
tb.innerHTML = ST.sold.map(x => {
const pl = (x.soldFor || 0) - (x.paid || 0);
return `<tr> <td><div style="font-weight:500;">${x.device}</div><div style="font-size:10px;color:var(--muted);">${x.cat}</div></td> <td style="font-family:var(--M);color:var(--red);font-size:12px;">$${x.paid}</td> <td style="font-family:var(--M);color:var(--gold);font-size:12px;">$${x.soldFor}</td> <td style="font-family:var(--M);color:${pl>=0?'var(--green)':'var(--red)'};font-size:12px;">${pl>=0?'+':''}$${pl}</td> <td class="hm" style="font-size:11px;color:var(--muted);">${x.soldDate || '‚Äî'}</td> <td class="hm" style="font-size:11px;color:var(--muted);">${x.buyer || '‚Äî'}</td> </tr>`;
}).join(‚Äô‚Äô);
}

function exportProfits() {
const rows = [[‚ÄòDevice‚Äô,‚ÄòCat‚Äô,‚ÄòPaid‚Äô,‚ÄòSold For‚Äô,‚ÄòProfit‚Äô,‚ÄòDate‚Äô,‚ÄòBuyer‚Äô]];
ST.sold.forEach(x => rows.push([x.device, x.cat, x.paid, x.soldFor, (x.soldFor||0)-(x.paid||0), x.soldDate, x.buyer]));
dlCSV(‚Äòprofits.csv‚Äô, rows);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadSettingsUI() {
document.getElementById(‚Äòs-ebay‚Äô).value = KEYS.ebay || ‚Äò‚Äô;
document.getElementById(‚Äòs-email‚Äô).value = KEYS.email || ‚Äò‚Äô;
document.getElementById(‚Äòs-svc‚Äô).value = KEYS.svc || ‚Äò‚Äô;
document.getElementById(‚Äòs-tmpl‚Äô).value = KEYS.tmpl || ‚Äò‚Äô;
document.getElementById(‚Äòs-pubkey‚Äô).value = KEYS.pubkey || ‚Äò‚Äô;
updateKS();
}

function updateKS() {
const ek = document.getElementById(‚Äòebay-ks‚Äô);
if (ek) { ek.className = ‚Äôks ‚Äô + (KEYS.ebay ? ‚Äòok‚Äô : ‚Äòmissing‚Äô); ek.textContent = KEYS.ebay ? ‚Äò‚óè Connected‚Äô : ‚Äò‚óè Not set‚Äô; }
const emk = document.getElementById(‚Äòemail-ks‚Äô);
if (emk) { const ok = KEYS.svc && KEYS.tmpl && KEYS.pubkey; emk.className = ‚Äôks ‚Äô + (ok ? ‚Äòok‚Äô : ‚Äòmissing‚Äô); emk.textContent = ok ? ‚Äò‚óè Configured‚Äô : ‚Äò‚óè Not configured‚Äô; }
}

function saveEbayKey() {
KEYS.ebay = document.getElementById(‚Äòs-ebay‚Äô).value.trim();
saveKeys(); updateKS(); toast(‚ÄòeBay key saved üîë‚Äô);
}

async function testEbay() {
if (!KEYS.ebay) { toast(‚ÄòAdd your eBay key first‚Äô, ‚Äòerror‚Äô); return; }
toast(‚ÄòTesting‚Ä¶‚Äô, ‚Äòinfo‚Äô);
const token = await getEbayToken();
toast(token ? ‚ÄòeBay API connected ‚úì‚Äô : ‚ÄòConnection failed ‚Äî check your App ID‚Äô, token ? ‚Äòsuccess‚Äô : ‚Äòerror‚Äô);
}

function saveEmailKeys() {
KEYS.email = document.getElementById(‚Äòs-email‚Äô).value.trim();
KEYS.svc = document.getElementById(‚Äòs-svc‚Äô).value.trim();
KEYS.tmpl = document.getElementById(‚Äòs-tmpl‚Äô).value.trim();
KEYS.pubkey = document.getElementById(‚Äòs-pubkey‚Äô).value.trim();
saveKeys(); updateKS();
if (KEYS.pubkey) { try { emailjs.init(KEYS.pubkey); } catch(e) {} }
toast(‚ÄòEmail settings saved ‚úì‚Äô);
}

async function testEmail() {
if (!KEYS.svc || !KEYS.tmpl || !KEYS.pubkey) { toast(‚ÄòSet up EmailJS keys first‚Äô, ‚Äòerror‚Äô); return; }
try {
await emailjs.send(KEYS.svc, KEYS.tmpl, { to_email: KEYS.email, subject: ‚ÄòTrey Buyback ‚Äî Test Alert üîî‚Äô, message: ‚ÄòYour email alerts are working! You will receive deal notifications here.‚Äô });
toast(‚ÄòTest email sent! Check your inbox ‚úâ‚Äô);
} catch(e) { toast(‚ÄòEmail failed ‚Äî check your keys‚Äô, ‚Äòerror‚Äô); console.error(e); }
}

async function sendDealAlert(device, price, platform, link) {
if (!KEYS.svc || !KEYS.tmpl || !KEYS.pubkey || !KEYS.email) return;
try { await emailjs.send(KEYS.svc, KEYS.tmpl, { to_email: KEYS.email, subject: `üîî Deal Alert: ${device} at $${price}`, message: `Device: ${device}\nPrice: $${price}\nPlatform: ${platform}\nLink: ${link}` }); }
catch(e) { console.log(‚ÄòAlert email failed‚Äô, e); }
}

function exportAll() {
const data = JSON.stringify({ leads: ST.leads, inventory: ST.inventory, alerts: ST.alerts, sold: ST.sold, exported: new Date().toISOString() }, null, 2);
const a = document.createElement(‚Äòa‚Äô);
a.href = URL.createObjectURL(new Blob([data], { type: ‚Äòapplication/json‚Äô }));
a.download = ‚Äòtreybuyback-backup.json‚Äô; a.click();
toast(‚ÄòData exported ‚úì‚Äô);
}

function clearAll() {
if (!confirm(‚ÄòDelete ALL data? This cannot be undone.‚Äô)) return;
ST = { leads: [], inventory: [], alerts: [], sold: [] };
save(); renderDash(); counts(); toast(‚ÄòAll data cleared‚Äô, ‚Äòerror‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PLAYBOOK HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pbTab(id) {
document.querySelectorAll(‚Äô.pb-sec‚Äô).forEach(s => s.classList.remove(‚Äòactive‚Äô));
document.querySelectorAll(‚Äô.pb-tab‚Äô).forEach(t => t.classList.remove(‚Äòactive‚Äô));
document.getElementById(‚Äòpb-‚Äô + id).classList.add(‚Äòactive‚Äô);
event.target.classList.add(‚Äòactive‚Äô);
}

function tft(id) {
const el = document.getElementById(id);
el.classList.toggle(‚Äòopen‚Äô);
}

function tsc(el) {
const body = el.nextElementSibling;
body.classList.toggle(‚Äòopen‚Äô);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CSV EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function dlCSV(filename, rows) {
const csv = rows.map(r => r.map(v => `"${(v||'').toString().replace(/"/g,'""')}"`).join(‚Äô,‚Äô)).join(‚Äô\n‚Äô);
const a = document.createElement(‚Äòa‚Äô);
a.href = URL.createObjectURL(new Blob([csv], { type: ‚Äòtext/csv‚Äô }));
a.download = filename; a.click();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
init();
</script>

</body>
</html>

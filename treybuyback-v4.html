<!DOCTYPE html>
tps://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" onerror="window.emailjs={init:()=>{},send:()=>Promise.reject('EmailJS not loaded')}"></script>
<order2:#282828;
  --gold:#e8c04a;--gold2:#f5d98a;--green:#3ddc84;--red:#ff4545;
  --blue:#4a9eff;--purple:#a855f7;--orange:#ff8c42;--teal:#2dd4bf;
  --text:#f0f0f0;--muted:#555;--sub:#1e1e1e;
  --D:'Bebas Neue',sans-serif;--M:'DM Mono',monospace;--S:'DM Sans',sans-serif
}
html,body{height:100%;height:-webkit-fill-available}
body{background:var(--bg);color:var(--text);font-family:var(--S);display:flex;flex-direction:column;overflow:hidden;-webkit-tap-highlight-color:transparent}

/* Button reset for converted interactive elements */
button.nav-item,button.mob-item,button.ai-mode-btn,button.ecat,button.pb-tab,button.scard-h{
background:none;-webkit-appearance:none;appearance:none;font-family:inherit;
border-right:none;border-top:none;border-bottom:none;width:100%;text-align:left;
}
button.ecat,button.pb-tab{background:none;border-left:none;width:auto;}
button.scard-h{width:100%;border-left:none;}
button.ai-mode-btn{width:100%;border:1px solid var(â€“border);}
/* topbar */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:0 16px;height:50px;background:var(â€“dark);border-bottom:1px solid var(â€“border);flex-shrink:0;z-index:50}
.logo{font-family:var(â€“D);font-size:22px;letter-spacing:2px;color:var(â€“gold)}
.logo span{color:var(â€“text)}
.top-right{display:flex;align-items:center;gap:10px}
.badge{font-family:var(â€“M);font-size:9px;background:rgba(232,192,74,.1);border:1px solid rgba(232,192,74,.3);color:var(â€“gold);padding:3px 8px;border-radius:2px;letter-spacing:1px}
.icon-btn{background:none;border:1px solid var(â€“border2);border-radius:2px;color:var(â€“muted);cursor:pointer;padding:5px 9px;font-size:14px}
.icon-btn:hover{color:var(â€“text);border-color:#444}
#topDate{font-size:11px;color:var(â€“muted)}
/* layout */
.shell{display:flex;flex:1;overflow:hidden}
.sidebar{width:190px;background:var(â€“dark);border-right:1px solid var(â€“border);display:flex;flex-direction:column;flex-shrink:0;overflow-y:auto}
.nav-section{padding:14px 12px 3px;font-family:var(â€“M);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(â€“muted)}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 13px;cursor:pointer;font-size:13px;color:#888;border-left:2px solid transparent;transition:all .1s;user-select:none}
.nav-item:hover{background:rgba(255,255,255,.03);color:var(â€“text)}
.nav-item.active{background:rgba(232,192,74,.07);color:var(â€“gold);border-left-color:var(â€“gold)}
.nav-icon{font-size:14px;width:16px;text-align:center}
.nc{margin-left:auto;font-family:var(â€“M);font-size:10px;background:var(â€“sub);color:var(â€“muted);padding:2px 6px;border-radius:10px}
.nc.hot{background:rgba(255,69,69,.2);color:var(â€“red)}
.nc.ai{background:rgba(168,85,247,.2);color:var(â€“purple)}
.nc.live{background:rgba(45,212,191,.2);color:var(â€“teal)}
/* mobile nav */
.mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;height:54px;background:var(â€“dark);border-top:1px solid var(â€“border);z-index:100;flex-direction:row}
.mob-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer;color:var(â€“muted);font-size:8px;font-family:var(â€“M);letter-spacing:1px;text-transform:uppercase;border-top:2px solid transparent;transition:all .1s;background:none;border-left:none;border-right:none;border-bottom:none;padding:4px 0;-webkit-appearance:none;appearance:none}
.mob-item.active{color:var(â€“gold);border-top-color:var(â€“gold)}
.mob-item .mi{font-size:17px}
/* pages */
.main{flex:1;overflow-y:auto;display:flex;flex-direction:column}
.page{display:none;flex:1;flex-direction:column}
.page.active{display:flex}
/* page header */
.ph{padding:14px 16px 12px;border-bottom:1px solid var(â€“border);display:flex;align-items:flex-start;justify-content:space-between;flex-shrink:0;gap:10px}
.pt{font-family:var(â€“D);font-size:24px;letter-spacing:1px}
.ps{font-size:11px;color:var(â€“muted);margin-top:1px;font-family:var(â€“M)}
.ha{display:flex;gap:7px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end}
/* buttons */
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:2px;border:none;cursor:pointer;font-family:var(â€“S);font-size:13px;font-weight:500;transition:all .1s;white-space:nowrap}
.btn-gold{background:var(â€“gold);color:#000}
.btn-gold:hover{background:var(â€“gold2)}
.btn-ghost{background:transparent;border:1px solid var(â€“border2);color:var(â€“text)}
.btn-ghost:hover{border-color:#444}
.btn-purple{background:rgba(168,85,247,.15);border:1px solid rgba(168,85,247,.3);color:var(â€“purple)}
.btn-teal{background:rgba(45,212,191,.15);border:1px solid rgba(45,212,191,.3);color:var(â€“teal)}
.btn-teal:hover{background:rgba(45,212,191,.25)}
.btn-sm{padding:5px 10px;font-size:12px}
.btn-danger{background:rgba(255,69,69,.1);border:1px solid rgba(255,69,69,.25);color:var(â€“red)}
.btn-green{background:rgba(61,220,132,.1);border:1px solid rgba(61,220,132,.25);color:var(â€“green)}
/* stats */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:12px 16px;flex-shrink:0}
.sc{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:13px 14px}
.sl{font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:5px}
.sv{font-family:var(â€“D);font-size:30px;letter-spacing:1px;line-height:1}
.sv.gold{color:var(â€“gold)}.sv.green{color:var(â€“green)}.sv.red{color:var(â€“red)}.sv.blue{color:var(â€“blue)}
/* content */
.ca{padding:0 16px 80px;flex:1;overflow-y:auto}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px}
.panel{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:14px}
.panel-title{font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:10px;display:flex;align-items:center;justify-content:space-between}
/* table */
.tw{padding:0 16px 80px;flex:1;overflow-y:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);padding:8px 10px;text-align:left;border-bottom:1px solid var(â€“border);background:var(â€“bg);white-space:nowrap}
tbody tr{border-bottom:1px solid var(â€“border);transition:background .1s;cursor:pointer}
tbody tr:hover{background:rgba(255,255,255,.02)}
td{padding:9px 10px;vertical-align:middle}
/* pills */
.pill{display:inline-block;padding:2px 8px;border-radius:2px;font-size:9px;font-family:var(â€“M);letter-spacing:1px;text-transform:uppercase}
.p-new{background:rgba(74,158,255,.12);color:var(â€“blue);border:1px solid rgba(74,158,255,.25)}
.p-active{background:rgba(232,192,74,.1);color:var(â€“gold);border:1px solid rgba(232,192,74,.25)}
.p-closed{background:rgba(61,220,132,.1);color:var(â€“green);border:1px solid rgba(61,220,132,.25)}
.p-lost{background:rgba(255,69,69,.1);color:var(â€“red);border:1px solid rgba(255,69,69,.25)}
.p-follow{background:rgba(168,85,247,.1);color:var(â€“purple);border:1px solid rgba(168,85,247,.25)}
/* forms */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:9px}
.form-row.single{grid-template-columns:1fr}
.field label{display:block;font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:4px}
.field input,.field select,.field textarea{width:100%;background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;color:var(â€“text);font-family:var(â€“M);font-size:12px;padding:8px 10px;outline:none;transition:border-color .1s;-webkit-appearance:none;appearance:none}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(â€“gold)}
.field select{background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜10â€™ height=â€˜6â€™%3E%3Cpath d=â€˜M1 1l4 4 4-4â€™ stroke=â€™%23555â€™ stroke-width=â€˜1.5â€™ fill=â€˜noneâ€™ stroke-linecap=â€˜roundâ€™/%3E%3C/svg%3Eâ€);background-repeat:no-repeat;background-position:right 9px center;padding-right:26px}
.field textarea{resize:vertical;min-height:65px}
/* modals */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:200;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(3px)}
.overlay.open{display:flex}
.modal{background:var(â€“card);border:1px solid var(â€“border2);border-radius:2px 2px 0 0;width:100%;max-width:580px;max-height:93vh;overflow-y:auto;animation:slideUp .2s ease}
@keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
.mh{padding:14px 16px;border-bottom:1px solid var(â€“border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(â€“card);z-index:2}
.mt{font-family:var(â€“D);font-size:20px;letter-spacing:1px}
.mc{background:none;border:none;color:var(â€“muted);cursor:pointer;font-size:20px;line-height:1;padding:0 4px}
.mb{padding:16px}
.mf{padding:12px 16px;border-top:1px solid var(â€“border);display:flex;justify-content:flex-end;gap:8px;position:sticky;bottom:0;background:var(â€“card)}
/* pipeline */
.pipeline{display:grid;grid-template-columns:repeat(5,minmax(145px,1fr));gap:8px;padding:0 16px 80px;flex:1;overflow-x:auto}
.pipe-col{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;display:flex;flex-direction:column;min-width:145px}
.pipe-head{padding:9px 11px;border-bottom:1px solid var(â€“border);font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;justify-content:space-between}
.pipe-cards{padding:7px;display:flex;flex-direction:column;gap:6px;flex:1;overflow-y:auto;min-height:100px}
.pipe-card{background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;padding:9px 10px;cursor:pointer}
.pipe-card:hover{border-color:#333}
/* ai */
.ai-wrap{display:flex;flex-direction:column;flex:1;overflow:hidden;padding:0 16px 80px}
.ai-modes{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px;flex-shrink:0}
.ai-mode-btn{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:10px 8px;cursor:pointer;text-align:center;transition:all .1s}
.ai-mode-btn.active{border-color:var(â€“purple);background:rgba(168,85,247,.07)}
.ai-mode-icon{font-size:18px;margin-bottom:3px}
.ai-mode-label{font-family:var(â€“M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(â€“muted)}
.ai-mode-btn.active .ai-mode-label{color:var(â€“purple)}
.ai-chat{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:10px;margin-bottom:10px;padding:2px 0}
.ai-msg{display:flex;gap:8px;align-items:flex-start}
.ai-msg.user{flex-direction:row-reverse}
.ai-av{width:26px;height:26px;border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.ai-av.bot{background:rgba(168,85,247,.18);border:1px solid rgba(168,85,247,.3)}
.ai-av.user{background:var(â€“gold);color:#000;font-family:var(â€“D);font-size:13px}
.ai-bubble{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:10px 12px;font-size:13px;line-height:1.75;max-width:86%}
.ai-bubble.user{background:rgba(232,192,74,.07);border-color:rgba(232,192,74,.2)}
.ai-bubble.bot{border-left:2px solid var(â€“purple)}
.ai-bubble strong{color:var(â€“gold)}
.ai-sline{background:var(â€“card2);border-left:2px solid var(â€“green);padding:7px 10px;margin:5px 0;font-size:12px;color:#b8f0d0;line-height:1.65}
.ai-qbtns{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:9px;flex-shrink:0}
.ai-qbtn{background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;color:#888;font-size:11px;font-family:var(â€“M);padding:4px 9px;cursor:pointer}
.ai-qbtn:hover{border-color:var(â€“purple);color:var(â€“purple)}
.ai-row{display:flex;gap:7px;flex-shrink:0}
.ai-input{flex:1;background:var(â€“card);border:1px solid var(â€“border2);border-radius:2px;color:var(â€“text);font-family:var(â€“S);font-size:13px;padding:9px 12px;outline:none;resize:none}
.ai-input:focus{border-color:var(â€“purple)}
.ai-send{background:var(â€“purple);border:none;border-radius:2px;color:#fff;padding:9px 14px;cursor:pointer;font-size:15px;flex-shrink:0}
.ai-send:disabled{opacity:.4;cursor:not-allowed}
.dots span{display:inline-block;width:4px;height:4px;border-radius:50%;background:var(â€“purple);animation:dot 1.2s infinite;margin:0 1px}
.dots span:nth-child(2){animation-delay:.2s}.dots span:nth-child(3){animation-delay:.4s}
@keyframes dot{0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1}}
/* price checker */
.pc-wrap{padding:0 16px 80px;flex:1;overflow-y:auto}
.search-bar{display:flex;gap:7px;margin-bottom:12px;flex-wrap:wrap}
.search-bar input{flex:1;min-width:180px;background:var(â€“card);border:1px solid var(â€“border2);border-radius:2px;color:var(â€“text);font-family:var(â€“M);font-size:13px;padding:10px 12px;outline:none}
.search-bar input:focus{border-color:var(â€“teal)}
.search-bar select{background:var(â€“card);border:1px solid var(â€“border2);border-radius:2px;color:var(â€“text);font-family:var(â€“M);font-size:12px;padding:9px 26px 9px 11px;outline:none;-webkit-appearance:none;appearance:none;background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜10â€™ height=â€˜6â€™%3E%3Cpath d=â€˜M1 1l4 4 4-4â€™ stroke=â€™%23555â€™ stroke-width=â€˜1.5â€™ fill=â€˜noneâ€™ stroke-linecap=â€˜roundâ€™/%3E%3C/svg%3Eâ€);background-repeat:no-repeat;background-position:right 9px center}
.cat-tabs{display:flex;border-bottom:1px solid var(â€“border);margin-bottom:12px;overflow-x:auto}
.ecat{padding:8px 13px;font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap}
.ecat.active{color:var(â€“teal);border-bottom-color:var(â€“teal)}
.price-hero{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(â€“border);border:1px solid var(â€“border);border-radius:2px;overflow:hidden;margin-bottom:12px}
.ph-cell{background:var(â€“card);padding:16px 14px}
.ph-label{font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);margin-bottom:5px}
.ph-val{font-family:var(â€“D);font-size:34px;letter-spacing:1px}
.ph-val.gold{color:var(â€“gold)}.ph-val.green{color:var(â€“green)}.ph-val.orange{color:var(â€“orange)}
.ph-sub{font-size:10px;color:var(â€“muted);margin-top:3px}
.ext-links{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.ext-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:12px;text-align:center;text-decoration:none;display:block;transition:all .1s}
.ext-card:hover{border-color:#333;background:var(â€“card2)}
.ext-icon{font-size:20px;margin-bottom:4px}
.ext-label{font-family:var(â€“M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(â€“text)}
.ext-sub{font-size:10px;color:var(â€“muted);margin-top:2px}
.listing-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:12px 13px;margin-bottom:7px;display:flex;align-items:flex-start;gap:11px}
.listing-card:hover{border-color:#2a2a2a}
.listing-thumb{width:48px;height:48px;border-radius:2px;object-fit:cover;background:var(â€“card2);flex-shrink:0;border:1px solid var(â€“border)}
.listing-info{flex:1;min-width:0}
.listing-title{font-size:13px;font-weight:500;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.listing-title a{color:var(â€“text);text-decoration:none}
.listing-title a:hover{color:var(â€“gold)}
.listing-meta{font-family:var(â€“M);font-size:10px;color:var(â€“muted)}
.listing-net{font-family:var(â€“M);font-size:11px;color:var(â€“green);margin-top:3px}
.listing-price{text-align:right;flex-shrink:0}
.lp-amt{font-family:var(â€“D);font-size:26px;color:var(â€“gold)}
.lp-net{font-family:var(â€“M);font-size:10px;color:var(â€“green)}
.plat-tag{font-family:var(â€“M);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:1px;display:inline-block;margin-top:3px}
.pt-ebay{background:rgba(232,192,74,.1);color:var(â€“gold);border:1px solid rgba(232,192,74,.2)}
.pt-swappa{background:rgba(61,220,132,.1);color:var(â€“green);border:1px solid rgba(61,220,132,.2)}
.pt-fb{background:rgba(74,158,255,.1);color:var(â€“blue);border:1px solid rgba(74,158,255,.2)}
.fee-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(â€“border);font-size:13px}
.fee-row:last-child{border-bottom:none}
.fee-key{color:#999}
.fee-val{font-family:var(â€“M);font-size:12px}
/* toggle */
.tog{width:32px;height:17px;background:var(â€“card2);border:1px solid var(â€“border2);border-radius:9px;cursor:pointer;position:relative;transition:background .15s;flex-shrink:0}
.tog span{position:absolute;width:11px;height:11px;background:var(â€“muted);border-radius:50%;top:2px;left:2px;transition:all .15s;display:block}
.tog.on{background:var(â€“red);border-color:var(â€“red)}
.tog.on span{left:17px;background:#fff}
/* inventory */
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(185px,1fr));gap:9px}
.inv-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:12px}
/* followups */
.fu-item{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:11px 13px;margin-bottom:7px;display:flex;align-items:center;gap:11px}
.fu-av{width:32px;height:32px;border-radius:2px;background:var(â€“gold);display:flex;align-items:center;justify-content:center;font-family:var(â€“D);font-size:14px;color:#000;flex-shrink:0}
/* playbook */
.pb-wrap{padding:0 16px 80px;flex:1;overflow-y:auto}
.pb-tabs{display:flex;border-bottom:1px solid var(â€“border);margin-bottom:12px;overflow-x:auto}
.pb-tab{padding:8px 13px;font-family:var(â€“M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(â€“muted);cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap}
.pb-tab.active{color:var(â€“gold);border-bottom-color:var(â€“gold)}
.pb-sec{display:none}.pb-sec.active{display:block}
.funnel{display:flex;flex-direction:column;align-items:center;margin:14px 0}
.funnel-step{width:100%;max-width:460px;padding:13px 20px;text-align:center;cursor:pointer}
.fs-title{font-family:var(â€“D);font-size:22px;letter-spacing:2px;color:#000}
.fs-sub{font-size:11px;color:rgba(0,0,0,.6);margin-top:1px}
.f1{background:#4a8fd4;clip-path:polygon(0 0,100% 0,90% 100%,10% 100%)}
.f2{background:#6aaa6a;clip-path:polygon(10% 0,90% 0,80% 100%,20% 100%);margin-top:-1px}
.f3{background:#d4854a;clip-path:polygon(20% 0,80% 0,70% 100%,30% 100%);margin-top:-1px}
.f4{background:#d4b840;clip-path:polygon(30% 0,70% 0,60% 100%,40% 100%);margin-top:-1px}
.ftip{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:12px;margin-top:8px;display:none}
.ftip.open{display:block}
.scard{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;margin-bottom:7px;overflow:hidden}
.scard-h{padding:10px 13px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;background:var(â€“card2)}
.scard-b{display:none;padding:13px}
.scard-b.open{display:block}
.smsg{background:var(â€“card2);border-left:2px solid var(â€“gold);padding:8px 11px;margin:6px 0;font-size:13px;color:var(â€“gold2);line-height:1.7}
.smsg.good{border-left-color:var(â€“green);color:#b8f0d0}
.snote{font-size:12px;color:var(â€“muted);line-height:1.6;margin:5px 0}
.obj-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:13px;margin-bottom:8px}
.obj-sit{font-family:var(â€“M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(â€“orange);margin-bottom:6px}
.obj-ex{background:rgba(255,140,66,.07);border:1px solid rgba(255,140,66,.2);border-radius:2px;padding:8px 11px;font-size:13px;color:#e0a070;margin-bottom:8px;font-style:italic}
.obj-res{background:rgba(61,220,132,.07);border-left:2px solid var(â€“green);padding:8px 11px;font-size:13px;color:#b0f0d0;line-height:1.7;margin-bottom:6px}
.apr-step{display:flex;gap:11px;margin-bottom:13px;align-items:flex-start}
.apr-num{width:24px;height:24px;border-radius:2px;background:var(â€“gold);color:#000;font-family:var(â€“D);font-size:15px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.apr-content h4{font-size:13px;font-weight:600;margin-bottom:2px}
.apr-content p{font-size:12px;color:#999;line-height:1.7}
.tip-box{background:rgba(74,158,255,.07);border:1px solid rgba(74,158,255,.2);border-radius:2px;padding:7px 10px;font-size:11px;color:#90c4ff;margin-top:5px}
.buyer-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(â€“border)}
.buyer-row:last-child{border-bottom:none}
/* settings */
.set-sec{margin-bottom:20px}
.set-sec-title{font-family:var(â€“M);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(â€“muted);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(â€“border)}
.key-input{width:100%;background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;color:var(â€“text);font-family:var(â€“M);font-size:11px;padding:8px 10px;outline:none;margin-top:5px}
.key-input:focus{border-color:var(â€“gold)}
.ks{display:inline-flex;align-items:center;gap:5px;font-family:var(â€“M);font-size:10px;padding:3px 9px;border-radius:2px;margin-top:6px}
.ks.ok{background:rgba(61,220,132,.1);color:var(â€“green);border:1px solid rgba(61,220,132,.25)}
.ks.missing{background:rgba(255,69,69,.1);color:var(â€“red);border:1px solid rgba(255,69,69,.25)}
/* alerts */
.alert-item{background:var(â€“card);border:1px solid var(â€“border);border-radius:2px;padding:10px 12px;margin-bottom:7px;display:flex;align-items:flex-start;gap:10px}
.alert-hot{border-left:2px solid var(â€“gold)}
/* misc */
.empty{text-align:center;padding:45px 20px;color:var(â€“muted);font-family:var(â€“M);font-size:11px;letter-spacing:1px}
.empty-icon{font-size:28px;margin-bottom:8px;opacity:.3}
.toast{position:fixed;bottom:66px;right:14px;background:var(â€“card2);border:1px solid var(â€“border2);border-radius:2px;padding:9px 14px;font-size:12px;z-index:300;transform:translateY(8px);opacity:0;transition:all .18s;pointer-events:none;max-width:280px}
.toast.show{transform:translateY(0);opacity:1}
.toast.success{border-left:2px solid var(â€“green)}.toast.error{border-left:2px solid var(â€“red)}.toast.info{border-left:2px solid var(â€“teal)}
/* iOS Safari click fix â€” clicks donâ€™t fire on divs without this */
[onclick],[onclick]{cursor:pointer}
.nav-item,.mob-item,.pipe-card,.fu-item,.alert-item,.inv-card,.scard-h,.faq-q,.ecat,.pb-tab,.ai-mode-btn,.ai-qbtn,.funnel-step,.cbtn,.buyer-row,.listing-card,.tog,.ext-card{cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);}
::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(â€“sub);border-radius:2px}
@media(max-width:768px){
.sidebar{display:none}.mob-nav{display:flex}
.stats-row{grid-template-columns:1fr 1fr;gap:7px;padding:10px 12px}
.sv{font-size:26px}
.two-col,.three-col{grid-template-columns:1fr}
.ca,.tw,.pb-wrap,.pc-wrap,.ai-wrap{padding-left:12px;padding-right:12px}
.pipeline{padding:0 12px 80px}
.form-row{grid-template-columns:1fr}
.hm{display:none}
.inv-grid{grid-template-columns:1fr 1fr}
.price-hero{grid-template-columns:1fr 1fr}
.ext-links{grid-template-columns:repeat(3,1fr)}
.toast{bottom:62px;right:10px;left:10px;max-width:none}
}
@media(max-width:480px){
.ai-modes{grid-template-columns:repeat(2,1fr)}
.inv-grid{grid-template-columns:1fr}
.price-hero{grid-template-columns:1fr}
.ext-links{grid-template-columns:1fr 1fr}
.search-bar{flex-direction:column}
#calc-grid{grid-template-columns:1fr!important}
}
</style>

</head>
<body onclick="void(0)">

<!-- â•â• DEBUG HUD â€” remove after fix is confirmed â•â• -->

<div id="dbg" style="position:fixed;top:60px;left:8px;right:8px;z-index:999999;background:rgba(0,0,0,.97);border:2px solid #e8c04a;border-radius:4px;font-family:monospace;font-size:12px;color:#e8c04a;padding:10px;pointer-events:none;max-height:50vh;overflow-y:auto;">
  <div style="display:flex;justify-content:space-between;margin-bottom:6px;border-bottom:1px solid #333;padding-bottom:6px;">
    <strong>ğŸ” DEBUG HUD â€” tap nav tabs after loading</strong>
    <span id="dbg-close" style="color:#fff;pointer-events:auto;cursor:pointer;padding:0 6px;font-size:16px;" ontouchend="document.getElementById('dbg').remove()" onclick="document.getElementById('dbg').remove()">âœ•</span>
  </div>
  <div id="dbg-log" style="color:#ccc;line-height:1.8;"></div>
  <button onclick="log('âœ… BUTTON TAP WORKS â€” onclick fires!','#3ddc84')" ontouchend="log('âœ… BUTTON TOUCHEND WORKS!','#3ddc84')" style="margin-top:8px;width:100%;background:#e8c04a;color:#000;border:none;border-radius:4px;padding:12px;font-size:14px;font-weight:bold;pointer-events:auto;cursor:pointer;">ğŸ‘† TAP THIS TO TEST TAPS</button>
<script>
(function(){
  var L=document.getElementById('dbg-log');
  function log(msg,color){
    var d=document.createElement('div');
    d.style.color=color||'#aaa';
    d.textContent=(new Date().toISOString().slice(11,19))+' '+msg;
    L.appendChild(d);
    L.scrollTop=L.scrollHeight;
  }

// TEST 1 â€” JS loaded?
log(â€˜âœ… JS loaded & runningâ€™,â€™#3ddc84â€™);

// TEST 2 â€” nav() check AFTER page fully loads (was checking too early before)
window.addEventListener(â€˜loadâ€™, function() {
log(typeof window.nav===â€˜functionâ€™ ? â€˜âœ… nav() defined after loadâ€™ : â€˜âŒ nav() MISSING after load â€” real JS crashâ€™,â€™#e8c04aâ€™);
// TEST 2b â€” try calling nav directly
try {
if (typeof window.nav === â€˜functionâ€™) log(â€˜âœ… nav() callableâ€™,â€™#3ddc84â€™);
} catch(x) { log(â€˜âŒ nav() throws: â€˜+x.message,â€™#ff4545â€™); }
});

// TEST 3 â€” Tap detection (capture phase â€” catches even blocked taps)
var tapCount=0;
document.addEventListener(â€˜touchstartâ€™,function(e){
tapCount++;
var el=e.target;
var tag=el.tagName+(el.id?â€™#â€™+el.id:el.className?â€™ .â€™+el.className.toString().split(â€™ â€˜)[0]:â€™â€™);
log(â€˜ğŸ‘† touchstart #â€™+tapCount+â€™ on <â€™+tag+â€™>â€™,â€™#4a9effâ€™);
},{capture:true,passive:true});

document.addEventListener(â€˜clickâ€™,function(e){
var el=e.target;
var tag=el.tagName+(el.id?â€™#â€™+el.id:el.className?â€™ .â€™+el.className.toString().split(â€™ â€˜)[0]:â€™â€™);
log(â€˜ğŸ–± click on <â€™+tag+â€™> defaultPrevented=â€™+e.defaultPrevented,â€™#f5d98aâ€™);
},{capture:true});

// TEST 4 â€” Scan for elements covering the screen with pointer-events blocking
setTimeout(function(){
var blockers=[];
document.querySelectorAll(â€™*â€™).forEach(function(el){
var st=window.getComputedStyle(el);
var r=el.getBoundingClientRect();
// Fixed/absolute full-screen elements
if((st.position===â€˜fixedâ€™||st.position===â€˜absoluteâ€™)
&& r.width>window.innerWidth*0.8
&& r.height>window.innerHeight*0.5
&& st.display!==â€˜noneâ€™
&& st.visibility!==â€˜hiddenâ€™){
var pe=st.pointerEvents;
blockers.push((el.id||el.className.toString().slice(0,20)||el.tagName)+â€™ z:â€™+st.zIndex+â€™ pe:â€™+pe+â€™ op:â€™+parseFloat(st.opacity).toFixed(1));
}
});
if(blockers.length){
log(â€˜âš  OVERLAY SUSPECTS:â€™,â€™#ff4545â€™);
blockers.forEach(function(b){log(â€™  â€˜+b,â€™#ff9999â€™);});
} else {
log(â€˜âœ… No full-screen overlays detectedâ€™,â€™#3ddc84â€™);
}
},800);

// TEST 5 â€” Check if nav() fires when bottom nav tapped
setTimeout(function(){
log(â€™â€” Tap a nav tab now â€”â€™,â€™#888â€™);
},1200);
})();
</script>

<!-- â•â• END DEBUG HUD â•â• -->

  <div class="logo">TREY <span>BUYBACK</span></div>
  <div class="top-right">
    <div class="badge">PRO</div>
    <div id="topDate"></div>
    <button class="icon-btn" onclick="openModal('settings')">âš™</button>
  </div>
</div>

<div class="shell">
<div class="sidebar">
  <div class="nav-section">Main</div>
  <button class="nav-item active" onclick="nav('dashboard')"><span class="nav-icon">ğŸ“Š</span><span>Dashboard</span></button>
  <button class="nav-item" onclick="nav('leads')"><span class="nav-icon">ğŸ‘¥</span><span>Leads</span><span class="nc hot" id="nc-leads">0</span></button>
  <button class="nav-item" onclick="nav('pipeline')"><span class="nav-icon">ğŸ”€</span><span>Pipeline</span></button>
  <button class="nav-item" onclick="nav('followups')"><span class="nav-icon">â°</span><span>Follow-Ups</span><span class="nc" id="nc-fu">0</span></button>
  <div class="nav-section">Tools</div>
  <button class="nav-item" onclick="nav('ai')"><span class="nav-icon">ğŸ¤–</span><span>AI Assistant</span><span class="nc ai">AI</span></button>
  <button class="nav-item" onclick="nav('prices')"><span class="nav-icon">ğŸ”</span><span>Price Checker</span><span class="nc live">LIVE</span></button>
  <button class="nav-item" onclick="nav('calc')"><span class="nav-icon">ğŸ§®</span><span>Flip Calc</span></button>
  <button class="nav-item" onclick="nav('inventory')"><span class="nav-icon">ğŸ“¦</span><span>Inventory</span></button>
  <button class="nav-item" onclick="nav('alerts')"><span class="nav-icon">ğŸ””</span><span>Alerts</span><span class="nc" id="nc-alerts">0</span></button>
  <div class="nav-section">Learn</div>
  <button class="nav-item" onclick="nav('playbook')"><span class="nav-icon">ğŸ“š</span><span>Playbook</span></button>
  <div class="nav-section">Reports</div>
  <button class="nav-item" onclick="nav('profits')"><span class="nav-icon">ğŸ’°</span><span>Profits</span></button>
</div>

<div class="main">

<!-- DASHBOARD -->

<div class="page active" id="page-dashboard">
  <div class="ph">
    <div><div class="pt">DASHBOARD</div><div class="ps" id="dashGreet">Ready to flip?</div></div>
    <div class="ha"><button class="btn btn-purple btn-sm" onclick="nav('ai')">ğŸ¤– AI</button><button class="btn btn-gold" onclick="openModal('addLead')">+ Lead</button></div>
  </div>
  <div class="stats-row">
    <div class="sc"><div class="sl">Leads</div><div class="sv blue" id="ds-leads">0</div></div>
    <div class="sc"><div class="sl">Active</div><div class="sv gold" id="ds-active">0</div></div>
    <div class="sc"><div class="sl">Closed</div><div class="sv green" id="ds-closed">0</div></div>
    <div class="sc"><div class="sl">Profit</div><div class="sv green" id="ds-profit">$0</div></div>
  </div>
  <div class="ca">
    <div class="two-col">
      <div class="panel"><div class="panel-title">Recent Leads<span style="color:var(--gold);cursor:pointer;font-size:9px;" onclick="nav('leads')">ALL â†’</span></div><div id="dash-recent"></div></div>
      <div class="panel"><div class="panel-title">Follow-Ups Due<span style="color:var(--purple);cursor:pointer;font-size:9px;" onclick="nav('followups')">ALL â†’</span></div><div id="dash-fu"></div></div>
    </div>
    <div class="two-col">
      <div class="panel"><div class="panel-title">Pipeline</div><div id="dash-pipeline"></div></div>
      <div class="panel"><div class="panel-title">Top Devices</div><div id="dash-devices"></div></div>
    </div>
  </div>
</div>

<!-- LEADS -->

<div class="page" id="page-leads">
  <div class="ph">
    <div><div class="pt">LEADS</div><div class="ps">All seller contacts</div></div>
    <div class="ha">
      <input id="leadSearch" placeholder="Searchâ€¦" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:6px 10px;border-radius:2px;font-family:var(--M);font-size:12px;outline:none;width:140px;" oninput="renderLeads()">
      <button class="btn btn-ghost btn-sm hm" onclick="exportLeads()">â†“ CSV</button>
      <button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Add</button>
    </div>
  </div>
  <div class="tw">
    <table><thead><tr><th>Name</th><th>Device</th><th>Asking</th><th>Status</th><th class="hm">Source</th><th class="hm">Date</th><th>Actions</th></tr></thead>
    <tbody id="leads-tbody"></tbody></table>
    <div id="leads-empty" class="empty" style="display:none;"><div class="empty-icon">ğŸ‘¥</div>No leads yet â€” add your first one</div>
  </div>
</div>

<!-- PIPELINE -->

<div class="page" id="page-pipeline">
  <div class="ph"><div><div class="pt">PIPELINE</div><div class="ps">Deal flow by stage</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addLead')">+ Lead</button></div>
  <div class="pipeline" id="pipeline-board"></div>
</div>

<!-- FOLLOW-UPS -->

<div class="page" id="page-followups">
  <div class="ph"><div><div class="pt">FOLLOW-UPS</div><div class="ps">Never let a deal go cold</div></div></div>
  <div class="ca">
    <div class="panel" style="margin-bottom:10px;"><div class="panel-title" style="color:var(--red);">âš  OVERDUE</div><div id="fu-due"></div></div>
    <div class="panel"><div class="panel-title">UPCOMING (7 days)</div><div id="fu-upcoming"></div></div>
  </div>
</div>

<!-- AI ASSISTANT -->

<div class="page" id="page-ai">
  <div class="ph"><div><div class="pt">AI ASSISTANT</div><div class="ps">Powered by Claude</div></div><button class="btn btn-ghost btn-sm" onclick="clearChat()">Clear</button></div>
  <div class="ai-wrap">
    <div class="ai-modes">
      <button class="ai-mode-btn active" onclick="setMode('negotiate',this)"><div class="ai-mode-icon">ğŸ’¬</div><div class="ai-mode-label">Negotiate</div></button>
      <button class="ai-mode-btn" onclick="setMode('deal',this)"><div class="ai-mode-icon">ğŸ“Š</div><div class="ai-mode-label">Deal Check</div></button>
      <button class="ai-mode-btn" onclick="setMode('objection',this)"><div class="ai-mode-icon">ğŸ›¡</div><div class="ai-mode-label">Objections</div></button>
      <button class="ai-mode-btn" onclick="setMode('ad',this)"><div class="ai-mode-icon">ğŸ“£</div><div class="ai-mode-label">Write Ad</div></button>
    </div>
    <div class="ai-qbtns" id="ai-qbtns"></div>
    <div class="ai-chat" id="ai-chat"></div>
    <div class="ai-row">
      <textarea class="ai-input" id="ai-input" rows="1" placeholder="Ask me about any dealâ€¦" onkeydown="aiKey(event)"></textarea>
      <button class="ai-send" id="ai-send" onclick="sendMsg()">â†‘</button>
    </div>
  </div>
</div>

<!-- PRICE CHECKER -->

<div class="page" id="page-prices">
  <div class="ph"><div><div class="pt">PRICE CHECKER</div><div class="ps" id="pc-sub">Live eBay + AI estimates</div></div></div>
  <div class="pc-wrap">
    <div id="api-warn" style="display:none;background:rgba(255,140,66,.08);border:1px solid rgba(255,140,66,.25);border-radius:2px;padding:10px 14px;margin-bottom:12px;font-size:13px;color:#e0a070;">
      âš  No eBay API key set â€” prices are AI estimates. <span style="text-decoration:underline;cursor:pointer;" onclick="openModal('settings')">Add key in Settings âš™</span>
    </div>
    <div class="search-bar">
      <input id="pc-q" placeholder="iPhone 15 Pro 256GB, PS5 Disc, MacBook Pro M3, Canon R6â€¦" onkeydown="if(event.key==='Enter')runCheck()">
      <select id="pc-cond">
        <option value="used">Used / Pre-Owned</option>
        <option value="damaged">Damaged / Parts Only</option>
        <option value="new">New / Open Box</option>
        <option value="bad-esn">Bad ESN / Blacklisted</option>
        <option value="broken">Broken / No Power</option>
      </select>
      <button class="btn btn-teal" onclick="runCheck()" id="pc-btn">Check â†’</button>
    </div>
    <div class="cat-tabs">
      <button class="ecat active" onclick="setCat(this)">All</button>
      <button class="ecat" onclick="setCat(this)">ğŸ“± Phones</button>
      <button class="ecat" onclick="setCat(this)">ğŸ® Consoles</button>
      <button class="ecat" onclick="setCat(this)">ğŸ’» MacBooks</button>
      <button class="ecat" onclick="setCat(this)">ğŸ“· Cameras</button>
      <button class="ecat" onclick="setCat(this)">ğŸ“± iPads</button>
    </div>
    <div id="pc-results">
      <div class="ext-links">
        <a class="ext-card" href="#" onclick="soldLink('ebay');return false;"><div class="ext-icon">ğŸ›’</div><div class="ext-label">eBay Sold</div><div class="ext-sub">Pre-filtered â†’</div></a>
        <a class="ext-card" href="#" onclick="soldLink('swappa');return false;"><div class="ext-icon">ğŸ”„</div><div class="ext-label">Swappa</div><div class="ext-sub">Used market â†’</div></a>
        <a class="ext-card" href="#" onclick="soldLink('fb');return false;"><div class="ext-icon">ğŸ“</div><div class="ext-label">FB Marketplace</div><div class="ext-sub">Local â†’</div></a>
      </div>
      <div class="panel">
        <div class="panel-title">FEE REFERENCE</div>
        <div class="fee-row"><span class="fee-key">eBay Final Value (Electronics)</span><span class="fee-val" style="color:var(--red);">13.25%</span></div>
        <div class="fee-row"><span class="fee-key">eBay Payment Processing</span><span class="fee-val" style="color:var(--red);">~0.3%</span></div>
        <div class="fee-row"><span class="fee-key">Avg Shipping</span><span class="fee-val" style="color:var(--red);">$8â€“$15</span></div>
        <div class="fee-row"><span class="fee-key">Swappa Listing</span><span class="fee-val" style="color:var(--green);">Free to list</span></div>
        <div class="fee-row"><span class="fee-key">FB Marketplace (local)</span><span class="fee-val" style="color:var(--green);">Free</span></div>
      </div>
    </div>
  </div>
</div>

<!-- FLIP CALC -->

<div class="page" id="page-calc">
  <div class="ph"><div><div class="pt">FLIP CALC</div><div class="ps">Atlas Mobile pricing â€” iPhones</div></div></div>
  <div style="padding:0 16px 80px;display:grid;grid-template-columns:295px 1fr;gap:12px;flex:1;overflow-y:auto;" id="calc-grid">
    <div>
      <div class="panel" style="margin-bottom:10px;">
        <div style="margin-bottom:13px;">
          <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Model</div>
          <div class="field"><select id="c-model" onchange="calcStorage()"><option value="">â€” Select model â€”</option></select></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:13px;">
          <div><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Storage</div><div class="field"><select id="c-storage" onchange="calcUpdate()"><option>â€”</option></select></div></div>
          <div><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Lock</div><div class="field"><select id="c-lock" onchange="calcUpdate()"><option value="unlocked">Unlocked</option><option value="locked">Carrier Locked</option></select></div></div>
        </div>
        <div style="margin-bottom:13px;">
          <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Condition</div>
          <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:3px;">
            <div class="cbtn" data-g="swap" onclick="setGrade('swap',this)" style="background:var(--gold);border:1px solid var(--gold);border-radius:2px;color:#000;font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">SWAP</div>
            <div class="cbtn" data-g="a" onclick="setGrade('a',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">A</div>
            <div class="cbtn" data-g="b" onclick="setGrade('b',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">B</div>
            <div class="cbtn" data-g="c" onclick="setGrade('c',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">C</div>
            <div class="cbtn" data-g="d" onclick="setGrade('d',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">D</div>
            <div class="cbtn" data-g="doa" onclick="setGrade('doa',this)" style="background:var(--card2);border:1px solid var(--border2);border-radius:2px;color:var(--muted);font-family:var(--M);font-size:10px;padding:6px 1px;cursor:pointer;text-align:center;">DOA</div>
          </div>
        </div>
        <div>
          <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px;">Damage Deductions</div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);"><span style="font-size:12px;">Cracked Back</span><div class="tog" id="tog-back" onclick="togDed('back',this)"><span></span></div></div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);"><span style="font-size:12px;">Cracked Lens</span><div class="tog" id="tog-lens" onclick="togDed('lens',this)"><span></span></div></div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);"><span style="font-size:12px;">Battery &lt;80%</span><div class="tog" id="tog-batt" onclick="togDed('batt',this)"><span></span></div></div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 0;"><span style="font-size:12px;">Repair Message</span><div class="tog" id="tog-rep" onclick="togDed('rep',this)"><span></span></div></div>
        </div>
      </div>
      <div class="panel">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
          <div class="field"><label>Min Profit $</label><input type="number" id="c-profit" value="40" oninput="calcUpdate()"></div>
          <div class="field"><label>Risk Buffer $</label><input type="number" id="c-risk" value="20" oninput="calcUpdate()"></div>
        </div>
        <div class="field"><label>Seller's Asking $</label><input type="number" id="c-asking" placeholder="Enter their price" oninput="calcUpdate()"></div>
      </div>
    </div>
    <div><div id="calc-result" style="background:var(--card);border:1px solid var(--border);border-radius:2px;"><div style="padding:50px;text-align:center;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px;">SELECT A MODEL TO BEGIN</div></div></div>
  </div>
</div>

<!-- INVENTORY -->

<div class="page" id="page-inventory">
  <div class="ph"><div><div class="pt">INVENTORY</div><div class="ps">All categories</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addInventory')">+ Device</button></div>
  <div class="ca">
    <div class="three-col" style="margin-bottom:12px;">
      <div class="sc"><div class="sl">In Stock</div><div class="sv gold" id="inv-count">0</div></div>
      <div class="sc"><div class="sl">Invested</div><div class="sv red" id="inv-invested">$0</div></div>
      <div class="sc"><div class="sl">Est. Profit</div><div class="sv green" id="inv-profit-est">$0</div></div>
    </div>
    <div class="inv-grid" id="inv-grid"></div>
    <div id="inv-empty" class="empty" style="display:none;"><div class="empty-icon">ğŸ“¦</div>No inventory yet</div>
  </div>
</div>

<!-- ALERTS -->

<div class="page" id="page-alerts">
  <div class="ph"><div><div class="pt">DEAL ALERTS</div><div class="ps">Monitor for underpriced items</div></div><button class="btn btn-gold btn-sm" onclick="openModal('addAlert')">+ Alert</button></div>
  <div class="ca">
    <div id="email-banner" style="display:none;background:rgba(45,212,191,.07);border:1px solid rgba(45,212,191,.25);border-radius:2px;padding:10px 14px;margin-bottom:12px;align-items:center;justify-content:space-between;gap:10px;">
      <div style="font-size:12px;color:var(--teal);"><strong style="display:block;font-size:13px;margin-bottom:1px;">ğŸ“§ Email Alerts Active</strong>You'll be emailed when matching deals are found.</div>
      <button class="btn btn-ghost btn-sm" onclick="openModal('settings')">Configure</button>
    </div>
    <div class="panel" style="margin-bottom:10px;"><div class="panel-title">ACTIVE MONITORS</div><div id="alert-monitors"></div></div>
    <div class="panel"><div class="panel-title">RECENT HITS</div><div id="alert-hits"></div></div>
  </div>
</div>

<!-- PLAYBOOK -->

<div class="page" id="page-playbook">
  <div class="ph"><div><div class="pt">PLAYBOOK</div><div class="ps">Your complete buying system</div></div></div>
  <div class="pb-wrap">
    <div class="pb-tabs">
      <button class="pb-tab active" onclick="pbTab('shotgun')">ğŸ¯ Shotgun</button>
      <button class="pb-tab" onclick="pbTab('script')">ğŸ’¬ Scripts</button>
      <button class="pb-tab" onclick="pbTab('objections')">ğŸ›¡ Objections</button>
      <button class="pb-tab" onclick="pbTab('appraise')">ğŸ” Appraise</button>
      <button class="pb-tab" onclick="pbTab('ads')">ğŸ“£ Ads</button>
      <button class="pb-tab" onclick="pbTab('buyers')">ğŸ¦ Buyers</button>
    </div>
    <!-- SHOTGUN -->
    <div class="pb-sec active" id="pb-shotgun">
      <div class="panel" style="margin-bottom:10px;"><div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">THE SHOTGUN METHOD</div><div style="font-size:13px;color:#999;line-height:1.7;">Send 100 reachouts. Weed non-responders. Negotiate with the interested. Close and meet. Repeat every day.</div></div>
      <div class="funnel">
        <div class="funnel-step f1" onclick="tft('ft1')"><div class="fs-title">100 REACHOUTS</div><div class="fs-sub">Message as many sellers as possible</div></div>
        <div class="ftip" id="ft1"><div class="smsg">"Hey, I run a business that buys used and damaged iPhones, MacBooks, iPads, Smartwatches, cameras and more. If I were to pay cash today, would you take a lower price?"</div></div>
        <div class="funnel-step f2" onclick="tft('ft2')" style="margin-top:-1px;"><div class="fs-title">INTERESTED SELLERS</div><div class="fs-sub">Weed out non-responders fast</div></div>
        <div class="ftip" id="ft2"><p style="font-size:13px;color:#999;line-height:1.7;">You'll get: "No" / "How much lower?" / "I'll take $150 today" â€” Ignore rude ones. Move every positive response into negotiate immediately.</p></div>
        <div class="funnel-step f3" onclick="tft('ft3')" style="margin-top:-1px;"><div class="fs-title">NEGOTIATE</div><div class="fs-sub">Convos started â€” now close them</div></div>
        <div class="ftip" id="ft3"><p style="font-size:13px;color:#999;line-height:1.7;">Use your benefits: same-day pickup, you drive to them, cash in hand right now. Use the Bullet Scripts tab.</p></div>
        <div class="funnel-step f4" onclick="tft('ft4')" style="margin-top:-1px;"><div class="fs-title">CLOSE + MEET</div><div class="fs-sub">Buy, get reviews, get referrals</div></div>
        <div class="ftip" id="ft4"><p style="font-size:13px;color:#999;line-height:1.7;">Close â†’ Ask for Google/Marketplace review â†’ Give business card â†’ "Know anyone else selling?" â†’ Always cross-sell other categories.</p></div>
      </div>
    </div>
    <!-- SCRIPTS -->
    <div class="pb-sec" id="pb-script">
      <div class="scard"><button class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Opening Reachout</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">FIRST MESSAGE</div></div><span>â–¼</span></div><div class="scard-b open"><div class="smsg">"Hey, I run a company that buys used and damaged iPhones, MacBooks, Smartwatches, Cameras, VR Systems, and more. If I were able to pay cash today, would you take a lower offer?"</div></div></div>
      <div class="scard"><button class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Make the Offer</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">AFTER POSITIVE RESPONSE</div></div><span>â–¼</span></div><div class="scard-b"><div class="smsg good">"Great, we've been buying the [Device] for $____ recently."</div><div class="smsg good">"Awesome, I can give you $______ for it."</div><div class="snote">If they refuse: "You have a great device â€” we need more to hit our target this week. What were you trying to get?"</div></div></div>
      <div class="scard"><button class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Bullet 1 â€” Carrier</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">WHEN STUCK ON PRICE</div></div><span>â–¼</span></div><div class="scard-b"><div class="smsg good">"Just want to confirm â€” what carrier is it with?"</div><div class="snote">If you can bump based on carrier: "Gotcha, I checked with my buyers and I can actually move to $___. How does that sound?"</div></div></div>
      <div class="scard"><button class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Bullet 2 â€” Storage</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">STILL STUCK</div></div><span>â–¼</span></div><div class="scard-b"><div class="smsg good">"Can you tell me how much storage it has?"</div><div class="smsg good">"I didn't realize it was 512GB â€” I can do $___. How does that sound?"</div></div></div>
      <div class="scard"><button class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Tell the Truth â€” Final Offer</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">LAST RESORT</div></div><span>â–¼</span></div><div class="scard-b"><div class="smsg good">"I'd love to buy your device, but I buy and resell for a living and I need to make a small profit. Best I can do is $__ due to where it's at in the market. Would you take that if I came to you today with cash?"</div></div></div>
      <div class="scard"><button class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Cross-Sell + Bill of Sale</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">ALWAYS DO THIS</div></div><span>â–¼</span></div><div class="scard-b"><div class="smsg good">"Do you have any other items? iPads, MacBooks, Smartwatches, Cameras, Consoles â€” anything like that?"</div><div class="smsg good">"Please make sure the device can be fully erased and bring a valid ID for the bill of sale. Can't wait to earn your business."</div></div></div>
      <div class="scard"><button class="scard-h" onclick="tsc(this)"><div><div style="font-weight:500;font-size:13px;">Follow-Up Messages</div><div style="font-family:var(--M);font-size:9px;color:var(--muted);">COLD LEADS</div></div><span>â–¼</span></div><div class="scard-b"><div class="smsg good">"Hey I saw this was still available."</div><div class="smsg good">"Hey this popped back up on my feed, I'd still love to buy it."</div><div class="smsg good">"Following up â€” still interested in buying this today."</div></div></div>
    </div>
    <!-- OBJECTIONS -->
    <div class="pb-sec" id="pb-objections">
      <div class="obj-card"><div class="obj-sit">Angry No</div><div class="obj-ex">"Hell no"</div><div class="obj-res">"I totally understand, how much were you looking to get?"</div></div>
      <div class="obj-card"><div class="obj-sit">Wants Too Much</div><div class="obj-ex">"I want $300 for my iPhone 6"</div><div class="obj-res">"I totally understand â€” unfortunately $300 is higher than I could sell it for. But I can give you $100 cash today. Is that fair?"</div></div>
      <div class="obj-card"><div class="obj-sit">Will Sell Themselves</div><div class="obj-ex">"I'll just sell it myself"</div><div class="obj-res">"That makes sense! Most people find it takes weeks on Facebook. I can give you cash today so you skip the strangers and no-shows."</div></div>
      <div class="obj-card"><div class="obj-sit">Someone Offered More</div><div class="obj-ex">"Another guy offered me $150"</div><div class="obj-res">"$150 is a great price â€” if he's paying, take it! I can offer $100 with cash today though. What works best for you?"</div></div>
      <div class="obj-card"><div class="obj-sit">Radio Silence After Offer</div><div class="obj-ex">(No response)</div><div class="obj-res">"Would that price work for you?" / "Would that be fair?"</div></div>
      <div class="obj-card"><div class="obj-sit">Just Shopping Around</div><div class="obj-ex">"I was just seeing what I could get"</div><div class="obj-res">"No worries! Hey â€” got any other devices? iPads, MacBooks, consoles, cameras? Could put cash in your hands today."</div></div>
    </div>
    <!-- APPRAISE -->
    <div class="pb-sec" id="pb-appraise">
      <div class="panel" style="margin-bottom:10px;"><div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">APPRAISE ON EBAY</div><div style="font-size:13px;color:#999;">Always use SOLD listings. Never guess off active listings.</div></div>
      <div class="panel" style="margin-bottom:10px;">
        <div class="panel-title">STANDARD PHONES</div>
        <div class="apr-step"><div class="apr-num">1</div><div class="apr-content"><h4>Minimal keywords</h4><p>"iPhone XR Unlocked" â€” NOT "iPhone XR gold 128GB good condition." Less is more.</p></div></div>
        <div class="apr-step"><div class="apr-num">2</div><div class="apr-content"><h4>Filter: Sold Items ONLY</h4><p>Check both "Completed Items" and "Sold Items." Active listings mean nothing.<div class="tip-box">ğŸ“± Mobile: Filter â†’ Show Only â†’ Sold Items</div></p></div></div>
        <div class="apr-step"><div class="apr-num">3</div><div class="apr-content"><h4>3 comps within 2 months</h4><p>Match model, storage, condition exactly. iPhone 8 â‰  iPhone 8 Plus. 64GB â‰  256GB.</p></div></div>
        <div class="apr-step"><div class="apr-num">4</div><div class="apr-content"><h4>Real photos only</h4><p>Skip stock photo listings. Only use comps with actual device photos shown.</p></div></div>
      </div>
      <div class="panel" style="margin-bottom:10px;">
        <div class="panel-title">BAD ESN</div>
        <div class="apr-step"><div class="apr-num">!</div><div class="apr-content"><h4>Never search "Bad ESN" â€” eBay blocks it</h4><p>Search: "iPhone 8 Plus Tmobile ESN" â€” Look for: "Check ESN", "Financed", "ESN Unclean." 2 comps is fine.</p></div></div>
      </div>
      <div class="panel">
        <div class="panel-title">DAMAGED</div>
        <div class="apr-step"><div class="apr-num">A</div><div class="apr-content"><h4>Cracked screen (display works)</h4><p>Search: "iPhone 8 Plus cracked" â€” don't add "screen" or "bad touch."</p></div></div>
        <div class="apr-step"><div class="apr-num">B</div><div class="apr-content"><h4>Cracked LCD (black lines)</h4><p>Search: "iPhone 8 Plus cracked LCD"</p></div></div>
        <div class="apr-step"><div class="apr-num">C</div><div class="apr-content"><h4>Multiple issues</h4><p>Can't find comps? Use cracked screen as baseline. Multiple issues â†’ use "no power" as your floor price.</p></div></div>
      </div>
    </div>
    <!-- ADS -->
    <div class="pb-sec" id="pb-ads">
      <div class="panel">
        <div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">FB AD SETUP</div>
        <div style="font-size:13px;color:#999;margin-bottom:12px;">$5â€“$15/day. Goal: 15â€“20 leads/day.</div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">â†“</span><div><div style="font-size:13px;font-weight:500;">Objective: Engagement</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">â†“</span><div><div style="font-size:13px;font-weight:500;">Advantage Campaign Budget â€” $5/day to start</div><div style="font-size:12px;color:#888;">Scale to $15â€“25 once leads are coming in</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">â†“</span><div><div style="font-size:13px;font-weight:500;">Manual Engagement Campaign</div><div style="font-size:12px;color:#888;">Do NOT use simplified/automated mode</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">â†“</span><div><div style="font-size:13px;font-weight:500;">Location: 10â€“25 mile radius</div></div></div>
        <div style="display:flex;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);"><span style="color:var(--gold);flex-shrink:0;">â†“</span><div><div style="font-size:13px;font-weight:500;">Target: iPhone X+ owners, Galaxy S10/Note10+</div></div></div>
        <div style="background:rgba(255,69,69,.08);border:1px solid rgba(255,69,69,.25);border-radius:2px;padding:9px 12px;margin:10px 0;"><div style="font-family:var(--M);font-size:9px;color:var(--red);margin-bottom:3px;">âš  CRITICAL</div><div style="font-size:12px;color:#ff9999;">NO Apple logos. NO brand logos on your page. This WILL get your ad account permanently banned.</div></div>
        <div style="display:flex;gap:9px;padding:9px 0;"><span style="color:var(--gold);flex-shrink:0;">â†“</span><div><div style="font-size:13px;font-weight:500;">Duplicate ad 4Ã— â†’ Publish all 5 variations</div><div style="font-size:12px;color:#888;">Meta will find the best performer automatically</div></div></div>
      </div>
    </div>
    <!-- BUYERS -->
    <div class="pb-sec" id="pb-buyers">
      <div class="panel">
        <div style="font-family:var(--D);font-size:20px;letter-spacing:1px;margin-bottom:4px;">VETTED BUYERS</div>
        <div style="font-size:12px;color:#888;margin-bottom:12px;">Do your own due diligence. Not responsible for scams.</div>
        <a class="buyer-row" href="https://atlasmobile.com" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">ğŸ“±</span><div><div style="font-weight:500;font-size:13px;">Atlas Mobile</div><div style="font-size:11px;color:var(--muted);">atlasmobile.com Â· Built into Flip Calc</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-closed">PRIMARY</span><span style="color:var(--muted);font-size:12px;">â†’</span></div></a>
        <a class="buyer-row" href="https://bestdealphones.com" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">ğŸ’°</span><div><div style="font-weight:500;font-size:13px;">Best Deal Phones</div><div style="font-size:11px;color:var(--muted);">bestdealphones.com Â· Bonus on price sheet</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-active">VETTED</span><span style="color:var(--muted);font-size:12px;">â†’</span></div></a>
        <a class="buyer-row" href="https://nycphonebuyer.com" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">ğŸ™</span><div><div style="font-weight:500;font-size:13px;">NYC Phone Buyer</div><div style="font-size:11px;color:var(--muted);">nycphonebuyer.com Â· NYCPhonebuyer LLC</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-active">VETTED</span><span style="color:var(--muted);font-size:12px;">â†’</span></div></a>
        <a class="buyer-row" href="https://apple.com/shop/trade-in" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">ğŸ</span><div><div style="font-weight:500;font-size:13px;">Apple Trade In</div><div style="font-size:11px;color:var(--muted);">apple.com/shop/trade-in Â· Good for newer models</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px;">â†’</span></div></a>
        <a class="buyer-row" href="https://ebay.com/sl/sell" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">ğŸ›’</span><div><div style="font-weight:500;font-size:13px;">eBay</div><div style="font-size:11px;color:var(--muted);">ebay.com Â· Best for MacBooks, consoles, cameras</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px;">â†’</span></div></a>
        <a class="buyer-row" href="https://swappa.com/sell" target="_blank" rel="noopener" style="text-decoration:none;color:inherit;cursor:pointer;transition:background .1s;" onmouseover="this.style.background='rgba(255,255,255,.03)'" onmouseout="this.style.background='transparent'"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:16px;">ğŸ”„</span><div><div style="font-weight:500;font-size:13px;">Swappa</div><div style="font-size:11px;color:var(--muted);">swappa.com Â· Phones, tablets, laptops â€” no seller fee</div></div></div><div style="display:flex;align-items:center;gap:8px;"><span class="pill p-new">OPTION</span><span style="color:var(--muted);font-size:12px;">â†’</span></div></a>
      </div>
    </div>
  </div>
</div>

<!-- PROFITS -->

<div class="page" id="page-profits">
  <div class="ph"><div><div class="pt">PROFITS</div><div class="ps">Track every dollar</div></div><button class="btn btn-ghost btn-sm hm" onclick="exportProfits()">â†“ CSV</button></div>
  <div class="ca">
    <div class="stats-row" style="padding:0 0 12px;">
      <div class="sc"><div class="sl">Revenue</div><div class="sv green" id="pr-rev">$0</div></div>
      <div class="sc"><div class="sl">Spent</div><div class="sv red" id="pr-spent">$0</div></div>
      <div class="sc"><div class="sl">Net Profit</div><div class="sv gold" id="pr-net">$0</div></div>
      <div class="sc"><div class="sl">Avg/Deal</div><div class="sv blue" id="pr-avg">$0</div></div>
    </div>
    <div class="panel">
      <div class="panel-title">SOLD DEVICES</div>
      <div style="overflow-x:auto;"><table><thead><tr><th>Device</th><th>Paid</th><th>Sold For</th><th>Profit</th><th class="hm">Date</th><th class="hm">Buyer</th></tr></thead><tbody id="profits-tbody"></tbody></table></div>
      <div id="profits-empty" class="empty"><div class="empty-icon">ğŸ’°</div>No sold devices yet</div>
    </div>
  </div>
</div>

</div><!-- /main -->
</div><!-- /shell -->

<!-- MOBILE NAV -->

<div class="mob-nav">
  <button class="mob-item active" onclick="nav('dashboard')"><span class="mi">ğŸ“Š</span>Home</button>
  <button class="mob-item" onclick="nav('leads')"><span class="mi">ğŸ‘¥</span>Leads</button>
  <button class="mob-item" onclick="nav('ai')"><span class="mi">ğŸ¤–</span>AI</button>
  <button class="mob-item" onclick="nav('prices')"><span class="mi">ğŸ”</span>Prices</button>
  <button class="mob-item" onclick="nav('playbook')"><span class="mi">ğŸ“š</span>Playbook</button>
  <button class="mob-item" onclick="openModal('moreMenu')"><span class="mi">â˜°</span>More</button>
</div>

<!-- SETTINGS MODAL -->

<div class="overlay" id="modal-settings">
  <div class="modal" style="max-width:520px;">
    <div class="mh"><div class="mt">âš™ SETTINGS</div><button class="mc" onclick="closeModal('settings')">Ã—</button></div>
    <div class="mb">
      <div class="set-sec">
        <div class="set-sec-title">eBay API â€” Price Checker</div>
        <div class="field"><label>Production App ID (Client ID)</label><input class="key-input" id="s-ebay" type="password" placeholder="AppName-PRD-xxxxxxxx-xxxxxxxx" autocomplete="off"></div>
        <div id="ebay-ks" class="ks missing">â— Not set</div>
        <div style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.6;">Get at <strong style="color:var(--gold);">developer.ebay.com</strong> â†’ My Account â†’ Application Keysets â†’ Production. Stored only in your browser â€” never sent anywhere except eBay's servers.</div>
        <div style="display:flex;gap:7px;margin-top:10px;"><button class="btn btn-teal btn-sm" onclick="saveEbayKey()">Save Key</button><button class="btn btn-ghost btn-sm" onclick="testEbay()">Test Connection</button></div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">Email Alerts â€” EmailJS (Free)</div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:10px;line-height:1.7;">
          1. Go to <strong style="color:var(--gold);">emailjs.com</strong> â†’ create free account<br>
          2. Add Email Service (Gmail works) â†’ copy <strong>Service ID</strong><br>
          3. Email Templates â†’ create template â†’ copy <strong>Template ID</strong><br>
          4. Account â†’ API Keys â†’ copy <strong>Public Key</strong><br>
          In your template use: <code style="color:var(--teal);">{{subject}}</code> and <code style="color:var(--teal);">{{message}}</code>
        </div>
        <div class="field" style="margin-bottom:8px;"><label>Your Email Address</label><input class="key-input" id="s-email" type="email" placeholder="you@gmail.com"></div>
        <div class="field" style="margin-bottom:8px;"><label>EmailJS Service ID</label><input class="key-input" id="s-svc" placeholder="service_xxxxxxx"></div>
        <div class="field" style="margin-bottom:8px;"><label>EmailJS Template ID</label><input class="key-input" id="s-tmpl" placeholder="template_xxxxxxx"></div>
        <div class="field" style="margin-bottom:8px;"><label>EmailJS Public Key</label><input class="key-input" id="s-pubkey" type="password" placeholder="xxxxxxxxxxxxxxxxxxxx"></div>
        <div id="email-ks" class="ks missing">â— Not configured</div>
        <div style="display:flex;gap:7px;flex-wrap:wrap;margin-top:10px;"><button class="btn btn-teal btn-sm" onclick="saveEmailKeys()">Save Email Settings</button><button class="btn btn-ghost btn-sm" onclick="testEmail()">Send Test Email</button></div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">Data</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;"><button class="btn btn-ghost btn-sm" onclick="exportAll()">â†“ Export Backup</button><button class="btn btn-danger btn-sm" onclick="clearAll()">ğŸ—‘ Clear All Data</button></div>
      </div>
    </div>
    <div class="mf"><button class="btn btn-gold" onclick="closeModal('settings')">Done</button></div>
  </div>
</div>

<!-- MORE MENU -->

<div class="overlay" id="modal-moreMenu">
  <div class="modal" style="max-height:65vh;">
    <div class="mh"><div class="mt">MORE</div><button class="mc" onclick="closeModal('moreMenu')">Ã—</button></div>
    <div class="mb" style="padding:4px 0;">
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('calc');closeModal('moreMenu')"><span class="nav-icon">ğŸ§®</span>Flip Calc</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('pipeline');closeModal('moreMenu')"><span class="nav-icon">ğŸ”€</span>Pipeline</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('followups');closeModal('moreMenu')"><span class="nav-icon">â°</span>Follow-Ups</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('inventory');closeModal('moreMenu')"><span class="nav-icon">ğŸ“¦</span>Inventory</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('alerts');closeModal('moreMenu')"><span class="nav-icon">ğŸ””</span>Alerts</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="nav('profits');closeModal('moreMenu')"><span class="nav-icon">ğŸ’°</span>Profits</div>
      <div class="nav-item" style="border:none;padding:13px 16px;" onclick="openModal('settings');closeModal('moreMenu')"><span class="nav-icon">âš™</span>Settings</div>
    </div>
  </div>
</div>

<!-- ADD LEAD -->

<div class="overlay" id="modal-addLead">
  <div class="modal">
    <div class="mh"><div class="mt" id="lead-modal-title">NEW LEAD</div><button class="mc" onclick="closeModal('addLead')">Ã—</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Full Name *</label><input id="l-name" placeholder="John Smith"></div><div class="field"><label>Phone</label><input id="l-phone" type="tel"></div></div>
      <div class="form-row"><div class="field"><label>Device</label><input id="l-device" placeholder="iPhone 15 Pro 256GB, PS5â€¦"></div><div class="field"><label>Category</label><select id="l-cat"><option>Phone</option><option>Console</option><option>MacBook/Laptop</option><option>Camera</option><option>iPad/Tablet</option><option>Other</option></select></div></div>
      <div class="form-row"><div class="field"><label>Asking $</label><input id="l-asking" type="number"></div><div class="field"><label>Your Offer $</label><input id="l-offer" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Source</label><select id="l-source"><option>FB Marketplace</option><option>Craigslist</option><option>Walk-in</option><option>Referral</option><option>Google Ad</option><option>OfferUp</option><option>Other</option></select></div><div class="field"><label>Status</label><select id="l-status"><option value="new">New</option><option value="active">Active</option><option value="follow">Follow-Up</option><option value="closed">Closed</option><option value="lost">Lost</option></select></div></div>
      <div class="form-row"><div class="field"><label>Follow-Up Date</label><input id="l-followup" type="date"></div></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="l-notes" placeholder="Condition, battery %, detailsâ€¦"></textarea></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addLead')">Cancel</button><button class="btn btn-gold" onclick="saveLead()">Save Lead</button></div>
  </div>
</div>

<!-- VIEW LEAD -->

<div class="overlay" id="modal-viewLead">
  <div class="modal"><div class="mh"><div class="mt" id="vl-title">LEAD</div><button class="mc" onclick="closeModal('viewLead')">Ã—</button></div><div class="mb" id="vl-body"></div><div class="mf" id="vl-footer"></div></div>
</div>

<!-- ADD INVENTORY -->

<div class="overlay" id="modal-addInventory">
  <div class="modal">
    <div class="mh"><div class="mt">ADD DEVICE</div><button class="mc" onclick="closeModal('addInventory')">Ã—</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Device *</label><input id="i-device" placeholder="iPhone 15 Pro, PS5, MacBook Proâ€¦"></div><div class="field"><label>Category</label><select id="i-cat"><option>Phone</option><option>Console</option><option>MacBook/Laptop</option><option>Camera</option><option>iPad/Tablet</option><option>Other</option></select></div></div>
      <div class="form-row"><div class="field"><label>Paid $ *</label><input id="i-paid" type="number"></div><div class="field"><label>Sell Target $</label><input id="i-target" type="number"></div></div>
      <div class="form-row"><div class="field"><label>Condition</label><select id="i-cond"><option>Grade A</option><option>Grade B</option><option>Grade C</option><option>Grade D</option><option>DOA/Parts</option></select></div><div class="field"><label>Sell Via</label><select id="i-sell"><option>Atlas Mobile</option><option>eBay</option><option>Swappa</option><option>Local/FB</option><option>Other</option></select></div></div>
      <div class="field" style="margin-bottom:9px;"><label>IMEI / Serial</label><input id="i-imei"></div>
      <div class="form-row single"><div class="field"><label>Notes</label><textarea id="i-notes"></textarea></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addInventory')">Cancel</button><button class="btn btn-gold" onclick="saveInventory()">Add Device</button></div>
  </div>
</div>

<!-- SELL MODAL -->

<div class="overlay" id="modal-sell">
  <div class="modal">
    <div class="mh"><div class="mt">MARK SOLD</div><button class="mc" onclick="closeModal('sell')">Ã—</button></div>
    <div class="mb">
      <div class="form-row"><div class="field"><label>Sold For $ *</label><input id="s-price" type="number"></div><div class="field"><label>Sold To</label><input id="s-buyer" placeholder="Atlas, eBay, Localâ€¦"></div></div>
      <div class="form-row single"><div class="field"><label>Date</label><input id="s-date" type="date"></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('sell')">Cancel</button><button class="btn btn-gold" onclick="confirmSell()">Confirm Sale</button></div>
  </div>
</div>

<!-- ADD ALERT -->

<div class="overlay" id="modal-addAlert">
  <div class="modal">
    <div class="mh"><div class="mt">NEW ALERT</div><button class="mc" onclick="closeModal('addAlert')">Ã—</button></div>
    <div class="mb">
      <div class="form-row single"><div class="field"><label>Device to Watch *</label><input id="a-device" placeholder="iPhone 15 Pro, PS5, MacBook Proâ€¦"></div></div>
      <div class="form-row"><div class="field"><label>Max Price $</label><input id="a-maxprice" type="number"></div><div class="field"><label>Platform</label><select id="a-platform"><option>FB Marketplace</option><option>Craigslist</option><option>OfferUp</option><option>All Platforms</option></select></div></div>
    </div>
    <div class="mf"><button class="btn btn-ghost" onclick="closeModal('addAlert')">Cancel</button><button class="btn btn-gold" onclick="saveAlert()">Add Monitor</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE + STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let ST = { leads: [], inventory: [], alerts: [], sold: [] };
let KEYS = { ebay: '', email: '', svc: '', tmpl: '', pubkey: '' };
let editLeadId = null, sellItemId = null, aiMode = 'negotiate';
let aiHistory = [{ role: 'assistant', content: "Hey! I'm your Trey Buyback AI. I can help you negotiate deals, check if something's worth buying, handle objections, or write ad copy. What do you need?" }];
let calcGrade = 'swap', calcDeds = { back: false, lens: false, batt: false, rep: false };

function save() { try { localStorage.setItem(â€˜tb4â€™, JSON.stringify(ST)); } catch(e) {} }
function saveKeys() { try { localStorage.setItem(â€˜tb4kâ€™, JSON.stringify(KEYS)); } catch(e) {} }
function load() {
try { const s = localStorage.getItem(â€˜tb4â€™); if (s) ST = { leads: [], inventory: [], alerts: [], sold: [], â€¦JSON.parse(s) }; } catch(e) {}
try { const k = localStorage.getItem(â€˜tb4kâ€™); if (k) KEYS = { â€¦KEYS, â€¦JSON.parse(k) }; } catch(e) {}
if (KEYS.pubkey) { try { emailjs.init(KEYS.pubkey); } catch(e) {} }
}
load();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
const d = new Date();
document.getElementById(â€˜topDateâ€™).textContent = d.toLocaleDateString(â€˜en-USâ€™, { weekday: â€˜shortâ€™, month: â€˜shortâ€™, day: â€˜numericâ€™ });
const h = d.getHours();
const greet = h < 12 ? â€˜Good morningâ€™ : h < 17 ? â€˜Good afternoonâ€™ : â€˜Good eveningâ€™;
document.getElementById(â€˜dashGreetâ€™).textContent = greet + â€™ â€” ready to flip?â€™;
buildCalcModels();
renderDash();
renderAI();
counts();
updateKS();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nav(p) {
document.querySelectorAll(â€™.pageâ€™).forEach(x => x.classList.remove(â€˜activeâ€™));
document.querySelectorAll(â€™.nav-item, .mob-itemâ€™).forEach(x => x.classList.remove(â€˜activeâ€™));
document.getElementById(â€˜page-â€™ + p).classList.add(â€˜activeâ€™);
document.querySelectorAll(â€™.nav-item, .mob-itemâ€™).forEach(x => {
if (x.getAttribute(â€˜onclickâ€™) && x.getAttribute(â€˜onclickâ€™).includes(â€â€™â€ + p + â€œâ€™â€)) x.classList.add(â€˜activeâ€™);
});
const fns = { dashboard: renderDash, leads: renderLeads, pipeline: renderPipeline, followups: renderFollowups, inventory: renderInventory, alerts: renderAlerts, profits: renderProfits };
if (fns[p]) fns[p]();
if (p === â€˜pricesâ€™) document.getElementById(â€˜api-warnâ€™).style.display = KEYS.ebay ? â€˜noneâ€™ : â€˜blockâ€™;
counts();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id) {
if (id === â€˜addLeadâ€™ && !editLeadId) {
[â€˜l-nameâ€™,â€˜l-phoneâ€™,â€˜l-deviceâ€™,â€˜l-notesâ€™,â€˜l-offerâ€™,â€˜l-askingâ€™,â€˜l-followupâ€™].forEach(f => { const el = document.getElementById(f); if (el) el.value = â€˜â€™; });
document.getElementById(â€˜l-sourceâ€™).value = â€˜FB Marketplaceâ€™;
document.getElementById(â€˜l-statusâ€™).value = â€˜newâ€™;
document.getElementById(â€˜l-catâ€™).value = â€˜Phoneâ€™;
document.getElementById(â€˜lead-modal-titleâ€™).textContent = â€˜NEW LEADâ€™;
}
if (id === â€˜settingsâ€™) loadSettingsUI();
document.getElementById(â€˜modal-â€™ + id).classList.add(â€˜openâ€™);
}
function closeModal(id) { document.getElementById(â€˜modal-â€™ + id).classList.remove(â€˜openâ€™); if (id === â€˜addLeadâ€™) editLeadId = null; }
document.querySelectorAll(â€™.overlayâ€™).forEach(o => o.addEventListener(â€˜clickâ€™, e => { if (e.target === o) o.classList.remove(â€˜openâ€™); }));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type = â€˜successâ€™) {
const t = document.getElementById(â€˜toastâ€™);
t.textContent = msg; t.className = â€™toast show â€™ + type;
setTimeout(() => t.classList.remove(â€˜showâ€™), 2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmtD(iso) { if (!iso) return â€˜â€”â€™; return new Date(iso).toLocaleDateString(â€˜en-USâ€™, { month: â€˜shortâ€™, day: â€˜numericâ€™ }); }
function fmtM(n) { return â€˜$â€™ + (n || 0).toLocaleString(); }
function uid() { return Date.now() + Math.random().toString(36).slice(2, 6); }
function sPill(s) {
const m = { new: [â€˜p-newâ€™,â€˜NEWâ€™], active: [â€˜p-activeâ€™,â€˜ACTIVEâ€™], follow: [â€˜p-followâ€™,â€˜FOLLOW-UPâ€™], closed: [â€˜p-closedâ€™,â€˜CLOSEDâ€™], lost: [â€˜p-lostâ€™,â€˜LOSTâ€™] };
const [cls, label] = m[s] || [â€˜p-newâ€™, s];
return `<span class="pill ${cls}">${label}</span>`;
}
function counts() {
document.getElementById(â€˜nc-leadsâ€™).textContent = ST.leads.filter(l => l.status === â€˜newâ€™).length;
document.getElementById(â€˜nc-fuâ€™).textContent = ST.leads.filter(l => l.followup && new Date(l.followup) <= new Date()).length;
document.getElementById(â€˜nc-alertsâ€™).textContent = ST.alerts.length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDash() {
const profit = ST.sold.reduce((s, x) => s + ((x.soldFor || 0) - (x.paid || 0)), 0);
document.getElementById(â€˜ds-leadsâ€™).textContent = ST.leads.length;
document.getElementById(â€˜ds-activeâ€™).textContent = ST.leads.filter(l => l.status === â€˜activeâ€™).length;
document.getElementById(â€˜ds-closedâ€™).textContent = ST.leads.filter(l => l.status === â€˜closedâ€™).length;
document.getElementById(â€˜ds-profitâ€™).textContent = fmtM(profit);

// Recent leads
const recent = ST.leads.slice(0, 5);
document.getElementById(â€˜dash-recentâ€™).innerHTML = recent.length ? recent.map(l =>
`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);" onclick="viewLead('${l.id}');event.stopPropagation()"> <div><div style="font-size:13px;font-weight:500;">${l.name}</div><div style="font-size:11px;color:var(--muted);">${l.device || 'â€”'}</div></div> ${sPill(l.status)} </div>`).join(â€™â€™) : â€˜<div style="color:var(--muted);font-size:12px;padding:10px 0;">No leads yet</div>â€™;

// Follow-ups due
const due = ST.leads.filter(l => l.followup && new Date(l.followup) <= new Date()).slice(0, 4);
document.getElementById(â€˜dash-fuâ€™).innerHTML = due.length ? due.map(l =>
`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);"> <div><div style="font-size:13px;font-weight:500;">${l.name}</div><div style="font-family:var(--M);font-size:10px;color:var(--red);">${l.followup}</div></div> <button class="btn btn-ghost btn-sm" onclick="viewLead('${l.id}')">View</button> </div>`).join(â€™â€™) : â€˜<div style="color:var(--muted);font-size:12px;padding:10px 0;">No follow-ups due</div>â€™;

// Pipeline summary
const stages = [[â€˜newâ€™,â€˜Newâ€™],[â€˜activeâ€™,â€˜Negotiatingâ€™],[â€˜followâ€™,â€˜Follow-Upâ€™],[â€˜closedâ€™,â€˜Closedâ€™],[â€˜lostâ€™,â€˜Lostâ€™]];
document.getElementById(â€˜dash-pipelineâ€™).innerHTML = stages.map(([k, label]) => {
const cnt = ST.leads.filter(l => l.status === k).length;
return `<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px;"><span>${label}</span><span style="font-family:var(--M);font-size:12px;">${cnt}</span></div>`;
}).join(â€™â€™);

// Top devices
const freq = {};
ST.leads.forEach(l => { if (l.device) { const k = l.device.split(â€™ â€˜).slice(0,3).join(â€™ â€˜); freq[k] = (freq[k] || 0) + 1; } });
const top = Object.entries(freq).sort((a,b) => b[1]-a[1]).slice(0, 5);
document.getElementById(â€˜dash-devicesâ€™).innerHTML = top.length ? top.map(([d,n]) =>
`<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px;"><span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px;">${d}</span><span style="font-family:var(--M);font-size:12px;color:var(--gold);">${n}x</span></div>`
).join(â€™â€™) : â€˜<div style="color:var(--muted);font-size:12px;padding:10px 0;">No devices yet</div>â€™;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LEADS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveLead() {
const name = document.getElementById(â€˜l-nameâ€™).value.trim();
if (!name) { toast(â€˜Name requiredâ€™, â€˜errorâ€™); return; }
const lead = {
id: editLeadId || uid(), name,
phone: document.getElementById(â€˜l-phoneâ€™).value.trim(),
device: document.getElementById(â€˜l-deviceâ€™).value.trim(),
cat: document.getElementById(â€˜l-catâ€™).value,
asking: parseFloat(document.getElementById(â€˜l-askingâ€™).value) || 0,
offer: parseFloat(document.getElementById(â€˜l-offerâ€™).value) || 0,
source: document.getElementById(â€˜l-sourceâ€™).value,
status: document.getElementById(â€˜l-statusâ€™).value,
notes: document.getElementById(â€˜l-notesâ€™).value.trim(),
followup: document.getElementById(â€˜l-followupâ€™).value,
added: editLeadId ? (ST.leads.find(l => l.id === editLeadId)?.added || new Date().toISOString()) : new Date().toISOString()
};
if (editLeadId) { const i = ST.leads.findIndex(l => l.id === editLeadId); if (i > -1) ST.leads[i] = lead; toast(â€˜Lead updated âœ“â€™); }
else { ST.leads.unshift(lead); toast(â€˜Lead added âœ“â€™); }
save(); closeModal(â€˜addLeadâ€™); renderLeads(); renderDash(); counts();
}

function renderLeads() {
const q = (document.getElementById(â€˜leadSearchâ€™)?.value || â€˜â€™).toLowerCase();
const rows = ST.leads.filter(l => l.name.toLowerCase().includes(q) || (l.phone || â€˜â€™).includes(q) || (l.device || â€˜â€™).toLowerCase().includes(q));
const tb = document.getElementById(â€˜leads-tbodyâ€™);
const em = document.getElementById(â€˜leads-emptyâ€™);
if (!rows.length) { tb.innerHTML = â€˜â€™; em.style.display = â€˜â€™; return; }
em.style.display = â€˜noneâ€™;
tb.innerHTML = rows.map(l => ` <tr onclick="viewLead('${l.id}')"> <td><div style="font-weight:500;">${l.name}</div><div style="font-family:var(--M);font-size:10px;color:var(--muted);">${l.phone || ''}</div></td> <td style="font-size:12px;">${l.device || 'â€”'}<div style="font-size:10px;color:var(--muted);">${l.cat || ''}</div></td> <td style="font-family:var(--M);color:var(--gold);font-size:12px;">${l.asking ? '$' + l.asking : 'â€”'}</td> <td>${sPill(l.status)}</td> <td class="hm" style="font-size:11px;color:var(--muted);">${l.source}</td> <td class="hm" style="font-family:var(--M);font-size:10px;color:var(--muted);">${fmtD(l.added)}</td> <td onclick="event.stopPropagation()"> <div style="display:flex;gap:4px;"> <button class="btn btn-ghost btn-sm" onclick="editLead('${l.id}')">Edit</button> <button class="btn btn-danger btn-sm" onclick="delLead('${l.id}')">âœ•</button> </div> </td> </tr>`).join(â€™â€™);
}

function viewLead(id) {
const l = ST.leads.find(x => x.id === id); if (!l) return;
document.getElementById(â€˜vl-titleâ€™).textContent = l.name.toUpperCase();
document.getElementById(â€˜vl-bodyâ€™).innerHTML = `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;"> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">PHONE</div><div style="font-family:var(--M);font-size:12px;">${l.phone || 'â€”'}</div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">STATUS</div>${sPill(l.status)}</div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">DEVICE</div><div style="font-size:13px;">${l.device || 'â€”'} <span style="font-size:10px;color:var(--muted);">${l.cat || ''}</span></div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">SOURCE</div><div style="font-size:13px;">${l.source}</div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">ASKING</div><div style="font-family:var(--M);color:var(--red);">${l.asking ? '$' + l.asking : 'â€”'}</div></div> <div><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">YOUR OFFER</div><div style="font-family:var(--M);color:var(--green);">${l.offer ? '$' + l.offer : 'â€”'}</div></div> ${l.followup ?`<div style="grid-column:1/-1"><div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-bottom:3px;">FOLLOW-UP</div><div style="font-family:var(--M);color:var(--purple);">${l.followup}</div></div>`: ''} </div> ${l.notes ?`<div style="background:var(--card2);border:1px solid var(--border);border-radius:2px;padding:10px;font-size:13px;color:#bbb;line-height:1.6;">${l.notes}</div>` : ''}`;
document.getElementById(â€˜vl-footerâ€™).innerHTML = ` <button class="btn btn-ghost" onclick="closeModal('viewLead')">Close</button> <button class="btn btn-ghost" onclick="closeModal('viewLead');editLead('${l.id}')">Edit</button> <button class="btn btn-gold" onclick="closeModal('viewLead');markBought('${l.id}')">Mark Bought â†’</button>`;
openModal(â€˜viewLeadâ€™);
}

function editLead(id) {
const l = ST.leads.find(x => x.id === id); if (!l) return;
editLeadId = id;
document.getElementById(â€˜lead-modal-titleâ€™).textContent = â€˜EDIT LEADâ€™;
document.getElementById(â€˜l-nameâ€™).value = l.name;
document.getElementById(â€˜l-phoneâ€™).value = l.phone || â€˜â€™;
document.getElementById(â€˜l-deviceâ€™).value = l.device || â€˜â€™;
document.getElementById(â€˜l-catâ€™).value = l.cat || â€˜Phoneâ€™;
document.getElementById(â€˜l-askingâ€™).value = l.asking || â€˜â€™;
document.getElementById(â€˜l-offerâ€™).value = l.offer || â€˜â€™;
document.getElementById(â€˜l-sourceâ€™).value = l.source;
document.getElementById(â€˜l-statusâ€™).value = l.status;
document.getElementById(â€˜l-notesâ€™).value = l.notes || â€˜â€™;
document.getElementById(â€˜l-followupâ€™).value = l.followup || â€˜â€™;
openModal(â€˜addLeadâ€™);
}

function delLead(id) {
if (!confirm(â€˜Delete this lead?â€™)) return;
ST.leads = ST.leads.filter(l => l.id !== id);
save(); renderLeads(); renderDash(); counts(); toast(â€˜Deletedâ€™);
}

function markBought(id) {
const l = ST.leads.find(x => x.id === id); if (!l) return;
l.status = â€˜closedâ€™;
document.getElementById(â€˜i-deviceâ€™).value = l.device || â€˜â€™;
document.getElementById(â€˜i-catâ€™).value = l.cat || â€˜Phoneâ€™;
document.getElementById(â€˜i-paidâ€™).value = l.offer || l.asking || â€˜â€™;
document.getElementById(â€˜i-notesâ€™).value = l.notes || â€˜â€™;
[â€˜i-imeiâ€™,â€˜i-targetâ€™].forEach(f => document.getElementById(f).value = â€˜â€™);
save(); renderLeads(); openModal(â€˜addInventoryâ€™);
}

function exportLeads() {
const rows = [[â€˜Nameâ€™,â€˜Phoneâ€™,â€˜Deviceâ€™,â€˜Catâ€™,â€˜Askingâ€™,â€˜Offerâ€™,â€˜Statusâ€™,â€˜Sourceâ€™,â€˜Notesâ€™,â€˜Addedâ€™]];
ST.leads.forEach(l => rows.push([l.name, l.phone, l.device, l.cat, l.asking, l.offer, l.status, l.source, l.notes, fmtD(l.added)]));
dlCSV(â€˜leads.csvâ€™, rows);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PIPELINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STAGES = [
{ key:â€˜newâ€™, label:â€˜Newâ€™, c:â€˜var(â€“blue)â€™ },
{ key:â€˜activeâ€™, label:â€˜Negotiatingâ€™, c:â€˜var(â€“gold)â€™ },
{ key:â€˜followâ€™, label:â€˜Follow-Upâ€™, c:â€˜var(â€“purple)â€™ },
{ key:â€˜closedâ€™, label:â€˜Bought âœ“â€™, c:â€˜var(â€“green)â€™ },
{ key:â€˜lostâ€™, label:â€˜Lostâ€™, c:â€˜var(â€“red)â€™ }
];

function renderPipeline() {
document.getElementById(â€˜pipeline-boardâ€™).innerHTML = STAGES.map(st => {
const leads = ST.leads.filter(l => l.status === st.key);
return `<div class="pipe-col"> <div class="pipe-head" style="border-top:2px solid ${st.c}"> <span>${st.label}</span> <span style="background:var(--sub);color:var(--muted);border-radius:10px;padding:1px 6px;font-size:10px;">${leads.length}</span> </div> <div class="pipe-cards"> ${leads.length ? leads.map(l => `
<div class="pipe-card" onclick="viewLead('${l.id}')">
<div style="font-size:12px;font-weight:500;">${l.name}</div>
<div style="font-size:10px;color:var(--muted);">${l.device || â€˜No deviceâ€™}</div>
${l.asking ? `<div style="font-family:var(--M);font-size:10px;color:var(--gold);margin-top:4px;">$${l.asking}</div>` : â€˜â€™}
</div>`).join('') : '<div style="color:var(--sub);font-size:10px;text-align:center;padding:12px;font-family:var(--M);">Empty</div>'} </div> </div>`;
}).join(â€™â€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FOLLOW-UPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFollowups() {
const today = new Date(); today.setHours(23,59,59,999);
const in7 = new Date(); in7.setDate(in7.getDate() + 7);
const due = ST.leads.filter(l => l.followup && new Date(l.followup) <= new Date());
const upcoming = ST.leads.filter(l => l.followup && new Date(l.followup) > new Date() && new Date(l.followup) <= in7);
const fuItem = l => `<div class="fu-item"> <div class="fu-av">${l.name[0].toUpperCase()}</div> <div style="flex:1;min-width:0;"> <div style="font-weight:500;font-size:13px;">${l.name}</div> <div style="font-size:11px;color:var(--muted);">${l.device || 'â€”'}</div> <div style="font-family:var(--M);font-size:10px;margin-top:2px;color:${new Date(l.followup) < new Date() ? 'var(--red)' : 'var(--purple)'};">${l.followup}</div> </div> <div style="display:flex;gap:6px;flex-shrink:0;"> ${l.phone ?`<a href="tel:${l.phone}" class="btn btn-green btn-sm">ğŸ“</a>` : ''} <button class="btn btn-ghost btn-sm" onclick="viewLead('${l.id}')">View</button> </div> </div>`;
document.getElementById(â€˜fu-dueâ€™).innerHTML = due.length ? due.map(fuItem).join(â€™â€™) : â€˜<div style="color:var(--muted);font-size:12px;padding:8px 0;">None overdue âœ“</div>â€™;
document.getElementById(â€˜fu-upcomingâ€™).innerHTML = upcoming.length ? upcoming.map(fuItem).join(â€™â€™) : â€˜<div style="color:var(--muted);font-size:12px;padding:8px 0;">No upcoming follow-ups</div>â€™;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AI ASSISTANT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const AI_MODES = {
negotiate: {
sys: `You are an expert reseller negotiation coach for Trey Buyback. The business buys used/damaged phones, MacBooks, consoles, cameras, iPads for resale. When given a seller conversation, provide word-for-word scripts the buyer should say. Format scripts in bold. Keep responses concise and tactical.`,
prompts: [â€˜Paste a seller convo â€” I'll write your next messageâ€™, â€˜Seller won't budge on price â€” help meâ€™, â€˜How do I bring up that I need to make profit?â€™, â€˜Seller ghosted after my offerâ€™]
},
deal: {
sys: `You are a used electronics deal analyzer for Trey Buyback. Given an item and asking price, analyze: current market value, eBay net after 13.25% fee + $12 shipping, max buy price (68% of net), estimated profit, and a clear BUY / PASS / NEGOTIATE verdict. Be direct and numbers-focused.`,
prompts: [â€˜iPhone 15 Pro 256GB â€” seller wants $600â€™, â€˜PS5 Disc, asking $300 â€” is it worth it?â€™, â€˜MacBook Pro M2, cracked screen, asking $400â€™, â€˜iPhone 13 bad ESN, they want $150â€™]
},
objection: {
sys: `You are an objection handling expert for Trey Buyback, a used electronics buying business. Give short, word-for-word responses the buyer should say to overcome seller objections. Focus on same-day cash, convenience, and empathy. Keep scripts natural and conversational.`,
prompts: [â€™â€œI'll just sell it myselfâ€ â€” what do I say?â€™, â€˜Seller says someone else offered moreâ€™, â€˜They're being rude and unresponsiveâ€™, â€˜Seller suddenly wants more than listed priceâ€™]
},
ad: {
sys: `You are a Facebook Marketplace and Craigslist ad copywriter for Trey Buyback, a local cash electronics buyer. Write compelling "WE BUY" ad copy that gets sellers to reach out. No Apple/brand logos mentioned. Focus on: instant cash, free pickup, no hassle, all conditions accepted. Create 2-3 variations.`,
prompts: [â€˜Write a general â€œwe buy phonesâ€ adâ€™, â€˜Ad targeting people with cracked iPhonesâ€™, â€˜Write a Craigslist post for buying MacBooksâ€™, â€˜Holiday season ad â€” people need cashâ€™]
}
};

function setMode(mode, btn) {
aiMode = mode;
document.querySelectorAll(â€™.ai-mode-btnâ€™).forEach(b => b.classList.remove(â€˜activeâ€™));
btn.classList.add(â€˜activeâ€™);
renderAIPrompts();
}

function renderAIPrompts() {
const prompts = AI_MODES[aiMode]?.prompts || [];
document.getElementById(â€˜ai-qbtnsâ€™).innerHTML = prompts.map(p =>
`<div class="ai-qbtn" onclick="usePrompt(this)">${p}</div>`).join(â€™â€™);
}

function renderAI() {
renderAIPrompts();
renderAIChat();
}

function renderAIChat() {
const chat = document.getElementById(â€˜ai-chatâ€™);
chat.innerHTML = aiHistory.map(m => ` <div class="ai-msg ${m.role}"> <div class="ai-av ${m.role === 'assistant' ? 'bot' : 'user'}">${m.role === 'assistant' ? 'ğŸ¤–' : 'T'}</div> <div class="ai-bubble ${m.role === 'assistant' ? 'bot' : 'user'}">${formatAIMsg(m.content)}</div> </div>`).join(â€™â€™);
chat.scrollTop = chat.scrollHeight;
}

function formatAIMsg(text) {
return text
.replace(/**(.*?)**/g, â€˜<strong>$1</strong>â€™)
.replace(/^> (.+)$/gm, â€˜<div class="ai-sline">$1</div>â€™)
.replace(/\n\n/g, â€˜<br><br>â€™)
.replace(/\n/g, â€˜<br>â€™);
}

function usePrompt(el) { document.getElementById(â€˜ai-inputâ€™).value = el.textContent; sendMsg(); }

function aiKey(e) {
if (e.key === â€˜Enterâ€™ && !e.shiftKey) { e.preventDefault(); sendMsg(); }
}

async function sendMsg() {
const input = document.getElementById(â€˜ai-inputâ€™);
const msg = input.value.trim();
if (!msg) return;
input.value = â€˜â€™;
const btn = document.getElementById(â€˜ai-sendâ€™);
btn.disabled = true;
aiHistory.push({ role: â€˜userâ€™, content: msg });
renderAIChat();

// Add typing indicator
const chat = document.getElementById(â€˜ai-chatâ€™);
const typing = document.createElement(â€˜divâ€™);
typing.className = â€˜ai-msgâ€™;
typing.innerHTML = â€˜<div class="ai-av bot">ğŸ¤–</div><div class="ai-bubble bot"><div class="dots"><span></span><span></span><span></span></div></div>â€™;
chat.appendChild(typing);
chat.scrollTop = chat.scrollHeight;

try {
const sys = AI_MODES[aiMode]?.sys || AI_MODES.negotiate.sys;
const res = await fetch(â€˜https://api.anthropic.com/v1/messagesâ€™, {
method: â€˜POSTâ€™,
headers: { â€˜Content-Typeâ€™: â€˜application/jsonâ€™ },
body: JSON.stringify({
model: â€˜claude-sonnet-4-20250514â€™,
max_tokens: 800,
system: sys,
messages: aiHistory.map(m => ({ role: m.role, content: m.content }))
})
});
const data = await res.json();
const reply = data.content?.[0]?.text || â€˜Sorry, I had trouble connecting. Try again.â€™;
aiHistory.push({ role: â€˜assistantâ€™, content: reply });
} catch(e) {
aiHistory.push({ role: â€˜assistantâ€™, content: â€˜Connection error â€” check your internet and try again.â€™ });
}
chat.removeChild(typing);
btn.disabled = false;
renderAIChat();
}

function clearChat() {
aiHistory = [{ role: â€˜assistantâ€™, content: â€œChat cleared. What do you need help with?â€ }];
renderAIChat();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PRICE CHECKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let lastQ = â€˜â€™;

function setCat(el) {
document.querySelectorAll(â€™.ecatâ€™).forEach(e => e.classList.remove(â€˜activeâ€™));
el.classList.add(â€˜activeâ€™);
}

function soldLink(platform) {
const q = document.getElementById(â€˜pc-qâ€™).value.trim() || lastQ;
if (!q) { toast(â€˜Enter an item firstâ€™, â€˜errorâ€™); return; }
const enc = encodeURIComponent(q);
const urls = {
ebay: `https://www.ebay.com/sch/i.html?_nkw=${enc}&LH_Complete=1&LH_Sold=1&_sop=13`,
swappa: `https://swappa.com/buy/${q.toLowerCase().replace(/\s+/g, '-')}`,
fb: `https://www.facebook.com/marketplace/search/?query=${enc}`
};
window.open(urls[platform], â€˜_blankâ€™);
}

async function getEbayToken() {
if (!KEYS.ebay) return null;
try {
const r = await fetch(â€˜https://api.ebay.com/identity/v1/oauth2/tokenâ€™, {
method: â€˜POSTâ€™,
headers: { â€˜Content-Typeâ€™: â€˜application/x-www-form-urlencodedâ€™, â€˜Authorizationâ€™: â€™Basic â€™ + btoa(KEYS.ebay + â€˜:â€™) },
body: â€˜grant_type=client_credentials&scope=https%3A%2F%2Fapi.ebay.com%2Foauth%2Fapi_scopeâ€™
});
const d = await r.json();
return d.access_token || null;
} catch(e) { return null; }
}

function condFilter(c) {
if (c === â€˜newâ€™) return â€˜&filter=conditionIds:{1000|1500}â€™;
if (c === â€˜usedâ€™) return â€˜&filter=conditionIds:{3000|2500|2750}â€™;
if (c === â€˜damagedâ€™ || c === â€˜brokenâ€™) return â€˜&filter=conditionIds:{7000}â€™;
return â€˜â€™;
}

async function runCheck() {
const q = document.getElementById(â€˜pc-qâ€™).value.trim();
const cond = document.getElementById(â€˜pc-condâ€™).value;
if (!q) { toast(â€˜Enter an item to searchâ€™, â€˜errorâ€™); return; }
lastQ = q;
const btn = document.getElementById(â€˜pc-btnâ€™);
btn.textContent = â€˜Checkingâ€¦â€™; btn.disabled = true;
const res = document.getElementById(â€˜pc-resultsâ€™);
res.innerHTML = `<div style="text-align:center;padding:50px;color:var(--muted);"><div style="font-size:28px;margin-bottom:10px;">ğŸ”</div><div style="font-family:var(--M);font-size:11px;letter-spacing:1px;">Searching for "${q}"â€¦</div></div>`;

let ebayItems = [];
if (KEYS.ebay) {
try {
const token = await getEbayToken();
if (token) {
const url = `https://api.ebay.com/buy/browse/v1/item_summary/search?q=${encodeURIComponent(q)}&limit=8&sort=newlyListed${condFilter(cond)}`;
const r = await fetch(url, { headers: { â€˜Authorizationâ€™: â€™Bearer â€™ + token, â€˜X-EBAY-C-MARKETPLACE-IDâ€™: â€˜EBAY_USâ€™ } });
const d = await r.json();
if (d.itemSummaries?.length) {
ebayItems = d.itemSummaries.map(i => ({
title: i.title, price: parseFloat(i.price?.value || 0),
condition: i.condition || â€˜Usedâ€™, url: i.itemWebUrl || â€˜https://ebay.comâ€™,
image: i.image?.imageUrl || null, platform: â€˜eBayâ€™, daysAgo: Math.floor(Math.random() * 6) + 1
}));
}
}
} catch(e) { console.log(â€˜eBay API error:â€™, e); }
}

try {
const sys = `You are a used electronics pricing expert. Return ONLY valid JSON, no markdown fences: {"avgSell":NUM,"ebayFee":13.25,"shipping":12,"notes":"STRING","buyTip":"STRING","comps":[{"title":"STRING","price":NUM,"platform":"eBay","condition":"STRING","daysAgo":NUM,"url":"STRING"},{"title":"STRING","price":NUM,"platform":"Swappa","condition":"STRING","daysAgo":NUM,"url":"STRING"},{"title":"STRING","price":NUM,"platform":"FB Marketplace","condition":"STRING","daysAgo":NUM,"url":"STRING"}]} Rules: Realistic 2025 market prices. Damaged/parts=30-50% of working. Bad ESN=40-60%. Broken=20-35%. All URLs must be real and clickable.`;
const aiR = await fetch(â€˜https://api.anthropic.com/v1/messagesâ€™, {
method: â€˜POSTâ€™,
headers: { â€˜Content-Typeâ€™: â€˜application/jsonâ€™ },
body: JSON.stringify({ model: â€˜claude-sonnet-4-20250514â€™, max_tokens: 800, system: sys, messages: [{ role: â€˜userâ€™, content: `Device: ${q}\nCondition: ${cond}` }] })
});
const aiD = await aiR.json();
const raw = aiD.content?.[0]?.text || â€˜{}â€™;
const d = JSON.parse(raw.replace(/`json|`/g, â€˜â€™).trim());
const avg = ebayItems.length > 0 ? Math.round(ebayItems.slice(0,5).reduce((s,i) => s+i.price, 0) / Math.min(ebayItems.length,5)) : (d.avgSell || 0);
const fee = d.ebayFee || 13.25; const ship = d.shipping || 12;
const feeAmt = Math.round(avg * (fee / 100));
const net = avg - feeAmt - ship;
const maxBuy = Math.round(net * 0.68);
const profit = net - maxBuy;
const enc = encodeURIComponent(q);
const allComps = [â€¦ebayItems.slice(0,4), â€¦(d.comps || [])].slice(0, 8);

```
res.innerHTML = `
  <div class="ext-links" style="margin-bottom:12px;">
    <a class="ext-card" href="https://www.ebay.com/sch/i.html?_nkw=${enc}&LH_Complete=1&LH_Sold=1&_sop=13" target="_blank" rel="noopener">
      <div class="ext-icon">ğŸ›’</div><div class="ext-label">eBay Sold</div><div class="ext-sub">Pre-filtered â†’</div>
    </a>
    <a class="ext-card" href="https://swappa.com/buy/${q.toLowerCase().replace(/\s+/g,'-')}" target="_blank" rel="noopener">
      <div class="ext-icon">ğŸ”„</div><div class="ext-label">Swappa</div><div class="ext-sub">Used market â†’</div>
    </a>
    <a class="ext-card" href="https://www.facebook.com/marketplace/search/?query=${enc}" target="_blank" rel="noopener">
      <div class="ext-icon">ğŸ“</div><div class="ext-label">FB Marketplace</div><div class="ext-sub">Local â†’</div>
    </a>
  </div>
  <div class="price-hero">
    <div class="ph-cell"><div class="ph-label">Avg Sell Price</div><div class="ph-val gold">$${avg}</div><div class="ph-sub">${ebayItems.length ? 'Live eBay data' : 'AI estimate'}</div></div>
    <div class="ph-cell"><div class="ph-label">Net After Fees</div><div class="ph-val green">$${net}</div><div class="ph-sub">${fee}% + $${ship} ship</div></div>
    <div class="ph-cell"><div class="ph-label">Max Buy Price</div><div class="ph-val orange">$${maxBuy}</div><div class="ph-sub">~$${profit} profit</div></div>
  </div>
  <div class="panel" style="margin-bottom:12px;">
    <div class="panel-title">FEE BREAKDOWN</div>
    <div class="fee-row"><span class="fee-key">Avg Sell Price</span><span class="fee-val" style="color:var(--gold);">$${avg}</span></div>
    <div class="fee-row"><span class="fee-key">eBay Fee (${fee}%)</span><span class="fee-val" style="color:var(--red);">-$${feeAmt}</span></div>
    <div class="fee-row"><span class="fee-key">Estimated Shipping</span><span class="fee-val" style="color:var(--red);">-$${ship}</span></div>
    <div class="fee-row"><span class="fee-key">Your Net</span><span class="fee-val" style="color:var(--green);">$${net}</span></div>
    <div class="fee-row"><span class="fee-key">Max Buy Price (68%)</span><span class="fee-val" style="color:var(--orange);">$${maxBuy}</span></div>
    <div class="fee-row"><span class="fee-key">Estimated Profit</span><span class="fee-val" style="color:var(--green);">$${profit}</span></div>
  </div>
  <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;">${ebayItems.length ? 'LIVE EBAY LISTINGS' : 'MARKET COMPS'} â€” click to open</div>
  ${allComps.map(c => {
    const cn = Math.round(c.price * (1 - fee/100) - ship);
    const ptc = c.platform === 'eBay' ? 'pt-ebay' : c.platform === 'Swappa' ? 'pt-swappa' : 'pt-fb';
    return `<div class="listing-card">
      ${c.image ? `<img class="listing-thumb" src="${c.image}" onerror="this.style.display='none'" loading="lazy">` : ''}
      <div class="listing-info">
        <div class="listing-title"><a href="${c.url}" target="_blank" rel="noopener">${c.title}</a></div>
        <div class="listing-meta">${c.condition || 'Used'}${c.daysAgo ? ' Â· ' + c.daysAgo + 'd ago' : ''}</div>
        <div class="listing-net">Net after fees: ~$${cn}</div>
        <span class="plat-tag ${ptc}">${c.platform}</span>
      </div>
      <div class="listing-price">
        <div class="lp-amt">$${c.price}</div>
        <div class="lp-net">~$${cn} net</div>
        <a href="${c.url}" target="_blank" rel="noopener" style="display:block;margin-top:5px;font-family:var(--M);font-size:10px;color:var(--teal);text-decoration:none;">View â†’</a>
      </div>
    </div>`;
  }).join('')}
  ${d.buyTip ? `<div style="background:rgba(45,212,191,.07);border:1px solid rgba(45,212,191,.2);border-radius:2px;padding:11px 13px;margin-top:10px;font-size:13px;color:#80e0d8;line-height:1.7;">ğŸ’¡ ${d.buyTip}</div>` : ''}
  ${d.notes ? `<div style="background:var(--card);border:1px solid var(--border);border-radius:2px;padding:11px 13px;margin-top:8px;font-size:12px;color:#777;line-height:1.7;">ğŸ“Š ${d.notes}</div>` : ''}
  <div style="margin-top:12px;display:flex;gap:8px;">
    <button class="btn btn-gold" style="flex:1;" onclick="addLeadFromPC('${q.replace(/'/g,"\\'")}',${maxBuy})">+ Add as Lead at $${maxBuy}</button>
    <button class="btn btn-ghost btn-sm" onclick="nav('calc')">Flip Calc</button>
  </div>`;
```

} catch(e) {
const enc = encodeURIComponent(q);
res.innerHTML = ` <div class="ext-links"> <a class="ext-card" href="https://www.ebay.com/sch/i.html?_nkw=${enc}&LH_Complete=1&LH_Sold=1" target="_blank"><div class="ext-icon">ğŸ›’</div><div class="ext-label">eBay Sold</div><div class="ext-sub">Search manually â†’</div></a> <a class="ext-card" href="https://swappa.com/buy/${q.toLowerCase().replace(/\s+/g,'-')}" target="_blank"><div class="ext-icon">ğŸ”„</div><div class="ext-label">Swappa</div></a> <a class="ext-card" href="https://www.facebook.com/marketplace/search/?query=${enc}" target="_blank"><div class="ext-icon">ğŸ“</div><div class="ext-label">FB Marketplace</div></a> </div> <div class="empty"><div class="empty-icon">âš ï¸</div>Could not load pricing data â€” check your connection and try again.</div>`;
}
btn.textContent = â€˜Check â†’â€™; btn.disabled = false;
}

function addLeadFromPC(device, maxBuy) {
document.getElementById(â€˜l-deviceâ€™).value = device;
document.getElementById(â€˜l-offerâ€™).value = maxBuy > 0 ? maxBuy : â€˜â€™;
document.getElementById(â€˜l-sourceâ€™).value = â€˜FB Marketplaceâ€™;
openModal(â€˜addLeadâ€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FLIP CALC â€” ATLAS MOBILE PRICING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ATLAS = {
â€œiPhone 7â€:        { â€œ32GBâ€: [38,30,22,16,9,4],    â€œ128GBâ€: [45,35,26,20,12,5],    â€œ256GBâ€: [50,40,30,23,14,6] },
â€œiPhone 7 Plusâ€:   { â€œ32GBâ€: [50,40,30,22,13,5],   â€œ128GBâ€: [58,46,35,26,16,6],    â€œ256GBâ€: [65,52,40,30,18,7] },
â€œiPhone 8â€:        { â€œ64GBâ€: [55,44,33,25,15,6],   â€œ128GBâ€: [62,50,38,28,17,7],    â€œ256GBâ€: [70,56,42,31,19,8] },
â€œiPhone 8 Plusâ€:   { â€œ64GBâ€: [70,56,42,31,19,8],   â€œ128GBâ€: [78,62,47,35,21,9],    â€œ256GBâ€: [85,68,51,38,23,10] },
â€œiPhone Xâ€:        { â€œ64GBâ€: [85,68,51,38,23,9],   â€œ256GBâ€: [95,76,57,42,26,11] },
â€œiPhone XRâ€:       { â€œ64GBâ€: [90,72,54,40,24,10],  â€œ128GBâ€: [100,80,60,44,27,11],  â€œ256GBâ€: [110,88,66,49,30,12] },
â€œiPhone XSâ€:       { â€œ64GBâ€: [95,76,57,43,26,11],  â€œ256GBâ€: [110,88,66,49,30,12],  â€œ512GBâ€: [125,100,75,55,34,14] },
â€œiPhone XS Maxâ€:   { â€œ64GBâ€: [105,84,63,47,29,12], â€œ256GBâ€: [120,96,72,53,32,13],  â€œ512GBâ€: [135,108,81,60,37,15] },
â€œiPhone 11â€:       { â€œ64GBâ€: [110,88,66,49,30,12], â€œ128GBâ€: [120,96,72,53,32,13],  â€œ256GBâ€: [135,108,81,60,37,15] },
â€œiPhone 11 Proâ€:   { â€œ64GBâ€: [145,116,87,64,39,16],â€œ256GBâ€: [160,128,96,71,43,18], â€œ512GBâ€: [180,144,108,80,49,20] },
â€œiPhone 11 Pro Maxâ€:{â€œ64GBâ€:[155,124,93,69,42,17], â€œ256GBâ€: [175,140,105,78,48,19],â€œ512GBâ€: [195,156,117,86,53,22] },
â€œiPhone 12â€:       { â€œ64GBâ€: [150,120,90,66,41,17],â€œ128GBâ€: [165,132,99,73,45,18], â€œ256GBâ€: [180,144,108,80,49,20] },
â€œiPhone 12 Miniâ€:  { â€œ64GBâ€: [130,104,78,58,35,14],â€œ128GBâ€: [145,116,87,64,39,16], â€œ256GBâ€: [160,128,96,71,43,18] },
â€œiPhone 12 Proâ€:   { â€œ128GBâ€:[185,148,111,82,50,21],â€œ256GBâ€:[200,160,120,89,54,22],â€œ512GBâ€:[220,176,132,98,60,25] },
â€œiPhone 12 Pro Maxâ€:{â€œ128GBâ€:[195,156,117,86,53,22],â€œ256GBâ€:[215,172,129,95,58,24],â€œ512GBâ€:[235,188,141,104,64,26] },
â€œiPhone 13â€:       { â€œ128GBâ€:[200,160,120,89,54,22],â€œ256GBâ€:[220,176,132,98,60,25],â€œ512GBâ€:[245,196,147,109,67,27] },
â€œiPhone 13 Miniâ€:  { â€œ128GBâ€:[170,136,102,75,46,19],â€œ256GBâ€:[190,152,114,84,52,21],â€œ512GBâ€:[210,168,126,93,57,23] },
â€œiPhone 13 Proâ€:   { â€œ128GBâ€:[240,192,144,107,65,27],â€œ256GBâ€:[260,208,156,115,71,29],â€œ512GBâ€:[285,228,171,126,77,32],â€œ1TBâ€:[310,248,186,138,84,35] },
â€œiPhone 13 Pro Maxâ€:{â€œ128GBâ€:[255,204,153,113,69,28],â€œ256GBâ€:[278,222,167,123,75,31],â€œ512GBâ€:[305,244,183,135,83,34],â€œ1TBâ€:[330,264,198,147,90,37] },
â€œiPhone 14â€:       { â€œ128GBâ€:[255,204,153,113,69,28],â€œ256GBâ€:[278,222,167,123,75,31],â€œ512GBâ€:[305,244,183,135,83,34] },
â€œiPhone 14 Plusâ€:  { â€œ128GBâ€:[230,184,138,102,62,26],â€œ256GBâ€:[252,202,151,112,68,28],â€œ512GBâ€:[275,220,165,122,75,31] },
â€œiPhone 14 Proâ€:   { â€œ128GBâ€:[320,256,192,142,87,36],â€œ256GBâ€:[345,276,207,153,93,38],â€œ512GBâ€:[375,300,225,166,102,42],â€œ1TBâ€:[405,324,243,180,110,45] },
â€œiPhone 14 Pro Maxâ€:{â€œ128GBâ€:[345,276,207,153,93,38],â€œ256GBâ€:[370,296,222,164,100,41],â€œ512GBâ€:[400,320,240,178,109,45],â€œ1TBâ€:[430,344,258,191,117,48] },
â€œiPhone 15â€:       { â€œ128GBâ€:[340,272,204,151,92,38],â€œ256GBâ€:[365,292,219,162,99,41],â€œ512GBâ€:[395,316,237,175,107,44] },
â€œiPhone 15 Plusâ€:  { â€œ128GBâ€:[310,248,186,138,84,35],â€œ256GBâ€:[335,268,201,149,91,37],â€œ512GBâ€:[365,292,219,162,99,41] },
â€œiPhone 15 Proâ€:   { â€œ128GBâ€:[420,336,252,186,114,47],â€œ256GBâ€:[450,360,270,200,122,50],â€œ512GBâ€:[490,392,294,217,133,55],â€œ1TBâ€:[530,424,318,235,144,59] },
â€œiPhone 15 Pro Maxâ€:{â€œ256GBâ€:[480,384,288,213,130,54],â€œ512GBâ€:[520,416,312,231,141,58],â€œ1TBâ€:[565,452,339,251,153,63] },
â€œiPhone 16â€:       { â€œ128GBâ€:[430,344,258,191,117,48],â€œ256GBâ€:[460,368,276,204,125,51],â€œ512GBâ€:[500,400,300,222,136,56] },
â€œiPhone 16 Plusâ€:  { â€œ128GBâ€:[395,316,237,175,107,44],â€œ256GBâ€:[425,340,255,189,115,47],â€œ512GBâ€:[465,372,279,206,126,52] },
â€œiPhone 16 Proâ€:   { â€œ128GBâ€:[520,416,312,231,141,58],â€œ256GBâ€:[555,444,333,246,151,62],â€œ512GBâ€:[600,480,360,266,163,67],â€œ1TBâ€:[645,516,387,286,175,72] },
â€œiPhone 16 Pro Maxâ€:{â€œ256GBâ€:[590,472,354,262,160,66],â€œ512GBâ€:[635,508,381,282,172,71],â€œ1TBâ€:[680,544,408,302,185,76] }
};
const GRADE_LABELS = [â€˜SWAPâ€™,â€˜Aâ€™,â€˜Bâ€™,â€˜Câ€™,â€˜Dâ€™,â€˜DOAâ€™];
const GRADE_KEYS = [â€˜swapâ€™,â€˜aâ€™,â€˜bâ€™,â€˜câ€™,â€˜dâ€™,â€˜doaâ€™];

function buildCalcModels() {
const sel = document.getElementById(â€˜c-modelâ€™);
Object.keys(ATLAS).forEach(m => { const o = document.createElement(â€˜optionâ€™); o.value = m; o.textContent = m; sel.appendChild(o); });
}

function calcStorage() {
const model = document.getElementById(â€˜c-modelâ€™).value;
const sel = document.getElementById(â€˜c-storageâ€™);
sel.innerHTML = â€˜<option value="">â€” Select â€”</option>â€™;
if (!model || !ATLAS[model]) { calcUpdate(); return; }
Object.keys(ATLAS[model]).forEach(s => { const o = document.createElement(â€˜optionâ€™); o.value = s; o.textContent = s; sel.appendChild(o); });
calcUpdate();
}

function setGrade(g, el) {
calcGrade = g;
document.querySelectorAll(â€™.cbtnâ€™).forEach(b => {
b.style.background = â€˜var(â€“card2)â€™; b.style.borderColor = â€˜var(â€“border2)â€™; b.style.color = â€˜var(â€“muted)â€™;
});
el.style.background = â€˜var(â€“gold)â€™; el.style.borderColor = â€˜var(â€“gold)â€™; el.style.color = â€˜#000â€™;
calcUpdate();
}

function togDed(key, el) {
calcDeds[key] = !calcDeds[key];
el.classList.toggle(â€˜onâ€™, calcDeds[key]);
calcUpdate();
}

function calcUpdate() {
const model = document.getElementById(â€˜c-modelâ€™).value;
const storage = document.getElementById(â€˜c-storageâ€™).value;
const lock = document.getElementById(â€˜c-lockâ€™).value;
const minProfit = parseFloat(document.getElementById(â€˜c-profitâ€™).value) || 40;
const riskBuf = parseFloat(document.getElementById(â€˜c-riskâ€™).value) || 20;
const asking = parseFloat(document.getElementById(â€˜c-askingâ€™).value) || 0;
const res = document.getElementById(â€˜calc-resultâ€™);

if (!model || !storage || !ATLAS[model] || !ATLAS[model][storage]) {
res.innerHTML = â€˜<div style="padding:50px;text-align:center;color:var(--muted);font-family:var(--M);font-size:11px;letter-spacing:1px;">SELECT MODEL + STORAGE</div>â€™;
return;
}

const gi = GRADE_KEYS.indexOf(calcGrade);
let atlasVal = ATLAS[model][storage][gi] || 0;
if (lock === â€˜lockedâ€™) atlasVal = Math.round(atlasVal * 0.88);
let deds = 0;
if (calcDeds.back) deds += Math.round(atlasVal * 0.06);
if (calcDeds.lens) deds += Math.round(atlasVal * 0.05);
if (calcDeds.batt) deds += Math.round(atlasVal * 0.08);
if (calcDeds.rep) deds += Math.round(atlasVal * 0.10);
const netAtlas = atlasVal - deds;
const maxBuy = Math.max(0, netAtlas - minProfit - riskBuf);
const estProfit = netAtlas - maxBuy;

let verdict = â€˜â€™, verdictColor = â€˜var(â€“muted)â€™;
if (asking > 0) {
if (asking <= maxBuy * 0.85) { verdict = â€˜ğŸ”¥ STEAL â€” BUY NOWâ€™; verdictColor = â€˜var(â€“green)â€™; }
else if (asking <= maxBuy) { verdict = â€˜âœ“ GOOD DEAL â€” BUYâ€™; verdictColor = â€˜var(â€“green)â€™; }
else if (asking <= maxBuy * 1.15) { verdict = â€˜âš¡ NEGOTIATE DOWNâ€™; verdictColor = â€˜var(â€“gold)â€™; }
else { verdict = â€˜âœ• PASS â€” TOO HIGHâ€™; verdictColor = â€˜var(â€“red)â€™; }
}

const allGrades = GRADE_KEYS.map((g, i) => {
let v = ATLAS[model][storage][i] || 0;
if (lock === â€˜lockedâ€™) v = Math.round(v * 0.88);
return { g: GRADE_LABELS[i], v };
});

res.innerHTML = `<div style="background:var(--card2);border-bottom:1px solid var(--border);padding:16px 18px;display:flex;align-items:center;justify-content:space-between;"> <div><div style="font-family:var(--D);font-size:22px;letter-spacing:1px;">${model}</div> <div style="font-family:var(--M);font-size:10px;color:var(--muted);">${storage} Â· ${lock === 'locked' ? 'Carrier Locked' : 'Unlocked'} Â· Grade ${GRADE_LABELS[gi]}</div></div> ${verdict ?`<div style="font-family:var(--D);font-size:16px;letter-spacing:1px;color:${verdictColor};">${verdict}</div>`: ''} </div> <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1px;background:var(--border);"> <div style="background:var(--card);padding:16px;text-align:center;"><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Atlas Value</div><div style="font-family:var(--D);font-size:30px;color:var(--blue);">$${atlasVal}</div></div> <div style="background:var(--card);padding:16px;text-align:center;"><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Max Buy</div><div style="font-family:var(--D);font-size:30px;color:var(--gold);">$${maxBuy}</div></div> <div style="background:var(--card);padding:16px;text-align:center;"><div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;">Est. Profit</div><div style="font-family:var(--D);font-size:30px;color:var(--green);">$${estProfit}</div></div> </div> ${asking > 0 ?`
<div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;">
<span style="font-size:13px;">Seller asking</span><span style="font-family:var(--D);font-size:22px;color:${asking > maxBuy ? 'var(--red)':'var(--green)'};">$${asking}</span>
</div>`: ''} ${deds > 0 ?`
<div style="padding:12px 16px;border-bottom:1px solid var(--border);">
<div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:7px;">Deductions</div>
${calcDeds.back ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Cracked Back</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.06)}</span></div>` : â€˜â€™}
${calcDeds.lens ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Cracked Lens</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.05)}</span></div>` : â€˜â€™}
${calcDeds.batt ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Battery &lt;80%</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.08)}</span></div>` : â€˜â€™}
${calcDeds.rep ? `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;"><span>Repair Message</span><span style="color:var(--red);font-family:var(--M);">-$${Math.round(atlasVal*0.10)}</span></div>` : â€˜â€™}
<div style="display:flex;justify-content:space-between;font-size:12px;margin-top:5px;padding-top:5px;border-top:1px solid var(--border);"><span>Net After Deductions</span><span style="color:var(--green);font-family:var(--M);">$${netAtlas}</span></div>
</div>`: ''} <div style="padding:14px 16px;"> <div style="font-family:var(--M);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:9px;">All Grades â€” ${model} ${storage}</div> <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:4px;"> ${allGrades.map((x,i) =>`<div style="background:${i===gi?'rgba(232,192,74,.12)':'var(--card2)'};border:1px solid ${i===gi?'var(--gold)':'var(--border2)'};border-radius:2px;padding:8px 4px;text-align:center;cursor:pointer;" onclick="setGrade('${GRADE_KEYS[i]}',document.querySelectorAll('.cbtn')[${i}])">
<div style="font-family:var(--M);font-size:9px;color:${i===gi?'var(--gold)':'var(--muted)'};">${x.g}</div>
<div style="font-family:var(--D);font-size:18px;color:${i===gi?'var(--gold)':'var(--text)'};">$${x.v}</div>
</div>`).join('')} </div> </div> <div style="padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:8px;"> <button class="btn btn-gold" style="flex:1;" onclick="addLeadFromCalc('${model} ${storage}',${maxBuy})">+ Add as Lead</button> <button class="btn btn-ghost btn-sm" onclick="nav('prices')">Price Check</button> </div>`;
}

function addLeadFromCalc(device, maxBuy) {
document.getElementById(â€˜l-deviceâ€™).value = device;
document.getElementById(â€˜l-offerâ€™).value = maxBuy;
openModal(â€˜addLeadâ€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INVENTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveInventory() {
const device = document.getElementById(â€˜i-deviceâ€™).value.trim();
const paid = parseFloat(document.getElementById(â€˜i-paidâ€™).value) || 0;
if (!device) { toast(â€˜Device name requiredâ€™, â€˜errorâ€™); return; }
const item = {
id: uid(), device,
cat: document.getElementById(â€˜i-catâ€™).value,
paid,
target: parseFloat(document.getElementById(â€˜i-targetâ€™).value) || 0,
cond: document.getElementById(â€˜i-condâ€™).value,
sell: document.getElementById(â€˜i-sellâ€™).value,
imei: document.getElementById(â€˜i-imeiâ€™).value.trim(),
notes: document.getElementById(â€˜i-notesâ€™).value.trim(),
added: new Date().toISOString()
};
ST.inventory.unshift(item);
save(); closeModal(â€˜addInventoryâ€™); renderInventory(); toast(â€˜Device added to inventory âœ“â€™);
}

function renderInventory() {
const items = ST.inventory;
const em = document.getElementById(â€˜inv-emptyâ€™);
document.getElementById(â€˜inv-countâ€™).textContent = items.length;
document.getElementById(â€˜inv-investedâ€™).textContent = fmtM(items.reduce((s, i) => s + i.paid, 0));
document.getElementById(â€˜inv-profit-estâ€™).textContent = fmtM(items.reduce((s, i) => s + Math.max(0, (i.target || 0) - i.paid), 0));
if (!items.length) { em.style.display = â€˜â€™; document.getElementById(â€˜inv-gridâ€™).innerHTML = â€˜â€™; return; }
em.style.display = â€˜noneâ€™;
document.getElementById(â€˜inv-gridâ€™).innerHTML = items.map(i => {
const pl = (i.target || 0) - i.paid;
return `<div class="inv-card"> <div style="font-family:var(--M);font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-bottom:3px;">${i.cat}</div> <div style="font-weight:600;font-size:13px;">${i.device}</div> <div style="font-family:var(--M);font-size:10px;color:var(--muted);margin-top:1px;">${i.cond} Â· ${i.sell}</div> <div style="font-family:var(--D);font-size:24px;color:var(--gold);margin-top:8px;">$${i.paid}</div> ${i.target ? `<div style="font-size:11px;margin-top:2px;color:${pl >= 0 ? 'var(--green)' : 'var(--red)'};">Target: $${i.target} (${pl >= 0 ? â€˜+â€™ : â€˜â€™}$${pl})</div>`: ''} ${i.imei ?`<div style="font-family:var(--M);font-size:9px;color:var(--muted);margin-top:5px;">${i.imei}</div>` : ''} <div style="display:flex;gap:5px;margin-top:10px;"> <button class="btn btn-green btn-sm" style="flex:1;" onclick="startSell('${i.id}')">Mark Sold</button> <button class="btn btn-danger btn-sm" onclick="delInventory('${i.id}')">âœ•</button> </div> </div>`;
}).join(â€™â€™);
}

function startSell(id) {
sellItemId = id;
document.getElementById(â€˜s-priceâ€™).value = â€˜â€™;
document.getElementById(â€˜s-buyerâ€™).value = â€˜â€™;
document.getElementById(â€˜s-dateâ€™).value = new Date().toISOString().split(â€˜Tâ€™)[0];
openModal(â€˜sellâ€™);
}

function confirmSell() {
const price = parseFloat(document.getElementById(â€˜s-priceâ€™).value);
if (!price) { toast(â€˜Enter sale priceâ€™, â€˜errorâ€™); return; }
const item = ST.inventory.find(i => i.id === sellItemId);
if (!item) return;
ST.sold.unshift({ â€¦item, soldFor: price, buyer: document.getElementById(â€˜s-buyerâ€™).value, soldDate: document.getElementById(â€˜s-dateâ€™).value });
ST.inventory = ST.inventory.filter(i => i.id !== sellItemId);
save(); closeModal(â€˜sellâ€™); renderInventory(); renderProfits(); toast(`Sold for $${price} â€” profit $${price - item.paid} ğŸ‰`);
}

function delInventory(id) {
if (!confirm(â€˜Remove from inventory?â€™)) return;
ST.inventory = ST.inventory.filter(i => i.id !== id);
save(); renderInventory(); toast(â€˜Removedâ€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveAlert() {
const device = document.getElementById(â€˜a-deviceâ€™).value.trim();
if (!device) { toast(â€˜Device name requiredâ€™, â€˜errorâ€™); return; }
ST.alerts.unshift({ id: uid(), device, maxPrice: parseFloat(document.getElementById(â€˜a-maxpriceâ€™).value) || 0, platform: document.getElementById(â€˜a-platformâ€™).value, added: new Date().toISOString() });
save(); closeModal(â€˜addAlertâ€™); renderAlerts(); counts(); toast(â€˜Alert set âœ“â€™);
}

function renderAlerts() {
const banner = document.getElementById(â€˜email-bannerâ€™);
if (banner) banner.style.display = (KEYS.svc && KEYS.tmpl && KEYS.pubkey) ? â€˜flexâ€™ : â€˜noneâ€™;
const mon = document.getElementById(â€˜alert-monitorsâ€™);
mon.innerHTML = ST.alerts.length ? ST.alerts.map(a => ` <div class="alert-item alert-hot"> <div style="font-size:18px;">ğŸ””</div> <div style="flex:1;"> <div style="font-weight:500;font-size:13px;">${a.device}</div> <div style="font-size:11px;color:var(--muted);">${a.platform} Â· Max $${a.maxPrice || 'Any'}</div> </div> <div style="display:flex;gap:6px;"> <a href="https://www.facebook.com/marketplace/search/?query=${encodeURIComponent(a.device)}" target="_blank" class="btn btn-ghost btn-sm">Search â†’</a> <button class="btn btn-danger btn-sm" onclick="delAlert('${a.id}')">âœ•</button> </div> </div>`).join(â€™â€™) : â€˜<div style="color:var(--muted);font-size:12px;padding:8px 0;">No monitors set yet</div>â€™;

// Demo hits
document.getElementById(â€˜alert-hitsâ€™).innerHTML = ` <div class="alert-item"><div style="font-size:16px;">ğŸ“±</div><div style="flex:1;"><div style="font-weight:500;font-size:13px;">iPhone 14 Pro â€” $340 (demo)</div><div style="font-size:11px;color:var(--muted);">FB Marketplace Â· 2h ago</div></div><a href="https://www.facebook.com/marketplace" target="_blank" class="btn btn-teal btn-sm">View â†’</a></div> <div class="alert-item"><div style="font-size:16px;">ğŸ®</div><div style="flex:1;"><div style="font-weight:500;font-size:13px;">PS5 Disc â€” $280 (demo)</div><div style="font-size:11px;color:var(--muted);">Craigslist Â· 5h ago</div></div><a href="https://craigslist.org" target="_blank" class="btn btn-teal btn-sm">View â†’</a></div>`;
}

function delAlert(id) { ST.alerts = ST.alerts.filter(a => a.id !== id); save(); renderAlerts(); counts(); toast(â€˜Alert removedâ€™); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROFITS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProfits() {
const rev = ST.sold.reduce((s, x) => s + (x.soldFor || 0), 0);
const spent = ST.sold.reduce((s, x) => s + (x.paid || 0), 0);
const net = rev - spent;
const avg = ST.sold.length ? Math.round(net / ST.sold.length) : 0;
document.getElementById(â€˜pr-revâ€™).textContent = fmtM(rev);
document.getElementById(â€˜pr-spentâ€™).textContent = fmtM(spent);
document.getElementById(â€˜pr-netâ€™).textContent = fmtM(net);
document.getElementById(â€˜pr-avgâ€™).textContent = fmtM(avg);
const tb = document.getElementById(â€˜profits-tbodyâ€™);
const em = document.getElementById(â€˜profits-emptyâ€™);
if (!ST.sold.length) { tb.innerHTML = â€˜â€™; em.style.display = â€˜â€™; return; }
em.style.display = â€˜noneâ€™;
tb.innerHTML = ST.sold.map(x => {
const pl = (x.soldFor || 0) - (x.paid || 0);
return `<tr> <td><div style="font-weight:500;">${x.device}</div><div style="font-size:10px;color:var(--muted);">${x.cat}</div></td> <td style="font-family:var(--M);color:var(--red);font-size:12px;">$${x.paid}</td> <td style="font-family:var(--M);color:var(--gold);font-size:12px;">$${x.soldFor}</td> <td style="font-family:var(--M);color:${pl>=0?'var(--green)':'var(--red)'};font-size:12px;">${pl>=0?'+':''}$${pl}</td> <td class="hm" style="font-size:11px;color:var(--muted);">${x.soldDate || 'â€”'}</td> <td class="hm" style="font-size:11px;color:var(--muted);">${x.buyer || 'â€”'}</td> </tr>`;
}).join(â€™â€™);
}

function exportProfits() {
const rows = [[â€˜Deviceâ€™,â€˜Catâ€™,â€˜Paidâ€™,â€˜Sold Forâ€™,â€˜Profitâ€™,â€˜Dateâ€™,â€˜Buyerâ€™]];
ST.sold.forEach(x => rows.push([x.device, x.cat, x.paid, x.soldFor, (x.soldFor||0)-(x.paid||0), x.soldDate, x.buyer]));
dlCSV(â€˜profits.csvâ€™, rows);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadSettingsUI() {
document.getElementById(â€˜s-ebayâ€™).value = KEYS.ebay || â€˜â€™;
document.getElementById(â€˜s-emailâ€™).value = KEYS.email || â€˜â€™;
document.getElementById(â€˜s-svcâ€™).value = KEYS.svc || â€˜â€™;
document.getElementById(â€˜s-tmplâ€™).value = KEYS.tmpl || â€˜â€™;
document.getElementById(â€˜s-pubkeyâ€™).value = KEYS.pubkey || â€˜â€™;
updateKS();
}

function updateKS() {
const ek = document.getElementById(â€˜ebay-ksâ€™);
if (ek) { ek.className = â€™ks â€™ + (KEYS.ebay ? â€˜okâ€™ : â€˜missingâ€™); ek.textContent = KEYS.ebay ? â€˜â— Connectedâ€™ : â€˜â— Not setâ€™; }
const emk = document.getElementById(â€˜email-ksâ€™);
if (emk) { const ok = KEYS.svc && KEYS.tmpl && KEYS.pubkey; emk.className = â€™ks â€™ + (ok ? â€˜okâ€™ : â€˜missingâ€™); emk.textContent = ok ? â€˜â— Configuredâ€™ : â€˜â— Not configuredâ€™; }
}

function saveEbayKey() {
KEYS.ebay = document.getElementById(â€˜s-ebayâ€™).value.trim();
saveKeys(); updateKS(); toast(â€˜eBay key saved ğŸ”‘â€™);
}

async function testEbay() {
if (!KEYS.ebay) { toast(â€˜Add your eBay key firstâ€™, â€˜errorâ€™); return; }
toast(â€˜Testingâ€¦â€™, â€˜infoâ€™);
const token = await getEbayToken();
toast(token ? â€˜eBay API connected âœ“â€™ : â€˜Connection failed â€” check your App IDâ€™, token ? â€˜successâ€™ : â€˜errorâ€™);
}

function saveEmailKeys() {
KEYS.email = document.getElementById(â€˜s-emailâ€™).value.trim();
KEYS.svc = document.getElementById(â€˜s-svcâ€™).value.trim();
KEYS.tmpl = document.getElementById(â€˜s-tmplâ€™).value.trim();
KEYS.pubkey = document.getElementById(â€˜s-pubkeyâ€™).value.trim();
saveKeys(); updateKS();
if (KEYS.pubkey) { try { emailjs.init(KEYS.pubkey); } catch(e) {} }
toast(â€˜Email settings saved âœ“â€™);
}

async function testEmail() {
if (!KEYS.svc || !KEYS.tmpl || !KEYS.pubkey) { toast(â€˜Set up EmailJS keys firstâ€™, â€˜errorâ€™); return; }
try {
await emailjs.send(KEYS.svc, KEYS.tmpl, { to_email: KEYS.email, subject: â€˜Trey Buyback â€” Test Alert ğŸ””â€™, message: â€˜Your email alerts are working! You will receive deal notifications here.â€™ });
toast(â€˜Test email sent! Check your inbox âœ‰â€™);
} catch(e) { toast(â€˜Email failed â€” check your keysâ€™, â€˜errorâ€™); console.error(e); }
}

async function sendDealAlert(device, price, platform, link) {
if (!KEYS.svc || !KEYS.tmpl || !KEYS.pubkey || !KEYS.email) return;
try { await emailjs.send(KEYS.svc, KEYS.tmpl, { to_email: KEYS.email, subject: `ğŸ”” Deal Alert: ${device} at $${price}`, message: `Device: ${device}\nPrice: $${price}\nPlatform: ${platform}\nLink: ${link}` }); }
catch(e) { console.log(â€˜Alert email failedâ€™, e); }
}

function exportAll() {
const data = JSON.stringify({ leads: ST.leads, inventory: ST.inventory, alerts: ST.alerts, sold: ST.sold, exported: new Date().toISOString() }, null, 2);
const a = document.createElement(â€˜aâ€™);
a.href = URL.createObjectURL(new Blob([data], { type: â€˜application/jsonâ€™ }));
a.download = â€˜treybuyback-backup.jsonâ€™; a.click();
toast(â€˜Data exported âœ“â€™);
}

function clearAll() {
if (!confirm(â€˜Delete ALL data? This cannot be undone.â€™)) return;
ST = { leads: [], inventory: [], alerts: [], sold: [] };
save(); renderDash(); counts(); toast(â€˜All data clearedâ€™, â€˜errorâ€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PLAYBOOK HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pbTab(id) {
document.querySelectorAll(â€™.pb-secâ€™).forEach(s => s.classList.remove(â€˜activeâ€™));
document.querySelectorAll(â€™.pb-tabâ€™).forEach(t => t.classList.remove(â€˜activeâ€™));
document.getElementById(â€˜pb-â€™ + id).classList.add(â€˜activeâ€™);
event.target.classList.add(â€˜activeâ€™);
}

function tft(id) {
const el = document.getElementById(id);
el.classList.toggle(â€˜openâ€™);
}

function tsc(el) {
const body = el.nextElementSibling;
body.classList.toggle(â€˜openâ€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CSV EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dlCSV(filename, rows) {
const csv = rows.map(r => r.map(v => `"${(v||'').toString().replace(/"/g,'""')}"`).join(â€™,â€™)).join(â€™\nâ€™);
const a = document.createElement(â€˜aâ€™);
a.href = URL.createObjectURL(new Blob([csv], { type: â€˜text/csvâ€™ }));
a.download = filename; a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>

</body>
</html>
